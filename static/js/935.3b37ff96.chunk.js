/*! For license information please see 935.3b37ff96.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkreact_homework_template=self.webpackChunkreact_homework_template||[]).push([[935],{5854:function(e,t,n){n.d(t,{BH:function(){return A},DV:function(){return J},G6:function(){return F},GJ:function(){return Y},L:function(){return k},LL:function(){return q},P0:function(){return S},Pz:function(){return N},Sg:function(){return P},UI:function(){return $},US:function(){return g},Wl:function(){return W},Yr:function(){return M},ZR:function(){return j},aH:function(){return x},b$:function(){return O},cI:function(){return H},dS:function(){return le},eu:function(){return V},g5:function(){return p},gK:function(){return ce},gQ:function(){return ae},h$:function(){return _},hl:function(){return U},hu:function(){return v},m9:function(){return fe},ne:function(){return oe},p$:function(){return b},pd:function(){return ie},q4:function(){return C},r3:function(){return Q},ru:function(){return D},tV:function(){return w},uI:function(){return Z},ug:function(){return he},vZ:function(){return ee},w1:function(){return L},w9:function(){return G},xO:function(){return ne},xb:function(){return X},z$:function(){return R},zd:function(){return re}});var r=n(7762),i=n(9439),a=n(7326),o=n(3144),s=n(5671),u=n(136),c=n(3668),l=n(8664),h=!1,f=!1,d="${JSCORE_VERSION}",v=function(e,t){if(!e)throw p(t)},p=function(e){return new Error("Firebase Database ("+d+") INTERNAL ASSERT FAILED: "+e)},y=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},g={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var a=e[i],o=i+1<e.length,s=o?e[i+1]:0,u=i+2<e.length,c=u?e[i+2]:0,l=a>>2,h=(3&a)<<4|s>>4,f=(15&s)<<2|c>>6,d=63&c;u||(d=64,o||(f=64)),r.push(n[l],n[h],n[f],n[d])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(y(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){var a=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&a)}else if(i>239&&i<365){var o=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(o>>10)),t[r++]=String.fromCharCode(56320+(1023&o))}else{var s=e[n++],u=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&u)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var a=n[e.charAt(i++)],o=i<e.length?n[e.charAt(i)]:0,s=++i<e.length?n[e.charAt(i)]:64,u=++i<e.length?n[e.charAt(i)]:64;if(++i,null==a||null==o||null==s||null==u)throw new m;var c=a<<2|o>>4;if(r.push(c),64!==s){var l=o<<4&240|s>>2;if(r.push(l),64!==u){var h=s<<6&192|u;r.push(h)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},m=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(){var e;return(0,s.Z)(this,n),(e=t.apply(this,arguments)).name="DecodeBase64StringError",e}return(0,o.Z)(n)}((0,l.Z)(Error)),_=function(e){var t=y(e);return g.encodeByteArray(t,!0)},k=function(e){return _(e).replace(/\./g,"")},w=function(e){try{return g.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function b(e){return I(void 0,e)}function I(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=I(e[n],t[n]));return e}var E=function(){return function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__},T=function(){try{return E()||function(){if("undefined"!==typeof process){var e={NODE_ENV:"production",PUBLIC_URL:"/LearnLingo",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0}}()||function(){if("undefined"!==typeof document){var e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}var t=e&&w(e[1]);return t&&JSON.parse(t)}}()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(e))}},C=function(e){var t,n;return null===(n=null===(t=T())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},S=function(e){var t=C(e);if(t){var n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error("Invalid host ".concat(t," with no separate hostname and port!"));var r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]}},x=function(){var e;return null===(e=T())||void 0===e?void 0:e.config},N=function(e){var t;return null===(t=T())||void 0===t?void 0:t["_".concat(e)]},A=function(){function e(){var t=this;(0,s.Z)(this,e),this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}return(0,o.Z)(e,[{key:"wrapCallback",value:function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"===typeof e&&(t.promise.catch((function(){})),1===e.length?e(n):e(n,r))}}}]),e}();function P(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var a=Object.assign({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[k(JSON.stringify({alg:"none",type:"JWT"})),k(JSON.stringify(a)),""].join(".")}function R(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function Z(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(R())}function D(){var e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}function O(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function L(){var e=R();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function M(){return!0===h||!0===f}function F(){return!function(){var e,t=null===(e=T())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(r){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function U(){try{return"object"===typeof indexedDB}catch(e){return!1}}function V(){return new Promise((function(e,t){try{var n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=function(){i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=function(){n=!1},i.onerror=function(){var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(a){t(a)}}))}var j=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e,r,i){var o;return(0,s.Z)(this,n),(o=t.call(this,r)).code=e,o.customData=i,o.name="FirebaseError",Object.setPrototypeOf((0,a.Z)(o),n.prototype),Error.captureStackTrace&&Error.captureStackTrace((0,a.Z)(o),q.prototype.create),o}return(0,o.Z)(n)}((0,l.Z)(Error)),q=function(){function e(t,n,r){(0,s.Z)(this,e),this.service=t,this.serviceName=n,this.errors=r}return(0,o.Z)(e,[{key:"create",value:function(e){var t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],i=r?B(r,t):"Error",a="".concat(this.serviceName,": ").concat(i," (").concat(n,")."),o=new j(n,a,t);return o}}]),e}();function B(e,t){return e.replace(z,(function(e,n){var r=t[n];return null!=r?String(r):"<".concat(n,"?>")}))}var z=/\{\$([^}]+)}/g;function H(e){return JSON.parse(e)}function W(e){return JSON.stringify(e)}var K=function(e){var t={},n={},r={},i="";try{var a=e.split(".");t=H(w(a[0])||""),n=H(w(a[1])||""),i=a[2],r=n.d||{},delete n.d}catch(o){}return{header:t,claims:n,data:r,signature:i}},G=function(e){var t=K(e).claims;return!!t&&"object"===typeof t&&t.hasOwnProperty("iat")},Y=function(e){var t=K(e).claims;return"object"===typeof t&&!0===t.admin};function Q(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function J(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function X(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function $(e,t,n){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function ee(e,t){if(e===t)return!0;for(var n=Object.keys(e),r=Object.keys(t),i=0,a=n;i<a.length;i++){var o=a[i];if(!r.includes(o))return!1;var s=e[o],u=t[o];if(te(s)&&te(u)){if(!ee(s,u))return!1}else if(s!==u)return!1}for(var c=0,l=r;c<l.length;c++){var h=l[c];if(!n.includes(h))return!1}return!0}function te(e){return null!==e&&"object"===typeof e}function ne(e){for(var t=[],n=function(){var e=(0,i.Z)(a[r],2),n=e[0],o=e[1];Array.isArray(o)?o.forEach((function(e){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(o))},r=0,a=Object.entries(e);r<a.length;r++)n();return t.length?"&"+t.join("&"):""}function re(e){var t={};return e.replace(/^\?/,"").split("&").forEach((function(e){if(e){var n=e.split("="),r=(0,i.Z)(n,2),a=r[0],o=r[1];t[decodeURIComponent(a)]=decodeURIComponent(o)}})),t}function ie(e){var t=e.indexOf("?");if(!t)return"";var n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}var ae=function(){function e(){(0,s.Z)(this,e),this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}return(0,o.Z)(e,[{key:"reset",value:function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}},{key:"compress_",value:function(e,t){t||(t=0);var n=this.W_;if("string"===typeof e)for(var r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(var i=0;i<16;i++)n[i]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(var a=16;a<80;a++){var o=n[a-3]^n[a-8]^n[a-14]^n[a-16];n[a]=4294967295&(o<<1|o>>>31)}for(var s,u,c=this.chain_[0],l=this.chain_[1],h=this.chain_[2],f=this.chain_[3],d=this.chain_[4],v=0;v<80;v++){v<40?v<20?(s=f^l&(h^f),u=1518500249):(s=l^h^f,u=1859775393):v<60?(s=l&h|f&(l|h),u=2400959708):(s=l^h^f,u=3395469782);var p=(c<<5|c>>>27)+s+d+u+n[v]&4294967295;d=f,f=h,h=4294967295&(l<<30|l>>>2),l=c,c=p}this.chain_[0]=this.chain_[0]+c&4294967295,this.chain_[1]=this.chain_[1]+l&4294967295,this.chain_[2]=this.chain_[2]+h&4294967295,this.chain_[3]=this.chain_[3]+f&4294967295,this.chain_[4]=this.chain_[4]+d&4294967295}},{key:"update",value:function(e,t){if(null!=e){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=0,i=this.buf_,a=this.inbuf_;r<t;){if(0===a)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"===typeof e){for(;r<t;)if(i[a]=e.charCodeAt(r),++r,++a===this.blockSize){this.compress_(i),a=0;break}}else for(;r<t;)if(i[a]=e[r],++r,++a===this.blockSize){this.compress_(i),a=0;break}}this.inbuf_=a,this.total_+=t}}},{key:"digest",value:function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);for(var r=0,i=0;i<5;i++)for(var a=24;a>=0;a-=8)e[r]=this.chain_[i]>>a&255,++r;return e}}]),e}();function oe(e,t){var n=new se(e,t);return n.subscribe.bind(n)}var se=function(){function e(t,n){var r=this;(0,s.Z)(this,e),this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then((function(){t(r)})).catch((function(e){r.error(e)}))}return(0,o.Z)(e,[{key:"next",value:function(e){this.forEachObserver((function(t){t.next(e)}))}},{key:"error",value:function(e){this.forEachObserver((function(t){t.error(e)})),this.close(e)}},{key:"complete",value:function(){this.forEachObserver((function(e){e.complete()})),this.close()}},{key:"subscribe",value:function(e,t,n){var i,a=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(i=function(e,t){if("object"!==typeof e||null===e)return!1;var n,i=(0,r.Z)(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a in e&&"function"===typeof e[a])return!0}}catch(o){i.e(o)}finally{i.f()}return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n}).next&&(i.next=ue),void 0===i.error&&(i.error=ue),void 0===i.complete&&(i.complete=ue);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{a.finalError?i.error(a.finalError):i.complete()}catch(e){}})),this.observers.push(i),o}},{key:"unsubscribeOne",value:function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}},{key:"forEachObserver",value:function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)}},{key:"sendOne",value:function(e,t){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(r){"undefined"!==typeof console&&console.error&&console.error(r)}}))}},{key:"close",value:function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((function(){t.observers=void 0,t.onNoObservers=void 0})))}}]),e}();function ue(){}function ce(e,t){return"".concat(e," failed: ").concat(t," argument ")}var le=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);if(i>=55296&&i<=56319){var a=i-55296;r++,v(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(a<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},he=function(e){for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function fe(e){return e&&e._delegate?e._delegate:e}},5861:function(e,t,n){function r(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){r(o,i,a,s,u,"next",e)}function u(e){r(o,i,a,s,u,"throw",e)}s(void 0)}))}}n.d(t,{Z:function(){return i}})},4942:function(e,t,n){function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{Z:function(){return r}})},1752:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(1120);function i(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=(0,r.Z)(e)););return e}function a(){return a="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=i(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},a.apply(this,arguments)}},9383:function(e,t,n){n.d(t,{Jn:function(){return K},qX:function(){return B},Xd:function(){return q},Mq:function(){return Y},ZF:function(){return G},KN:function(){return Q}});var r=n(3433),i=n(5861),a=n(7762),o=n(4942),s=n(5671),u=n(3144),c=n(7757),l=n(3258),h=n(6781),f=n(5854);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p,y;var g=new WeakMap,m=new WeakMap,_=new WeakMap,k=new WeakMap,w=new WeakMap;var b={get:function(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return m.get(e);if("objectStoreNames"===t)return e.objectStoreNames||_.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return T(e[t])},set:function(e,t,n){return e[t]=n,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function I(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(y||(y=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(C(this),n),T(g.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return T(e.apply(C(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var a=e.call.apply(e,[C(this),t].concat(r));return _.set(a,t.sort?t.sort():[t]),T(a)}}function E(e){return"function"===typeof e?I(e):(e instanceof IDBTransaction&&function(e){if(!m.has(e)){var t=new Promise((function(t,n){var r=function(){e.removeEventListener("complete",i),e.removeEventListener("error",a),e.removeEventListener("abort",a)},i=function(){t(),r()},a=function(){n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",a),e.addEventListener("abort",a)}));m.set(e,t)}}(e),t=e,(p||(p=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((function(e){return t instanceof e}))?new Proxy(e,b):e);var t}function T(e){if(e instanceof IDBRequest)return function(e){var t=new Promise((function(t,n){var r=function(){e.removeEventListener("success",i),e.removeEventListener("error",a)},i=function(){t(T(e.result)),r()},a=function(){n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",a)}));return t.then((function(t){t instanceof IDBCursor&&g.set(t,e)})).catch((function(){})),w.set(t,e),t}(e);if(k.has(e))return k.get(e);var t=E(e);return t!==e&&(k.set(e,t),w.set(t,e)),t}var C=function(e){return w.get(e)};var S,x,N=["get","getKey","getAll","getAllKeys","count"],A=["put","add","delete","clear"],P=new Map;function R(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"===typeof t){if(P.get(t))return P.get(t);var n=t.replace(/FromIndex$/,""),r=t!==n,a=A.includes(n);if(n in(r?IDBIndex:IDBObjectStore).prototype&&(a||N.includes(n))){var o=function(){var e=(0,i.Z)(c.mark((function e(t){var i,o,s,u,l,h,f=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=this.transaction(t,a?"readwrite":"readonly"),s=o.store,u=f.length,l=new Array(u>1?u-1:0),h=1;h<u;h++)l[h-1]=f[h];return r&&(s=s.index(l.shift())),e.next=6,Promise.all([(i=s)[n].apply(i,l),a&&o.done]);case 6:return e.abrupt("return",e.sent[0]);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();return P.set(t,o),o}}}b=function(e){return v(v({},e),{},{get:function(t,n,r){return R(t,n)||e.get(t,n,r)},has:function(t,n){return!!R(t,n)||e.has(t,n)}})}(b);var Z=function(){function e(t){(0,s.Z)(this,e),this.container=t}return(0,u.Z)(e,[{key:"getPlatformInfoString",value:function(){return this.container.getProviders().map((function(e){if(function(e){var t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){var t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null})).filter((function(e){return e})).join(" ")}}]),e}();var D="@firebase/app",O="0.9.28",L=new h.Yd("@firebase/app"),M="[DEFAULT]",F=(S={},(0,o.Z)(S,D,"fire-core"),(0,o.Z)(S,"@firebase/app-compat","fire-core-compat"),(0,o.Z)(S,"@firebase/analytics","fire-analytics"),(0,o.Z)(S,"@firebase/analytics-compat","fire-analytics-compat"),(0,o.Z)(S,"@firebase/app-check","fire-app-check"),(0,o.Z)(S,"@firebase/app-check-compat","fire-app-check-compat"),(0,o.Z)(S,"@firebase/auth","fire-auth"),(0,o.Z)(S,"@firebase/auth-compat","fire-auth-compat"),(0,o.Z)(S,"@firebase/database","fire-rtdb"),(0,o.Z)(S,"@firebase/database-compat","fire-rtdb-compat"),(0,o.Z)(S,"@firebase/functions","fire-fn"),(0,o.Z)(S,"@firebase/functions-compat","fire-fn-compat"),(0,o.Z)(S,"@firebase/installations","fire-iid"),(0,o.Z)(S,"@firebase/installations-compat","fire-iid-compat"),(0,o.Z)(S,"@firebase/messaging","fire-fcm"),(0,o.Z)(S,"@firebase/messaging-compat","fire-fcm-compat"),(0,o.Z)(S,"@firebase/performance","fire-perf"),(0,o.Z)(S,"@firebase/performance-compat","fire-perf-compat"),(0,o.Z)(S,"@firebase/remote-config","fire-rc"),(0,o.Z)(S,"@firebase/remote-config-compat","fire-rc-compat"),(0,o.Z)(S,"@firebase/storage","fire-gcs"),(0,o.Z)(S,"@firebase/storage-compat","fire-gcs-compat"),(0,o.Z)(S,"@firebase/firestore","fire-fst"),(0,o.Z)(S,"@firebase/firestore-compat","fire-fst-compat"),(0,o.Z)(S,"fire-js","fire-js"),(0,o.Z)(S,"firebase","fire-js-all"),S),U=new Map,V=new Map;function j(e,t){try{e.container.addComponent(t)}catch(n){L.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function q(e){var t=e.name;if(V.has(t))return L.debug("There were multiple attempts to register component ".concat(t,".")),!1;V.set(t,e);var n,r=(0,a.Z)(U.values());try{for(r.s();!(n=r.n()).done;){j(n.value,e)}}catch(i){r.e(i)}finally{r.f()}return!0}function B(e,t){var n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}var z=(x={},(0,o.Z)(x,"no-app","No Firebase App '{$appName}' has been created - call initializeApp() first"),(0,o.Z)(x,"bad-app-name","Illegal App name: '{$appName}"),(0,o.Z)(x,"duplicate-app","Firebase App named '{$appName}' already exists with different options or config"),(0,o.Z)(x,"app-deleted","Firebase App named '{$appName}' already deleted"),(0,o.Z)(x,"no-options","Need to provide options, when not being deployed to hosting via source."),(0,o.Z)(x,"invalid-app-argument","firebase.{$appName}() takes either no argument or a Firebase App instance."),(0,o.Z)(x,"invalid-log-argument","First argument to `onLog` must be null or a function."),(0,o.Z)(x,"idb-open","Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}."),(0,o.Z)(x,"idb-get","Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}."),(0,o.Z)(x,"idb-set","Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}."),(0,o.Z)(x,"idb-delete","Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."),x),H=new f.LL("app","Firebase",z),W=function(){function e(t,n,r){var i=this;(0,s.Z)(this,e),this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new l.wA("app",(function(){return i}),"PUBLIC"))}return(0,u.Z)(e,[{key:"automaticDataCollectionEnabled",get:function(){return this.checkDestroyed(),this._automaticDataCollectionEnabled},set:function(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}},{key:"name",get:function(){return this.checkDestroyed(),this._name}},{key:"options",get:function(){return this.checkDestroyed(),this._options}},{key:"config",get:function(){return this.checkDestroyed(),this._config}},{key:"container",get:function(){return this._container}},{key:"isDeleted",get:function(){return this._isDeleted},set:function(e){this._isDeleted=e}},{key:"checkDestroyed",value:function(){if(this.isDeleted)throw H.create("app-deleted",{appName:this._name})}}]),e}(),K="10.8.1";function G(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){var r=t;t={name:r}}var i=Object.assign({name:M,automaticDataCollectionEnabled:!1},t),o=i.name;if("string"!==typeof o||!o)throw H.create("bad-app-name",{appName:String(o)});if(n||(n=(0,f.aH)()),!n)throw H.create("no-options");var s=U.get(o);if(s){if((0,f.vZ)(n,s.options)&&(0,f.vZ)(i,s.config))return s;throw H.create("duplicate-app",{appName:o})}var u,c=new l.H0(o),h=(0,a.Z)(V.values());try{for(h.s();!(u=h.n()).done;){var d=u.value;c.addComponent(d)}}catch(p){h.e(p)}finally{h.f()}var v=new W(n,i,c);return U.set(o,v),v}function Y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=U.get(e);if(!t&&e===M&&(0,f.aH)())return G();if(!t)throw H.create("no-app",{appName:e});return t}function Q(e,t,n){var r,i=null!==(r=F[e])&&void 0!==r?r:e;n&&(i+="-".concat(n));var a=i.match(/\s|\//),o=t.match(/\s|\//);if(a||o){var s=['Unable to register library "'.concat(i,'" with version "').concat(t,'":')];return a&&s.push('library name "'.concat(i,'" contains illegal characters (whitespace or "/")')),a&&o&&s.push("and"),o&&s.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void L.warn(s.join(" "))}q(new l.wA("".concat(i,"-version"),(function(){return{library:i,version:t}}),"VERSION"))}var J="firebase-heartbeat-store",X=null;function $(){return X||(X=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.blocked,i=n.upgrade,a=n.blocking,o=n.terminated,s=indexedDB.open(e,t),u=T(s);return i&&s.addEventListener("upgradeneeded",(function(e){i(T(s.result),e.oldVersion,e.newVersion,T(s.transaction),e)})),r&&s.addEventListener("blocked",(function(e){return r(e.oldVersion,e.newVersion,e)})),u.then((function(e){o&&e.addEventListener("close",(function(){return o()})),a&&e.addEventListener("versionchange",(function(e){return a(e.oldVersion,e.newVersion,e)}))})).catch((function(){})),u}("firebase-heartbeat-database",1,{upgrade:function(e,t){if(0===t)try{e.createObjectStore(J)}catch(n){console.warn(n)}}}).catch((function(e){throw H.create("idb-open",{originalErrorMessage:e.message})}))),X}function ee(e){return te.apply(this,arguments)}function te(){return(te=(0,i.Z)(c.mark((function e(t){var n,r,i,a;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,$();case 3:return n=e.sent,r=n.transaction(J),e.next=7,r.objectStore(J).get(ie(t));case 7:return i=e.sent,e.next=10,r.done;case 10:return e.abrupt("return",i);case 13:e.prev=13,e.t0=e.catch(0),e.t0 instanceof f.ZR?L.warn(e.t0.message):(a=H.create("idb-get",{originalErrorMessage:null===e.t0||void 0===e.t0?void 0:e.t0.message}),L.warn(a.message));case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}function ne(e,t){return re.apply(this,arguments)}function re(){return(re=(0,i.Z)(c.mark((function e(t,n){var r,i,a,o;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,$();case 3:return r=e.sent,i=r.transaction(J,"readwrite"),a=i.objectStore(J),e.next=8,a.put(n,ie(t));case 8:return e.next=10,i.done;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),e.t0 instanceof f.ZR?L.warn(e.t0.message):(o=H.create("idb-set",{originalErrorMessage:null===e.t0||void 0===e.t0?void 0:e.t0.message}),L.warn(o.message));case 15:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}function ie(e){return"".concat(e.name,"!").concat(e.options.appId)}var ae=function(){function e(t){var n=this;(0,s.Z)(this,e),this.container=t,this._heartbeatsCache=null;var r=this.container.getProvider("app").getImmediate();this._storage=new ce(r),this._heartbeatsCachePromise=this._storage.read().then((function(e){return n._heartbeatsCache=e,e}))}return(0,u.Z)(e,[{key:"triggerHeartbeat",value:function(){var e=(0,i.Z)(c.mark((function e(){var t,n,r,i,a;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.container.getProvider("platform-logger").getImmediate(),i=r.getPlatformInfoString(),a=oe(),null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)){e.next=9;break}return e.next=6,this._heartbeatsCachePromise;case 6:if(this._heartbeatsCache=e.sent,null!=(null===(n=this._heartbeatsCache)||void 0===n?void 0:n.heartbeats)){e.next=9;break}return e.abrupt("return");case 9:if(this._heartbeatsCache.lastSentHeartbeatDate!==a&&!this._heartbeatsCache.heartbeats.some((function(e){return e.date===a}))){e.next=13;break}return e.abrupt("return");case 13:this._heartbeatsCache.heartbeats.push({date:a,agent:i});case 14:return this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((function(e){var t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),e.abrupt("return",this._storage.overwrite(this._heartbeatsCache));case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getHeartbeatsHeader",value:function(){var e=(0,i.Z)(c.mark((function e(){var t,n,r,i,a,o;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._heartbeatsCache){e.next=3;break}return e.next=3,this._heartbeatsCachePromise;case 3:if(null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)&&0!==this._heartbeatsCache.heartbeats.length){e.next=5;break}return e.abrupt("return","");case 5:if(n=oe(),r=se(this._heartbeatsCache.heartbeats),i=r.heartbeatsToSend,a=r.unsentEntries,o=(0,f.L)(JSON.stringify({version:2,heartbeats:i})),this._heartbeatsCache.lastSentHeartbeatDate=n,!(a.length>0)){e.next=15;break}return this._heartbeatsCache.heartbeats=a,e.next=13,this._storage.overwrite(this._heartbeatsCache);case 13:e.next=17;break;case 15:this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache);case 17:return e.abrupt("return",o);case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function oe(){return(new Date).toISOString().substring(0,10)}function se(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024,r=[],i=e.slice(),o=(0,a.Z)(e);try{var s=function(){var e=t.value,a=r.find((function(t){return t.agent===e.agent}));if(a){if(a.dates.push(e.date),le(r)>n)return a.dates.pop(),"break"}else if(r.push({agent:e.agent,dates:[e.date]}),le(r)>n)return r.pop(),"break";i=i.slice(1)};for(o.s();!(t=o.n()).done;){var u=s();if("break"===u)break}}catch(c){o.e(c)}finally{o.f()}return{heartbeatsToSend:r,unsentEntries:i}}var ue,ce=function(){function e(t){(0,s.Z)(this,e),this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}return(0,u.Z)(e,[{key:"runIndexedDBEnvironmentCheck",value:function(){var e=(0,i.Z)(c.mark((function e(){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,f.hl)()){e.next=4;break}return e.abrupt("return",!1);case 4:return e.abrupt("return",(0,f.eu)().then((function(){return!0})).catch((function(){return!1})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"read",value:function(){var e=(0,i.Z)(c.mark((function e(){var t;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canUseIndexedDBPromise;case 2:if(e.sent){e.next=7;break}return e.abrupt("return",{heartbeats:[]});case 7:return e.next=9,ee(this.app);case 9:if(!(null===(t=e.sent)||void 0===t?void 0:t.heartbeats)){e.next=14;break}return e.abrupt("return",t);case 14:return e.abrupt("return",{heartbeats:[]});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"overwrite",value:function(){var e=(0,i.Z)(c.mark((function e(t){var n,r;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canUseIndexedDBPromise;case 2:if(e.sent){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.read();case 9:return r=e.sent,e.abrupt("return",ne(this.app,{lastSentHeartbeatDate:null!==(n=t.lastSentHeartbeatDate)&&void 0!==n?n:r.lastSentHeartbeatDate,heartbeats:t.heartbeats}));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"add",value:function(){var e=(0,i.Z)(c.mark((function e(t){var n,i;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canUseIndexedDBPromise;case 2:if(e.sent){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.read();case 9:return i=e.sent,e.abrupt("return",ne(this.app,{lastSentHeartbeatDate:null!==(n=t.lastSentHeartbeatDate)&&void 0!==n?n:i.lastSentHeartbeatDate,heartbeats:[].concat((0,r.Z)(i.heartbeats),(0,r.Z)(t.heartbeats))}));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function le(e){return(0,f.L)(JSON.stringify({version:2,heartbeats:e})).length}ue="",q(new l.wA("platform-logger",(function(e){return new Z(e)}),"PRIVATE")),q(new l.wA("heartbeat",(function(e){return new ae(e)}),"PRIVATE")),Q(D,O,ue),Q(D,O,"esm2017"),Q("fire-js","")},3258:function(e,t,n){n.d(t,{H0:function(){return v},wA:function(){return h}});var r=n(3433),i=n(5861),a=n(9439),o=n(7762),s=n(5671),u=n(3144),c=n(7757),l=n(5854),h=function(){function e(t,n,r){(0,s.Z)(this,e),this.name=t,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return(0,u.Z)(e,[{key:"setInstantiationMode",value:function(e){return this.instantiationMode=e,this}},{key:"setMultipleInstances",value:function(e){return this.multipleInstances=e,this}},{key:"setServiceProps",value:function(e){return this.serviceProps=e,this}},{key:"setInstanceCreatedCallback",value:function(e){return this.onInstanceCreated=e,this}}]),e}(),f="[DEFAULT]",d=function(){function e(t,n){(0,s.Z)(this,e),this.name=t,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}return(0,u.Z)(e,[{key:"get",value:function(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var n=new l.BH;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch(i){}}return this.instancesDeferred.get(t).promise}},{key:"getImmediate",value:function(e){var t,n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}},{key:"getComponent",value:function(){return this.component}},{key:"setComponent",value:function(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:f})}catch(l){}var t,n=(0,o.Z)(this.instancesDeferred.entries());try{for(n.s();!(t=n.n()).done;){var r=(0,a.Z)(t.value,2),i=r[0],s=r[1],u=this.normalizeInstanceIdentifier(i);try{var c=this.getOrInitializeService({instanceIdentifier:u});s.resolve(c)}catch(l){}}}catch(h){n.e(h)}finally{n.f()}}}},{key:"clearInstance",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}},{key:"delete",value:function(){var e=(0,i.Z)(c.mark((function e(){var t;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Array.from(this.instances.values()),e.next=3,Promise.all([].concat((0,r.Z)(t.filter((function(e){return"INTERNAL"in e})).map((function(e){return e.INTERNAL.delete()}))),(0,r.Z)(t.filter((function(e){return"_delete"in e})).map((function(e){return e._delete()})))));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isComponentSet",value:function(){return null!=this.component}},{key:"isInitialized",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;return this.instances.has(e)}},{key:"getOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;return this.instancesOptions.get(e)||{}}},{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.options,n=void 0===t?{}:t,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error("".concat(this.name,"(").concat(r,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));var i,s=this.getOrInitializeService({instanceIdentifier:r,options:n}),u=(0,o.Z)(this.instancesDeferred.entries());try{for(u.s();!(i=u.n()).done;){var c=(0,a.Z)(i.value,2),l=c[0],h=c[1],f=this.normalizeInstanceIdentifier(l);r===f&&h.resolve(s)}}catch(d){u.e(d)}finally{u.f()}return s}},{key:"onInit",value:function(e,t){var n,r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);var a=this.instances.get(r);return a&&e(a,r),function(){i.delete(e)}}},{key:"invokeOnInitCallbacks",value:function(e,t){var n=this.onInitCallbacks.get(t);if(n){var r,i=(0,o.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;try{a(e,t)}catch(s){}}}catch(u){i.e(u)}finally{i.f()}}}},{key:"getOrInitializeService",value:function(e){var t,n=e.instanceIdentifier,r=e.options,i=void 0===r?{}:r,a=this.instances.get(n);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:(t=n,t===f?void 0:t),options:i}),this.instances.set(n,a),this.instancesOptions.set(n,i),this.invokeOnInitCallbacks(a,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,a)}catch(o){}return a||null}},{key:"normalizeInstanceIdentifier",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;return this.component?this.component.multipleInstances?e:f:e}},{key:"shouldAutoInitialize",value:function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}]),e}();var v=function(){function e(t){(0,s.Z)(this,e),this.name=t,this.providers=new Map}return(0,u.Z)(e,[{key:"addComponent",value:function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}},{key:"addOrOverwriteComponent",value:function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}},{key:"getProvider",value:function(e){if(this.providers.has(e))return this.providers.get(e);var t=new d(e,this);return this.providers.set(e,t),t}},{key:"getProviders",value:function(){return Array.from(this.providers.values())}}]),e}()},6781:function(e,t,n){n.d(t,{Yd:function(){return d},in:function(){return i}});var r,i,a=n(5671),o=n(3144),s=n(4942),u=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i||(i={}));var c={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},l=i.INFO,h=(r={},(0,s.Z)(r,i.DEBUG,"log"),(0,s.Z)(r,i.VERBOSE,"log"),(0,s.Z)(r,i.INFO,"info"),(0,s.Z)(r,i.WARN,"warn"),(0,s.Z)(r,i.ERROR,"error"),r),f=function(e,t){if(!(t<e.logLevel)){var n=(new Date).toISOString(),r=h[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var i,a=arguments.length,o=new Array(a>2?a-2:0),s=2;s<a;s++)o[s-2]=arguments[s];(i=console)[r].apply(i,["[".concat(n,"]  ").concat(e.name,":")].concat(o))}},d=function(){function e(t){(0,a.Z)(this,e),this.name=t,this._logLevel=l,this._logHandler=f,this._userLogHandler=null,u.push(this)}return(0,o.Z)(e,[{key:"logLevel",get:function(){return this._logLevel},set:function(e){if(!(e in i))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}},{key:"setLogLevel",value:function(e){this._logLevel="string"===typeof e?c[e]:e}},{key:"logHandler",get:function(){return this._logHandler},set:function(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}},{key:"userLogHandler",get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.DEBUG].concat(t)),this._logHandler.apply(this,[this,i.DEBUG].concat(t))}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.VERBOSE].concat(t)),this._logHandler.apply(this,[this,i.VERBOSE].concat(t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.INFO].concat(t)),this._logHandler.apply(this,[this,i.INFO].concat(t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.WARN].concat(t)),this._logHandler.apply(this,[this,i.WARN].concat(t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.ERROR].concat(t)),this._logHandler.apply(this,[this,i.ERROR].concat(t))}}]),e}()},4702:function(e,t,n){n.d(t,{ZF:function(){return r.ZF}});var r=n(9383);(0,r.KN)("firebase","10.8.1","app")},3385:function(e,t,n){n.d(t,{Xb:function(){return sn},v0:function(){return si},Aj:function(){return fn},e5:function(){return cn}});var r,i=n(1752),a=n(1120),o=n(7326),s=n(136),u=n(3668),c=n(9439),l=n(7762),h=n(5861),f=n(5671),d=n(3144),v=n(3433),p=n(4942),y=n(7757),g=n.n(y),m=n(5854),_=n(9383),k=n(6781),w=n(9388),b=n(3258);function I(){return(0,p.Z)({},"dependent-sdk-initialized-before-auth","Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.")}var E=I,T=new m.LL("auth","Firebase",I()),C=new k.Yd("@firebase/auth");function S(e){if(C.logLevel<=k.in.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];C.warn.apply(C,["Auth (".concat(_.Jn,"): ").concat(e)].concat(n))}}function x(e){if(C.logLevel<=k.in.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];C.error.apply(C,["Auth (".concat(_.Jn,"): ").concat(e)].concat(n))}}function N(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw R.apply(void 0,[e].concat(n))}function A(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return R.apply(void 0,[e].concat(n))}function P(e,t,n){var r=Object.assign(Object.assign({},E()),(0,p.Z)({},t,n));return new m.LL("auth","Firebase",r).create(t,{appName:e.name})}function R(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("string"!==typeof e){var i,a=n[0],o=(0,v.Z)(n.slice(1));return o[0]&&(o[0].appName=e.name),(i=e._errorFactory).create.apply(i,[a].concat((0,v.Z)(o)))}return T.create.apply(T,[e].concat(n))}function Z(e,t){if(!e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];throw R.apply(void 0,[t].concat(r))}}function D(e){var t="INTERNAL ASSERTION FAILED: "+e;throw x(t),new Error(t)}function O(e,t){e||D(t)}function L(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function M(){return"http:"===F()||"https:"===F()}function F(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}var U=function(){function e(t,n){(0,f.Z)(this,e),this.shortDelay=t,this.longDelay=n,O(n>t,"Short delay should be less than long delay!"),this.isMobile=(0,m.uI)()||(0,m.b$)()}return(0,d.Z)(e,[{key:"get",value:function(){return"undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(M()||(0,m.ru)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}]),e}();function V(e,t){O(e.emulator,"Emulator should always be set here");var n=e.emulator.url;return t?"".concat(n).concat(t.startsWith("/")?t.slice(1):t):n}var j=function(){function e(){(0,f.Z)(this,e)}return(0,d.Z)(e,null,[{key:"initialize",value:function(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}},{key:"fetch",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void D("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}))},{key:"headers",value:function(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void D("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}},{key:"response",value:function(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void D("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}]),e}(),q=(r={},(0,p.Z)(r,"CREDENTIAL_MISMATCH","custom-token-mismatch"),(0,p.Z)(r,"MISSING_CUSTOM_TOKEN","internal-error"),(0,p.Z)(r,"INVALID_IDENTIFIER","invalid-email"),(0,p.Z)(r,"MISSING_CONTINUE_URI","internal-error"),(0,p.Z)(r,"INVALID_PASSWORD","wrong-password"),(0,p.Z)(r,"MISSING_PASSWORD","missing-password"),(0,p.Z)(r,"INVALID_LOGIN_CREDENTIALS","invalid-credential"),(0,p.Z)(r,"EMAIL_EXISTS","email-already-in-use"),(0,p.Z)(r,"PASSWORD_LOGIN_DISABLED","operation-not-allowed"),(0,p.Z)(r,"INVALID_IDP_RESPONSE","invalid-credential"),(0,p.Z)(r,"INVALID_PENDING_TOKEN","invalid-credential"),(0,p.Z)(r,"FEDERATED_USER_ID_ALREADY_LINKED","credential-already-in-use"),(0,p.Z)(r,"MISSING_REQ_TYPE","internal-error"),(0,p.Z)(r,"EMAIL_NOT_FOUND","user-not-found"),(0,p.Z)(r,"RESET_PASSWORD_EXCEED_LIMIT","too-many-requests"),(0,p.Z)(r,"EXPIRED_OOB_CODE","expired-action-code"),(0,p.Z)(r,"INVALID_OOB_CODE","invalid-action-code"),(0,p.Z)(r,"MISSING_OOB_CODE","internal-error"),(0,p.Z)(r,"CREDENTIAL_TOO_OLD_LOGIN_AGAIN","requires-recent-login"),(0,p.Z)(r,"INVALID_ID_TOKEN","invalid-user-token"),(0,p.Z)(r,"TOKEN_EXPIRED","user-token-expired"),(0,p.Z)(r,"USER_NOT_FOUND","user-token-expired"),(0,p.Z)(r,"TOO_MANY_ATTEMPTS_TRY_LATER","too-many-requests"),(0,p.Z)(r,"PASSWORD_DOES_NOT_MEET_REQUIREMENTS","password-does-not-meet-requirements"),(0,p.Z)(r,"INVALID_CODE","invalid-verification-code"),(0,p.Z)(r,"INVALID_SESSION_INFO","invalid-verification-id"),(0,p.Z)(r,"INVALID_TEMPORARY_PROOF","invalid-credential"),(0,p.Z)(r,"MISSING_SESSION_INFO","missing-verification-id"),(0,p.Z)(r,"SESSION_EXPIRED","code-expired"),(0,p.Z)(r,"MISSING_ANDROID_PACKAGE_NAME","missing-android-pkg-name"),(0,p.Z)(r,"UNAUTHORIZED_DOMAIN","unauthorized-continue-uri"),(0,p.Z)(r,"INVALID_OAUTH_CLIENT_ID","invalid-oauth-client-id"),(0,p.Z)(r,"ADMIN_ONLY_OPERATION","admin-restricted-operation"),(0,p.Z)(r,"INVALID_MFA_PENDING_CREDENTIAL","invalid-multi-factor-session"),(0,p.Z)(r,"MFA_ENROLLMENT_NOT_FOUND","multi-factor-info-not-found"),(0,p.Z)(r,"MISSING_MFA_ENROLLMENT_ID","missing-multi-factor-info"),(0,p.Z)(r,"MISSING_MFA_PENDING_CREDENTIAL","missing-multi-factor-session"),(0,p.Z)(r,"SECOND_FACTOR_EXISTS","second-factor-already-in-use"),(0,p.Z)(r,"SECOND_FACTOR_LIMIT_EXCEEDED","maximum-second-factor-count-exceeded"),(0,p.Z)(r,"BLOCKING_FUNCTION_ERROR_RESPONSE","internal-error"),(0,p.Z)(r,"RECAPTCHA_NOT_ENABLED","recaptcha-not-enabled"),(0,p.Z)(r,"MISSING_RECAPTCHA_TOKEN","missing-recaptcha-token"),(0,p.Z)(r,"INVALID_RECAPTCHA_TOKEN","invalid-recaptcha-token"),(0,p.Z)(r,"INVALID_RECAPTCHA_ACTION","invalid-recaptcha-action"),(0,p.Z)(r,"MISSING_CLIENT_TYPE","missing-client-type"),(0,p.Z)(r,"MISSING_RECAPTCHA_VERSION","missing-recaptcha-version"),(0,p.Z)(r,"INVALID_RECAPTCHA_VERSION","invalid-recaptcha-version"),(0,p.Z)(r,"INVALID_REQ_TYPE","invalid-req-type"),r),B=new U(3e4,6e4);function z(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}function H(e,t,n,r){return W.apply(this,arguments)}function W(){return W=(0,h.Z)(g().mark((function e(t,n,r,i){var a,o=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>4&&void 0!==o[4]?o[4]:{},e.abrupt("return",K(t,a,(0,h.Z)(g().mark((function e(){var a,o,s,u;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={},o={},i&&("GET"===n?o=i:a={body:JSON.stringify(i)}),s=(0,m.xO)(Object.assign({key:t.config.apiKey},o)).slice(1),e.next=6,t._getAdditionalHeaders();case 6:return(u=e.sent)["Content-Type"]="application/json",t.languageCode&&(u["X-Firebase-Locale"]=t.languageCode),e.abrupt("return",j.fetch()(J(t,t.config.apiHost,r,s),Object.assign({method:n,headers:u,referrerPolicy:"no-referrer"},a)));case 10:case"end":return e.stop()}}),e)})))));case 2:case"end":return e.stop()}}),e)}))),W.apply(this,arguments)}function K(e,t,n){return G.apply(this,arguments)}function G(){return(G=(0,h.Z)(g().mark((function e(t,n,r){var i,a,o,s,u,l,h,f,d,v;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t._canInitEmulator=!1,i=Object.assign(Object.assign({},q),n),e.prev=2,a=new $(t),e.next=6,Promise.race([r(),a.promise]);case 6:return o=e.sent,a.clearNetworkTimeout(),e.next=10,o.json();case 10:if(!("needConfirmation"in(s=e.sent))){e.next=13;break}throw ee(t,"account-exists-with-different-credential",s);case 13:if(!o.ok||"errorMessage"in s){e.next=17;break}return e.abrupt("return",s);case 17:if(u=o.ok?s.errorMessage:s.error.message,l=u.split(" : "),h=(0,c.Z)(l,2),f=h[0],d=h[1],"FEDERATED_USER_ID_ALREADY_LINKED"!==f){e.next=23;break}throw ee(t,"credential-already-in-use",s);case 23:if("EMAIL_EXISTS"!==f){e.next=27;break}throw ee(t,"email-already-in-use",s);case 27:if("USER_DISABLED"!==f){e.next=29;break}throw ee(t,"user-disabled",s);case 29:if(v=i[f]||f.toLowerCase().replace(/[_\s]+/g,"-"),!d){e.next=34;break}throw P(t,v,d);case 34:N(t,v);case 35:e.next=42;break;case 37:if(e.prev=37,e.t0=e.catch(2),!(e.t0 instanceof m.ZR)){e.next=41;break}throw e.t0;case 41:N(t,"network-request-failed",{message:String(e.t0)});case 42:case"end":return e.stop()}}),e,null,[[2,37]])})))).apply(this,arguments)}function Y(e,t,n,r){return Q.apply(this,arguments)}function Q(){return Q=(0,h.Z)(g().mark((function e(t,n,r,i){var a,o,s=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>4&&void 0!==s[4]?s[4]:{},e.next=3,H(t,n,r,i,a);case 3:return"mfaPendingCredential"in(o=e.sent)&&N(t,"multi-factor-auth-required",{_serverResponse:o}),e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)}))),Q.apply(this,arguments)}function J(e,t,n,r){var i="".concat(t).concat(n,"?").concat(r);return e.config.emulator?V(e.config,i):"".concat(e.config.apiScheme,"://").concat(i)}function X(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}var $=function(){function e(t){var n=this;(0,f.Z)(this,e),this.auth=t,this.timer=null,this.promise=new Promise((function(e,t){n.timer=setTimeout((function(){return t(A(n.auth,"network-request-failed"))}),B.get())}))}return(0,d.Z)(e,[{key:"clearNetworkTimeout",value:function(){clearTimeout(this.timer)}}]),e}();function ee(e,t,n){var r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);var i=A(e,t,r);return i.customData._tokenResponse=n,i}function te(e){return void 0!==e&&void 0!==e.enterprise}var ne=function(){function e(t){if((0,f.Z)(this,e),this.siteKey="",this.recaptchaEnforcementState=[],void 0===t.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}return(0,d.Z)(e,[{key:"getProviderEnforcementState",value:function(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;var t,n=(0,l.Z)(this.recaptchaEnforcementState);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.provider&&r.provider===e)return X(r.enforcementState)}}catch(i){n.e(i)}finally{n.f()}return null}},{key:"isProviderEnabled",value:function(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}]),e}();function re(e,t){return ie.apply(this,arguments)}function ie(){return(ie=(0,h.Z)(g().mark((function e(t,n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",H(t,"GET","/v2/recaptchaConfig",z(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(e,t){return oe.apply(this,arguments)}function oe(){return(oe=(0,h.Z)(g().mark((function e(t,n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",H(t,"POST","/v1/accounts:delete",n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(e,t){return ue.apply(this,arguments)}function ue(){return(ue=(0,h.Z)(g().mark((function e(t,n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",H(t,"POST","/v1/accounts:lookup",n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ce(e){if(e)try{var t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(n){}}function le(){return le=(0,h.Z)(g().mark((function e(t){var n,r,i,a,o,s,u=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]&&u[1],r=(0,m.m9)(t),e.next=4,r.getIdToken(n);case 4:return i=e.sent,Z((a=fe(i))&&a.exp&&a.auth_time&&a.iat,r.auth,"internal-error"),o="object"===typeof a.firebase?a.firebase:void 0,s=null===o||void 0===o?void 0:o.sign_in_provider,e.abrupt("return",{claims:a,token:i,authTime:ce(he(a.auth_time)),issuedAtTime:ce(he(a.iat)),expirationTime:ce(he(a.exp)),signInProvider:s||null,signInSecondFactor:(null===o||void 0===o?void 0:o.sign_in_second_factor)||null});case 10:case"end":return e.stop()}}),e)}))),le.apply(this,arguments)}function he(e){return 1e3*Number(e)}function fe(e){var t=e.split("."),n=(0,c.Z)(t,3),r=n[0],i=n[1],a=n[2];if(void 0===r||void 0===i||void 0===a)return x("JWT malformed, contained fewer than 3 sections"),null;try{var o=(0,m.tV)(i);return o?JSON.parse(o):(x("Failed to decode base64 JWT payload"),null)}catch(s){return x("Caught error parsing JWT payload as JSON",null===s||void 0===s?void 0:s.toString()),null}}function de(e,t){return ve.apply(this,arguments)}function ve(){return ve=(0,h.Z)(g().mark((function e(t,n){var r=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.length>2&&void 0!==r[2]&&r[2])){e.next=3;break}return e.abrupt("return",n);case 3:return e.prev=3,e.next=6,n;case 6:return e.abrupt("return",e.sent);case 9:if(e.prev=9,e.t0=e.catch(3),!(e.t0 instanceof m.ZR&&pe(e.t0))){e.next=15;break}if(t.auth.currentUser!==t){e.next=15;break}return e.next=15,t.auth.signOut();case 15:throw e.t0;case 16:case"end":return e.stop()}}),e,null,[[3,9]])}))),ve.apply(this,arguments)}function pe(e){var t=e.code;return t==="auth/".concat("user-disabled")||t==="auth/".concat("user-token-expired")}var ye=function(){function e(t){(0,f.Z)(this,e),this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}return(0,d.Z)(e,[{key:"_start",value:function(){this.isRunning||(this.isRunning=!0,this.schedule())}},{key:"_stop",value:function(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}},{key:"getInterval",value:function(e){var t;if(e){var n=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),n}this.errorBackoff=3e4;var r=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,r)}},{key:"schedule",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isRunning){var n=this.getInterval(t);this.timerId=setTimeout((0,h.Z)(g().mark((function t(){return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.iteration();case 2:case"end":return t.stop()}}),t)}))),n)}}},{key:"iteration",value:function(){var e=(0,h.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.user.getIdToken(!0);case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),(null===e.t0||void 0===e.t0?void 0:e.t0.code)==="auth/".concat("network-request-failed")&&this.schedule(!0),e.abrupt("return");case 9:this.schedule();case 10:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(){return e.apply(this,arguments)}}()}]),e}(),ge=function(){function e(t,n){(0,f.Z)(this,e),this.createdAt=t,this.lastLoginAt=n,this._initializeTime()}return(0,d.Z)(e,[{key:"_initializeTime",value:function(){this.lastSignInTime=ce(this.lastLoginAt),this.creationTime=ce(this.createdAt)}},{key:"_copy",value:function(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}},{key:"toJSON",value:function(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}]),e}();function me(e){return _e.apply(this,arguments)}function _e(){return(_e=(0,h.Z)(g().mark((function e(t){var n,r,i,a,o,s,u,c,l,h,f;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.auth,e.next=3,t.getIdToken();case 3:return i=e.sent,e.next=6,de(t,se(r,{idToken:i}));case 6:Z(null===(a=e.sent)||void 0===a?void 0:a.users.length,r,"internal-error"),o=a.users[0],t._notifyReloadListener(o),s=(null===(n=o.providerUserInfo)||void 0===n?void 0:n.length)?be(o.providerUserInfo):[],u=we(t.providerData,s),c=t.isAnonymous,l=!(t.email&&o.passwordHash)&&!(null===u||void 0===u?void 0:u.length),h=!!c&&l,f={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:u,metadata:new ge(o.createdAt,o.lastLoginAt),isAnonymous:h},Object.assign(t,f);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ke(){return(ke=(0,h.Z)(g().mark((function e(t){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,m.m9)(t),e.next=3,me(n);case 3:return e.next=5,n.auth._persistUserIfCurrent(n);case 5:n.auth._notifyListenersIfCurrent(n);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function we(e,t){var n=e.filter((function(e){return!t.some((function(t){return t.providerId===e.providerId}))}));return[].concat((0,v.Z)(n),(0,v.Z)(t))}function be(e){return e.map((function(e){var t=e.providerId,n=(0,w._T)(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}))}function Ie(e,t){return Ee.apply(this,arguments)}function Ee(){return(Ee=(0,h.Z)(g().mark((function e(t,n){var r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K(t,{},(0,h.Z)(g().mark((function e(){var r,i,a,o,s,u;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,m.xO)({grant_type:"refresh_token",refresh_token:n}).slice(1),i=t.config,a=i.tokenApiHost,o=i.apiKey,s=J(t,a,"/v1/token","key=".concat(o)),e.next=5,t._getAdditionalHeaders();case 5:return(u=e.sent)["Content-Type"]="application/x-www-form-urlencoded",e.abrupt("return",j.fetch()(s,{method:"POST",headers:u,body:r}));case 8:case"end":return e.stop()}}),e)}))));case 2:return r=e.sent,e.abrupt("return",{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Te(e,t){return Ce.apply(this,arguments)}function Ce(){return(Ce=(0,h.Z)(g().mark((function e(t,n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",H(t,"POST","/v2/accounts:revokeToken",z(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Se=function(){function e(){(0,f.Z)(this,e),this.refreshToken=null,this.accessToken=null,this.expirationTime=null}return(0,d.Z)(e,[{key:"isExpired",get:function(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}},{key:"updateFromServerResponse",value:function(e){Z(e.idToken,"internal-error"),Z("undefined"!==typeof e.idToken,"internal-error"),Z("undefined"!==typeof e.refreshToken,"internal-error");var t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):function(e){var t=fe(e);return Z(t,"internal-error"),Z("undefined"!==typeof t.exp,"internal-error"),Z("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}},{key:"getToken",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n,r=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>1&&void 0!==r[1]&&r[1],Z(!this.accessToken||this.refreshToken,t,"user-token-expired"),n||!this.accessToken||this.isExpired){e.next=4;break}return e.abrupt("return",this.accessToken);case 4:if(!this.refreshToken){e.next=8;break}return e.next=7,this.refresh(t,this.refreshToken);case 7:return e.abrupt("return",this.accessToken);case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"clearRefreshToken",value:function(){this.refreshToken=null}},{key:"refresh",value:function(){var e=(0,h.Z)(g().mark((function e(t,n){var r,i,a,o;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ie(t,n);case 2:r=e.sent,i=r.accessToken,a=r.refreshToken,o=r.expiresIn,this.updateTokensAndExpiration(i,a,Number(o));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateTokensAndExpiration",value:function(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}},{key:"toJSON",value:function(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}},{key:"_assign",value:function(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}},{key:"_clone",value:function(){return Object.assign(new e,this.toJSON())}},{key:"_performRefresh",value:function(){return D("not implemented")}}],[{key:"fromJSON",value:function(t,n){var r=n.refreshToken,i=n.accessToken,a=n.expirationTime,o=new e;return r&&(Z("string"===typeof r,"internal-error",{appName:t}),o.refreshToken=r),i&&(Z("string"===typeof i,"internal-error",{appName:t}),o.accessToken=i),a&&(Z("number"===typeof a,"internal-error",{appName:t}),o.expirationTime=a),o}}]),e}();function xe(e,t){Z("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}var Ne=function(){function e(t){(0,f.Z)(this,e);var n=t.uid,r=t.auth,i=t.stsTokenManager,a=(0,w._T)(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ye(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?(0,v.Z)(a.providerData):[],this.metadata=new ge(a.createdAt||void 0,a.lastLoginAt||void 0)}return(0,d.Z)(e,[{key:"getIdToken",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,de(this,this.stsTokenManager.getToken(this.auth,t));case 2:if(Z(n=e.sent,this.auth,"internal-error"),this.accessToken===n){e.next=9;break}return this.accessToken=n,e.next=8,this.auth._persistUserIfCurrent(this);case 8:this.auth._notifyListenersIfCurrent(this);case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getIdTokenResult",value:function(e){return function(e){return le.apply(this,arguments)}(this,e)}},{key:"reload",value:function(){return function(e){return ke.apply(this,arguments)}(this)}},{key:"_assign",value:function(e){this!==e&&(Z(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((function(e){return Object.assign({},e)})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}},{key:"_clone",value:function(t){var n=new e(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}},{key:"_onReload",value:function(e){Z(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}},{key:"_notifyReloadListener",value:function(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}},{key:"_startProactiveRefresh",value:function(){this.proactiveRefresh._start()}},{key:"_stopProactiveRefresh",value:function(){this.proactiveRefresh._stop()}},{key:"_updateTokensIfNecessary",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n,r,i=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]&&i[1],r=!1,t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),r=!0),!n){e.next=6;break}return e.next=6,me(this);case 6:return e.next=8,this.auth._persistUserIfCurrent(this);case 8:r&&this.auth._notifyListenersIfCurrent(this);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=(0,h.Z)(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getIdToken();case 2:return t=e.sent,e.next=5,de(this,ae(this.auth,{idToken:t}));case 5:return this.stsTokenManager.clearRefreshToken(),e.abrupt("return",this.auth.signOut());case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toJSON",value:function(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((function(e){return Object.assign({},e)})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}},{key:"refreshToken",get:function(){return this.stsTokenManager.refreshToken||""}}],[{key:"_fromJSON",value:function(t,n){var r,i,a,o,s,u,c,l,h=null!==(r=n.displayName)&&void 0!==r?r:void 0,f=null!==(i=n.email)&&void 0!==i?i:void 0,d=null!==(a=n.phoneNumber)&&void 0!==a?a:void 0,v=null!==(o=n.photoURL)&&void 0!==o?o:void 0,p=null!==(s=n.tenantId)&&void 0!==s?s:void 0,y=null!==(u=n._redirectEventId)&&void 0!==u?u:void 0,g=null!==(c=n.createdAt)&&void 0!==c?c:void 0,m=null!==(l=n.lastLoginAt)&&void 0!==l?l:void 0,_=n.uid,k=n.emailVerified,w=n.isAnonymous,b=n.providerData,I=n.stsTokenManager;Z(_&&I,t,"internal-error");var E=Se.fromJSON(this.name,I);Z("string"===typeof _,t,"internal-error"),xe(h,t.name),xe(f,t.name),Z("boolean"===typeof k,t,"internal-error"),Z("boolean"===typeof w,t,"internal-error"),xe(d,t.name),xe(v,t.name),xe(p,t.name),xe(y,t.name),xe(g,t.name),xe(m,t.name);var T=new e({uid:_,auth:t,email:f,emailVerified:k,displayName:h,isAnonymous:w,photoURL:v,phoneNumber:d,tenantId:p,stsTokenManager:E,createdAt:g,lastLoginAt:m});return b&&Array.isArray(b)&&(T.providerData=b.map((function(e){return Object.assign({},e)}))),y&&(T._redirectEventId=y),T}},{key:"_fromIdTokenResponse",value:function(){var t=(0,h.Z)(g().mark((function t(n,r){var i,a,o,s=arguments;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=s.length>2&&void 0!==s[2]&&s[2],(a=new Se).updateFromServerResponse(r),o=new e({uid:r.localId,auth:n,stsTokenManager:a,isAnonymous:i}),t.next=6,me(o);case 6:return t.abrupt("return",o);case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}]),e}(),Ae=new Map;function Pe(e){O(e instanceof Function,"Expected a class definition");var t=Ae.get(e);return t?(O(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Ae.set(e,t),t)}var Re=function(){function e(){(0,f.Z)(this,e),this.type="NONE",this.storage={}}return(0,d.Z)(e,[{key:"_isAvailable",value:function(){var e=(0,h.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_set",value:function(){var e=(0,h.Z)(g().mark((function e(t,n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.storage[t]=n;case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_get",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.storage[t],e.abrupt("return",void 0===n?null:n);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_remove",value:function(){var e=(0,h.Z)(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:delete this.storage[t];case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_addListener",value:function(e,t){}},{key:"_removeListener",value:function(e,t){}}]),e}();Re.type="NONE";var Ze=Re;function De(e,t,n){return"firebase".concat(":",e,":").concat(t,":").concat(n)}var Oe=function(){function e(t,n,r){(0,f.Z)(this,e),this.persistence=t,this.auth=n,this.userKey=r;var i=this.auth,a=i.config,o=i.name;this.fullUserKey=De(this.userKey,a.apiKey,o),this.fullPersistenceKey=De("persistence",a.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}return(0,d.Z)(e,[{key:"setCurrentUser",value:function(e){return this.persistence._set(this.fullUserKey,e.toJSON())}},{key:"getCurrentUser",value:function(){var e=(0,h.Z)(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.persistence._get(this.fullUserKey);case 2:return t=e.sent,e.abrupt("return",t?Ne._fromJSON(this.auth,t):null);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeCurrentUser",value:function(){return this.persistence._remove(this.fullUserKey)}},{key:"savePersistenceForRedirect",value:function(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}},{key:"setPersistence",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.persistence!==t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.getCurrentUser();case 4:return n=e.sent,e.next=7,this.removeCurrentUser();case 7:if(this.persistence=t,!n){e.next=10;break}return e.abrupt("return",this.setCurrentUser(n));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"delete",value:function(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}}],[{key:"create",value:function(){var t=(0,h.Z)(g().mark((function t(n,r){var i,a,o,s,u,c,f,d,v,p,y,m=arguments;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=m.length>2&&void 0!==m[2]?m[2]:"authUser",r.length){t.next=3;break}return t.abrupt("return",new e(Pe(Ze),n,i));case 3:return t.next=5,Promise.all(r.map(function(){var e=(0,h.Z)(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._isAvailable();case 2:if(!e.sent){e.next=4;break}return e.abrupt("return",t);case 4:return e.abrupt("return",void 0);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:a=t.sent.filter((function(e){return e})),o=a[0]||Pe(Ze),s=De(i,n.config.apiKey,n.name),u=null,c=(0,l.Z)(r),t.prev=10,c.s();case 12:if((f=c.n()).done){t.next=29;break}return d=f.value,t.prev=14,t.next=17,d._get(s);case 17:if(!(v=t.sent)){t.next=23;break}return p=Ne._fromJSON(n,v),d!==o&&(u=p),o=d,t.abrupt("break",29);case 23:t.next=27;break;case 25:t.prev=25,t.t0=t.catch(14);case 27:t.next=12;break;case 29:t.next=34;break;case 31:t.prev=31,t.t1=t.catch(10),c.e(t.t1);case 34:return t.prev=34,c.f(),t.finish(34);case 37:if(y=a.filter((function(e){return e._shouldAllowMigration})),o._shouldAllowMigration&&y.length){t.next=40;break}return t.abrupt("return",new e(o,n,i));case 40:if(o=y[0],!u){t.next=44;break}return t.next=44,o._set(s,u.toJSON());case 44:return t.next=46,Promise.all(r.map(function(){var e=(0,h.Z)(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t===o){e.next=8;break}return e.prev=1,e.next=4,t._remove(s);case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t){return e.apply(this,arguments)}}()));case 46:return t.abrupt("return",new e(o,n,i));case 47:case"end":return t.stop()}}),t,null,[[10,31,34,37],[14,25]])})));return function(e,n){return t.apply(this,arguments)}}()}]),e}();function Le(e){var t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Ve(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Me(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(qe(t))return"Blackberry";if(Be(t))return"Webos";if(Fe(t))return"Safari";if((t.includes("chrome/")||Ue(t))&&!t.includes("edge/"))return"Chrome";if(je(t))return"Android";var n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);return 2===(null===n||void 0===n?void 0:n.length)?n[1]:"Other"}function Me(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.z$)();return/firefox\//i.test(e)}function Fe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.z$)(),t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Ue(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.z$)();return/crios\//i.test(e)}function Ve(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.z$)();return/iemobile/i.test(e)}function je(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.z$)();return/android/i.test(e)}function qe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.z$)();return/blackberry/i.test(e)}function Be(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.z$)();return/webos/i.test(e)}function ze(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.z$)();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function He(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.z$)();return ze(t)&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}function We(){return(0,m.w1)()&&10===document.documentMode}function Ke(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,m.z$)();return ze(e)||je(e)||Be(e)||qe(e)||/windows phone/i.test(e)||Ve(e)}function Ge(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=Le((0,m.z$)());break;case"Worker":t="".concat(Le((0,m.z$)()),"-").concat(e);break;default:t=e}var r=n.length?n.join(","):"FirebaseCore-web";return"".concat(t,"/","JsCore","/").concat(_.Jn,"/").concat(r)}var Ye=function(){function e(t){(0,f.Z)(this,e),this.auth=t,this.queue=[]}return(0,d.Z)(e,[{key:"pushCallback",value:function(e,t){var n=this,r=function(t){return new Promise((function(n,r){try{n(e(t))}catch(i){r(i)}}))};r.onAbort=t,this.queue.push(r);var i=this.queue.length-1;return function(){n.queue[i]=function(){return Promise.resolve()}}}},{key:"runMiddleware",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n,r,i,a,o,s,u;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.auth.currentUser!==t){e.next=2;break}return e.abrupt("return");case 2:n=[],e.prev=3,r=(0,l.Z)(this.queue),e.prev=5,r.s();case 7:if((i=r.n()).done){e.next=14;break}return a=i.value,e.next=11,a(t);case 11:a.onAbort&&n.push(a.onAbort);case 12:e.next=7;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(5),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:e.next=30;break;case 24:e.prev=24,e.t1=e.catch(3),n.reverse(),o=(0,l.Z)(n);try{for(o.s();!(s=o.n()).done;){u=s.value;try{u()}catch(c){}}}catch(h){o.e(h)}finally{o.f()}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===e.t1||void 0===e.t1?void 0:e.t1.message});case 30:case"end":return e.stop()}}),e,this,[[3,24],[5,16,19,22]])})));return function(t){return e.apply(this,arguments)}}()}]),e}();function Qe(e){return Je.apply(this,arguments)}function Je(){return Je=(0,h.Z)(g().mark((function e(t){var n,r=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.abrupt("return",H(t,"GET","/v2/passwordPolicy",z(t,n)));case 2:case"end":return e.stop()}}),e)}))),Je.apply(this,arguments)}var Xe=function(){function e(t){var n,r,i,a;(0,f.Z)(this,e);var o=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(n=o.minPasswordLength)&&void 0!==n?n:6,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),void 0!==o.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),void 0!==o.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),void 0!==o.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),void 0!==o.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(i=null===(r=t.allowedNonAlphanumericCharacters)||void 0===r?void 0:r.join(""))&&void 0!==i?i:"",this.forceUpgradeOnSignin=null!==(a=t.forceUpgradeOnSignin)&&void 0!==a&&a,this.schemaVersion=t.schemaVersion}return(0,d.Z)(e,[{key:"validatePassword",value:function(e){var t,n,r,i,a,o,s={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,s),this.validatePasswordCharacterOptions(e,s),s.isValid&&(s.isValid=null===(t=s.meetsMinPasswordLength)||void 0===t||t),s.isValid&&(s.isValid=null===(n=s.meetsMaxPasswordLength)||void 0===n||n),s.isValid&&(s.isValid=null===(r=s.containsLowercaseLetter)||void 0===r||r),s.isValid&&(s.isValid=null===(i=s.containsUppercaseLetter)||void 0===i||i),s.isValid&&(s.isValid=null===(a=s.containsNumericCharacter)||void 0===a||a),s.isValid&&(s.isValid=null===(o=s.containsNonAlphanumericCharacter)||void 0===o||o),s}},{key:"validatePasswordLengthOptions",value:function(e,t){var n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}},{key:"validatePasswordCharacterOptions",value:function(e,t){var n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(var r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}},{key:"updatePasswordCharacterOptionsStatuses",value:function(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}]),e}(),$e=function(){function e(t,n,r,i){(0,f.Z)(this,e),this.app=t,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new tt(this),this.idTokenSubscription=new tt(this),this.beforeStateQueue=new Ye(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=T,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=i.sdkClientVersion}return(0,d.Z)(e,[{key:"_initializeWithPersistence",value:function(e,t){var n=this;return t&&(this._popupRedirectResolver=Pe(t)),this._initializationPromise=this.queue((0,h.Z)(g().mark((function r(){var i,a;return g().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!n._deleted){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,Oe.create(n,e);case 4:if(n.persistenceManager=r.sent,!n._deleted){r.next=7;break}return r.abrupt("return");case 7:if(!(null===(i=n._popupRedirectResolver)||void 0===i?void 0:i._shouldInitProactively)){r.next=15;break}return r.prev=8,r.next=11,n._popupRedirectResolver._initialize(n);case 11:r.next=15;break;case 13:r.prev=13,r.t0=r.catch(8);case 15:return r.next=17,n.initializeCurrentUser(t);case 17:if(n.lastNotifiedUid=(null===(a=n.currentUser)||void 0===a?void 0:a.uid)||null,!n._deleted){r.next=20;break}return r.abrupt("return");case 20:n._isInitialized=!0;case 21:case"end":return r.stop()}}),r,null,[[8,13]])})))),this._initializationPromise}},{key:"_onStorageEvent",value:function(){var e=(0,h.Z)(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._deleted){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.assertedPersistence.getCurrentUser();case 4:if(t=e.sent,this.currentUser||t){e.next=7;break}return e.abrupt("return");case 7:if(!this.currentUser||!t||this.currentUser.uid!==t.uid){e.next=12;break}return this._currentUser._assign(t),e.next=11,this.currentUser.getIdToken();case 11:return e.abrupt("return");case 12:return e.next=14,this._updateCurrentUser(t,!0);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initializeCurrentUser",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n,r,i,a,o,s,u;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.assertedPersistence.getCurrentUser();case 2:if(r=e.sent,i=r,a=!1,!t||!this.config.authDomain){e.next=14;break}return e.next=8,this.getOrInitRedirectPersistenceManager();case 8:return o=null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId,s=null===i||void 0===i?void 0:i._redirectEventId,e.next=12,this.tryRedirectSignIn(t);case 12:u=e.sent,o&&o!==s||!(null===u||void 0===u?void 0:u.user)||(i=u.user,a=!0);case 14:if(i){e.next=16;break}return e.abrupt("return",this.directlySetCurrentUser(null));case 16:if(i._redirectEventId){e.next=32;break}if(!a){e.next=27;break}return e.prev=18,e.next=21,this.beforeStateQueue.runMiddleware(i);case 21:e.next=27;break;case 23:e.prev=23,e.t0=e.catch(18),i=r,this._popupRedirectResolver._overrideRedirectResult(this,(function(){return Promise.reject(e.t0)}));case 27:if(!i){e.next=31;break}return e.abrupt("return",this.reloadAndSetCurrentUserOrClear(i));case 31:return e.abrupt("return",this.directlySetCurrentUser(null));case 32:return Z(this._popupRedirectResolver,this,"argument-error"),e.next=35,this.getOrInitRedirectPersistenceManager();case 35:if(!this.redirectUser||this.redirectUser._redirectEventId!==i._redirectEventId){e.next=37;break}return e.abrupt("return",this.directlySetCurrentUser(i));case 37:return e.abrupt("return",this.reloadAndSetCurrentUserOrClear(i));case 38:case"end":return e.stop()}}),e,this,[[18,23]])})));return function(t){return e.apply(this,arguments)}}()},{key:"tryRedirectSignIn",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.prev=1,e.next=4,this._popupRedirectResolver._completeRedirectFn(this,t,!0);case 4:n=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(1),e.next=11,this._setRedirectUser(null);case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"reloadAndSetCurrentUserOrClear",value:function(){var e=(0,h.Z)(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,me(t);case 3:e.next=9;break;case 5:if(e.prev=5,e.t0=e.catch(0),(null===e.t0||void 0===e.t0?void 0:e.t0.code)==="auth/".concat("network-request-failed")){e.next=9;break}return e.abrupt("return",this.directlySetCurrentUser(null));case 9:return e.abrupt("return",this.directlySetCurrentUser(t));case 10:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"useDeviceLanguage",value:function(){this.languageCode=function(){if("undefined"===typeof navigator)return null;var e=navigator;return e.languages&&e.languages[0]||e.language||null}()}},{key:"_delete",value:function(){var e=(0,h.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._deleted=!0;case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateCurrentUser",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t?(0,m.m9)(t):null)&&Z(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),e.abrupt("return",this._updateCurrentUser(n&&n._clone(this)));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateCurrentUser",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n,r=this,i=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]&&i[1],!this._deleted){e.next=3;break}return e.abrupt("return");case 3:if(t&&Z(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),n){e.next=7;break}return e.next=7,this.beforeStateQueue.runMiddleware(t);case 7:return e.abrupt("return",this.queue((0,h.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.directlySetCurrentUser(t);case 2:r.notifyAuthListeners();case 3:case"end":return e.stop()}}),e)})))));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signOut",value:function(){var e=(0,h.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.beforeStateQueue.runMiddleware(null);case 2:if(!this.redirectPersistenceManager&&!this._popupRedirectResolver){e.next=5;break}return e.next=5,this._setRedirectUser(null);case 5:return e.abrupt("return",this._updateCurrentUser(null,!0));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setPersistence",value:function(e){var t=this;return this.queue((0,h.Z)(g().mark((function n(){return g().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.assertedPersistence.setPersistence(Pe(e));case 2:case"end":return n.stop()}}),n)}))))}},{key:"_getRecaptchaConfig",value:function(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}},{key:"validatePassword",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._getPasswordPolicyInternal()){e.next=3;break}return e.next=3,this._updatePasswordPolicy();case 3:if((n=this._getPasswordPolicyInternal()).schemaVersion===this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION){e.next=6;break}return e.abrupt("return",Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})));case 6:return e.abrupt("return",n.validatePassword(t));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getPasswordPolicyInternal",value:function(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}},{key:"_updatePasswordPolicy",value:function(){var e=(0,h.Z)(g().mark((function e(){var t,n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qe(this);case 2:t=e.sent,n=new Xe(t),null===this.tenantId?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n;case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getPersistence",value:function(){return this.assertedPersistence.persistence.type}},{key:"_updateErrorMap",value:function(e){this._errorFactory=new m.LL("auth","Firebase",e())}},{key:"onAuthStateChanged",value:function(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}},{key:"beforeAuthStateChanged",value:function(e,t){return this.beforeStateQueue.pushCallback(e,t)}},{key:"onIdTokenChanged",value:function(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}},{key:"authStateReady",value:function(){var e=this;return new Promise((function(t,n){if(e.currentUser)t();else var r=e.onAuthStateChanged((function(){r(),t()}),n)}))}},{key:"revokeAccessToken",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.currentUser){e.next=8;break}return e.next=3,this.currentUser.getIdToken();case 3:return n=e.sent,r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:n},null!=this.tenantId&&(r.tenantId=this.tenantId),e.next=8,Te(this,r);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"toJSON",value:function(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}},{key:"_setRedirectUser",value:function(){var e=(0,h.Z)(g().mark((function e(t,n){var r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getOrInitRedirectPersistenceManager(n);case 2:return r=e.sent,e.abrupt("return",null===t?r.removeCurrentUser():r.setCurrentUser(t));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getOrInitRedirectPersistenceManager",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.redirectPersistenceManager){e.next=9;break}return Z(n=t&&Pe(t)||this._popupRedirectResolver,this,"argument-error"),e.next=5,Oe.create(this,[Pe(n._redirectPersistence)],"redirectUser");case 5:return this.redirectPersistenceManager=e.sent,e.next=8,this.redirectPersistenceManager.getCurrentUser();case 8:this.redirectUser=e.sent;case 9:return e.abrupt("return",this.redirectPersistenceManager);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_redirectUserForId",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isInitialized){e.next=3;break}return e.next=3,this.queue((0,h.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))));case 3:if((null===(n=this._currentUser)||void 0===n?void 0:n._redirectEventId)!==t){e.next=5;break}return e.abrupt("return",this._currentUser);case 5:if((null===(r=this.redirectUser)||void 0===r?void 0:r._redirectEventId)!==t){e.next=7;break}return e.abrupt("return",this.redirectUser);case 7:return e.abrupt("return",null);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_persistUserIfCurrent",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==this.currentUser){e.next=2;break}return e.abrupt("return",this.queue((0,h.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.directlySetCurrentUser(t));case 1:case"end":return e.stop()}}),e)})))));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_notifyListenersIfCurrent",value:function(e){e===this.currentUser&&this.notifyAuthListeners()}},{key:"_key",value:function(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}},{key:"_startProactiveRefresh",value:function(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}},{key:"_stopProactiveRefresh",value:function(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}},{key:"_currentUser",get:function(){return this.currentUser}},{key:"notifyAuthListeners",value:function(){var e,t;if(this._isInitialized){this.idTokenSubscription.next(this.currentUser);var n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}}},{key:"registerStateListener",value:function(e,t,n,r){var i=this;if(this._deleted)return function(){};var a="function"===typeof t?t:t.next.bind(t),o=!1,s=this._isInitialized?Promise.resolve():this._initializationPromise;if(Z(s,this,"internal-error"),s.then((function(){o||a(i.currentUser)})),"function"===typeof t){var u=e.addObserver(t,n,r);return function(){o=!0,u()}}var c=e.addObserver(t);return function(){o=!0,c()}}},{key:"directlySetCurrentUser",value:function(){var e=(0,h.Z)(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,!t){e.next=8;break}return e.next=6,this.assertedPersistence.setCurrentUser(t);case 6:e.next=10;break;case 8:return e.next=10,this.assertedPersistence.removeCurrentUser();case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queue",value:function(e){return this.operations=this.operations.then(e,e),this.operations}},{key:"assertedPersistence",get:function(){return Z(this.persistenceManager,this,"internal-error"),this.persistenceManager}},{key:"_logFramework",value:function(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ge(this.config.clientPlatform,this._getFrameworks()))}},{key:"_getFrameworks",value:function(){return this.frameworks}},{key:"_getAdditionalHeaders",value:function(){var e=(0,h.Z)(g().mark((function e(){var t,n,r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,p.Z)({},"X-Client-Version",this.clientVersion),this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId),e.next=4,null===(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader();case 4:return(r=e.sent)&&(n["X-Firebase-Client"]=r),e.next=8,this._getAppCheckToken();case 8:return(i=e.sent)&&(n["X-Firebase-AppCheck"]=i),e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getAppCheckToken",value:function(){var e=(0,h.Z)(g().mark((function e(){var t,n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getToken();case 2:return(null===(n=e.sent)||void 0===n?void 0:n.error)&&S("Error while retrieving App Check token: ".concat(n.error)),e.abrupt("return",null===n||void 0===n?void 0:n.token);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function et(e){return(0,m.m9)(e)}var tt=function(){function e(t){var n=this;(0,f.Z)(this,e),this.auth=t,this.observer=null,this.addObserver=(0,m.ne)((function(e){return n.observer=e}))}return(0,d.Z)(e,[{key:"next",get:function(){return Z(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}]),e}(),nt={loadJS:function(){return(0,h.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Unable to load external scripts");case 1:case"end":return e.stop()}}),e)})))()},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function rt(e){return nt.loadJS(e)}function it(){return nt.recaptchaEnterpriseScript}function at(e){return"__".concat(e).concat(Math.floor(1e6*Math.random()))}var ot="NO_RECAPTCHA",st=function(){function e(t){(0,f.Z)(this,e),this.type="recaptcha-enterprise",this.auth=et(t)}return(0,d.Z)(e,[{key:"verify",value:function(){var e=(0,h.Z)(g().mark((function e(){var t,n,r,i,a,o=this,s=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e,n,r){var i=window.grecaptcha;te(i)?i.enterprise.ready((function(){i.enterprise.execute(e,{action:t}).then((function(e){n(e)})).catch((function(){n(ot)}))})):r(Error("No reCAPTCHA enterprise script loaded."))},i=function(){return i=(0,h.Z)(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=5;break}if(null!=t.tenantId||null==t._agentRecaptchaConfig){e.next=3;break}return e.abrupt("return",t._agentRecaptchaConfig.siteKey);case 3:if(null==t.tenantId||void 0===t._tenantRecaptchaConfigs[t.tenantId]){e.next=5;break}return e.abrupt("return",t._tenantRecaptchaConfigs[t.tenantId].siteKey);case 5:return e.abrupt("return",new Promise(function(){var e=(0,h.Z)(g().mark((function e(n,r){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:re(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((function(e){if(void 0!==e.recaptchaKey){var i=new ne(e);return null==t.tenantId?t._agentRecaptchaConfig=i:t._tenantRecaptchaConfigs[t.tenantId]=i,n(i.siteKey)}r(new Error("recaptcha Enterprise site key undefined"))})).catch((function(e){r(e)}));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 6:case"end":return e.stop()}}),e)}))),i.apply(this,arguments)},r=function(e){return i.apply(this,arguments)},t=s.length>0&&void 0!==s[0]?s[0]:"verify",n=s.length>1&&void 0!==s[1]&&s[1],e.abrupt("return",new Promise((function(e,t){r(o.auth).then((function(r){if(!n&&te(window.grecaptcha))a(r,e,t);else{if("undefined"===typeof window)return void t(new Error("RecaptchaVerifier is only supported in browser"));var i=it();0!==i.length&&(i+=r),rt(i).then((function(){a(r,e,t)})).catch((function(e){t(e)}))}})).catch((function(e){t(e)}))})));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}();function ut(e,t,n){return ct.apply(this,arguments)}function ct(){return ct=(0,h.Z)(g().mark((function e(t,n,r){var i,a,o,s,u=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=u.length>3&&void 0!==u[3]&&u[3],a=new st(t),e.prev=2,e.next=5,a.verify(r);case 5:o=e.sent,e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(2),e.next=12,a.verify(r,!0);case 12:o=e.sent;case 13:return s=Object.assign({},n),i?Object.assign(s,{captchaResp:o}):Object.assign(s,{captchaResponse:o}),Object.assign(s,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(s,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),e.abrupt("return",s);case 18:case"end":return e.stop()}}),e,null,[[2,8]])}))),ct.apply(this,arguments)}function lt(e,t,n,r){return ht.apply(this,arguments)}function ht(){return ht=(0,h.Z)(g().mark((function e(t,n,r,i){var a,o;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null===(a=t._getRecaptchaConfig())||void 0===a?void 0:a.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))){e.next=7;break}return e.next=3,ut(t,n,r,"getOobCode"===r);case 3:return o=e.sent,e.abrupt("return",i(t,o));case 7:return e.abrupt("return",i(t,n).catch(function(){var e=(0,h.Z)(g().mark((function e(a){var o;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.code!=="auth/".concat("missing-recaptcha-token")){e.next=8;break}return console.log("".concat(r," is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.")),e.next=4,ut(t,n,r,"getOobCode"===r);case 4:return o=e.sent,e.abrupt("return",i(t,o));case 8:return e.abrupt("return",Promise.reject(a));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:case"end":return e.stop()}}),e)}))),ht.apply(this,arguments)}function ft(e,t){var n=(0,_.qX)(e,"auth");if(n.isInitialized()){var r=n.getImmediate(),i=n.getOptions();if((0,m.vZ)(i,null!==t&&void 0!==t?t:{}))return r;N(r,"already-initialized")}return n.initialize({options:t})}function dt(e,t,n){var r=et(e);Z(r._canInitEmulator,r,"emulator-config-failed"),Z(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");var i=!!(null===n||void 0===n?void 0:n.disableWarnings),a=vt(t),o=function(e){var t=vt(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};var r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){var a=i[1];return{host:a,port:pt(r.substr(a.length+1))}}var o=r.split(":"),s=(0,c.Z)(o,2);return{host:s[0],port:pt(s[1])}}(t),s=o.host,u=o.port,l=null===u?"":":".concat(u);r.config.emulator={url:"".concat(a,"//").concat(s).concat(l,"/")},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:s,port:u,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){var e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function vt(e){var t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function pt(e){if(!e)return null;var t=Number(e);return isNaN(t)?null:t}var yt=function(){function e(t,n){(0,f.Z)(this,e),this.providerId=t,this.signInMethod=n}return(0,d.Z)(e,[{key:"toJSON",value:function(){return D("not implemented")}},{key:"_getIdTokenResponse",value:function(e){return D("not implemented")}},{key:"_linkToIdToken",value:function(e,t){return D("not implemented")}},{key:"_getReauthenticationResolver",value:function(e){return D("not implemented")}}]),e}();function gt(e,t){return mt.apply(this,arguments)}function mt(){return(mt=(0,h.Z)(g().mark((function e(t,n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",H(t,"POST","/v1/accounts:signUp",n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _t(e,t){return kt.apply(this,arguments)}function kt(){return(kt=(0,h.Z)(g().mark((function e(t,n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Y(t,"POST","/v1/accounts:signInWithPassword",z(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wt(e,t){return bt.apply(this,arguments)}function bt(){return(bt=(0,h.Z)(g().mark((function e(t,n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Y(t,"POST","/v1/accounts:signInWithEmailLink",z(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function It(e,t){return Et.apply(this,arguments)}function Et(){return(Et=(0,h.Z)(g().mark((function e(t,n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Y(t,"POST","/v1/accounts:signInWithEmailLink",z(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Tt=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return(0,f.Z)(this,n),(a=t.call(this,"password",i))._email=e,a._password=r,a._tenantId=o,a}return(0,d.Z)(n,[{key:"toJSON",value:function(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}},{key:"_getIdTokenResponse",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=this.signInMethod,e.next="password"===e.t0?3:"emailLink"===e.t0?5:6;break;case 3:return n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},e.abrupt("return",lt(t,n,"signInWithPassword",_t));case 5:return e.abrupt("return",wt(t,{email:this._email,oobCode:this._password}));case 6:N(t,"internal-error");case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_linkToIdToken",value:function(){var e=(0,h.Z)(g().mark((function e(t,n){var r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=this.signInMethod,e.next="password"===e.t0?3:"emailLink"===e.t0?5:6;break;case 3:return r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},e.abrupt("return",lt(t,r,"signUpPassword",gt));case 5:return e.abrupt("return",It(t,{idToken:n,email:this._email,oobCode:this._password}));case 6:N(t,"internal-error");case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getReauthenticationResolver",value:function(e){return this._getIdTokenResponse(e)}}],[{key:"_fromEmailAndPassword",value:function(e,t){return new n(e,t,"password")}},{key:"_fromEmailAndCode",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new n(e,t,"emailLink",r)}},{key:"fromJSON",value:function(e){var t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}}]),n}(yt);function Ct(e,t){return St.apply(this,arguments)}function St(){return(St=(0,h.Z)(g().mark((function e(t,n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Y(t,"POST","/v1/accounts:signInWithIdp",z(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var xt=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,f.Z)(this,n),(e=t.apply(this,arguments)).pendingToken=null,e}return(0,d.Z)(n,[{key:"toJSON",value:function(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}},{key:"_getIdTokenResponse",value:function(e){return Ct(e,this.buildRequest())}},{key:"_linkToIdToken",value:function(e,t){var n=this.buildRequest();return n.idToken=t,Ct(e,n)}},{key:"_getReauthenticationResolver",value:function(e){var t=this.buildRequest();return t.autoCreate=!1,Ct(e,t)}},{key:"buildRequest",value:function(){var e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{var t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,m.xO)(t)}return e}}],[{key:"_fromParams",value:function(e){var t=new n(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):N("argument-error"),t}},{key:"fromJSON",value:function(e){var t="string"===typeof e?JSON.parse(e):e,r=t.providerId,i=t.signInMethod,a=(0,w._T)(t,["providerId","signInMethod"]);if(!r||!i)return null;var o=new n(r,i);return o.idToken=a.idToken||void 0,o.accessToken=a.accessToken||void 0,o.secret=a.secret,o.nonce=a.nonce,o.pendingToken=a.pendingToken||null,o}}]),n}(yt);function Nt(e,t){return At.apply(this,arguments)}function At(){return(At=(0,h.Z)(g().mark((function e(t,n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",H(t,"POST","/v1/accounts:sendVerificationCode",z(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pt(){return(Pt=(0,h.Z)(g().mark((function e(t,n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Y(t,"POST","/v1/accounts:signInWithPhoneNumber",z(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Rt(){return(Rt=(0,h.Z)(g().mark((function e(t,n){var r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y(t,"POST","/v1/accounts:signInWithPhoneNumber",z(t,n));case 2:if(!(r=e.sent).temporaryProof){e.next=5;break}throw ee(t,"account-exists-with-different-credential",r);case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Zt=(0,p.Z)({},"USER_NOT_FOUND","user-not-found");function Dt(){return(Dt=(0,h.Z)(g().mark((function e(t,n){var r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object.assign(Object.assign({},n),{operation:"REAUTH"}),e.abrupt("return",Y(t,"POST","/v1/accounts:signInWithPhoneNumber",z(t,r),Zt));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ot=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e){var r;return(0,f.Z)(this,n),(r=t.call(this,"phone","phone")).params=e,r}return(0,d.Z)(n,[{key:"_getIdTokenResponse",value:function(e){return function(e,t){return Pt.apply(this,arguments)}(e,this._makeVerificationRequest())}},{key:"_linkToIdToken",value:function(e,t){return function(e,t){return Rt.apply(this,arguments)}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}},{key:"_getReauthenticationResolver",value:function(e){return function(e,t){return Dt.apply(this,arguments)}(e,this._makeVerificationRequest())}},{key:"_makeVerificationRequest",value:function(){var e=this.params,t=e.temporaryProof,n=e.phoneNumber,r=e.verificationId,i=e.verificationCode;return t&&n?{temporaryProof:t,phoneNumber:n}:{sessionInfo:r,code:i}}},{key:"toJSON",value:function(){var e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}}],[{key:"_fromVerification",value:function(e,t){return new n({verificationId:e,verificationCode:t})}},{key:"_fromTokenResponse",value:function(e,t){return new n({phoneNumber:e,temporaryProof:t})}},{key:"fromJSON",value:function(e){"string"===typeof e&&(e=JSON.parse(e));var t=e,r=t.verificationId,i=t.verificationCode,a=t.phoneNumber,o=t.temporaryProof;return i||r||a||o?new n({verificationId:r,verificationCode:i,phoneNumber:a,temporaryProof:o}):null}}]),n}(yt);var Lt=function(){function e(t){var n,r,i,a,o,s;(0,f.Z)(this,e);var u=(0,m.zd)((0,m.pd)(t)),c=null!==(n=u.apiKey)&&void 0!==n?n:null,l=null!==(r=u.oobCode)&&void 0!==r?r:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=u.mode)&&void 0!==i?i:null);Z(c&&l&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=l,this.continueUrl=null!==(a=u.continueUrl)&&void 0!==a?a:null,this.languageCode=null!==(o=u.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(s=u.tenantId)&&void 0!==s?s:null}return(0,d.Z)(e,null,[{key:"parseLink",value:function(t){var n=function(e){var t=(0,m.zd)((0,m.pd)(e)).link,n=t?(0,m.zd)((0,m.pd)(t)).deep_link_id:null,r=(0,m.zd)((0,m.pd)(e)).deep_link_id;return(r?(0,m.zd)((0,m.pd)(r)).link:null)||r||n||t||e}(t);try{return new e(n)}catch(r){return null}}}]),e}();var Mt=function(){function e(){(0,f.Z)(this,e),this.providerId=e.PROVIDER_ID}return(0,d.Z)(e,null,[{key:"credential",value:function(e,t){return Tt._fromEmailAndPassword(e,t)}},{key:"credentialWithLink",value:function(e,t){var n=Lt.parseLink(t);return Z(n,"argument-error"),Tt._fromEmailAndCode(e,n.code,n.tenantId)}}]),e}();Mt.PROVIDER_ID="password",Mt.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Mt.EMAIL_LINK_SIGN_IN_METHOD="emailLink";var Ft=function(){function e(t){(0,f.Z)(this,e),this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}return(0,d.Z)(e,[{key:"setDefaultLanguage",value:function(e){this.defaultLanguageCode=e}},{key:"setCustomParameters",value:function(e){return this.customParameters=e,this}},{key:"getCustomParameters",value:function(){return this.customParameters}}]),e}(),Ut=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,f.Z)(this,n),(e=t.apply(this,arguments)).scopes=[],e}return(0,d.Z)(n,[{key:"addScope",value:function(e){return this.scopes.includes(e)||this.scopes.push(e),this}},{key:"getScopes",value:function(){return(0,v.Z)(this.scopes)}}]),n}(Ft),Vt=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,f.Z)(this,n),t.call(this,"facebook.com")}return(0,d.Z)(n,null,[{key:"credential",value:function(e){return xt._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}},{key:"credentialFromResult",value:function(e){return n.credentialFromTaggedObject(e)}},{key:"credentialFromError",value:function(e){return n.credentialFromTaggedObject(e.customData||{})}},{key:"credentialFromTaggedObject",value:function(e){var t=e._tokenResponse;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return n.credential(t.oauthAccessToken)}catch(r){return null}}}]),n}(Ut);Vt.FACEBOOK_SIGN_IN_METHOD="facebook.com",Vt.PROVIDER_ID="facebook.com";var jt=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,f.Z)(this,n),(e=t.call(this,"google.com")).addScope("profile"),e}return(0,d.Z)(n,null,[{key:"credential",value:function(e,t){return xt._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}},{key:"credentialFromResult",value:function(e){return n.credentialFromTaggedObject(e)}},{key:"credentialFromError",value:function(e){return n.credentialFromTaggedObject(e.customData||{})}},{key:"credentialFromTaggedObject",value:function(e){var t=e._tokenResponse;if(!t)return null;var r=t.oauthIdToken,i=t.oauthAccessToken;if(!r&&!i)return null;try{return n.credential(r,i)}catch(a){return null}}}]),n}(Ut);jt.GOOGLE_SIGN_IN_METHOD="google.com",jt.PROVIDER_ID="google.com";var qt=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,f.Z)(this,n),t.call(this,"github.com")}return(0,d.Z)(n,null,[{key:"credential",value:function(e){return xt._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GITHUB_SIGN_IN_METHOD,accessToken:e})}},{key:"credentialFromResult",value:function(e){return n.credentialFromTaggedObject(e)}},{key:"credentialFromError",value:function(e){return n.credentialFromTaggedObject(e.customData||{})}},{key:"credentialFromTaggedObject",value:function(e){var t=e._tokenResponse;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return n.credential(t.oauthAccessToken)}catch(r){return null}}}]),n}(Ut);qt.GITHUB_SIGN_IN_METHOD="github.com",qt.PROVIDER_ID="github.com";var Bt=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,f.Z)(this,n),t.call(this,"twitter.com")}return(0,d.Z)(n,null,[{key:"credential",value:function(e,t){return xt._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}},{key:"credentialFromResult",value:function(e){return n.credentialFromTaggedObject(e)}},{key:"credentialFromError",value:function(e){return n.credentialFromTaggedObject(e.customData||{})}},{key:"credentialFromTaggedObject",value:function(e){var t=e._tokenResponse;if(!t)return null;var r=t.oauthAccessToken,i=t.oauthTokenSecret;if(!r||!i)return null;try{return n.credential(r,i)}catch(a){return null}}}]),n}(Ut);function zt(e,t){return Ht.apply(this,arguments)}function Ht(){return(Ht=(0,h.Z)(g().mark((function e(t,n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Y(t,"POST","/v1/accounts:signUp",z(t,n)));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Bt.TWITTER_SIGN_IN_METHOD="twitter.com",Bt.PROVIDER_ID="twitter.com";var Wt=function(){function e(t){(0,f.Z)(this,e),this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}return(0,d.Z)(e,null,[{key:"_fromIdTokenResponse",value:function(){var t=(0,h.Z)(g().mark((function t(n,r,i){var a,o,s,u,c=arguments;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=c.length>3&&void 0!==c[3]&&c[3],t.next=3,Ne._fromIdTokenResponse(n,i,a);case 3:return o=t.sent,s=Kt(i),u=new e({user:o,providerId:s,_tokenResponse:i,operationType:r}),t.abrupt("return",u);case 7:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"_forOperation",value:function(){var t=(0,h.Z)(g().mark((function t(n,r,i){var a;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n._updateTokensIfNecessary(i,!0);case 2:return a=Kt(i),t.abrupt("return",new e({user:n,providerId:a,_tokenResponse:i,operationType:r}));case 4:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}()}]),e}();function Kt(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}var Gt=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i,a){var s,u;return(0,f.Z)(this,n),(s=t.call(this,r.code,r.message)).operationType=i,s.user=a,Object.setPrototypeOf((0,o.Z)(s),n.prototype),s.customData={appName:e.name,tenantId:null!==(u=e.tenantId)&&void 0!==u?u:void 0,_serverResponse:r.customData._serverResponse,operationType:i},s}return(0,d.Z)(n,null,[{key:"_fromErrorAndOperation",value:function(e,t,r,i){return new n(e,t,r,i)}}]),n}(m.ZR);function Yt(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((function(n){if(n.code==="auth/".concat("multi-factor-auth-required"))throw Gt._fromErrorAndOperation(e,n,t,r);throw n}))}function Qt(e,t){return Jt.apply(this,arguments)}function Jt(){return Jt=(0,h.Z)(g().mark((function e(t,n){var r,i,a=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]&&a[2],e.t0=de,e.t1=t,e.t2=n,e.t3=t.auth,e.next=7,t.getIdToken();case 7:return e.t4=e.sent,e.t5=e.t2._linkToIdToken.call(e.t2,e.t3,e.t4),e.t6=r,e.next=12,(0,e.t0)(e.t1,e.t5,e.t6);case 12:return i=e.sent,e.abrupt("return",Wt._forOperation(t,"link",i));case 14:case"end":return e.stop()}}),e)}))),Jt.apply(this,arguments)}function Xt(e,t){return $t.apply(this,arguments)}function $t(){return $t=(0,h.Z)(g().mark((function e(t,n){var r,i,a,o,s,u,c=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>2&&void 0!==c[2]&&c[2],i=t.auth,a="reauthenticate",e.prev=3,e.next=6,de(t,Yt(i,a,n,t),r);case 6:return Z((o=e.sent).idToken,i,"internal-error"),Z(s=fe(o.idToken),i,"internal-error"),u=s.sub,Z(t.uid===u,i,"user-mismatch"),e.abrupt("return",Wt._forOperation(t,a,o));case 15:throw e.prev=15,e.t0=e.catch(3),(null===e.t0||void 0===e.t0?void 0:e.t0.code)==="auth/".concat("user-not-found")&&N(i,"user-mismatch"),e.t0;case 19:case"end":return e.stop()}}),e,null,[[3,15]])}))),$t.apply(this,arguments)}function en(e,t){return tn.apply(this,arguments)}function tn(){return tn=(0,h.Z)(g().mark((function e(t,n){var r,i,a,o,s=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]&&s[2],i="signIn",e.next=4,Yt(t,i,n);case 4:return a=e.sent,e.next=7,Wt._fromIdTokenResponse(t,i,a);case 7:if(o=e.sent,r){e.next=11;break}return e.next=11,t._updateCurrentUser(o.user);case 11:return e.abrupt("return",o);case 12:case"end":return e.stop()}}),e)}))),tn.apply(this,arguments)}function nn(e,t){return rn.apply(this,arguments)}function rn(){return(rn=(0,h.Z)(g().mark((function e(t,n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",en(et(t),n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function an(e){return on.apply(this,arguments)}function on(){return(on=(0,h.Z)(g().mark((function e(t){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=et(t))._getPasswordPolicyInternal()){e.next=4;break}return e.next=4,n._updatePasswordPolicy();case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function sn(e,t,n){return un.apply(this,arguments)}function un(){return(un=(0,h.Z)(g().mark((function e(t,n,r){var i,a,o,s;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=et(t),a=lt(i,{returnSecureToken:!0,email:n,password:r,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",zt),e.next=5,a.catch((function(e){throw e.code==="auth/".concat("password-does-not-meet-requirements")&&an(t),e}));case 5:return o=e.sent,e.next=8,Wt._fromIdTokenResponse(i,"signIn",o);case 8:return s=e.sent,e.next=11,i._updateCurrentUser(s.user);case 11:return e.abrupt("return",s);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function cn(e,t,n){return nn((0,m.m9)(e),Mt.credential(t,n)).catch(function(){var t=(0,h.Z)(g().mark((function t(n){return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:throw n.code==="auth/".concat("password-does-not-meet-requirements")&&an(e),n;case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}function ln(e,t,n,r){return(0,m.m9)(e).onIdTokenChanged(t,n,r)}function hn(e,t,n){return(0,m.m9)(e).beforeAuthStateChanged(t,n)}function fn(e,t,n,r){return(0,m.m9)(e).onAuthStateChanged(t,n,r)}function dn(e,t){return H(e,"POST","/v2/accounts/mfaEnrollment:start",z(e,t))}function vn(e,t){return H(e,"POST","/v2/accounts/mfaEnrollment:finalize",z(e,t))}new WeakMap;var pn="__sak",yn=function(){function e(t,n){(0,f.Z)(this,e),this.storageRetriever=t,this.type=n}return(0,d.Z)(e,[{key:"_isAvailable",value:function(){try{return this.storage?(this.storage.setItem(pn,"1"),this.storage.removeItem(pn),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}},{key:"_set",value:function(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}},{key:"_get",value:function(e){var t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}},{key:"_remove",value:function(e){return this.storage.removeItem(e),Promise.resolve()}},{key:"storage",get:function(){return this.storageRetriever()}}]),e}();var gn=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,f.Z)(this,n),(e=t.call(this,(function(){return window.localStorage}),"LOCAL")).boundEventHandler=function(t,n){return e.onStorageEvent(t,n)},e.listeners={},e.localCache={},e.pollTimer=null,e.safariLocalStorageNotSynced=function(){var e=(0,m.z$)();return Fe(e)||ze(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),e.fallbackToPolling=Ke(),e._shouldAllowMigration=!0,e}return(0,d.Z)(n,[{key:"forAllChangedKeys",value:function(e){for(var t=0,n=Object.keys(this.listeners);t<n.length;t++){var r=n[t],i=this.storage.getItem(r),a=this.localCache[r];i!==a&&e(r,a,i)}}},{key:"onStorageEvent",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.key){var r=e.key;if(n?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){var i=this.storage.getItem(r);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!n)return}var a=function(){var e=t.storage.getItem(r);(n||t.localCache[r]!==e)&&t.notifyListeners(r,e)},o=this.storage.getItem(r);We()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,10):a()}else this.forAllChangedKeys((function(e,n,r){t.notifyListeners(e,r)}))}},{key:"notifyListeners",value:function(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(var r=0,i=Array.from(n);r<i.length;r++){(0,i[r])(t?JSON.parse(t):t)}}},{key:"startPolling",value:function(){var e=this;this.stopPolling(),this.pollTimer=setInterval((function(){e.forAllChangedKeys((function(t,n,r){e.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:n,newValue:r}),!0)}))}),1e3)}},{key:"stopPolling",value:function(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}},{key:"attachListener",value:function(){window.addEventListener("storage",this.boundEventHandler)}},{key:"detachListener",value:function(){window.removeEventListener("storage",this.boundEventHandler)}},{key:"_addListener",value:function(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}},{key:"_removeListener",value:function(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}},{key:"_set",value:function(){var e=(0,h.Z)(g().mark((function e(t,r){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.Z)((0,a.Z)(n.prototype),"_set",this).call(this,t,r);case 2:this.localCache[t]=JSON.stringify(r);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_get",value:function(){var e=(0,h.Z)(g().mark((function e(t){var r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.Z)((0,a.Z)(n.prototype),"_get",this).call(this,t);case 2:return r=e.sent,this.localCache[t]=JSON.stringify(r),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_remove",value:function(){var e=(0,h.Z)(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.Z)((0,a.Z)(n.prototype),"_remove",this).call(this,t);case 2:delete this.localCache[t];case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(yn);gn.type="LOCAL";var mn=gn,_n=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,f.Z)(this,n),t.call(this,(function(){return window.sessionStorage}),"SESSION")}return(0,d.Z)(n,[{key:"_addListener",value:function(e,t){}},{key:"_removeListener",value:function(e,t){}}]),n}(yn);_n.type="SESSION";var kn=_n;function wn(e){return Promise.all(e.map(function(){var e=(0,h.Z)(g().mark((function e(t){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t;case 3:return n=e.sent,e.abrupt("return",{fulfilled:!0,value:n});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{fulfilled:!1,reason:e.t0});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()))}var bn=function(){function e(t){(0,f.Z)(this,e),this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}return(0,d.Z)(e,[{key:"isListeningto",value:function(e){return this.eventTarget===e}},{key:"handleEvent",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n,r,i,a,o,s,u,c;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(n=t).data,i=r.eventId,a=r.eventType,o=r.data,null===(s=this.handlersMap[a])||void 0===s?void 0:s.size){e.next=5;break}return e.abrupt("return");case 5:return n.ports[0].postMessage({status:"ack",eventId:i,eventType:a}),u=Array.from(s).map(function(){var e=(0,h.Z)(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t(n.origin,o));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=9,wn(u);case 9:c=e.sent,n.ports[0].postMessage({status:"done",eventId:i,eventType:a,response:c});case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_subscribe",value:function(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}},{key:"_unsubscribe",value:function(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}],[{key:"_getInstance",value:function(t){var n=this.receivers.find((function(e){return e.isListeningto(t)}));if(n)return n;var r=new e(t);return this.receivers.push(r),r}}]),e}();function In(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="",r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}bn.receivers=[];var En=function(){function e(t){(0,f.Z)(this,e),this.target=t,this.handlers=new Set}return(0,d.Z)(e,[{key:"removeMessageHandler",value:function(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}},{key:"_send",value:function(){var e=(0,h.Z)(g().mark((function e(t,n){var r,i,a,o,s=this,u=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>2&&void 0!==u[2]?u[2]:50,i="undefined"!==typeof MessageChannel?new MessageChannel:null){e.next=4;break}throw new Error("connection_unavailable");case 4:return e.abrupt("return",new Promise((function(e,u){var c=In("",20);i.port1.start();var l=setTimeout((function(){u(new Error("unsupported_event"))}),r);o={messageChannel:i,onMessage:function(t){var n=t;if(n.data.eventId===c)switch(n.data.status){case"ack":clearTimeout(l),a=setTimeout((function(){u(new Error("timeout"))}),3e3);break;case"done":clearTimeout(a),e(n.data.response);break;default:clearTimeout(l),clearTimeout(a),u(new Error("invalid_response"))}}},s.handlers.add(o),i.port1.addEventListener("message",o.onMessage),s.target.postMessage({eventType:t,eventId:c,data:n},[i.port2])})).finally((function(){o&&s.removeMessageHandler(o)})));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();function Tn(){return window}function Cn(e){Tn().location.href=e}function Sn(){return"undefined"!==typeof Tn().WorkerGlobalScope&&"function"===typeof Tn().importScripts}function xn(){return Nn.apply(this,arguments)}function Nn(){return(Nn=(0,h.Z)(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===navigator||void 0===navigator?void 0:navigator.serviceWorker){e.next=2;break}return e.abrupt("return",null);case 2:return e.prev=2,e.next=5,navigator.serviceWorker.ready;case 5:return t=e.sent,e.abrupt("return",t.active);case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})))).apply(this,arguments)}function An(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}var Pn="firebaseLocalStorageDb",Rn="firebaseLocalStorage",Zn="fbase_key",Dn=function(){function e(t){(0,f.Z)(this,e),this.request=t}return(0,d.Z)(e,[{key:"toPromise",value:function(){var e=this;return new Promise((function(t,n){e.request.addEventListener("success",(function(){t(e.request.result)})),e.request.addEventListener("error",(function(){n(e.request.error)}))}))}}]),e}();function On(e,t){return e.transaction([Rn],t?"readwrite":"readonly").objectStore(Rn)}function Ln(){var e=indexedDB.deleteDatabase(Pn);return new Dn(e).toPromise()}function Mn(){var e=indexedDB.open(Pn,1);return new Promise((function(t,n){e.addEventListener("error",(function(){n(e.error)})),e.addEventListener("upgradeneeded",(function(){var t=e.result;try{t.createObjectStore(Rn,{keyPath:Zn})}catch(r){n(r)}})),e.addEventListener("success",(0,h.Z)(g().mark((function n(){var r;return g().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((r=e.result).objectStoreNames.contains(Rn)){n.next=12;break}return r.close(),n.next=5,Ln();case 5:return n.t0=t,n.next=8,Mn();case 8:n.t1=n.sent,(0,n.t0)(n.t1),n.next=13;break;case 12:t(r);case 13:case"end":return n.stop()}}),n)}))))}))}function Fn(e,t,n){return Un.apply(this,arguments)}function Un(){return(Un=(0,h.Z)(g().mark((function e(t,n,r){var i,a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=On(t,!0).put((i={},(0,p.Z)(i,Zn,n),(0,p.Z)(i,"value",r),i)),e.abrupt("return",new Dn(a).toPromise());case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Vn(e,t){return jn.apply(this,arguments)}function jn(){return(jn=(0,h.Z)(g().mark((function e(t,n){var r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=On(t,!1).get(n),e.next=3,new Dn(r).toPromise();case 3:return i=e.sent,e.abrupt("return",void 0===i?null:i.value);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qn(e,t){var n=On(e,!0).delete(t);return new Dn(n).toPromise()}var Bn=function(){function e(){(0,f.Z)(this,e),this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((function(){}),(function(){}))}return(0,d.Z)(e,[{key:"_openDb",value:function(){var e=(0,h.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.db){e.next=2;break}return e.abrupt("return",this.db);case 2:return e.next=4,Mn();case 4:return this.db=e.sent,e.abrupt("return",this.db);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_withRetries",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:return e.prev=2,e.next=5,this._openDb();case 5:return r=e.sent,e.next=8,t(r);case 8:return e.abrupt("return",e.sent);case 11:if(e.prev=11,e.t0=e.catch(2),!(n++>3)){e.next=15;break}throw e.t0;case 15:this.db&&(this.db.close(),this.db=void 0);case 16:e.next=1;break;case 18:case"end":return e.stop()}}),e,this,[[2,11]])})));return function(t){return e.apply(this,arguments)}}()},{key:"initializeServiceWorkerMessaging",value:function(){var e=(0,h.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Sn()?this.initializeReceiver():this.initializeSender());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initializeReceiver",value:function(){var e=(0,h.Z)(g().mark((function e(){var t=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.receiver=bn._getInstance(Sn()?self:null),this.receiver._subscribe("keyChanged",function(){var e=(0,h.Z)(g().mark((function e(n,r){var i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._poll();case 2:return i=e.sent,e.abrupt("return",{keyProcessed:i.includes(r.key)});case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.receiver._subscribe("ping",function(){var e=(0,h.Z)(g().mark((function e(t,n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",["keyChanged"]);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initializeSender",value:function(){var e=(0,h.Z)(g().mark((function e(){var t,n,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xn();case 2:if(this.activeServiceWorker=e.sent,this.activeServiceWorker){e.next=5;break}return e.abrupt("return");case 5:return this.sender=new En(this.activeServiceWorker),e.next=8,this.sender._send("ping",{},800);case 8:if(r=e.sent){e.next=11;break}return e.abrupt("return");case 11:(null===(t=r[0])||void 0===t?void 0:t.fulfilled)&&(null===(n=r[0])||void 0===n?void 0:n.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"notifyServiceWorker",value:function(){var e=(0,h.Z)(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sender&&this.activeServiceWorker&&An()===this.activeServiceWorker){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50);case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_isAvailable",value:function(){var e=(0,h.Z)(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,indexedDB){e.next=3;break}return e.abrupt("return",!1);case 3:return e.next=5,Mn();case 5:return t=e.sent,e.next=8,Fn(t,pn,"1");case 8:return e.next=10,qn(t,pn);case 10:return e.abrupt("return",!0);case 13:e.prev=13,e.t0=e.catch(0);case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"_withPendingWrite",value:function(){var e=(0,h.Z)(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.pendingWrites++,e.prev=1,e.next=4,t();case 4:return e.prev=4,this.pendingWrites--,e.finish(4);case 7:case"end":return e.stop()}}),e,this,[[1,,4,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_set",value:function(){var e=(0,h.Z)(g().mark((function e(t,n){var r=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._withPendingWrite((0,h.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r._withRetries((function(e){return Fn(e,t,n)}));case 2:return r.localCache[t]=n,e.abrupt("return",r.notifyServiceWorker(t));case 4:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_get",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._withRetries((function(e){return Vn(e,t)}));case 2:return n=e.sent,this.localCache[t]=n,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_remove",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._withPendingWrite((0,h.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._withRetries((function(e){return qn(e,t)}));case 2:return delete n.localCache[t],e.abrupt("return",n.notifyServiceWorker(t));case 4:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_poll",value:function(){var e=(0,h.Z)(g().mark((function e(){var t,n,r,i,a,o,s,u,c,h,f;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._withRetries((function(e){var t=On(e,!1).getAll();return new Dn(t).toPromise()}));case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",[]);case 5:if(0===this.pendingWrites){e.next=7;break}return e.abrupt("return",[]);case 7:if(n=[],r=new Set,0!==t.length){i=(0,l.Z)(t);try{for(i.s();!(a=i.n()).done;)o=a.value,s=o.fbase_key,u=o.value,r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(u)&&(this.notifyListeners(s,u),n.push(s))}catch(d){i.e(d)}finally{i.f()}}for(c=0,h=Object.keys(this.localCache);c<h.length;c++)f=h[c],this.localCache[f]&&!r.has(f)&&(this.notifyListeners(f,null),n.push(f));return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"notifyListeners",value:function(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(var r=0,i=Array.from(n);r<i.length;r++){(0,i[r])(t)}}},{key:"startPolling",value:function(){var e=this;this.stopPolling(),this.pollTimer=setInterval((0,h.Z)(g().mark((function t(){return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._poll());case 1:case"end":return t.stop()}}),t)}))),800)}},{key:"stopPolling",value:function(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}},{key:"_addListener",value:function(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}},{key:"_removeListener",value:function(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}]),e}();Bn.type="LOCAL";var zn=Bn;function Hn(e,t){return H(e,"POST","/v2/accounts/mfaSignIn:start",z(e,t))}function Wn(e,t){return H(e,"POST","/v2/accounts/mfaSignIn:finalize",z(e,t))}at("rcb"),new U(3e4,6e4);var Kn="recaptcha";function Gn(e,t,n){return Yn.apply(this,arguments)}function Yn(){return(Yn=(0,h.Z)(g().mark((function e(t,n,r){var i,a,o,s,u,c,l,h,f;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.verify();case 2:if(a=e.sent,e.prev=3,Z("string"===typeof a,t,"argument-error"),Z(r.type===Kn,t,"argument-error"),!("session"in(o="string"===typeof n?{phoneNumber:n}:n))){e.next=26;break}if(s=o.session,!("phoneNumber"in o)){e.next=17;break}return Z("enroll"===s.type,t,"internal-error"),e.next=13,dn(t,{idToken:s.credential,phoneEnrollmentInfo:{phoneNumber:o.phoneNumber,recaptchaToken:a}});case 13:return u=e.sent,e.abrupt("return",u.phoneSessionInfo.sessionInfo);case 17:return Z("signin"===s.type,t,"internal-error"),Z(c=(null===(i=o.multiFactorHint)||void 0===i?void 0:i.uid)||o.multiFactorUid,t,"missing-multi-factor-info"),e.next=22,Hn(t,{mfaPendingCredential:s.credential,mfaEnrollmentId:c,phoneSignInInfo:{recaptchaToken:a}});case 22:return l=e.sent,e.abrupt("return",l.phoneResponseInfo.sessionInfo);case 24:e.next=31;break;case 26:return e.next=28,Nt(t,{phoneNumber:o.phoneNumber,recaptchaToken:a});case 28:return h=e.sent,f=h.sessionInfo,e.abrupt("return",f);case 31:return e.prev=31,r._reset(),e.finish(31);case 34:case"end":return e.stop()}}),e,null,[[3,,31,34]])})))).apply(this,arguments)}var Qn=function(){function e(t){(0,f.Z)(this,e),this.providerId=e.PROVIDER_ID,this.auth=et(t)}return(0,d.Z)(e,[{key:"verifyPhoneNumber",value:function(e,t){return Gn(this.auth,e,(0,m.m9)(t))}}],[{key:"credential",value:function(e,t){return Ot._fromVerification(e,t)}},{key:"credentialFromResult",value:function(t){var n=t;return e.credentialFromTaggedObject(n)}},{key:"credentialFromError",value:function(t){return e.credentialFromTaggedObject(t.customData||{})}},{key:"credentialFromTaggedObject",value:function(e){var t=e._tokenResponse;if(!t)return null;var n=t.phoneNumber,r=t.temporaryProof;return n&&r?Ot._fromTokenResponse(n,r):null}}]),e}();function Jn(e,t){return t?Pe(t):(Z(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Qn.PROVIDER_ID="phone",Qn.PHONE_SIGN_IN_METHOD="phone";var Xn=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e){var r;return(0,f.Z)(this,n),(r=t.call(this,"custom","custom")).params=e,r}return(0,d.Z)(n,[{key:"_getIdTokenResponse",value:function(e){return Ct(e,this._buildIdpRequest())}},{key:"_linkToIdToken",value:function(e,t){return Ct(e,this._buildIdpRequest(t))}},{key:"_getReauthenticationResolver",value:function(e){return Ct(e,this._buildIdpRequest())}},{key:"_buildIdpRequest",value:function(e){var t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}]),n}(yt);function $n(e){return en(e.auth,new Xn(e),e.bypassAuthState)}function er(e){var t=e.auth,n=e.user;return Z(n,t,"internal-error"),Xt(n,new Xn(e),e.bypassAuthState)}function tr(e){return nr.apply(this,arguments)}function nr(){return(nr=(0,h.Z)(g().mark((function e(t){var n,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.auth,Z(r=t.user,n,"internal-error"),e.abrupt("return",Qt(r,new Xn(t),t.bypassAuthState));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var rr=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,f.Z)(this,e),this.auth=t,this.resolver=r,this.user=i,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}return(0,d.Z)(e,[{key:"execute",value:function(){var e=this;return new Promise(function(){var t=(0,h.Z)(g().mark((function t(n,r){return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.pendingPromise={resolve:n,reject:r},t.prev=1,t.next=4,e.resolver._initialize(e.auth);case 4:return e.eventManager=t.sent,t.next=7,e.onExecution();case 7:e.eventManager.registerConsumer(e),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(1),e.reject(t.t0);case 13:case"end":return t.stop()}}),t,null,[[1,10]])})));return function(e,n){return t.apply(this,arguments)}}())}},{key:"onAuthEvent",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n,r,i,a,o,s,u;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.urlResponse,r=t.sessionId,i=t.postBody,a=t.tenantId,o=t.error,s=t.type,!o){e.next=4;break}return this.reject(o),e.abrupt("return");case 4:return u={auth:this.auth,requestUri:n,sessionId:r,tenantId:a||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState},e.prev=5,e.t0=this,e.next=9,this.getIdpTask(s)(u);case 9:e.t1=e.sent,e.t0.resolve.call(e.t0,e.t1),e.next=16;break;case 13:e.prev=13,e.t2=e.catch(5),this.reject(e.t2);case 16:case"end":return e.stop()}}),e,this,[[5,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onError",value:function(e){this.reject(e)}},{key:"getIdpTask",value:function(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return $n;case"linkViaPopup":case"linkViaRedirect":return tr;case"reauthViaPopup":case"reauthViaRedirect":return er;default:N(this.auth,"internal-error")}}},{key:"resolve",value:function(e){O(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}},{key:"reject",value:function(e){O(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}},{key:"unregisterAndCleanUp",value:function(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}]),e}(),ir=new U(2e3,1e4);var ar=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i,a,s){var u;return(0,f.Z)(this,n),(u=t.call(this,e,r,a,s)).provider=i,u.authWindow=null,u.pollId=null,n.currentPopupAction&&n.currentPopupAction.cancel(),n.currentPopupAction=(0,o.Z)(u),u}return(0,d.Z)(n,[{key:"executeNotNull",value:function(){var e=(0,h.Z)(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.execute();case 2:return Z(t=e.sent,this.auth,"internal-error"),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onExecution",value:function(){var e=(0,h.Z)(g().mark((function e(){var t,n=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O(1===this.filter.length,"Popup operations only handle one event"),t=In(),e.next=4,this.resolver._openPopup(this.auth,this.provider,this.filter[0],t);case 4:this.authWindow=e.sent,this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch((function(e){n.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(function(e){e||n.reject(A(n.auth,"web-storage-unsupported"))})),this.pollUserCancellation();case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"eventId",get:function(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}},{key:"cancel",value:function(){this.reject(A(this.auth,"cancelled-popup-request"))}},{key:"cleanUp",value:function(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,n.currentPopupAction=null}},{key:"pollUserCancellation",value:function(){var e=this;!function t(){var n,r;(null===(r=null===(n=e.authWindow)||void 0===n?void 0:n.window)||void 0===r?void 0:r.closed)?e.pollId=window.setTimeout((function(){e.pollId=null,e.reject(A(e.auth,"popup-closed-by-user"))}),8e3):e.pollId=window.setTimeout(t,ir.get())}()}}]),n}(rr);ar.currentPopupAction=null;var or=new Map,sr=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,f.Z)(this,n),(i=t.call(this,e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],r,void 0,a)).eventId=null,i}return(0,d.Z)(n,[{key:"execute",value:function(){var e=(0,h.Z)(g().mark((function e(){var t,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=or.get(this.auth._key())){e.next=21;break}return e.prev=2,e.next=5,ur(this.resolver,this.auth);case 5:if(!e.sent){e.next=12;break}return e.next=9,(0,i.Z)((0,a.Z)(n.prototype),"execute",this).call(this);case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=null;case 13:r=e.t0,t=function(){return Promise.resolve(r)},e.next=20;break;case 17:e.prev=17,e.t1=e.catch(2),t=function(){return Promise.reject(e.t1)};case 20:or.set(this.auth._key(),t);case 21:return this.bypassAuthState||or.set(this.auth._key(),(function(){return Promise.resolve(null)})),e.abrupt("return",t());case 23:case"end":return e.stop()}}),e,this,[[2,17]])})));return function(){return e.apply(this,arguments)}}()},{key:"onAuthEvent",value:function(){var e=(0,h.Z)(g().mark((function e(t){var r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("signInViaRedirect"!==t.type){e.next=4;break}return e.abrupt("return",(0,i.Z)((0,a.Z)(n.prototype),"onAuthEvent",this).call(this,t));case 4:if("unknown"!==t.type){e.next=7;break}return this.resolve(null),e.abrupt("return");case 7:if(!t.eventId){e.next=17;break}return e.next=10,this.auth._redirectUserForId(t.eventId);case 10:if(!(r=e.sent)){e.next=16;break}return this.user=r,e.abrupt("return",(0,i.Z)((0,a.Z)(n.prototype),"onAuthEvent",this).call(this,t));case 16:this.resolve(null);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onExecution",value:function(){var e=(0,h.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"cleanUp",value:function(){}}]),n}(rr);function ur(e,t){return cr.apply(this,arguments)}function cr(){return(cr=(0,h.Z)(g().mark((function e(t,n){var r,i,a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=fr(n),i=hr(t),e.next=4,i._isAvailable();case 4:if(e.sent){e.next=6;break}return e.abrupt("return",!1);case 6:return e.next=8,i._get(r);case 8:return e.t0=e.sent,a="true"===e.t0,e.next=12,i._remove(r);case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function lr(e,t){or.set(e._key(),t)}function hr(e){return Pe(e._redirectPersistence)}function fr(e){return De("pendingRedirect",e.config.apiKey,e.name)}function dr(e,t){return vr.apply(this,arguments)}function vr(){return vr=(0,h.Z)(g().mark((function e(t,n){var r,i,a,o,s,u=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]&&u[2],i=et(t),a=Jn(i,n),o=new sr(i,a,r),e.next=6,o.execute();case 6:if(!(s=e.sent)||r){e.next=13;break}return delete s.user._redirectEventId,e.next=11,i._persistUserIfCurrent(s.user);case 11:return e.next=13,i._setRedirectUser(null,n);case 13:return e.abrupt("return",s);case 14:case"end":return e.stop()}}),e)}))),vr.apply(this,arguments)}var pr=function(){function e(t){(0,f.Z)(this,e),this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}return(0,d.Z)(e,[{key:"registerConsumer",value:function(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}},{key:"unregisterConsumer",value:function(e){this.consumers.delete(e)}},{key:"onEvent",value:function(e){var t=this;if(this.hasEventBeenHandled(e))return!1;var n=!1;return this.consumers.forEach((function(r){t.isEventForConsumer(e,r)&&(n=!0,t.sendToConsumer(e,r),t.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return gr(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}},{key:"sendToConsumer",value:function(e,t){var n;if(e.error&&!gr(e)){var r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(A(this.auth,r))}else t.onAuthEvent(e)}},{key:"isEventForConsumer",value:function(e,t){var n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}},{key:"hasEventBeenHandled",value:function(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(yr(e))}},{key:"saveEventToCache",value:function(e){this.cachedEventUids.add(yr(e)),this.lastProcessedEventTime=Date.now()}}]),e}();function yr(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((function(e){return e})).join("-")}function gr(e){var t=e.type,n=e.error;return"unknown"===t&&(null===n||void 0===n?void 0:n.code)==="auth/".concat("no-auth-event")}function mr(e){return _r.apply(this,arguments)}function _r(){return _r=(0,h.Z)(g().mark((function e(t){var n,r=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.abrupt("return",H(t,"GET","/v1/projects",n));case 2:case"end":return e.stop()}}),e)}))),_r.apply(this,arguments)}var kr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,wr=/^https?/;function br(){return(br=(0,h.Z)(g().mark((function e(t){var n,r,i,a,o;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.config.emulator){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,mr(t);case 4:n=e.sent,r=n.authorizedDomains,i=(0,l.Z)(r),e.prev=7,i.s();case 9:if((a=i.n()).done){e.next=20;break}if(o=a.value,e.prev=11,!Ir(o)){e.next=14;break}return e.abrupt("return");case 14:e.next=18;break;case 16:e.prev=16,e.t0=e.catch(11);case 18:e.next=9;break;case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(7),i.e(e.t1);case 25:return e.prev=25,i.f(),e.finish(25);case 28:N(t,"unauthorized-domain");case 29:case"end":return e.stop()}}),e,null,[[7,22,25,28],[11,16]])})))).apply(this,arguments)}function Ir(e){var t=L(),n=new URL(t),r=n.protocol,i=n.hostname;if(e.startsWith("chrome-extension://")){var a=new URL(e);return""===a.hostname&&""===i?"chrome-extension:"===r&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===r&&a.hostname===i}if(!wr.test(r))return!1;if(kr.test(e))return i===e;var o=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+o+"|"+o+")$","i").test(i)}var Er=new U(3e4,6e4);function Tr(){var e=Tn().___jsl;if(null===e||void 0===e?void 0:e.H)for(var t=0,n=Object.keys(e.H);t<n.length;t++){var r=n[t];if(e.H[r].r=e.H[r].r||[],e.H[r].L=e.H[r].L||[],e.H[r].r=(0,v.Z)(e.H[r].L),e.CP)for(var i=0;i<e.CP.length;i++)e.CP[i]=null}}function Cr(e){return new Promise((function(t,n){var r,i,a;function o(){Tr(),gapi.load("gapi.iframes",{callback:function(){t(gapi.iframes.getContext())},ontimeout:function(){Tr(),n(A(e,"network-request-failed"))},timeout:Er.get()})}if(null===(i=null===(r=Tn().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(a=Tn().gapi)||void 0===a?void 0:a.load)){var s=at("iframefcb");return Tn()[s]=function(){gapi.load?o():n(A(e,"network-request-failed"))},rt("".concat(nt.gapiScript,"?onload=").concat(s)).catch((function(e){return n(e)}))}o()}})).catch((function(e){throw Sr=null,e}))}var Sr=null;function xr(e){return Sr=Sr||Cr(e)}var Nr=new U(5e3,15e3),Ar={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Pr=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Rr(e){var t=e.config;Z(t.authDomain,e,"auth-domain-config-required");var n=t.emulator?V(t,"emulator/auth/iframe"):"https://".concat(e.config.authDomain,"/").concat("__/auth/iframe"),r={apiKey:t.apiKey,appName:e.name,v:_.Jn},i=Pr.get(e.config.apiHost);i&&(r.eid=i);var a=e._getFrameworks();return a.length&&(r.fw=a.join(",")),"".concat(n,"?").concat((0,m.xO)(r).slice(1))}function Zr(e){return Dr.apply(this,arguments)}function Dr(){return Dr=(0,h.Z)(g().mark((function e(t){var n,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xr(t);case 2:return n=e.sent,Z(r=Tn().gapi,t,"internal-error"),e.abrupt("return",n.open({where:document.body,url:Rr(t),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ar,dontclear:!0},(function(e){return new Promise(function(){var n=(0,h.Z)(g().mark((function n(r,i){var a,o,s;return g().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=function(){Tn().clearTimeout(o),r(e)},n.next=3,e.restyle({setHideOnLeave:!1});case 3:a=A(t,"network-request-failed"),o=Tn().setTimeout((function(){i(a)}),Nr.get()),e.ping(s).then(s,(function(){i(a)}));case 6:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}())})));case 6:case"end":return e.stop()}}),e)}))),Dr.apply(this,arguments)}var Or={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Lr="_blank",Mr="http://localhost",Fr=function(){function e(t){(0,f.Z)(this,e),this.window=t,this.associatedEvent=null}return(0,d.Z)(e,[{key:"close",value:function(){if(this.window)try{this.window.close()}catch(e){}}}]),e}();function Ur(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600,a=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString(),s="",u=Object.assign(Object.assign({},Or),{width:r.toString(),height:i.toString(),top:a,left:o}),l=(0,m.z$)().toLowerCase();n&&(s=Ue(l)?Lr:n),Me(l)&&(t=t||Mr,u.scrollbars="yes");var h=Object.entries(u).reduce((function(e,t){var n=(0,c.Z)(t,2),r=n[0],i=n[1];return"".concat(e).concat(r,"=").concat(i,",")}),"");if(He(l)&&"_self"!==s)return Vr(t||"",s),new Fr(null);var f=window.open(t||"",s,h);Z(f,e,"popup-blocked");try{f.focus()}catch(d){}return new Fr(f)}function Vr(e,t){var n=document.createElement("a");n.href=e,n.target=t;var r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}var jr=encodeURIComponent("fac");function qr(e,t,n,r,i,a){return Br.apply(this,arguments)}function Br(){return(Br=(0,h.Z)(g().mark((function e(t,n,r,i,a,o){var s,u,l,h,f,d,v,p,y,k,w,b,I;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Z(t.config.authDomain,t,"auth-domain-config-required"),Z(t.config.apiKey,t,"invalid-api-key"),s={apiKey:t.config.apiKey,appName:t.name,authType:r,redirectUrl:i,v:_.Jn,eventId:a},n instanceof Ft)for(n.setDefaultLanguage(t.languageCode),s.providerId=n.providerId||"",(0,m.xb)(n.getCustomParameters())||(s.customParameters=JSON.stringify(n.getCustomParameters())),u=0,l=Object.entries(o||{});u<l.length;u++)h=(0,c.Z)(l[u],2),f=h[0],d=h[1],s[f]=d;for(n instanceof Ut&&(v=n.getScopes().filter((function(e){return""!==e}))).length>0&&(s.scopes=v.join(",")),t.tenantId&&(s.tid=t.tenantId),p=s,y=0,k=Object.keys(p);y<k.length;y++)w=k[y],void 0===p[w]&&delete p[w];return e.next=10,t._getAppCheckToken();case 10:return b=e.sent,I=b?"#".concat(jr,"=").concat(encodeURIComponent(b)):"",e.abrupt("return","".concat(zr(t),"?").concat((0,m.xO)(p).slice(1)).concat(I));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function zr(e){var t=e.config;return t.emulator?V(t,"emulator/auth/handler"):"https://".concat(t.authDomain,"/").concat("__/auth/handler")}var Hr="webStorageSupport",Wr=function(){function e(){(0,f.Z)(this,e),this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=kn,this._completeRedirectFn=dr,this._overrideRedirectResult=lr}return(0,d.Z)(e,[{key:"_openPopup",value:function(){var e=(0,h.Z)(g().mark((function e(t,n,r,i){var a,o;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O(null===(a=this.eventManagers[t._key()])||void 0===a?void 0:a.manager,"_initialize() not called before _openPopup()"),e.next=3,qr(t,n,r,L(),i);case 3:return o=e.sent,e.abrupt("return",Ur(t,o,In()));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"_openRedirect",value:function(){var e=(0,h.Z)(g().mark((function e(t,n,r,i){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._originValidation(t);case 2:return e.next=4,qr(t,n,r,L(),i);case 4:return Cn(e.sent),e.abrupt("return",new Promise((function(){})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"_initialize",value:function(e){var t=this,n=e._key();if(this.eventManagers[n]){var r=this.eventManagers[n],i=r.manager,a=r.promise;return i?Promise.resolve(i):(O(a,"If manager is not set, promise should be"),a)}var o=this.initAndGetManager(e);return this.eventManagers[n]={promise:o},o.catch((function(){delete t.eventManagers[n]})),o}},{key:"initAndGetManager",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n,r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Zr(t);case 2:return n=e.sent,r=new pr(t),n.register("authEvent",(function(e){return Z(null===e||void 0===e?void 0:e.authEvent,t,"invalid-auth-event"),{status:r.onEvent(e.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:r},this.iframes[t._key()]=n,e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_isIframeWebStorageSupported",value:function(e,t){this.iframes[e._key()].send(Hr,{type:Hr},(function(n){var r,i=null===(r=null===n||void 0===n?void 0:n[0])||void 0===r?void 0:r.webStorageSupport;void 0!==i&&t(!!i),N(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}},{key:"_originValidation",value:function(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=function(e){return br.apply(this,arguments)}(e)),this.originValidationPromises[t]}},{key:"_shouldInitProactively",get:function(){return Ke()||Fe()||ze()}}]),e}(),Kr=Wr,Gr=function(){function e(t){(0,f.Z)(this,e),this.factorId=t}return(0,d.Z)(e,[{key:"_process",value:function(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return D("unexpected MultiFactorSessionType")}}}]),e}(),Yr=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e){var r;return(0,f.Z)(this,n),(r=t.call(this,"phone")).credential=e,r}return(0,d.Z)(n,[{key:"_finalizeEnroll",value:function(e,t,n){return function(e,t){return H(e,"POST","/v2/accounts/mfaEnrollment:finalize",z(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}},{key:"_finalizeSignIn",value:function(e,t){return function(e,t){return H(e,"POST","/v2/accounts/mfaSignIn:finalize",z(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}],[{key:"_fromCredential",value:function(e){return new n(e)}}]),n}(Gr);(function(){function e(){(0,f.Z)(this,e)}return(0,d.Z)(e,null,[{key:"assertion",value:function(e){return Yr._fromCredential(e)}}]),e}()).FACTOR_ID="phone";var Qr=function(){function e(){(0,f.Z)(this,e)}return(0,d.Z)(e,null,[{key:"assertionForEnrollment",value:function(e,t){return Jr._fromSecret(e,t)}},{key:"assertionForSignIn",value:function(e,t){return Jr._fromEnrollmentId(e,t)}},{key:"generateSecret",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n,r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Z("undefined"!==typeof(null===(n=(r=t).user)||void 0===n?void 0:n.auth),"internal-error"),e.next=4,a=r.user.auth,o={idToken:r.credential,totpEnrollmentInfo:{}},H(a,"POST","/v2/accounts/mfaEnrollment:start",z(a,o));case 4:return i=e.sent,e.abrupt("return",Xr._fromStartTotpMfaEnrollmentResponse(i,r.user.auth));case 6:case"end":return e.stop()}var a,o}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}();Qr.FACTOR_ID="totp";var Jr=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i){var a;return(0,f.Z)(this,n),(a=t.call(this,"totp")).otp=e,a.enrollmentId=r,a.secret=i,a}return(0,d.Z)(n,[{key:"_finalizeEnroll",value:function(){var e=(0,h.Z)(g().mark((function e(t,n,r){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Z("undefined"!==typeof this.secret,t,"argument-error"),e.abrupt("return",vn(t,{idToken:n,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_finalizeSignIn",value:function(){var e=(0,h.Z)(g().mark((function e(t,n){var r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Z(void 0!==this.enrollmentId&&void 0!==this.otp,t,"argument-error"),r={verificationCode:this.otp},e.abrupt("return",Wn(t,{mfaPendingCredential:n,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r}));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}],[{key:"_fromSecret",value:function(e,t){return new n(t,void 0,e)}},{key:"_fromEnrollmentId",value:function(e,t){return new n(t,e)}}]),n}(Gr),Xr=function(){function e(t,n,r,i,a,o,s){(0,f.Z)(this,e),this.sessionInfo=o,this.auth=s,this.secretKey=t,this.hashingAlgorithm=n,this.codeLength=r,this.codeIntervalSeconds=i,this.enrollmentCompletionDeadline=a}return(0,d.Z)(e,[{key:"_makeTotpVerificationInfo",value:function(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}},{key:"generateQrCodeUrl",value:function(e,t){var n,r=!1;return($r(e)||$r(t))&&(r=!0),r&&($r(e)&&(e=(null===(n=this.auth.currentUser)||void 0===n?void 0:n.email)||"unknownuser"),$r(t)&&(t=this.auth.name)),"otpauth://totp/".concat(t,":").concat(e,"?secret=").concat(this.secretKey,"&issuer=").concat(t,"&algorithm=").concat(this.hashingAlgorithm,"&digits=").concat(this.codeLength)}}],[{key:"_fromStartTotpMfaEnrollmentResponse",value:function(t,n){return new e(t.totpSessionInfo.sharedSecretKey,t.totpSessionInfo.hashingAlgorithm,t.totpSessionInfo.verificationCodeLength,t.totpSessionInfo.periodSec,new Date(t.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),t.totpSessionInfo.sessionInfo,n)}}]),e}();function $r(e){return"undefined"===typeof e||0===(null===e||void 0===e?void 0:e.length)}var ei="@firebase/auth",ti="1.6.1",ni=function(){function e(t){(0,f.Z)(this,e),this.auth=t,this.internalListeners=new Map}return(0,d.Z)(e,[{key:"getUid",value:function(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}},{key:"getToken",value:function(){var e=(0,h.Z)(g().mark((function e(t){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.assertAuthConfigured(),e.next=3,this.auth._initializationPromise;case 3:if(this.auth.currentUser){e.next=5;break}return e.abrupt("return",null);case 5:return e.next=7,this.auth.currentUser.getIdToken(t);case 7:return n=e.sent,e.abrupt("return",{accessToken:n});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addAuthTokenListener",value:function(e){if(this.assertAuthConfigured(),!this.internalListeners.has(e)){var t=this.auth.onIdTokenChanged((function(t){e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}}},{key:"removeAuthTokenListener",value:function(e){this.assertAuthConfigured();var t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}},{key:"assertAuthConfigured",value:function(){Z(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}},{key:"updateProactiveRefresh",value:function(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}]),e}();var ri,ii=(0,m.Pz)("authIdTokenMaxAge")||300,ai=null,oi=function(e){return function(){var t=(0,h.Z)(g().mark((function t(n){var r,i,a;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=n,!t.t0){t.next=5;break}return t.next=4,n.getIdTokenResult();case 4:t.t0=t.sent;case 5:if(r=t.t0,!((i=r&&((new Date).getTime()-Date.parse(r.issuedAtTime))/1e3)&&i>ii)){t.next=9;break}return t.abrupt("return");case 9:if(a=null===r||void 0===r?void 0:r.token,ai!==a){t.next=12;break}return t.abrupt("return");case 12:return ai=a,t.next=15,fetch(e,{method:a?"POST":"DELETE",headers:a?{Authorization:"Bearer ".concat(a)}:{}});case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()};function si(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_.Mq)(),t=(0,_.qX)(e,"auth");if(t.isInitialized())return t.getImmediate();var n=ft(e,{popupRedirectResolver:Kr,persistence:[zn,mn,kn]}),r=(0,m.Pz)("authTokenSyncURL");if(r){var i=oi(r);hn(n,i,(function(){return i(n.currentUser)})),ln(n,(function(e){return i(e)}))}var a=(0,m.q4)("auth");return a&&dt(n,"http://".concat(a)),n}nt={loadJS:function(e){return new Promise((function(t,n){var r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=function(e){var t=A("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)}))},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},ri="Browser",(0,_.Xd)(new b.wA("auth",(function(e,t){var n=t.options,r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),o=r.options,s=o.apiKey,u=o.authDomain;Z(s&&!s.includes(":"),"invalid-api-key",{appName:r.name});var c={apiKey:s,authDomain:u,clientPlatform:ri,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ge(ri)},l=new $e(r,i,a,c);return function(e,t){var n=(null===t||void 0===t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Pe);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null===t||void 0===t?void 0:t.popupRedirectResolver)}(l,n),l}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((function(e,t,n){e.getProvider("auth-internal").initialize()}))),(0,_.Xd)(new b.wA("auth-internal",(function(e){return function(e){return new ni(e)}(et(e.getProvider("auth").getImmediate()))}),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,_.KN)(ei,ti,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(ri)),(0,_.KN)(ei,ti,"esm2017")},2685:function(e,t,n){n.d(t,{U2:function(){return Mi},N8:function(){return zi},iH:function(){return Oi}});var r=n(9439),i=n(5861),a=n(7326),o=n(136),s=n(3668),u=n(3433),c=n(7762),l=n(5671),h=n(3144),f=n(7757),d=n.n(f),v=n(9383),p=n(3258),y=n(5854),g=n(6781),m="@firebase/database",_="1.0.3",k="";function w(e){k=e}var b=function(){function e(t){(0,l.Z)(this,e),this.domStorage_=t,this.prefix_="firebase:"}return(0,h.Z)(e,[{key:"set",value:function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),(0,y.Wl)(t))}},{key:"get",value:function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:(0,y.cI)(t)}},{key:"remove",value:function(e){this.domStorage_.removeItem(this.prefixedName_(e))}},{key:"prefixedName_",value:function(e){return this.prefix_+e}},{key:"toString",value:function(){return this.domStorage_.toString()}}]),e}(),I=function(){function e(){(0,l.Z)(this,e),this.cache_={},this.isInMemoryStorage=!0}return(0,h.Z)(e,[{key:"set",value:function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}},{key:"get",value:function(e){return(0,y.r3)(this.cache_,e)?this.cache_[e]:null}},{key:"remove",value:function(e){delete this.cache_[e]}}]),e}(),E=function(e){try{if("undefined"!==typeof window&&"undefined"!==typeof window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new b(t)}}catch(n){}return new I},T=E("localStorage"),C=E("sessionStorage"),S=new g.Yd("@firebase/database"),x=function(){var e=1;return function(){return e++}}(),N=function(e){var t=(0,y.dS)(e),n=new y.gQ;n.update(t);var r=n.digest();return y.US.encodeByteArray(r)},A=function e(){for(var t="",n=0;n<arguments.length;n++){var r=n<0||arguments.length<=n?void 0:arguments[n];Array.isArray(r)||r&&"object"===typeof r&&"number"===typeof r.length?t+=e.apply(null,r):t+="object"===typeof r?(0,y.Wl)(r):r,t+=" "}return t},P=null,R=!0,Z=function(e,t){(0,y.hu)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(S.logLevel=g.in.VERBOSE,P=S.log.bind(S),t&&C.set("logging_enabled",!0)):"function"===typeof e?P=e:(P=null,C.remove("logging_enabled"))},D=function(){if(!0===R&&(R=!1,null===P&&!0===C.get("logging_enabled")&&Z(!0)),P){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=A.apply(null,t);P(r)}},O=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];D.apply(void 0,[e].concat(n))}},L=function(){var e="FIREBASE INTERNAL ERROR: "+A.apply(void 0,arguments);S.error(e)},M=function(){var e="FIREBASE FATAL ERROR: ".concat(A.apply(void 0,arguments));throw S.error(e),new Error(e)},F=function(){var e="FIREBASE WARNING: "+A.apply(void 0,arguments);S.warn(e)},U=function(e){return"number"===typeof e&&(e!==e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},V="[MIN_NAME]",j="[MAX_NAME]",q=function(e,t){if(e===t)return 0;if(e===V||t===j)return-1;if(t===V||e===j)return 1;var n=Q(e),r=Q(t);return null!==n?null!==r?n-r===0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1},B=function(e,t){return e===t?0:e<t?-1:1},z=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+(0,y.Wl)(t))},H=function e(t){if("object"!==typeof t||null===t)return(0,y.Wl)(t);var n=[];for(var r in t)n.push(r);n.sort();for(var i="{",a=0;a<n.length;a++)0!==a&&(i+=","),i+=(0,y.Wl)(n[a]),i+=":",i+=e(t[n[a]]);return i+="}"},W=function(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function K(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}var G=function(e){(0,y.hu)(!U(e),"Invalid JSON number");var t,n,r,i,a,o=1023;0===e?(n=0,r=0,t=1/e===-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),o))+o,r=Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,r=Math.round(e/Math.pow(2,-1074))));var s=[];for(a=52;a;a-=1)s.push(r%2?1:0),r=Math.floor(r/2);for(a=11;a;a-=1)s.push(n%2?1:0),n=Math.floor(n/2);s.push(t?1:0),s.reverse();var u=s.join(""),c="";for(a=0;a<64;a+=8){var l=parseInt(u.substr(a,8),2).toString(16);1===l.length&&(l="0"+l),c+=l}return c.toLowerCase()};var Y=new RegExp("^-?(0*)\\d{1,10}$"),Q=function(e){if(Y.test(e)){var t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},J=function(e){try{e()}catch(t){setTimeout((function(){var e=t.stack||"";throw F("Exception was thrown by user callback.",e),t}),Math.floor(0))}},X=function(e,t){var n=setTimeout(e,t);return"number"===typeof n&&"undefined"!==typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"===typeof n&&n.unref&&n.unref(),n},$=function(){function e(t,n){var r=this;(0,l.Z)(this,e),this.appName_=t,this.appCheckProvider=n,this.appCheck=null===n||void 0===n?void 0:n.getImmediate({optional:!0}),this.appCheck||null===n||void 0===n||n.get().then((function(e){return r.appCheck=e}))}return(0,h.Z)(e,[{key:"getToken",value:function(e){var t=this;return this.appCheck?this.appCheck.getToken(e):new Promise((function(n,r){setTimeout((function(){t.appCheck?t.getToken(e).then(n,r):n(null)}),0)}))}},{key:"addTokenChangeListener",value:function(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((function(t){return t.addTokenListener(e)}))}},{key:"notifyForInvalidToken",value:function(){F('Provided AppCheck credentials for the app named "'.concat(this.appName_,'" ')+"are invalid. This usually indicates your app was not initialized correctly.")}}]),e}(),ee=function(){function e(t,n,r){var i=this;(0,l.Z)(this,e),this.appName_=t,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit((function(e){return i.auth_=e}))}return(0,h.Z)(e,[{key:"getToken",value:function(e){var t=this;return this.auth_?this.auth_.getToken(e).catch((function(e){return e&&"auth/token-not-initialized"===e.code?(D("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)})):new Promise((function(n,r){setTimeout((function(){t.auth_?t.getToken(e).then(n,r):n(null)}),0)}))}},{key:"addTokenChangeListener",value:function(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((function(t){return t.addAuthTokenListener(e)}))}},{key:"removeTokenChangeListener",value:function(e){this.authProvider_.get().then((function(t){return t.removeAuthTokenListener(e)}))}},{key:"notifyForInvalidToken",value:function(){var e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',F(e)}}]),e}(),te=function(){function e(t){(0,l.Z)(this,e),this.accessToken=t}return(0,h.Z)(e,[{key:"getToken",value:function(e){return Promise.resolve({accessToken:this.accessToken})}},{key:"addTokenChangeListener",value:function(e){e(this.accessToken)}},{key:"removeTokenChangeListener",value:function(e){}},{key:"notifyForInvalidToken",value:function(){}}]),e}();te.OWNER="owner";var ne="5",re=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ie="websocket",ae="long_polling",oe=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]&&arguments[7];(0,l.Z)(this,e),this.secure=n,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=a,this.persistenceKey=o,this.includeNamespaceInQueryParams=s,this.isUsingEmulator=u,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=T.get("host:"+t)||this._host}return(0,h.Z)(e,[{key:"isCacheableHost",value:function(){return"s-"===this.internalHost.substr(0,2)}},{key:"isCustomHost",value:function(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}},{key:"host",get:function(){return this._host},set:function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&T.set("host:"+this._host,this.internalHost))}},{key:"toString",value:function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}},{key:"toURLString",value:function(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns=".concat(this.namespace):"";return"".concat(e).concat(this.host,"/").concat(t)}}]),e}();function se(e,t,n){var r;if((0,y.hu)("string"===typeof t,"typeof type must == string"),(0,y.hu)("object"===typeof n,"typeof params must == object"),t===ie)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==ae)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);var i=[];return K(n,(function(e,t){i.push(e+"="+t)})),r+i.join("&")}var ue=function(){function e(){(0,l.Z)(this,e),this.counters_={}}return(0,h.Z)(e,[{key:"incrementCounter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;(0,y.r3)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}},{key:"get",value:function(){return(0,y.p$)(this.counters_)}}]),e}(),ce={},le={};function he(e){var t=e.toString();return ce[t]||(ce[t]=new ue),ce[t]}var fe=function(){function e(t){(0,l.Z)(this,e),this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return(0,h.Z)(e,[{key:"closeAfter",value:function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}},{key:"handleResponse",value:function(e,t){var n=this;this.pendingResponses[e]=t;for(var r=function(){var e=n.pendingResponses[n.currentResponseNum];delete n.pendingResponses[n.currentResponseNum];for(var t=function(t){e[t]&&J((function(){n.onMessage_(e[t])}))},r=0;r<e.length;++r)t(r);if(n.currentResponseNum===n.closeAfterResponse)return n.onClose&&(n.onClose(),n.onClose=null),"break";n.currentResponseNum++};this.pendingResponses[this.currentResponseNum];){if("break"===r())break}}}]),e}(),de="start",ve="close",pe=function(){function e(t,n,r,i,a,o,s){var u=this;(0,l.Z)(this,e),this.connId=t,this.repoInfo=n,this.applicationId=r,this.appCheckToken=i,this.authToken=a,this.transportSessionId=o,this.lastSessionId=s,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=O(t),this.stats_=he(n),this.urlFn=function(e){return u.appCheckToken&&(e.ac=u.appCheckToken),se(n,ae,e)}}return(0,h.Z)(e,[{key:"open",value:function(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new fe(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if((0,y.Yr)()||"complete"===document.readyState)e();else{var t=!1,n=function n(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((function(){if(!n.isClosed_){n.scriptTagHolder=new ye((function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var i=t[0],a=t[1],o=t[2];t[3],t[4];if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,i===de)n.id=a,n.password=o;else{if(i!==ve)throw new Error("Unrecognized command received: "+i);a?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(a,(function(){n.onClosed_()}))):n.onClosed_()}}),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var i=t[0],a=t[1];n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(i,a)}),(function(){n.onClosed_()}),n.urlFn);var e={start:"t"};e.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=n.scriptTagHolder.uniqueCallbackIdentifier),e.v=ne,n.transportSessionId&&(e.s=n.transportSessionId),n.lastSessionId&&(e.ls=n.lastSessionId),n.applicationId&&(e.p=n.applicationId),n.appCheckToken&&(e.ac=n.appCheckToken),"undefined"!==typeof location&&location.hostname&&re.test(location.hostname)&&(e.r="f");var t=n.urlFn(e);n.log_("Connecting via long-poll to "+t),n.scriptTagHolder.addTag(t,(function(){}))}}))}},{key:"start",value:function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}},{key:"markConnectionHealthy",value:function(){}},{key:"shutdown_",value:function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}},{key:"onClosed_",value:function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}},{key:"close",value:function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}},{key:"send",value:function(e){var t=(0,y.Wl)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var n=(0,y.h$)(t),r=W(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}},{key:"addDisconnectPingFrame",value:function(e,t){if(!(0,y.Yr)()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}}},{key:"incrementIncomingBytes_",value:function(e){var t=(0,y.Wl)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}],[{key:"forceAllow",value:function(){e.forceAllow_=!0}},{key:"forceDisallow",value:function(){e.forceDisallow_=!0}},{key:"isAvailable",value:function(){return!(0,y.Yr)()&&(!!e.forceAllow_||!e.forceDisallow_&&"undefined"!==typeof document&&null!=document.createElement&&!("object"===typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"===typeof Windows&&"object"===typeof Windows.UI))}}]),e}(),ye=function(){function e(t,n,r,i){if((0,l.Z)(this,e),this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,y.Yr)())this.commandCB=t,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=x(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();var a="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length))a='<script>document.domain="'+document.domain+'";<\/script>';var o="<html><body>"+a+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(s){D("frame writing exception"),s.stack&&D(s.stack),D(s)}}}return(0,h.Z)(e,[{key:"close",value:function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)}),Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())}},{key:"startLongPoll",value:function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}},{key:"newRequest_",value:function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;for(var t=this.urlFn(e),n="",r=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}},{key:"enqueueSegment",value:function(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}},{key:"addLongPollTag_",value:function(e,t){var n=this;this.outstandingRequests.add(t);var r=function(){n.outstandingRequests.delete(t),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(e,(function(){clearTimeout(i),r()}))}},{key:"addTag",value:function(e,t){var n=this;(0,y.Yr)()?this.doNodeLongPoll(e,t):setTimeout((function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){D("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(i){}}),Math.floor(1))}}],[{key:"createIFrame_",value:function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||D("No IE domain setting required")}catch(n){var t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}}]),e}(),ge=null;"undefined"!==typeof MozWebSocket?ge=MozWebSocket:"undefined"!==typeof WebSocket&&(ge=WebSocket);var me=function(){function e(t,n,r,i,a,o,s){(0,l.Z)(this,e),this.connId=t,this.applicationId=r,this.appCheckToken=i,this.authToken=a,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=O(this.connId),this.stats_=he(n),this.connURL=e.connectionURL_(n,o,s,i,r),this.nodeAdmin=n.nodeAdmin}return(0,h.Z)(e,[{key:"open",value:function(e,t){var n=this;this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,T.set("previous_websocket_failure",!0);try{var r;if((0,y.Yr)()){var i=this.nodeAdmin?"AdminNode":"Node";r={headers:{"User-Agent":"Firebase/".concat(ne,"/").concat(k,"/").concat(process.platform,"/").concat(i),"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(r.headers.Authorization="Bearer ".concat(this.authToken)),this.appCheckToken&&(r.headers["X-Firebase-AppCheck"]=this.appCheckToken);var a={NODE_ENV:"production",PUBLIC_URL:"/LearnLingo",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0},o=0===this.connURL.indexOf("wss://")?a.HTTPS_PROXY||a.https_proxy:a.HTTP_PROXY||a.http_proxy;o&&(r.proxy={origin:o})}this.mySock=new ge(this.connURL,[],r)}catch(u){this.log_("Error instantiating WebSocket.");var s=u.message||u.data;return s&&this.log_(s),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(e){n.handleIncomingFrame(e)},this.mySock.onerror=function(e){n.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&n.log_(t),n.onClosed_()}}},{key:"start",value:function(){}},{key:"markConnectionHealthy",value:function(){T.remove("previous_websocket_failure")}},{key:"appendFrame_",value:function(e){if(this.frames.push(e),this.frames.length===this.totalFrames){var t=this.frames.join("");this.frames=null;var n=(0,y.cI)(t);this.onMessage(n)}}},{key:"handleNewFrameCount_",value:function(e){this.totalFrames=e,this.frames=[]}},{key:"extractFrameCount_",value:function(e){if((0,y.hu)(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}},{key:"handleIncomingFrame",value:function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var n=this.extractFrameCount_(t);null!==n&&this.appendFrame_(n)}}}},{key:"send",value:function(e){this.resetKeepAlive();var t=(0,y.Wl)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=W(t,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])}},{key:"shutdown_",value:function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}},{key:"onClosed_",value:function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}},{key:"close",value:function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}},{key:"resetKeepAlive",value:function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()}),Math.floor(45e3))}},{key:"sendString_",value:function(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}],[{key:"connectionURL_",value:function(e,t,n,r,i){var a={};return a.v=ne,!(0,y.Yr)()&&"undefined"!==typeof location&&location.hostname&&re.test(location.hostname)&&(a.r="f"),t&&(a.s=t),n&&(a.ls=n),r&&(a.ac=r),i&&(a.p=i),se(e,ie,a)}},{key:"forceDisallow",value:function(){e.forceDisallow_=!0}},{key:"isAvailable",value:function(){var t=!1;if("undefined"!==typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(t=!0)}return!t&&null!==ge&&!e.forceDisallow_}},{key:"previouslyFailed",value:function(){return T.isInMemoryStorage||!0===T.get("previous_websocket_failure")}}]),e}();me.responsesRequiredToBeHealthy=2,me.healthyTimeout=3e4;var _e=function(){function e(t){(0,l.Z)(this,e),this.initTransports_(t)}return(0,h.Z)(e,[{key:"initTransports_",value:function(t){var n=me&&me.isAvailable(),r=n&&!me.previouslyFailed();if(t.webSocketOnly&&(n||F("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[me];else{var i,a=this.transports_=[],o=(0,c.Z)(e.ALL_TRANSPORTS);try{for(o.s();!(i=o.n()).done;){var s=i.value;s&&s.isAvailable()&&a.push(s)}}catch(u){o.e(u)}finally{o.f()}e.globalTransportInitialized_=!0}}},{key:"initialTransport",value:function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}},{key:"upgradeTransport",value:function(){return this.transports_.length>1?this.transports_[1]:null}}],[{key:"ALL_TRANSPORTS",get:function(){return[pe,me]}},{key:"IS_TRANSPORT_INITIALIZED",get:function(){return this.globalTransportInitialized_}}]),e}();_e.globalTransportInitialized_=!1;var ke=function(){function e(t,n,r,i,a,o,s,u,c,h){(0,l.Z)(this,e),this.id=t,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=a,this.onMessage_=o,this.onReady_=s,this.onDisconnect_=u,this.onKill_=c,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=O("c:"+this.id+":"),this.transportManager_=new _e(n),this.log_("Connection created"),this.start_()}return(0,h.Z)(e,[{key:"start_",value:function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){e.conn_&&e.conn_.open(n,r)}),Math.floor(0));var i=t.healthyTimeout||0;i>0&&(this.healthyTimeout_=X((function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>102400?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>10240?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))}),Math.floor(i)))}},{key:"nextTransportId_",value:function(){return"c:"+this.id+":"+this.connectionCount++}},{key:"disconnReceiver_",value:function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}}},{key:"connReceiver_",value:function(e){var t=this;return function(n){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}}},{key:"sendRequest",value:function(e){var t={t:"d",d:e};this.sendData_(t)}},{key:"tryCleanupConnection",value:function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}},{key:"onSecondaryControl_",value:function(e){if("t"in e){var t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}},{key:"onSecondaryMessageReceived_",value:function(e){var t=z("t",e),n=z("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}},{key:"upgradeIfSecondaryHealthy_",value:function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}},{key:"proceedWithUpgrade_",value:function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}},{key:"onPrimaryMessageReceived_",value:function(e){var t=z("t",e),n=z("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}},{key:"onDataMessage_",value:function(e){this.onPrimaryResponse_(),this.onMessage_(e)}},{key:"onPrimaryResponse_",value:function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}},{key:"onControl_",value:function(e){var t=z("t",e);if("d"in e){var n=e.d;if("h"===t){var r=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?L("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):L("Unknown control packet command: "+t)}}},{key:"onHandshake_",value:function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),ne!==n&&F("Protocol version mismatch detected"),this.tryStartUpgrade_())}},{key:"tryStartUpgrade_",value:function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}},{key:"startUpgrade_",value:function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),X((function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())}),Math.floor(6e4))}},{key:"onReset_",value:function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}},{key:"onConnectionEstablished_",value:function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):X((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}},{key:"sendPingOnPrimaryIfNecessary_",value:function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}},{key:"onSecondaryConnectionLost_",value:function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}},{key:"onConnectionLost_",value:function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(T.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}},{key:"onConnectionShutdown_",value:function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}},{key:"sendData_",value:function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}},{key:"close",value:function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}},{key:"closeConnections_",value:function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}]),e}(),we=function(){function e(){(0,l.Z)(this,e)}return(0,h.Z)(e,[{key:"put",value:function(e,t,n,r){}},{key:"merge",value:function(e,t,n,r){}},{key:"refreshAuthToken",value:function(e){}},{key:"refreshAppCheckToken",value:function(e){}},{key:"onDisconnectPut",value:function(e,t,n){}},{key:"onDisconnectMerge",value:function(e,t,n){}},{key:"onDisconnectCancel",value:function(e,t){}},{key:"reportStats",value:function(e){}}]),e}(),be=function(){function e(t){(0,l.Z)(this,e),this.allowedEvents_=t,this.listeners_={},(0,y.hu)(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}return(0,h.Z)(e,[{key:"trigger",value:function(e){if(Array.isArray(this.listeners_[e])){for(var t=(0,u.Z)(this.listeners_[e]),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var a=0;a<t.length;a++)t[a].callback.apply(t[a].context,r)}}},{key:"on",value:function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)}},{key:"off",value:function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}},{key:"validateEventType_",value:function(e){(0,y.hu)(this.allowedEvents_.find((function(t){return t===e})),"Unknown event: "+e)}}]),e}(),Ie=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,l.Z)(this,n),(e=t.call(this,["online"])).online_=!0,"undefined"===typeof window||"undefined"===typeof window.addEventListener||(0,y.uI)()||(window.addEventListener("online",(function(){e.online_||(e.online_=!0,e.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){e.online_&&(e.online_=!1,e.trigger("online",!1))}),!1)),e}return(0,h.Z)(n,[{key:"getInitialEvent",value:function(e){return(0,y.hu)("online"===e,"Unknown event type: "+e),[this.online_]}},{key:"currentlyOnline",value:function(){return this.online_}}],[{key:"getInstance",value:function(){return new n}}]),n}(be),Ee=function(){function e(t,n){if((0,l.Z)(this,e),void 0===n){this.pieces_=t.split("/");for(var r=0,i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=n}return(0,h.Z)(e,[{key:"toString",value:function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}]),e}();function Te(){return new Ee("")}function Ce(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function Se(e){return e.pieces_.length-e.pieceNum_}function xe(e){var t=e.pieceNum_;return t<e.pieces_.length&&t++,new Ee(e.pieces_,t)}function Ne(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Ae(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.pieces_.slice(e.pieceNum_+t)}function Pe(e){if(e.pieceNum_>=e.pieces_.length)return null;for(var t=[],n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new Ee(t,0)}function Re(e,t){for(var n=[],r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof Ee)for(var i=t.pieceNum_;i<t.pieces_.length;i++)n.push(t.pieces_[i]);else for(var a=t.split("/"),o=0;o<a.length;o++)a[o].length>0&&n.push(a[o]);return new Ee(n,0)}function Ze(e){return e.pieceNum_>=e.pieces_.length}function De(e,t){var n=Ce(e),r=Ce(t);if(null===n)return t;if(n===r)return De(xe(e),xe(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Oe(e,t){if(Se(e)!==Se(t))return!1;for(var n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function Le(e,t){var n=e.pieceNum_,r=t.pieceNum_;if(Se(e)>Se(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}var Me=(0,h.Z)((function e(t,n){(0,l.Z)(this,e),this.errorPrefix_=n,this.parts_=Ae(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(var r=0;r<this.parts_.length;r++)this.byteLength_+=(0,y.ug)(this.parts_[r]);Fe(this)}));function Fe(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+Ue(e))}function Ue(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}var Ve=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e,r,i;return(0,l.Z)(this,n),e=t.call(this,["visible"]),"undefined"!==typeof document&&"undefined"!==typeof document.addEventListener&&("undefined"!==typeof document.hidden?(i="visibilitychange",r="hidden"):"undefined"!==typeof document.mozHidden?(i="mozvisibilitychange",r="mozHidden"):"undefined"!==typeof document.msHidden?(i="msvisibilitychange",r="msHidden"):"undefined"!==typeof document.webkitHidden&&(i="webkitvisibilitychange",r="webkitHidden")),e.visible_=!0,i&&document.addEventListener(i,(function(){var t=!document[r];t!==e.visible_&&(e.visible_=t,e.trigger("visible",t))}),!1),e}return(0,h.Z)(n,[{key:"getInitialEvent",value:function(e){return(0,y.hu)("visible"===e,"Unknown event type: "+e),[this.visible_]}}],[{key:"getInstance",value:function(){return new n}}]),n}(be),je=1e3,qe=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,r,i,o,s,u,c,h){var f;if((0,l.Z)(this,n),(f=t.call(this)).repoInfo_=e,f.applicationId_=r,f.onDataUpdate_=i,f.onConnectStatus_=o,f.onServerInfoUpdate_=s,f.authTokenProvider_=u,f.appCheckTokenProvider_=c,f.authOverride_=h,f.id=n.nextPersistentConnectionId_++,f.log_=O("p:"+f.id+":"),f.interruptReasons_={},f.listens=new Map,f.outstandingPuts_=[],f.outstandingGets_=[],f.outstandingPutCount_=0,f.outstandingGetCount_=0,f.onDisconnectRequestQueue_=[],f.connected_=!1,f.reconnectDelay_=je,f.maxReconnectDelay_=3e5,f.securityDebugCallback_=null,f.lastSessionId=null,f.establishConnectionTimer_=null,f.visible_=!1,f.requestCBHash_={},f.requestNumber_=0,f.realtime_=null,f.authToken_=null,f.appCheckToken_=null,f.forceTokenRefresh_=!1,f.invalidAuthTokenCount_=0,f.invalidAppCheckTokenCount_=0,f.firstConnection_=!0,f.lastConnectionAttemptTime_=null,f.lastConnectionEstablishedTime_=null,h&&!(0,y.Yr)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return Ve.getInstance().on("visible",f.onVisible_,(0,a.Z)(f)),-1===e.host.indexOf("fblocal")&&Ie.getInstance().on("online",f.onOnline_,(0,a.Z)(f)),f}return(0,h.Z)(n,[{key:"sendRequest",value:function(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_((0,y.Wl)(i)),(0,y.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}},{key:"get",value:function(e){this.initConnection_();var t=new y.BH,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:function(e){var n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;var r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}},{key:"listen",value:function(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,a=e._path.toString();this.log_("Listen called for "+a+" "+i),this.listens.has(a)||this.listens.set(a,new Map),(0,y.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,y.hu)(!this.listens.get(a).has(i),"listen() called twice for same path/queryId.");var o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(a).set(i,o),this.connected_&&this.sendListen_(o)}},{key:"sendGet_",value:function(e){var t=this,n=this.outstandingGets_[e];this.sendRequest("g",n.request,(function(r){delete t.outstandingGets_[e],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),n.onComplete&&n.onComplete(r)}))}},{key:"sendListen_",value:function(e){var t=this,r=e.query,i=r._path.toString(),a=r._queryIdentifier;this.log_("Listen on "+i+" for "+a);var o={p:i};e.tag&&(o.q=r._queryObject,o.t=e.tag),o.h=e.hashFn(),this.sendRequest("q",o,(function(o){var s=o.d,u=o.s;n.warnOnListenWarnings_(s,r),(t.listens.get(i)&&t.listens.get(i).get(a))===e&&(t.log_("listen response",o),"ok"!==u&&t.removeListen_(i,a),e.onComplete&&e.onComplete(u,s))}))}},{key:"refreshAuthToken",value:function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(e)}},{key:"reduceReconnectDelayIfAdminCredential_",value:function(e){(e&&40===e.length||(0,y.GJ)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}},{key:"refreshAppCheckToken",value:function(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(function(){}))}},{key:"tryAuth",value:function(){var e=this;if(this.connected_&&this.authToken_){var t=this.authToken_,n=(0,y.w9)(t)?"auth":"gauth",r={cred:t};null===this.authOverride_?r.noauth=!0:"object"===typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,(function(n){var r=n.s,i=n.d||"error";e.authToken_===t&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,i))}))}}},{key:"tryAppCheck",value:function(){var e=this;this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(function(t){var n=t.s,r=t.d||"error";"ok"===n?e.invalidAppCheckTokenCount_=0:e.onAppCheckRevoked_(n,r)}))}},{key:"unlisten",value:function(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),(0,y.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}},{key:"sendUnlisten_",value:function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);var i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}},{key:"onDisconnectPut",value:function(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}},{key:"onDisconnectMerge",value:function(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}},{key:"onDisconnectCancel",value:function(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}},{key:"sendOnDisconnect_",value:function(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,(function(e){r&&setTimeout((function(){r(e.s,e.d)}),Math.floor(0))}))}},{key:"put",value:function(e,t,n,r){this.putInternal("p",e,t,n,r)}},{key:"merge",value:function(e,t,n,r){this.putInternal("m",e,t,n,r)}},{key:"putInternal",value:function(e,t,n,r,i){this.initConnection_();var a={p:t,d:n};void 0!==i&&(a.h=i),this.outstandingPuts_.push({action:e,request:a,onComplete:r}),this.outstandingPutCount_++;var o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}},{key:"sendPut_",value:function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,(function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),i&&i(r.s,r.d)}))}},{key:"reportStats",value:function(e){var t=this;if(this.connected_){var n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,(function(e){if("ok"!==e.s){var n=e.d;t.log_("reportStats","Error sending stats: "+n)}}))}}},{key:"onDataMessage_",value:function(e){if("r"in e){this.log_("from server: "+(0,y.Wl)(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}},{key:"onDataPush_",value:function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):L("Unrecognized action received from server: "+(0,y.Wl)(e)+"\nAre you using the latest client?")}},{key:"onReady_",value:function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}},{key:"scheduleConnect_",value:function(e){var t=this;(0,y.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){t.establishConnectionTimer_=null,t.establishConnection_()}),Math.floor(e))}},{key:"initConnection_",value:function(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}},{key:"onVisible_",value:function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=je,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}},{key:"onOnline_",value:function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=je,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}},{key:"onRealtimeDisconnect_",value:function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=je),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var e=(new Date).getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}},{key:"establishConnection_",value:function(){var e=(0,i.Z)(d().mark((function e(){var t,i,a,o,s,u,c,l,h,f,v,p,g,m,_=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.shouldReconnect_()){e.next=30;break}return this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null,t=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),a=this.onRealtimeDisconnect_.bind(this),o=this.id+":"+n.nextConnectionId_++,s=this.lastSessionId,u=!1,c=null,l=function(){c?c.close():(u=!0,a())},h=function(e){(0,y.hu)(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(e)},this.realtime_={close:l,sendRequest:h},f=this.forceTokenRefresh_,this.forceTokenRefresh_=!1,e.prev=16,e.next=19,Promise.all([this.authTokenProvider_.getToken(f),this.appCheckTokenProvider_.getToken(f)]);case 19:v=e.sent,p=(0,r.Z)(v,2),g=p[0],m=p[1],u?D("getToken() completed but was canceled"):(D("getToken() completed. Creating connection."),this.authToken_=g&&g.accessToken,this.appCheckToken_=m&&m.token,c=new ke(o,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,i,a,(function(e){F(e+" ("+_.repoInfo_.toString()+")"),_.interrupt("server_kill")}),s)),e.next=30;break;case 26:e.prev=26,e.t0=e.catch(16),this.log_("Failed to get token: "+e.t0),u||(this.repoInfo_.nodeAdmin&&F(e.t0),l());case 30:case"end":return e.stop()}}),e,this,[[16,26]])})));return function(){return e.apply(this,arguments)}}()},{key:"interrupt",value:function(e){D("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}},{key:"resume",value:function(e){D("Resuming connection for reason: "+e),delete this.interruptReasons_[e],(0,y.xb)(this.interruptReasons_)&&(this.reconnectDelay_=je,this.realtime_||this.scheduleConnect_(0))}},{key:"handleTimestamp_",value:function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}},{key:"cancelSentTransactions_",value:function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}},{key:"onListenRevoked_",value:function(e,t){var n;n=t?t.map((function(e){return H(e)})).join("$"):"default";var r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}},{key:"removeListen_",value:function(e,t){var n,r=new Ee(e).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(t),i.delete(t),0===i.size&&this.listens.delete(r)}else n=void 0;return n}},{key:"onAuthRevoked_",value:function(e,t){D("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}},{key:"onAppCheckRevoked_",value:function(e,t){D("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}},{key:"onSecurityDebugPacket_",value:function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}},{key:"restoreState_",value:function(){this.tryAuth(),this.tryAppCheck();var e,t=(0,c.Z)(this.listens.values());try{for(t.s();!(e=t.n()).done;){var n,r=e.value,i=(0,c.Z)(r.values());try{for(i.s();!(n=i.n()).done;){var a=n.value;this.sendListen_(a)}}catch(l){i.e(l)}finally{i.f()}}}catch(l){t.e(l)}finally{t.f()}for(var o=0;o<this.outstandingPuts_.length;o++)this.outstandingPuts_[o]&&this.sendPut_(o);for(;this.onDisconnectRequestQueue_.length;){var s=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(s.action,s.pathString,s.data,s.onComplete)}for(var u=0;u<this.outstandingGets_.length;u++)this.outstandingGets_[u]&&this.sendGet_(u)}},{key:"sendConnectStats_",value:function(){var e={},t="js";(0,y.Yr)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+k.replace(/\./g,"-")]=1,(0,y.uI)()?e["framework.cordova"]=1:(0,y.b$)()&&(e["framework.reactnative"]=1),this.reportStats(e)}},{key:"shouldReconnect_",value:function(){var e=Ie.getInstance().currentlyOnline();return(0,y.xb)(this.interruptReasons_)&&e}}],[{key:"warnOnListenWarnings_",value:function(e,t){if(e&&"object"===typeof e&&(0,y.r3)(e,"w")){var n=(0,y.DV)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();F("Using an unspecified index. Your data will be downloaded and "+"filtered on the client. Consider adding ".concat(r," at ")+"".concat(i," to your security rules for better performance."))}}}}]),n}(we);qe.nextPersistentConnectionId_=0,qe.nextConnectionId_=0;var Be,ze=function(){function e(t,n){(0,l.Z)(this,e),this.name=t,this.node=n}return(0,h.Z)(e,null,[{key:"Wrap",value:function(t,n){return new e(t,n)}}]),e}(),He=function(){function e(){(0,l.Z)(this,e)}return(0,h.Z)(e,[{key:"getCompare",value:function(){return this.compare.bind(this)}},{key:"indexedValueChanged",value:function(e,t){var n=new ze(V,e),r=new ze(V,t);return 0!==this.compare(n,r)}},{key:"minPost",value:function(){return ze.MIN}}]),e}(),We=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,l.Z)(this,n),t.apply(this,arguments)}return(0,h.Z)(n,[{key:"compare",value:function(e,t){return q(e.name,t.name)}},{key:"isDefinedOn",value:function(e){throw(0,y.g5)("KeyIndex.isDefinedOn not expected to be called.")}},{key:"indexedValueChanged",value:function(e,t){return!1}},{key:"minPost",value:function(){return ze.MIN}},{key:"maxPost",value:function(){return new ze(j,Be)}},{key:"makePost",value:function(e,t){return(0,y.hu)("string"===typeof e,"KeyIndex indexValue must always be a string."),new ze(e,Be)}},{key:"toString",value:function(){return".key"}}],[{key:"__EMPTY_NODE",get:function(){return Be},set:function(e){Be=e}}]),n}(He),Ke=new We,Ge=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;(0,l.Z)(this,e),this.isReverse_=i,this.resultGenerator_=a,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(o=n?r(t.key,n):1,i&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}return(0,h.Z)(e,[{key:"getNext",value:function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}},{key:"hasNext",value:function(){return this.nodeStack_.length>0}},{key:"peek",value:function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}]),e}(),Ye=function(){function e(t,n,r,i,a){(0,l.Z)(this,e),this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:Xe.EMPTY_NODE,this.right=null!=a?a:Xe.EMPTY_NODE}return(0,h.Z)(e,[{key:"copy",value:function(t,n,r,i,a){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=a?a:this.right)}},{key:"count",value:function(){return this.left.count()+1+this.right.count()}},{key:"isEmpty",value:function(){return!1}},{key:"inorderTraversal",value:function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:"min_",value:function(){return this.left.isEmpty()?this:this.left.min_()}},{key:"minKey",value:function(){return this.min_().key}},{key:"maxKey",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()}},{key:"removeMin_",value:function(){if(this.left.isEmpty())return Xe.EMPTY_NODE;var e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}},{key:"remove",value:function(e,t){var n,r;if(t(e,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Xe.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}},{key:"isRed_",value:function(){return this.color}},{key:"fixUp_",value:function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}},{key:"moveRedLeft_",value:function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}},{key:"moveRedRight_",value:function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}},{key:"rotateLeft_",value:function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}},{key:"rotateRight_",value:function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}},{key:"colorFlip_",value:function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}},{key:"checkMaxDepth_",value:function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1}},{key:"check_",value:function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}]),e}();Ye.RED=!0,Ye.BLACK=!1;var Qe,Je=function(){function e(){(0,l.Z)(this,e)}return(0,h.Z)(e,[{key:"copy",value:function(e,t,n,r,i){return this}},{key:"insert",value:function(e,t,n){return new Ye(e,t,null)}},{key:"remove",value:function(e,t){return this}},{key:"count",value:function(){return 0}},{key:"isEmpty",value:function(){return!0}},{key:"inorderTraversal",value:function(e){return!1}},{key:"reverseTraversal",value:function(e){return!1}},{key:"minKey",value:function(){return null}},{key:"maxKey",value:function(){return null}},{key:"check_",value:function(){return 0}},{key:"isRed_",value:function(){return!1}}]),e}(),Xe=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.EMPTY_NODE;(0,l.Z)(this,e),this.comparator_=t,this.root_=n}return(0,h.Z)(e,[{key:"insert",value:function(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,Ye.BLACK,null,null))}},{key:"remove",value:function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Ye.BLACK,null,null))}},{key:"get",value:function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}},{key:"getPredecessorKey",value:function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}},{key:"isEmpty",value:function(){return this.root_.isEmpty()}},{key:"count",value:function(){return this.root_.count()}},{key:"minKey",value:function(){return this.root_.minKey()}},{key:"maxKey",value:function(){return this.root_.maxKey()}},{key:"inorderTraversal",value:function(e){return this.root_.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.root_.reverseTraversal(e)}},{key:"getIterator",value:function(e){return new Ge(this.root_,null,this.comparator_,!1,e)}},{key:"getIteratorFrom",value:function(e,t){return new Ge(this.root_,e,this.comparator_,!1,t)}},{key:"getReverseIteratorFrom",value:function(e,t){return new Ge(this.root_,e,this.comparator_,!0,t)}},{key:"getReverseIterator",value:function(e){return new Ge(this.root_,null,this.comparator_,!0,e)}}]),e}();function $e(e,t){return q(e.name,t.name)}function et(e,t){return q(e,t)}Xe.EMPTY_NODE=new Je;var tt,nt,rt,it=function(e){return"number"===typeof e?"number:"+G(e):"string:"+e},at=function(e){if(e.isLeafNode()){var t=e.val();(0,y.hu)("string"===typeof t||"number"===typeof t||"object"===typeof t&&(0,y.r3)(t,".sv"),"Priority must be a string or number.")}else(0,y.hu)(e===Qe||e.isEmpty(),"priority of unexpected type.");(0,y.hu)(e===Qe||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},ot=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.__childrenNodeConstructor.EMPTY_NODE;(0,l.Z)(this,e),this.value_=t,this.priorityNode_=n,this.lazyHash_=null,(0,y.hu)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),at(this.priorityNode_)}return(0,h.Z)(e,[{key:"isLeafNode",value:function(){return!0}},{key:"getPriority",value:function(){return this.priorityNode_}},{key:"updatePriority",value:function(t){return new e(this.value_,t)}},{key:"getImmediateChild",value:function(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE}},{key:"getChild",value:function(t){return Ze(t)?this:".priority"===Ce(t)?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE}},{key:"hasChild",value:function(){return!1}},{key:"getPredecessorChildName",value:function(e,t){return null}},{key:"updateImmediateChild",value:function(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)}},{key:"updateChild",value:function(t,n){var r=Ce(t);return null===r?n:n.isEmpty()&&".priority"!==r?this:((0,y.hu)(".priority"!==r||1===Se(t),".priority must be the last token in a path"),this.updateImmediateChild(r,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(xe(t),n)))}},{key:"isEmpty",value:function(){return!1}},{key:"numChildren",value:function(){return 0}},{key:"forEachChild",value:function(e,t){return!1}},{key:"val",value:function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}},{key:"hash",value:function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+it(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?G(this.value_):this.value_,this.lazyHash_=N(e)}return this.lazyHash_}},{key:"getValue",value:function(){return this.value_}},{key:"compareTo",value:function(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:((0,y.hu)(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}},{key:"compareToLeafNode_",value:function(t){var n=typeof t.value_,r=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(n),a=e.VALUE_TYPE_ORDER.indexOf(r);return(0,y.hu)(i>=0,"Unknown leaf type: "+n),(0,y.hu)(a>=0,"Unknown leaf type: "+r),i===a?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:a-i}},{key:"withIndex",value:function(){return this}},{key:"isIndexed",value:function(){return!0}},{key:"equals",value:function(e){if(e===this)return!0;if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}],[{key:"__childrenNodeConstructor",get:function(){return tt},set:function(e){tt=e}}]),e}();ot.VALUE_TYPE_ORDER=["object","boolean","number","string"];var st,ut,ct=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,l.Z)(this,n),t.apply(this,arguments)}return(0,h.Z)(n,[{key:"compare",value:function(e,t){var n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?q(e.name,t.name):i}},{key:"isDefinedOn",value:function(e){return!e.getPriority().isEmpty()}},{key:"indexedValueChanged",value:function(e,t){return!e.getPriority().equals(t.getPriority())}},{key:"minPost",value:function(){return ze.MIN}},{key:"maxPost",value:function(){return new ze(j,new ot("[PRIORITY-POST]",rt))}},{key:"makePost",value:function(e,t){var n=nt(e);return new ze(t,new ot("[PRIORITY-POST]",n))}},{key:"toString",value:function(){return".priority"}}]),n}(He),lt=new ct,ht=Math.log(2),ft=function(){function e(t){(0,l.Z)(this,e);var n;this.count=(n=t+1,parseInt(Math.log(n)/ht,10)),this.current_=this.count-1;var r,i=(r=this.count,parseInt(Array(r+1).join("1"),2));this.bits_=t+1&i}return(0,h.Z)(e,[{key:"nextBitIsOne",value:function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e}}]),e}(),dt=function(e,t,n,r){e.sort(t);var i=function t(r,i){var a,o,s=i-r;if(0===s)return null;if(1===s)return a=e[r],o=n?n(a):a,new Ye(o,a.node,Ye.BLACK,null,null);var u=parseInt(s/2,10)+r,c=t(r,u),l=t(u+1,i);return a=e[u],o=n?n(a):a,new Ye(o,a.node,Ye.BLACK,c,l)},a=function(t){for(var r=null,a=null,o=e.length,s=function(t,r){var a=o-t,s=o;o-=t;var c=i(a+1,s),l=e[a],h=n?n(l):l;u(new Ye(h,l.node,r,null,c))},u=function(e){r?(r.left=e,r=e):(a=e,r=e)},c=0;c<t.count;++c){var l=t.nextBitIsOne(),h=Math.pow(2,t.count-(c+1));l?s(h,Ye.BLACK):(s(h,Ye.BLACK),s(h,Ye.RED))}return a}(new ft(e.length));return new Xe(r||t,a)},vt={},pt=function(){function e(t,n){(0,l.Z)(this,e),this.indexes_=t,this.indexSet_=n}return(0,h.Z)(e,[{key:"get",value:function(e){var t=(0,y.DV)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Xe?t:null}},{key:"hasIndex",value:function(e){return(0,y.r3)(this.indexSet_,e.toString())}},{key:"addIndex",value:function(t,n){(0,y.hu)(t!==Ke,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,i=[],a=!1,o=n.getIterator(ze.Wrap),s=o.getNext();s;)a=a||t.isDefinedOn(s.node),i.push(s),s=o.getNext();r=a?dt(i,t.getCompare()):vt;var u=t.toString(),c=Object.assign({},this.indexSet_);c[u]=t;var l=Object.assign({},this.indexes_);return l[u]=r,new e(l,c)}},{key:"addToIndexes",value:function(t,n){var r=this;return new e((0,y.UI)(this.indexes_,(function(e,i){var a=(0,y.DV)(r.indexSet_,i);if((0,y.hu)(a,"Missing index implementation for "+i),e===vt){if(a.isDefinedOn(t.node)){for(var o=[],s=n.getIterator(ze.Wrap),u=s.getNext();u;)u.name!==t.name&&o.push(u),u=s.getNext();return o.push(t),dt(o,a.getCompare())}return vt}var c=n.get(t.name),l=e;return c&&(l=l.remove(new ze(t.name,c))),l.insert(t,t.node)})),this.indexSet_)}},{key:"removeFromIndexes",value:function(t,n){return new e((0,y.UI)(this.indexes_,(function(e){if(e===vt)return e;var r=n.get(t.name);return r?e.remove(new ze(t.name,r)):e})),this.indexSet_)}}],[{key:"Default",get:function(){return(0,y.hu)(vt&&lt,"ChildrenNode.ts has not been loaded"),st=st||new e({".priority":vt},{".priority":lt})}}]),e}(),yt=function(){function e(t,n,r){(0,l.Z)(this,e),this.children_=t,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&at(this.priorityNode_),this.children_.isEmpty()&&(0,y.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return(0,h.Z)(e,[{key:"isLeafNode",value:function(){return!1}},{key:"getPriority",value:function(){return this.priorityNode_||ut}},{key:"updatePriority",value:function(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)}},{key:"getImmediateChild",value:function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?ut:t}},{key:"getChild",value:function(e){var t=Ce(e);return null===t?this:this.getImmediateChild(t).getChild(xe(e))}},{key:"hasChild",value:function(e){return null!==this.children_.get(e)}},{key:"updateImmediateChild",value:function(t,n){if((0,y.hu)(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);var r,i,a=new ze(t,n);n.isEmpty()?(r=this.children_.remove(t),i=this.indexMap_.removeFromIndexes(a,this.children_)):(r=this.children_.insert(t,n),i=this.indexMap_.addToIndexes(a,this.children_));var o=r.isEmpty()?ut:this.priorityNode_;return new e(r,o,i)}},{key:"updateChild",value:function(e,t){var n=Ce(e);if(null===n)return t;(0,y.hu)(".priority"!==Ce(e)||1===Se(e),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(xe(e),t);return this.updateImmediateChild(n,r)}},{key:"isEmpty",value:function(){return this.children_.isEmpty()}},{key:"numChildren",value:function(){return this.children_.count()}},{key:"val",value:function(t){if(this.isEmpty())return null;var n={},r=0,i=0,a=!0;if(this.forEachChild(lt,(function(o,s){n[o]=s.val(t),r++,a&&e.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):a=!1})),!t&&a&&i<2*r){var o=[];for(var s in n)o[s]=n[s];return o}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}},{key:"hash",value:function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+it(this.getPriority().val())+":"),this.forEachChild(lt,(function(t,n){var r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":N(e)}return this.lazyHash_}},{key:"getPredecessorChildName",value:function(e,t,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new ze(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)}},{key:"getFirstChildName",value:function(e){var t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()}},{key:"getFirstChild",value:function(e){var t=this.getFirstChildName(e);return t?new ze(t,this.children_.get(t)):null}},{key:"getLastChildName",value:function(e){var t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()}},{key:"getLastChild",value:function(e){var t=this.getLastChildName(e);return t?new ze(t,this.children_.get(t)):null}},{key:"forEachChild",value:function(e,t){var n=this.resolveIndex_(e);return n?n.inorderTraversal((function(e){return t(e.name,e.node)})):this.children_.inorderTraversal(t)}},{key:"getIterator",value:function(e){return this.getIteratorFrom(e.minPost(),e)}},{key:"getIteratorFrom",value:function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getIteratorFrom(e.name,ze.Wrap),i=r.peek();null!=i&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r}},{key:"getReverseIterator",value:function(e){return this.getReverseIteratorFrom(e.maxPost(),e)}},{key:"getReverseIteratorFrom",value:function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getReverseIteratorFrom(e.name,ze.Wrap),i=r.peek();null!=i&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r}},{key:"compareTo",value:function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===gt?-1:0}},{key:"withIndex",value:function(t){if(t===Ke||this.indexMap_.hasIndex(t))return this;var n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)}},{key:"isIndexed",value:function(e){return e===Ke||this.indexMap_.hasIndex(e)}},{key:"equals",value:function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){for(var n=this.getIterator(lt),r=t.getIterator(lt),i=n.getNext(),a=r.getNext();i&&a;){if(i.name!==a.name||!i.node.equals(a.node))return!1;i=n.getNext(),a=r.getNext()}return null===i&&null===a}return!1}return!1}},{key:"resolveIndex_",value:function(e){return e===Ke?null:this.indexMap_.get(e.toString())}}],[{key:"EMPTY_NODE",get:function(){return ut||(ut=new e(new Xe(et),null,pt.Default))}}]),e}();yt.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;var gt=new(function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,l.Z)(this,n),t.call(this,new Xe(et),yt.EMPTY_NODE,pt.Default)}return(0,h.Z)(n,[{key:"compareTo",value:function(e){return e===this?0:1}},{key:"equals",value:function(e){return e===this}},{key:"getPriority",value:function(){return this}},{key:"getImmediateChild",value:function(e){return yt.EMPTY_NODE}},{key:"isEmpty",value:function(){return!1}}]),n}(yt));Object.defineProperties(ze,{MIN:{value:new ze(V,yt.EMPTY_NODE)},MAX:{value:new ze(j,gt)}}),We.__EMPTY_NODE=yt.EMPTY_NODE,ot.__childrenNodeConstructor=yt,Qe=gt,function(e){rt=e}(gt);function mt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===e)return yt.EMPTY_NODE;if("object"===typeof e&&".priority"in e&&(t=e[".priority"]),(0,y.hu)(null===t||"string"===typeof t||"number"===typeof t||"object"===typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"===typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!==typeof e||".sv"in e){var n=e;return new ot(n,mt(t))}if(e instanceof Array){var r=yt.EMPTY_NODE;return K(e,(function(t,n){if((0,y.r3)(e,t)&&"."!==t.substring(0,1)){var i=mt(n);!i.isLeafNode()&&i.isEmpty()||(r=r.updateImmediateChild(t,i))}})),r.updatePriority(mt(t))}var i=[],a=!1,o=e;if(K(o,(function(e,t){if("."!==e.substring(0,1)){var n=mt(t);n.isEmpty()||(a=a||!n.getPriority().isEmpty(),i.push(new ze(e,n)))}})),0===i.length)return yt.EMPTY_NODE;var s=dt(i,$e,(function(e){return e.name}),et);if(a){var u=dt(i,lt.getCompare());return new yt(s,mt(t),new pt({".priority":u},{".priority":lt}))}return new yt(s,mt(t),pt.Default)}!function(e){nt=e}(mt);var _t=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,l.Z)(this,n),(r=t.call(this)).indexPath_=e,(0,y.hu)(!Ze(e)&&".priority"!==Ce(e),"Can't create PathIndex with empty path or .priority key"),r}return(0,h.Z)(n,[{key:"extractChild",value:function(e){return e.getChild(this.indexPath_)}},{key:"isDefinedOn",value:function(e){return!e.getChild(this.indexPath_).isEmpty()}},{key:"compare",value:function(e,t){var n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?q(e.name,t.name):i}},{key:"makePost",value:function(e,t){var n=mt(e),r=yt.EMPTY_NODE.updateChild(this.indexPath_,n);return new ze(t,r)}},{key:"maxPost",value:function(){var e=yt.EMPTY_NODE.updateChild(this.indexPath_,gt);return new ze(j,e)}},{key:"toString",value:function(){return Ae(this.indexPath_,0).join("/")}}]),n}(He),kt=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,l.Z)(this,n),t.apply(this,arguments)}return(0,h.Z)(n,[{key:"compare",value:function(e,t){var n=e.node.compareTo(t.node);return 0===n?q(e.name,t.name):n}},{key:"isDefinedOn",value:function(e){return!0}},{key:"indexedValueChanged",value:function(e,t){return!e.equals(t)}},{key:"minPost",value:function(){return ze.MIN}},{key:"maxPost",value:function(){return ze.MAX}},{key:"makePost",value:function(e,t){var n=mt(e);return new ze(t,n)}},{key:"toString",value:function(){return".value"}}]),n}(He),wt=new kt;function bt(e){return{type:"value",snapshotNode:e}}function It(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Et(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Tt(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}var Ct=function(){function e(t){(0,l.Z)(this,e),this.index_=t}return(0,h.Z)(e,[{key:"updateChild",value:function(e,t,n,r,i,a){(0,y.hu)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var o=e.getImmediateChild(t);return o.getChild(r).equals(n.getChild(r))&&o.isEmpty()===n.isEmpty()?e:(null!=a&&(n.isEmpty()?e.hasChild(t)?a.trackChildChange(Et(t,o)):(0,y.hu)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?a.trackChildChange(It(t,n)):a.trackChildChange(Tt(t,n,o))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}},{key:"updateFullNode",value:function(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(lt,(function(e,r){t.hasChild(e)||n.trackChildChange(Et(e,r))})),t.isLeafNode()||t.forEachChild(lt,(function(t,r){if(e.hasChild(t)){var i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(Tt(t,r,i))}else n.trackChildChange(It(t,r))}))),t.withIndex(this.index_)}},{key:"updatePriority",value:function(e,t){return e.isEmpty()?yt.EMPTY_NODE:e.updatePriority(t)}},{key:"filtersNodes",value:function(){return!1}},{key:"getIndexedFilter",value:function(){return this}},{key:"getIndex",value:function(){return this.index_}}]),e}(),St=function(){function e(t){(0,l.Z)(this,e),this.indexedFilter_=new Ct(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}return(0,h.Z)(e,[{key:"getStartPost",value:function(){return this.startPost_}},{key:"getEndPost",value:function(){return this.endPost_}},{key:"matches",value:function(e){var t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}},{key:"updateChild",value:function(e,t,n,r,i,a){return this.matches(new ze(t,n))||(n=yt.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,a)}},{key:"updateFullNode",value:function(e,t,n){t.isLeafNode()&&(t=yt.EMPTY_NODE);var r=t.withIndex(this.index_);r=r.updatePriority(yt.EMPTY_NODE);var i=this;return t.forEachChild(lt,(function(e,t){i.matches(new ze(e,t))||(r=r.updateImmediateChild(e,yt.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)}},{key:"updatePriority",value:function(e,t){return e}},{key:"filtersNodes",value:function(){return!0}},{key:"getIndexedFilter",value:function(){return this.indexedFilter_}},{key:"getIndex",value:function(){return this.index_}}],[{key:"getStartPost_",value:function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}},{key:"getEndPost_",value:function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}]),e}(),xt=function(){function e(t){var n=this;(0,l.Z)(this,e),this.withinDirectionalStart=function(e){return n.reverse_?n.withinEndPost(e):n.withinStartPost(e)},this.withinDirectionalEnd=function(e){return n.reverse_?n.withinStartPost(e):n.withinEndPost(e)},this.withinStartPost=function(e){var t=n.index_.compare(n.rangedFilter_.getStartPost(),e);return n.startIsInclusive_?t<=0:t<0},this.withinEndPost=function(e){var t=n.index_.compare(e,n.rangedFilter_.getEndPost());return n.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new St(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft(),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}return(0,h.Z)(e,[{key:"updateChild",value:function(e,t,n,r,i,a){return this.rangedFilter_.matches(new ze(t,n))||(n=yt.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,a):this.fullLimitUpdateChild_(e,t,n,i,a)}},{key:"updateFullNode",value:function(e,t,n){var r;if(t.isLeafNode()||t.isEmpty())r=yt.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){var i;r=yt.EMPTY_NODE.withIndex(this.index_),i=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var a=0;i.hasNext()&&a<this.limit_;){var o=i.getNext();if(this.withinDirectionalStart(o)){if(!this.withinDirectionalEnd(o))break;r=r.updateImmediateChild(o.name,o.node),a++}}}else{var s;r=(r=t.withIndex(this.index_)).updatePriority(yt.EMPTY_NODE),s=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);for(var u=0;s.hasNext();){var c=s.getNext();u<this.limit_&&this.withinDirectionalStart(c)&&this.withinDirectionalEnd(c)?u++:r=r.updateImmediateChild(c.name,yt.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}},{key:"updatePriority",value:function(e,t){return e}},{key:"filtersNodes",value:function(){return!0}},{key:"getIndexedFilter",value:function(){return this.rangedFilter_.getIndexedFilter()}},{key:"getIndex",value:function(){return this.index_}},{key:"fullLimitUpdateChild_",value:function(e,t,n,r,i){var a;if(this.reverse_){var o=this.index_.getCompare();a=function(e,t){return o(t,e)}}else a=this.index_.getCompare();var s=e;(0,y.hu)(s.numChildren()===this.limit_,"");var u=new ze(t,n),c=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),l=this.rangedFilter_.matches(u);if(s.hasChild(t)){for(var h=s.getImmediateChild(t),f=r.getChildAfterChild(this.index_,c,this.reverse_);null!=f&&(f.name===t||s.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);var d=null==f?1:a(f,u);if(l&&!n.isEmpty()&&d>=0)return null!=i&&i.trackChildChange(Tt(t,n,h)),s.updateImmediateChild(t,n);null!=i&&i.trackChildChange(Et(t,h));var v=s.updateImmediateChild(t,yt.EMPTY_NODE);return null!=f&&this.rangedFilter_.matches(f)?(null!=i&&i.trackChildChange(It(f.name,f.node)),v.updateImmediateChild(f.name,f.node)):v}return n.isEmpty()?e:l&&a(c,u)>=0?(null!=i&&(i.trackChildChange(Et(c.name,c.node)),i.trackChildChange(It(t,n))),s.updateImmediateChild(t,n).updateImmediateChild(c.name,yt.EMPTY_NODE)):e}}]),e}(),Nt=function(){function e(){(0,l.Z)(this,e),this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=lt}return(0,h.Z)(e,[{key:"hasStart",value:function(){return this.startSet_}},{key:"isViewFromLeft",value:function(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}},{key:"getIndexStartValue",value:function(){return(0,y.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}},{key:"getIndexStartName",value:function(){return(0,y.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:V}},{key:"hasEnd",value:function(){return this.endSet_}},{key:"getIndexEndValue",value:function(){return(0,y.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}},{key:"getIndexEndName",value:function(){return(0,y.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:j}},{key:"hasLimit",value:function(){return this.limitSet_}},{key:"hasAnchoredLimit",value:function(){return this.limitSet_&&""!==this.viewFrom_}},{key:"getLimit",value:function(){return(0,y.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_}},{key:"getIndex",value:function(){return this.index_}},{key:"loadsAllData",value:function(){return!(this.startSet_||this.endSet_||this.limitSet_)}},{key:"isDefault",value:function(){return this.loadsAllData()&&this.index_===lt}},{key:"copy",value:function(){var t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}]),e}();function At(e){var t,n={};if(e.isDefault())return n;if(e.index_===lt?t="$priority":e.index_===wt?t="$value":e.index_===Ke?t="$key":((0,y.hu)(e.index_ instanceof _t,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=(0,y.Wl)(t),e.startSet_){var r=e.startAfterSet_?"startAfter":"startAt";n[r]=(0,y.Wl)(e.indexStartValue_),e.startNameSet_&&(n[r]+=","+(0,y.Wl)(e.indexStartName_))}if(e.endSet_){var i=e.endBeforeSet_?"endBefore":"endAt";n[i]=(0,y.Wl)(e.indexEndValue_),e.endNameSet_&&(n[i]+=","+(0,y.Wl)(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function Pt(e){var t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;var n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==lt&&(t.i=e.index_.toString()),t}var Rt=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,r,i,a){var o;return(0,l.Z)(this,n),(o=t.call(this)).repoInfo_=e,o.onDataUpdate_=r,o.authTokenProvider_=i,o.appCheckTokenProvider_=a,o.log_=O("p:rest:"),o.listens_={},o}return(0,h.Z)(n,[{key:"reportStats",value:function(e){throw new Error("Method not implemented.")}},{key:"listen",value:function(e,t,r,i){var a=this,o=e._path.toString();this.log_("Listen called for "+o+" "+e._queryIdentifier);var s=n.getListenId_(e,r),u={};this.listens_[s]=u;var c=At(e._queryParams);this.restRequest_(o+".json",c,(function(e,t){var n=t;(404===e&&(n=null,e=null),null===e&&a.onDataUpdate_(o,n,!1,r),(0,y.DV)(a.listens_,s)===u)&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)}))}},{key:"unlisten",value:function(e,t){var r=n.getListenId_(e,t);delete this.listens_[r]}},{key:"get",value:function(e){var t=this,n=At(e._queryParams),r=e._path.toString(),i=new y.BH;return this.restRequest_(r+".json",n,(function(e,n){var a=n;404===e&&(a=null,e=null),null===e?(t.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))})),i.promise}},{key:"refreshAuthToken",value:function(e){}},{key:"restRequest_",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((function(a){var o=(0,r.Z)(a,2),s=o[0],u=o[1];s&&s.accessToken&&(n.auth=s.accessToken),u&&u.token&&(n.ac=u.token);var c=(t.repoInfo_.secure?"https://":"http://")+t.repoInfo_.host+e+"?ns="+t.repoInfo_.namespace+(0,y.xO)(n);t.log_("Sending REST request for "+c);var l=new XMLHttpRequest;l.onreadystatechange=function(){if(i&&4===l.readyState){t.log_("REST Response for "+c+" received. status:",l.status,"response:",l.responseText);var e=null;if(l.status>=200&&l.status<300){try{e=(0,y.cI)(l.responseText)}catch(n){F("Failed to parse JSON response for "+c+": "+l.responseText)}i(null,e)}else 401!==l.status&&404!==l.status&&F("Got unsuccessful REST response for "+c+" Status: "+l.status),i(l.status);i=null}},l.open("GET",c,!0),l.send()}))}}],[{key:"getListenId_",value:function(e,t){return void 0!==t?"tag$"+t:((0,y.hu)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}}]),n}(we),Zt=function(){function e(){(0,l.Z)(this,e),this.rootNode_=yt.EMPTY_NODE}return(0,h.Z)(e,[{key:"getNode",value:function(e){return this.rootNode_.getChild(e)}},{key:"updateSnapshot",value:function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}]),e}();function Dt(){return{value:null,children:new Map}}function Ot(e,t,n){if(Ze(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{var r=Ce(t);e.children.has(r)||e.children.set(r,Dt()),Ot(e.children.get(r),t=xe(t),n)}}function Lt(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach((function(e,n){t(n,e)}))}(e,(function(e,r){Lt(r,new Ee(t.toString()+"/"+e),n)}))}var Mt,Ft=function(){function e(t){(0,l.Z)(this,e),this.collection_=t,this.last_=null}return(0,h.Z)(e,[{key:"get",value:function(){var e=this.collection_.get(),t=Object.assign({},e);return this.last_&&K(this.last_,(function(e,n){t[e]=t[e]-n})),this.last_=e,t}}]),e}(),Ut=function(){function e(t,n){(0,l.Z)(this,e),this.server_=n,this.statsToReport_={},this.statsListener_=new Ft(t);var r=1e4+2e4*Math.random();X(this.reportStats_.bind(this),Math.floor(r))}return(0,h.Z)(e,[{key:"reportStats_",value:function(){var e=this,t=this.statsListener_.get(),n={},r=!1;K(t,(function(t,i){i>0&&(0,y.r3)(e.statsToReport_,t)&&(n[t]=i,r=!0)})),r&&this.server_.reportStats(n),X(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}]),e}();function Vt(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Mt||(Mt={}));var jt,qt=function(){function e(t,n,r){(0,l.Z)(this,e),this.path=t,this.affectedTree=n,this.revert=r,this.type=Mt.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}return(0,h.Z)(e,[{key:"operationForChild",value:function(t){if(Ze(this.path)){if(null!=this.affectedTree.value)return(0,y.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new Ee(t));return new e(Te(),n,this.revert)}return(0,y.hu)(Ce(this.path)===t,"operationForChild called for unrelated child."),new e(xe(this.path),this.affectedTree,this.revert)}}]),e}(),Bt=function(){function e(t,n){(0,l.Z)(this,e),this.source=t,this.path=n,this.type=Mt.LISTEN_COMPLETE}return(0,h.Z)(e,[{key:"operationForChild",value:function(t){return Ze(this.path)?new e(this.source,Te()):new e(this.source,xe(this.path))}}]),e}(),zt=function(){function e(t,n,r){(0,l.Z)(this,e),this.source=t,this.path=n,this.snap=r,this.type=Mt.OVERWRITE}return(0,h.Z)(e,[{key:"operationForChild",value:function(t){return Ze(this.path)?new e(this.source,Te(),this.snap.getImmediateChild(t)):new e(this.source,xe(this.path),this.snap)}}]),e}(),Ht=function(){function e(t,n,r){(0,l.Z)(this,e),this.source=t,this.path=n,this.children=r,this.type=Mt.MERGE}return(0,h.Z)(e,[{key:"operationForChild",value:function(t){if(Ze(this.path)){var n=this.children.subtree(new Ee(t));return n.isEmpty()?null:n.value?new zt(this.source,Te(),n.value):new e(this.source,Te(),n)}return(0,y.hu)(Ce(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new e(this.source,xe(this.path),this.children)}},{key:"toString",value:function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}]),e}(),Wt=function(){function e(t,n,r){(0,l.Z)(this,e),this.node_=t,this.fullyInitialized_=n,this.filtered_=r}return(0,h.Z)(e,[{key:"isFullyInitialized",value:function(){return this.fullyInitialized_}},{key:"isFiltered",value:function(){return this.filtered_}},{key:"isCompleteForPath",value:function(e){if(Ze(e))return this.isFullyInitialized()&&!this.filtered_;var t=Ce(e);return this.isCompleteForChild(t)}},{key:"isCompleteForChild",value:function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}},{key:"getNode",value:function(){return this.node_}}]),e}(),Kt=(0,h.Z)((function e(t){(0,l.Z)(this,e),this.query_=t,this.index_=this.query_._queryParams.getIndex()}));function Gt(e,t,n,r,i,a){var o=r.filter((function(e){return e.type===n}));o.sort((function(t,n){return function(e,t,n){if(null==t.childName||null==n.childName)throw(0,y.g5)("Should only compare child_ events.");var r=new ze(t.childName,t.snapshotNode),i=new ze(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(e,t,n)})),o.forEach((function(n){var r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,a);i.forEach((function(i){i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))}))}))}function Yt(e,t){return{eventCache:e,serverCache:t}}function Qt(e,t,n,r){return Yt(new Wt(t,n,r),e.serverCache)}function Jt(e,t,n,r){return Yt(e.eventCache,new Wt(t,n,r))}function Xt(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function $t(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}var en=function(){return jt||(jt=new Xe(B)),jt},tn=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:en();(0,l.Z)(this,e),this.value=t,this.children=n}return(0,h.Z)(e,[{key:"isEmpty",value:function(){return null===this.value&&this.children.isEmpty()}},{key:"findRootMostMatchingPathAndValue",value:function(e,t){if(null!=this.value&&t(this.value))return{path:Te(),value:this.value};if(Ze(e))return null;var n=Ce(e),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(xe(e),t);return null!=i?{path:Re(new Ee(n),i.path),value:i.value}:null}return null}},{key:"findRootMostValueAndPath",value:function(e){return this.findRootMostMatchingPathAndValue(e,(function(){return!0}))}},{key:"subtree",value:function(t){if(Ze(t))return this;var n=Ce(t),r=this.children.get(n);return null!==r?r.subtree(xe(t)):new e(null)}},{key:"set",value:function(t,n){if(Ze(t))return new e(n,this.children);var r=Ce(t),i=(this.children.get(r)||new e(null)).set(xe(t),n),a=this.children.insert(r,i);return new e(this.value,a)}},{key:"remove",value:function(t){if(Ze(t))return this.children.isEmpty()?new e(null):new e(null,this.children);var n=Ce(t),r=this.children.get(n);if(r){var i,a=r.remove(xe(t));return i=a.isEmpty()?this.children.remove(n):this.children.insert(n,a),null===this.value&&i.isEmpty()?new e(null):new e(this.value,i)}return this}},{key:"get",value:function(e){if(Ze(e))return this.value;var t=Ce(e),n=this.children.get(t);return n?n.get(xe(e)):null}},{key:"setTree",value:function(t,n){if(Ze(t))return n;var r,i=Ce(t),a=(this.children.get(i)||new e(null)).setTree(xe(t),n);return r=a.isEmpty()?this.children.remove(i):this.children.insert(i,a),new e(this.value,r)}},{key:"fold",value:function(e){return this.fold_(Te(),e)}},{key:"fold_",value:function(e,t){var n={};return this.children.inorderTraversal((function(r,i){n[r]=i.fold_(Re(e,r),t)})),t(e,this.value,n)}},{key:"findOnPath",value:function(e,t){return this.findOnPath_(e,Te(),t)}},{key:"findOnPath_",value:function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(Ze(e))return null;var i=Ce(e),a=this.children.get(i);return a?a.findOnPath_(xe(e),Re(t,i),n):null}},{key:"foreachOnPath",value:function(e,t){return this.foreachOnPath_(e,Te(),t)}},{key:"foreachOnPath_",value:function(t,n,r){if(Ze(t))return this;this.value&&r(n,this.value);var i=Ce(t),a=this.children.get(i);return a?a.foreachOnPath_(xe(t),Re(n,i),r):new e(null)}},{key:"foreach",value:function(e){this.foreach_(Te(),e)}},{key:"foreach_",value:function(e,t){this.children.inorderTraversal((function(n,r){r.foreach_(Re(e,n),t)})),this.value&&t(e,this.value)}},{key:"foreachChild",value:function(e){this.children.inorderTraversal((function(t,n){n.value&&e(t,n.value)}))}}],[{key:"fromObject",value:function(t){var n=new e(null);return K(t,(function(e,t){n=n.set(new Ee(e),t)})),n}}]),e}(),nn=function(){function e(t){(0,l.Z)(this,e),this.writeTree_=t}return(0,h.Z)(e,null,[{key:"empty",value:function(){return new e(new tn(null))}}]),e}();function rn(e,t,n){if(Ze(t))return new nn(new tn(n));var r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){var i=r.path,a=r.value,o=De(i,t);return a=a.updateChild(o,n),new nn(e.writeTree_.set(i,a))}var s=new tn(n),u=e.writeTree_.setTree(t,s);return new nn(u)}function an(e,t,n){var r=e;return K(n,(function(e,n){r=rn(r,Re(t,e),n)})),r}function on(e,t){if(Ze(t))return nn.empty();var n=e.writeTree_.setTree(t,new tn(null));return new nn(n)}function sn(e,t){return null!=un(e,t)}function un(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(De(n.path,t)):null}function cn(e){var t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(lt,(function(e,n){t.push(new ze(e,n))})):e.writeTree_.children.inorderTraversal((function(e,n){null!=n.value&&t.push(new ze(e,n.value))})),t}function ln(e,t){if(Ze(t))return e;var n=un(e,t);return new nn(null!=n?new tn(n):e.writeTree_.subtree(t))}function hn(e){return e.writeTree_.isEmpty()}function fn(e,t){return dn(Te(),e.writeTree_,t)}function dn(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);var r=null;return t.children.inorderTraversal((function(t,i){".priority"===t?((0,y.hu)(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=dn(Re(e,t),i,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(Re(e,".priority"),r)),n}function vn(e,t){return xn(t,e)}function pn(e,t){for(var n=0;n<e.allWrites.length;n++){var r=e.allWrites[n];if(r.writeId===t)return r}return null}function yn(e,t){var n=e.allWrites.findIndex((function(e){return e.writeId===t}));(0,y.hu)(n>=0,"removeWrite called with nonexistent writeId.");var r=e.allWrites[n];e.allWrites.splice(n,1);for(var i=r.visible,a=!1,o=e.allWrites.length-1;i&&o>=0;){var s=e.allWrites[o];s.visible&&(o>=n&&gn(s,r.path)?i=!1:Le(r.path,s.path)&&(a=!0)),o--}if(i){if(a)return function(e){e.visibleWrites=_n(e.allWrites,mn,Te()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;r.snap?e.visibleWrites=on(e.visibleWrites,r.path):K(r.children,(function(t){e.visibleWrites=on(e.visibleWrites,Re(r.path,t))}));return!0}return!1}function gn(e,t){if(e.snap)return Le(e.path,t);for(var n in e.children)if(e.children.hasOwnProperty(n)&&Le(Re(e.path,n),t))return!0;return!1}function mn(e){return e.visible}function _n(e,t,n){for(var r=nn.empty(),i=0;i<e.length;++i){var a=e[i];if(t(a)){var o=a.path,s=void 0;if(a.snap)Le(n,o)?r=rn(r,s=De(n,o),a.snap):Le(o,n)&&(s=De(o,n),r=rn(r,Te(),a.snap.getChild(s)));else{if(!a.children)throw(0,y.g5)("WriteRecord should have .snap or .children");if(Le(n,o))r=an(r,s=De(n,o),a.children);else if(Le(o,n))if(Ze(s=De(o,n)))r=an(r,Te(),a.children);else{var u=(0,y.DV)(a.children,Ce(s));if(u){var c=u.getChild(xe(s));r=rn(r,Te(),c)}}}}}return r}function kn(e,t,n,r,i){if(r||i){var a=ln(e.visibleWrites,t);if(!i&&hn(a))return n;if(i||null!=n||sn(a,Te())){return fn(_n(e.allWrites,(function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(Le(e.path,t)||Le(t,e.path))}),t),n||yt.EMPTY_NODE)}return null}var o=un(e.visibleWrites,t);if(null!=o)return o;var s=ln(e.visibleWrites,t);return hn(s)?n:null!=n||sn(s,Te())?fn(s,n||yt.EMPTY_NODE):null}function wn(e,t,n,r){return kn(e.writeTree,e.treePath,t,n,r)}function bn(e,t){return function(e,t,n){var r=yt.EMPTY_NODE,i=un(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(lt,(function(e,t){r=r.updateImmediateChild(e,t)})),r;if(n){var a=ln(e.visibleWrites,t);return n.forEachChild(lt,(function(e,t){var n=fn(ln(a,new Ee(e)),t);r=r.updateImmediateChild(e,n)})),cn(a).forEach((function(e){r=r.updateImmediateChild(e.name,e.node)})),r}return cn(ln(e.visibleWrites,t)).forEach((function(e){r=r.updateImmediateChild(e.name,e.node)})),r}(e.writeTree,e.treePath,t)}function In(e,t,n,r){return function(e,t,n,r,i){(0,y.hu)(r||i,"Either existingEventSnap or existingServerSnap must exist");var a=Re(t,n);if(sn(e.visibleWrites,a))return null;var o=ln(e.visibleWrites,a);return hn(o)?i.getChild(n):fn(o,i.getChild(n))}(e.writeTree,e.treePath,t,n,r)}function En(e,t){return function(e,t){return un(e.visibleWrites,t)}(e.writeTree,Re(e.treePath,t))}function Tn(e,t,n,r,i,a){return function(e,t,n,r,i,a,o){var s,u=ln(e.visibleWrites,t),c=un(u,Te());if(null!=c)s=c;else{if(null==n)return[];s=fn(u,n)}if((s=s.withIndex(o)).isEmpty()||s.isLeafNode())return[];for(var l=[],h=o.getCompare(),f=a?s.getReverseIteratorFrom(r,o):s.getIteratorFrom(r,o),d=f.getNext();d&&l.length<i;)0!==h(d,r)&&l.push(d),d=f.getNext();return l}(e.writeTree,e.treePath,t,n,r,i,a)}function Cn(e,t,n){return function(e,t,n,r){var i=Re(t,n),a=un(e.visibleWrites,i);return null!=a?a:r.isCompleteForChild(n)?fn(ln(e.visibleWrites,i),r.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function Sn(e,t){return xn(Re(e.treePath,t),e.writeTree)}function xn(e,t){return{treePath:e,writeTree:t}}var Nn=function(){function e(){(0,l.Z)(this,e),this.changeMap=new Map}return(0,h.Z)(e,[{key:"trackChildChange",value:function(e){var t=e.type,n=e.childName;(0,y.hu)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,y.hu)(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,Tt(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,Et(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,It(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw(0,y.g5)("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,Tt(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}},{key:"getChanges",value:function(){return Array.from(this.changeMap.values())}}]),e}(),An=new(function(){function e(){(0,l.Z)(this,e)}return(0,h.Z)(e,[{key:"getCompleteChild",value:function(e){return null}},{key:"getChildAfterChild",value:function(e,t,n){return null}}]),e}()),Pn=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(0,l.Z)(this,e),this.writes_=t,this.viewCache_=n,this.optCompleteServerCache_=r}return(0,h.Z)(e,[{key:"getCompleteChild",value:function(e){var t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new Wt(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Cn(this.writes_,e,n)}},{key:"getChildAfterChild",value:function(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:$t(this.viewCache_),i=Tn(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]}}]),e}();function Rn(e,t,n,r,i){var a,o,s=new Nn;if(n.type===Mt.OVERWRITE){var u=n;u.source.fromUser?a=On(e,t,u.path,u.snap,r,i,s):((0,y.hu)(u.source.fromServer,"Unknown source."),o=u.source.tagged||t.serverCache.isFiltered()&&!Ze(u.path),a=Dn(e,t,u.path,u.snap,r,i,o,s))}else if(n.type===Mt.MERGE){var c=n;c.source.fromUser?a=function(e,t,n,r,i,a,o){var s=t;return r.foreach((function(r,u){var c=Re(n,r);Ln(t,Ce(c))&&(s=On(e,s,c,u,i,a,o))})),r.foreach((function(r,u){var c=Re(n,r);Ln(t,Ce(c))||(s=On(e,s,c,u,i,a,o))})),s}(e,t,c.path,c.children,r,i,s):((0,y.hu)(c.source.fromServer,"Unknown source."),o=c.source.tagged||t.serverCache.isFiltered(),a=Fn(e,t,c.path,c.children,r,i,o,s))}else if(n.type===Mt.ACK_USER_WRITE){var l=n;a=l.revert?function(e,t,n,r,i,a){var o;if(null!=En(r,n))return t;var s,u=new Pn(r,t,i),c=t.eventCache.getNode();if(Ze(n)||".priority"===Ce(n)){var l;if(t.serverCache.isFullyInitialized())l=wn(r,$t(t));else{var h=t.serverCache.getNode();(0,y.hu)(h instanceof yt,"serverChildren would be complete if leaf node"),l=bn(r,h)}s=e.filter.updateFullNode(c,l,a)}else{var f=Ce(n),d=Cn(r,f,t.serverCache);null==d&&t.serverCache.isCompleteForChild(f)&&(d=c.getImmediateChild(f)),(s=null!=d?e.filter.updateChild(c,f,d,xe(n),u,a):t.eventCache.getNode().hasChild(f)?e.filter.updateChild(c,f,yt.EMPTY_NODE,xe(n),u,a):c).isEmpty()&&t.serverCache.isFullyInitialized()&&(o=wn(r,$t(t))).isLeafNode()&&(s=e.filter.updateFullNode(s,o,a))}return o=t.serverCache.isFullyInitialized()||null!=En(r,Te()),Qt(t,s,o,e.filter.filtersNodes())}(e,t,l.path,r,i,s):function(e,t,n,r,i,a,o){if(null!=En(i,n))return t;var s=t.serverCache.isFiltered(),u=t.serverCache;if(null!=r.value){if(Ze(n)&&u.isFullyInitialized()||u.isCompleteForPath(n))return Dn(e,t,n,u.getNode().getChild(n),i,a,s,o);if(Ze(n)){var c=new tn(null);return u.getNode().forEachChild(Ke,(function(e,t){c=c.set(new Ee(e),t)})),Fn(e,t,n,c,i,a,s,o)}return t}var l=new tn(null);return r.foreach((function(e,t){var r=Re(n,e);u.isCompleteForPath(r)&&(l=l.set(e,u.getNode().getChild(r)))})),Fn(e,t,n,l,i,a,s,o)}(e,t,l.path,l.affectedTree,r,i,s)}else{if(n.type!==Mt.LISTEN_COMPLETE)throw(0,y.g5)("Unknown operation type: "+n.type);a=function(e,t,n,r,i){var a=t.serverCache,o=Jt(t,a.getNode(),a.isFullyInitialized()||Ze(n),a.isFiltered());return Zn(e,o,n,r,An,i)}(e,t,n.path,r,s)}var h=s.getChanges();return function(e,t,n){var r=t.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),a=Xt(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(a)||!r.getNode().getPriority().equals(a.getPriority()))&&n.push(bt(Xt(t)))}}(t,a,h),{viewCache:a,changes:h}}function Zn(e,t,n,r,i,a){var o,s,u=t.eventCache;if(null!=En(r,n))return t;if(Ze(n))if((0,y.hu)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){var c=$t(t),l=bn(r,c instanceof yt?c:yt.EMPTY_NODE);o=e.filter.updateFullNode(t.eventCache.getNode(),l,a)}else{var h=wn(r,$t(t));o=e.filter.updateFullNode(t.eventCache.getNode(),h,a)}else{var f=Ce(n);if(".priority"===f){(0,y.hu)(1===Se(n),"Can't have a priority with additional path components");var d=u.getNode(),v=In(r,n,d,s=t.serverCache.getNode());o=null!=v?e.filter.updatePriority(d,v):u.getNode()}else{var p,g=xe(n);if(u.isCompleteForChild(f)){s=t.serverCache.getNode();var m=In(r,n,u.getNode(),s);p=null!=m?u.getNode().getImmediateChild(f).updateChild(g,m):u.getNode().getImmediateChild(f)}else p=Cn(r,f,t.serverCache);o=null!=p?e.filter.updateChild(u.getNode(),f,p,g,i,a):u.getNode()}}return Qt(t,o,u.isFullyInitialized()||Ze(n),e.filter.filtersNodes())}function Dn(e,t,n,r,i,a,o,s){var u,c=t.serverCache,l=o?e.filter:e.filter.getIndexedFilter();if(Ze(n))u=l.updateFullNode(c.getNode(),r,null);else if(l.filtersNodes()&&!c.isFiltered()){var h=c.getNode().updateChild(n,r);u=l.updateFullNode(c.getNode(),h,null)}else{var f=Ce(n);if(!c.isCompleteForPath(n)&&Se(n)>1)return t;var d=xe(n),v=c.getNode().getImmediateChild(f).updateChild(d,r);u=".priority"===f?l.updatePriority(c.getNode(),v):l.updateChild(c.getNode(),f,v,d,An,null)}var p=Jt(t,u,c.isFullyInitialized()||Ze(n),l.filtersNodes());return Zn(e,p,n,i,new Pn(i,p,a),s)}function On(e,t,n,r,i,a,o){var s,u,c=t.eventCache,l=new Pn(i,t,a);if(Ze(n))u=e.filter.updateFullNode(t.eventCache.getNode(),r,o),s=Qt(t,u,!0,e.filter.filtersNodes());else{var h=Ce(n);if(".priority"===h)u=e.filter.updatePriority(t.eventCache.getNode(),r),s=Qt(t,u,c.isFullyInitialized(),c.isFiltered());else{var f,d=xe(n),v=c.getNode().getImmediateChild(h);if(Ze(d))f=r;else{var p=l.getCompleteChild(h);f=null!=p?".priority"===Ne(d)&&p.getChild(Pe(d)).isEmpty()?p:p.updateChild(d,r):yt.EMPTY_NODE}if(v.equals(f))s=t;else s=Qt(t,e.filter.updateChild(c.getNode(),h,f,d,l,o),c.isFullyInitialized(),e.filter.filtersNodes())}}return s}function Ln(e,t){return e.eventCache.isCompleteForChild(t)}function Mn(e,t,n){return n.foreach((function(e,n){t=t.updateChild(e,n)})),t}function Fn(e,t,n,r,i,a,o,s){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;var u,c=t;u=Ze(n)?r:new tn(null).setTree(n,r);var l=t.serverCache.getNode();return u.children.inorderTraversal((function(n,r){if(l.hasChild(n)){var u=Mn(0,t.serverCache.getNode().getImmediateChild(n),r);c=Dn(e,c,new Ee(n),u,i,a,o,s)}})),u.children.inorderTraversal((function(n,r){var u=!t.serverCache.isCompleteForChild(n)&&null===r.value;if(!l.hasChild(n)&&!u){var h=Mn(0,t.serverCache.getNode().getImmediateChild(n),r);c=Dn(e,c,new Ee(n),h,i,a,o,s)}})),c}var Un,Vn=function(){function e(t,n){(0,l.Z)(this,e),this.query_=t,this.eventRegistrations_=[];var r,i=this.query_._queryParams,a=new Ct(i.getIndex()),o=(r=i).loadsAllData()?new Ct(r.getIndex()):r.hasLimit()?new xt(r):new St(r);this.processor_=function(e){return{filter:e}}(o);var s=n.serverCache,u=n.eventCache,c=a.updateFullNode(yt.EMPTY_NODE,s.getNode(),null),h=o.updateFullNode(yt.EMPTY_NODE,u.getNode(),null),f=new Wt(c,s.isFullyInitialized(),a.filtersNodes()),d=new Wt(h,u.isFullyInitialized(),o.filtersNodes());this.viewCache_=Yt(d,f),this.eventGenerator_=new Kt(this.query_)}return(0,h.Z)(e,[{key:"query",get:function(){return this.query_}}]),e}();function jn(e,t){var n=$t(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!Ze(t)&&!n.getImmediateChild(Ce(t)).isEmpty())?n.getChild(t):null}function qn(e){return 0===e.eventRegistrations_.length}function Bn(e,t,n){var r=[];if(n){(0,y.hu)(null==t,"A cancel should cancel all event registrations.");var i=e.query._path;e.eventRegistrations_.forEach((function(e){var t=e.createCancelEvent(n,i);t&&r.push(t)}))}if(t){for(var a=[],o=0;o<e.eventRegistrations_.length;++o){var s=e.eventRegistrations_[o];if(s.matches(t)){if(t.hasAnyCallback()){a=a.concat(e.eventRegistrations_.slice(o+1));break}}else a.push(s)}e.eventRegistrations_=a}else e.eventRegistrations_=[];return r}function zn(e,t,n,r){t.type===Mt.MERGE&&null!==t.source.queryId&&((0,y.hu)($t(e.viewCache_),"We should always have a full cache before handling merges"),(0,y.hu)(Xt(e.viewCache_),"Missing event cache, even though we have a server cache"));var i,a,o=e.viewCache_,s=Rn(e.processor_,o,t,n,r);return i=e.processor_,a=s.viewCache,(0,y.hu)(a.eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),(0,y.hu)(a.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed"),(0,y.hu)(s.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,Hn(e,s.changes,s.viewCache.eventCache.getNode(),null)}function Hn(e,t,n,r){var i=r?[r]:e.eventRegistrations_;return function(e,t,n,r){var i=[],a=[];return t.forEach((function(t){var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&a.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),Gt(e,i,"child_removed",t,r,n),Gt(e,i,"child_added",t,r,n),Gt(e,i,"child_moved",a,r,n),Gt(e,i,"child_changed",t,r,n),Gt(e,i,"value",t,r,n),i}(e.eventGenerator_,t,n,i)}var Wn,Kn=(0,h.Z)((function e(){(0,l.Z)(this,e),this.views=new Map}));function Gn(e){return 0===e.views.size}function Yn(e,t,n,r){var i=t.source.queryId;if(null!==i){var a=e.views.get(i);return(0,y.hu)(null!=a,"SyncTree gave us an op for an invalid query."),zn(a,t,n,r)}var o,s=[],u=(0,c.Z)(e.views.values());try{for(u.s();!(o=u.n()).done;){var l=o.value;s=s.concat(zn(l,t,n,r))}}catch(h){u.e(h)}finally{u.f()}return s}function Qn(e,t,n,r,i){var a=t._queryIdentifier,o=e.views.get(a);if(!o){var s=wn(n,i?r:null),u=!1;s?u=!0:r instanceof yt?(s=bn(n,r),u=!1):(s=yt.EMPTY_NODE,u=!1);var c=Yt(new Wt(s,u,!1),new Wt(r,i,!1));return new Vn(t,c)}return o}function Jn(e,t,n,r,i,a){var o=Qn(e,t,r,i,a);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,n),function(e,t){var n=e.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(lt,(function(e,t){r.push(It(e,t))})),n.isFullyInitialized()&&r.push(bt(n.getNode())),Hn(e,r,n.getNode(),t)}(o,n)}function Xn(e,t,n,i){var a=t._queryIdentifier,o=[],s=[],u=rr(e);if("default"===a){var l,h=(0,c.Z)(e.views.entries());try{for(h.s();!(l=h.n()).done;){var f=(0,r.Z)(l.value,2),d=f[0],v=f[1];s=s.concat(Bn(v,n,i)),qn(v)&&(e.views.delete(d),v.query._queryParams.loadsAllData()||o.push(v.query))}}catch(g){h.e(g)}finally{h.f()}}else{var p=e.views.get(a);p&&(s=s.concat(Bn(p,n,i)),qn(p)&&(e.views.delete(a),p.query._queryParams.loadsAllData()||o.push(p.query)))}return u&&!rr(e)&&o.push(new((0,y.hu)(Un,"Reference.ts has not been loaded"),Un)(t._repo,t._path)),{removed:o,events:s}}function $n(e){var t,n=[],r=(0,c.Z)(e.views.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;i.query._queryParams.loadsAllData()||n.push(i)}}catch(a){r.e(a)}finally{r.f()}return n}function er(e,t){var n,r=null,i=(0,c.Z)(e.views.values());try{for(i.s();!(n=i.n()).done;){var a=n.value;r=r||jn(a,t)}}catch(o){i.e(o)}finally{i.f()}return r}function tr(e,t){if(t._queryParams.loadsAllData())return ir(e);var n=t._queryIdentifier;return e.views.get(n)}function nr(e,t){return null!=tr(e,t)}function rr(e){return null!=ir(e)}function ir(e){var t,n=(0,c.Z)(e.views.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.query._queryParams.loadsAllData())return r}}catch(i){n.e(i)}finally{n.f()}return null}var ar=1,or=(0,h.Z)((function e(t){(0,l.Z)(this,e),this.listenProvider_=t,this.syncPointTree_=new tn(null),this.pendingWriteTree_={visibleWrites:nn.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}));function sr(e,t,n,r,i){return function(e,t,n,r,i){(0,y.hu)(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:i}),i&&(e.visibleWrites=rn(e.visibleWrites,t,n)),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r,i),i?pr(e,new zt({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function ur(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=pn(e.pendingWriteTree_,t),i=yn(e.pendingWriteTree_,t);if(i){var a=new tn(null);return null!=r.snap?a=a.set(Te(),!0):K(r.children,(function(e){a=a.set(new Ee(e),!0)})),pr(e,new qt(r.path,a,n))}return[]}function cr(e,t,n){return pr(e,new zt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function lr(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=t._path,o=e.syncPointTree_.get(a),s=[];if(o&&("default"===t._queryIdentifier||nr(o,t))){var u=Xn(o,t,n,r);Gn(o)&&(e.syncPointTree_=e.syncPointTree_.remove(a));var c=u.removed;if(s=u.events,!i){var l=-1!==c.findIndex((function(e){return e._queryParams.loadsAllData()})),h=e.syncPointTree_.findOnPath(a,(function(e,t){return rr(t)}));if(l&&!h){var f=e.syncPointTree_.subtree(a);if(!f.isEmpty())for(var d=Er(f),v=0;v<d.length;++v){var p=d[v],y=p.query,g=mr(e,p);e.listenProvider_.startListening(Tr(y),_r(e,y),g.hashFn,g.onComplete)}}if(!h&&c.length>0&&!r)if(l){var m=null;e.listenProvider_.stopListening(Tr(t),m)}else c.forEach((function(t){var n=e.queryToTagMap.get(kr(t));e.listenProvider_.stopListening(Tr(t),n)}))}Cr(e,c)}return s}function hr(e,t,n,r){var i=wr(e,r);if(null!=i){var a=br(i),o=a.path,s=a.queryId,u=De(o,t);return Ir(e,o,new zt(Vt(s),u,n))}return[]}function fr(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=t._path,a=null,o=!1;e.syncPointTree_.foreachOnPath(i,(function(e,t){var n=De(e,i);a=a||er(t,n),o=o||rr(t)}));var s,u=e.syncPointTree_.get(i);if(u?(o=o||rr(u),a=a||er(u,Te())):(u=new Kn,e.syncPointTree_=e.syncPointTree_.set(i,u)),null!=a)s=!0;else{s=!1,a=yt.EMPTY_NODE;var c=e.syncPointTree_.subtree(i);c.foreachChild((function(e,t){var n=er(t,Te());n&&(a=a.updateImmediateChild(e,n))}))}var l=nr(u,t);if(!l&&!t._queryParams.loadsAllData()){var h=kr(t);(0,y.hu)(!e.queryToTagMap.has(h),"View does not exist, but we have a tag");var f=Sr();e.queryToTagMap.set(h,f),e.tagToQueryMap.set(f,h)}var d=vn(e.pendingWriteTree_,i),v=Jn(u,t,n,d,a,s);if(!l&&!o&&!r){var p=tr(u,t);v=v.concat(xr(e,t,p))}return v}function dr(e,t,n){var r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(function(e,n){var r=er(n,De(e,t));if(r)return r}));return kn(r,t,i,n,!0)}function vr(e,t){var n=t._path,r=null;e.syncPointTree_.foreachOnPath(n,(function(e,t){var i=De(e,n);r=r||er(t,i)}));var i=e.syncPointTree_.get(n);i?r=r||er(i,Te()):(i=new Kn,e.syncPointTree_=e.syncPointTree_.set(n,i));var a=null!=r,o=a?new Wt(r,!0,!1):null;return function(e){return Xt(e.viewCache_)}(Qn(i,t,vn(e.pendingWriteTree_,t._path),a?o.getNode():yt.EMPTY_NODE,a))}function pr(e,t){return yr(t,e.syncPointTree_,null,vn(e.pendingWriteTree_,Te()))}function yr(e,t,n,r){if(Ze(e.path))return gr(e,t,n,r);var i=t.get(Te());null==n&&null!=i&&(n=er(i,Te()));var a=[],o=Ce(e.path),s=e.operationForChild(o),u=t.children.get(o);if(u&&s){var c=n?n.getImmediateChild(o):null,l=Sn(r,o);a=a.concat(yr(s,u,c,l))}return i&&(a=a.concat(Yn(i,e,r,n))),a}function gr(e,t,n,r){var i=t.get(Te());null==n&&null!=i&&(n=er(i,Te()));var a=[];return t.children.inorderTraversal((function(t,i){var o=n?n.getImmediateChild(t):null,s=Sn(r,t),u=e.operationForChild(t);u&&(a=a.concat(gr(u,i,o,s)))})),i&&(a=a.concat(Yn(i,e,r,n))),a}function mr(e,t){var n=t.query,r=_r(e,n);return{hashFn:function(){var e=function(e){return e.viewCache_.serverCache.getNode()}(t)||yt.EMPTY_NODE;return e.hash()},onComplete:function(t){if("ok"===t)return r?function(e,t,n){var r=wr(e,n);if(r){var i=br(r),a=i.path,o=i.queryId,s=De(a,t);return Ir(e,a,new Bt(Vt(o),s))}return[]}(e,n._path,r):function(e,t){return pr(e,new Bt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);var i=function(e,t){var n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");var r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(t,n);return lr(e,n,null,i)}}}function _r(e,t){var n=kr(t);return e.queryToTagMap.get(n)}function kr(e){return e._path.toString()+"$"+e._queryIdentifier}function wr(e,t){return e.tagToQueryMap.get(t)}function br(e){var t=e.indexOf("$");return(0,y.hu)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Ee(e.substr(0,t))}}function Ir(e,t,n){var r=e.syncPointTree_.get(t);return(0,y.hu)(r,"Missing sync point for query tag that we're tracking"),Yn(r,n,vn(e.pendingWriteTree_,t),null)}function Er(e){return e.fold((function(e,t,n){if(t&&rr(t))return[ir(t)];var r=[];return t&&(r=$n(t)),K(n,(function(e,t){r=r.concat(t)})),r}))}function Tr(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new((0,y.hu)(Wn,"Reference.ts has not been loaded"),Wn)(e._repo,e._path):e}function Cr(e,t){for(var n=0;n<t.length;++n){var r=t[n];if(!r._queryParams.loadsAllData()){var i=kr(r),a=e.queryToTagMap.get(i);e.queryToTagMap.delete(i),e.tagToQueryMap.delete(a)}}}function Sr(){return ar++}function xr(e,t,n){var r=t._path,i=_r(e,t),a=mr(e,n),o=e.listenProvider_.startListening(Tr(t),i,a.hashFn,a.onComplete),s=e.syncPointTree_.subtree(r);if(i)(0,y.hu)(!rr(s.value),"If we're adding a query, it shouldn't be shadowed");else for(var u=s.fold((function(e,t,n){if(!Ze(e)&&t&&rr(t))return[ir(t).query];var r=[];return t&&(r=r.concat($n(t).map((function(e){return e.query})))),K(n,(function(e,t){r=r.concat(t)})),r})),c=0;c<u.length;++c){var l=u[c];e.listenProvider_.stopListening(Tr(l),_r(e,l))}return o}var Nr=function(){function e(t){(0,l.Z)(this,e),this.node_=t}return(0,h.Z)(e,[{key:"getImmediateChild",value:function(t){return new e(this.node_.getImmediateChild(t))}},{key:"node",value:function(){return this.node_}}]),e}(),Ar=function(){function e(t,n){(0,l.Z)(this,e),this.syncTree_=t,this.path_=n}return(0,h.Z)(e,[{key:"getImmediateChild",value:function(t){var n=Re(this.path_,t);return new e(this.syncTree_,n)}},{key:"node",value:function(){return dr(this.syncTree_,this.path_)}}]),e}(),Pr=function(e,t,n){return e&&"object"===typeof e?((0,y.hu)(".sv"in e,"Unexpected leaf node or priority contents"),"string"===typeof e[".sv"]?Rr(e[".sv"],t,n):"object"===typeof e[".sv"]?Zr(e[".sv"],t):void(0,y.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Rr=function(e,t,n){if("timestamp"===e)return n.timestamp;(0,y.hu)(!1,"Unexpected server value: "+e)},Zr=function(e,t,n){e.hasOwnProperty("increment")||(0,y.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!==typeof r&&(0,y.hu)(!1,"Unexpected increment value: "+r);var i=t.node();if((0,y.hu)(null!==i&&"undefined"!==typeof i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;var a=i.getValue();return"number"!==typeof a?r:a+r},Dr=function(e,t,n,r){return Lr(t,new Ar(n,e),r)},Or=function(e,t,n){return Lr(e,new Nr(t),n)};function Lr(e,t,n){var r,i=e.getPriority().val(),a=Pr(i,t.getImmediateChild(".priority"),n);if(e.isLeafNode()){var o=e,s=Pr(o.getValue(),t,n);return s!==o.getValue()||a!==o.getPriority().val()?new ot(s,mt(a)):e}var u=e;return r=u,a!==u.getPriority().val()&&(r=r.updatePriority(new ot(a))),u.forEachChild(lt,(function(e,i){var a=Lr(i,t.getImmediateChild(e),n);a!==i&&(r=r.updateImmediateChild(e,a))})),r}var Mr=(0,h.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{children:{},childCount:0};(0,l.Z)(this,e),this.name=t,this.parent=n,this.node=r}));function Fr(e,t){for(var n=t instanceof Ee?t:new Ee(t),r=e,i=Ce(n);null!==i;){var a=(0,y.DV)(r.node.children,i)||{children:{},childCount:0};r=new Mr(i,r,a),i=Ce(n=xe(n))}return r}function Ur(e){return e.node.value}function Vr(e,t){e.node.value=t,Hr(e)}function jr(e){return e.node.childCount>0}function qr(e,t){K(e.node.children,(function(n,r){t(new Mr(n,e,r))}))}function Br(e,t,n,r){n&&!r&&t(e),qr(e,(function(e){Br(e,t,!0,r)})),n&&r&&t(e)}function zr(e){return new Ee(null===e.parent?e.name:zr(e.parent)+"/"+e.name)}function Hr(e){null!==e.parent&&function(e,t,n){var r=function(e){return void 0===Ur(e)&&!jr(e)}(n),i=(0,y.r3)(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,Hr(e)):r||i||(e.node.children[t]=n.node,e.node.childCount++,Hr(e))}(e.parent,e.name,e)}var Wr=/[\[\].#$\/\u0000-\u001F\u007F]/,Kr=/[\[\].#$\u0000-\u001F\u007F]/,Gr=10485760,Yr=function(e){return"string"===typeof e&&0!==e.length&&!Wr.test(e)},Qr=function(e){return"string"===typeof e&&0!==e.length&&!Kr.test(e)},Jr=function e(t,n,r){var i=r instanceof Ee?new Me(r,t):r;if(void 0===n)throw new Error(t+"contains undefined "+Ue(i));if("function"===typeof n)throw new Error(t+"contains a function "+Ue(i)+" with contents = "+n.toString());if(U(n))throw new Error(t+"contains "+n.toString()+" "+Ue(i));if("string"===typeof n&&n.length>Gr/3&&(0,y.ug)(n)>Gr)throw new Error(t+"contains a string greater than "+"10485760 utf8 bytes "+Ue(i)+" ('"+n.substring(0,50)+"...')");if(n&&"object"===typeof n){var a=!1,o=!1;if(K(n,(function(n,r){if(".value"===n)a=!0;else if(".priority"!==n&&".sv"!==n&&(o=!0,!Yr(n)))throw new Error(t+" contains an invalid key ("+n+") "+Ue(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var s,u;u=n,(s=i).parts_.length>0&&(s.byteLength_+=1),s.parts_.push(u),s.byteLength_+=(0,y.ug)(u),Fe(s),e(t,r,i),function(e){var t=e.parts_.pop();e.byteLength_-=(0,y.ug)(t),e.parts_.length>0&&(e.byteLength_-=1)}(i)})),a&&o)throw new Error(t+' contains ".value" child '+Ue(i)+" in addition to actual children.")}},Xr=function(e,t,n,r){if((!r||void 0!==n)&&!Qr(n))throw new Error((0,y.gK)(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},$r=function(e,t){var n=t.path.toString();if("string"!==typeof t.repoInfo.host||0===t.repoInfo.host.length||!Yr(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Qr(e)}(n))throw new Error((0,y.gK)(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},ei=(0,h.Z)((function e(){(0,l.Z)(this,e),this.eventLists_=[],this.recursionDepth_=0}));function ti(e,t){for(var n=null,r=0;r<t.length;r++){var i=t[r],a=i.getPath();null===n||Oe(a,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:a}),n.events.push(i)}n&&e.eventLists_.push(n)}function ni(e,t,n){ti(e,n),ri(e,(function(e){return Le(e,t)||Le(t,e)}))}function ri(e,t){e.recursionDepth_++;for(var n=!0,r=0;r<e.eventLists_.length;r++){var i=e.eventLists_[r];if(i)t(i.path)?(ii(e.eventLists_[r]),e.eventLists_[r]=null):n=!1}n&&(e.eventLists_=[]),e.recursionDepth_--}function ii(e){for(var t=0;t<e.events.length;t++){var n=e.events[t];if(null!==n){e.events[t]=null;var r=n.getEventRunner();P&&D("event: "+n.toString()),J(r)}}}var ai="repo_interrupt",oi=function(){function e(t,n,r,i){(0,l.Z)(this,e),this.repoInfo_=t,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ei,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Dt(),this.transactionQueueTree_=new Mr,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}return(0,h.Z)(e,[{key:"toString",value:function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}]),e}();function si(e,t,n){if(e.stats_=he(e.repoInfo_),e.forceRestClient_||("object"===typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new Rt(e.repoInfo_,(function(t,n,r,i){li(e,t,n,r,i)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((function(){return hi(e,!0)}),0);else{if("undefined"!==typeof n&&null!==n){if("object"!==typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,y.Wl)(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}e.persistentConnection_=new qe(e.repoInfo_,t,(function(t,n,r,i){li(e,t,n,r,i)}),(function(t){hi(e,t)}),(function(t){!function(e,t){K(t,(function(t,n){fi(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((function(t){e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((function(t){e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(e,t){var n=e.toString();return le[n]||(le[n]=t()),le[n]}(e.repoInfo_,(function(){return new Ut(e.stats_,e.server_)})),e.infoData_=new Zt,e.infoSyncTree_=new or({startListening:function(t,n,r,i){var a=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(a=cr(e.infoSyncTree_,t._path,o),setTimeout((function(){i("ok")}),0)),a},stopListening:function(){}}),fi(e,"connected",!1),e.serverSyncTree_=new or({startListening:function(t,n,r,i){return e.server_.listen(t,r,n,(function(n,r){var a=i(n,r);ni(e.eventQueue_,t._path,a)})),[]},stopListening:function(t,n){e.server_.unlisten(t,n)}})}function ui(e){var t=e.infoData_.getNode(new Ee(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function ci(e){return(t=(t={timestamp:ui(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function li(e,t,n,r,i){e.dataUpdateCount++;var a=new Ee(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;var o=[];if(i)if(r){var s=(0,y.UI)(n,(function(e){return mt(e)}));o=function(e,t,n,r){var i=wr(e,r);if(i){var a=br(i),o=a.path,s=a.queryId,u=De(o,t),c=tn.fromObject(n);return Ir(e,o,new Ht(Vt(s),u,c))}return[]}(e.serverSyncTree_,a,s,i)}else{var u=mt(n);o=hr(e.serverSyncTree_,a,u,i)}else if(r){var c=(0,y.UI)(n,(function(e){return mt(e)}));o=function(e,t,n){var r=tn.fromObject(n);return pr(e,new Ht({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,r))}(e.serverSyncTree_,a,c)}else{var l=mt(n);o=cr(e.serverSyncTree_,a,l)}var h=a;o.length>0&&(h=_i(e,a)),ni(e.eventQueue_,h,o)}function hi(e,t){fi(e,"connected",t),!1===t&&function(e){pi(e,"onDisconnectEvents");var t=ci(e),n=Dt();Lt(e.onDisconnect_,Te(),(function(r,i){var a=Dr(r,i,e.serverSyncTree_,t);Ot(n,r,a)}));var r=[];Lt(n,Te(),(function(t,n){r=r.concat(cr(e.serverSyncTree_,t,n));var i=Ei(e,t);_i(e,i)})),e.onDisconnect_=Dt(),ni(e.eventQueue_,Te(),r)}(e)}function fi(e,t,n){var r=new Ee("/.info/"+t),i=mt(n);e.infoData_.updateSnapshot(r,i);var a=cr(e.infoSyncTree_,r,i);ni(e.eventQueue_,r,a)}function di(e){return e.nextWriteId_++}function vi(e){e.persistentConnection_&&e.persistentConnection_.interrupt(ai)}function pi(e){var t="";e.persistentConnection_&&(t=e.persistentConnection_.id+":");for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];D.apply(void 0,[t].concat(r))}function yi(e,t,n){return dr(e.serverSyncTree_,t,n)||yt.EMPTY_NODE}function gi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.transactionQueueTree_;if(t||Ii(e,t),Ur(t)){var n=wi(e,t);(0,y.hu)(n.length>0,"Sending zero length transaction queue");var r=n.every((function(e){return 0===e.status}));r&&mi(e,zr(t),n)}else jr(t)&&qr(t,(function(t){gi(e,t)}))}function mi(e,t,n){for(var r=n.map((function(e){return e.currentWriteId})),i=yi(e,t,r),a=i,o=i.hash(),s=0;s<n.length;s++){var u=n[s];(0,y.hu)(0===u.status,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;var c=De(t,u.path);a=a.updateChild(c,u.currentOutputSnapshotRaw)}var l=a.val(!0),h=t;e.server_.put(h.toString(),l,(function(r){pi(e,"transaction put response",{path:h.toString(),status:r});var i=[];if("ok"===r){for(var a=[],o=function(t){n[t].status=2,i=i.concat(ur(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&a.push((function(){return n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)})),n[t].unwatcher()},s=0;s<n.length;s++)o(s);Ii(e,Fr(e.transactionQueueTree_,t)),gi(e,e.transactionQueueTree_),ni(e.eventQueue_,t,i);for(var u=0;u<a.length;u++)J(a[u])}else{if("datastale"===r)for(var c=0;c<n.length;c++)3===n[c].status?n[c].status=4:n[c].status=0;else{F("transaction at "+h.toString()+" failed: "+r);for(var l=0;l<n.length;l++)n[l].status=4,n[l].abortReason=r}_i(e,t)}}),o)}function _i(e,t){var n=ki(e,t),r=zr(n);return function(e,t,n){if(0===t.length)return;for(var r=[],i=[],a=t.filter((function(e){return 0===e.status})).map((function(e){return e.currentWriteId})),o=function(o){var s,u=t[o],c=De(n,u.path),l=!1,h=void 0;if((0,y.hu)(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null."),4===u.status)l=!0,h=u.abortReason,i=i.concat(ur(e.serverSyncTree_,u.currentWriteId,!0));else if(0===u.status)if(u.retryCount>=25)l=!0,h="maxretry",i=i.concat(ur(e.serverSyncTree_,u.currentWriteId,!0));else{var f=yi(e,u.path,a);u.currentInputSnapshot=f;var d=t[o].update(f.val());if(void 0!==d){Jr("transaction failed: Data returned ",d,u.path);var v=mt(d);"object"===typeof d&&null!=d&&(0,y.r3)(d,".priority")||(v=v.updatePriority(f.getPriority()));var p=u.currentWriteId,g=ci(e),m=Or(v,f,g);u.currentOutputSnapshotRaw=v,u.currentOutputSnapshotResolved=m,u.currentWriteId=di(e),a.splice(a.indexOf(p),1),i=(i=i.concat(sr(e.serverSyncTree_,u.path,m,u.currentWriteId,u.applyLocally))).concat(ur(e.serverSyncTree_,p,!0))}else l=!0,h="nodata",i=i.concat(ur(e.serverSyncTree_,u.currentWriteId,!0))}ni(e.eventQueue_,n,i),i=[],l&&(t[o].status=2,s=t[o].unwatcher,setTimeout(s,Math.floor(0)),t[o].onComplete&&("nodata"===h?r.push((function(){return t[o].onComplete(null,!1,t[o].currentInputSnapshot)})):r.push((function(){return t[o].onComplete(new Error(h),!1,null)}))))},s=0;s<t.length;s++)o(s);Ii(e,e.transactionQueueTree_);for(var u=0;u<r.length;u++)J(r[u]);gi(e,e.transactionQueueTree_)}(e,wi(e,n),r),r}function ki(e,t){var n,r=e.transactionQueueTree_;for(n=Ce(t);null!==n&&void 0===Ur(r);)r=Fr(r,n),n=Ce(t=xe(t));return r}function wi(e,t){var n=[];return bi(e,t,n),n.sort((function(e,t){return e.order-t.order})),n}function bi(e,t,n){var r=Ur(t);if(r)for(var i=0;i<r.length;i++)n.push(r[i]);qr(t,(function(t){bi(e,t,n)}))}function Ii(e,t){var n=Ur(t);if(n){for(var r=0,i=0;i<n.length;i++)2!==n[i].status&&(n[r]=n[i],r++);n.length=r,Vr(t,n.length>0?n:void 0)}qr(t,(function(t){Ii(e,t)}))}function Ei(e,t){var n=zr(ki(e,t)),r=Fr(e.transactionQueueTree_,t);return function(e,t,n){for(var r=n?e:e.parent;null!==r;){if(t(r))return!0;r=r.parent}}(r,(function(t){Ti(e,t)})),Ti(e,r),Br(r,(function(t){Ti(e,t)})),n}function Ti(e,t){var n=Ur(t);if(n){for(var r=[],i=[],a=-1,o=0;o<n.length;o++)3===n[o].status||(1===n[o].status?((0,y.hu)(a===o-1,"All SENT items should be at beginning of queue."),a=o,n[o].status=3,n[o].abortReason="set"):((0,y.hu)(0===n[o].status,"Unexpected transaction status in abort"),n[o].unwatcher(),i=i.concat(ur(e.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&r.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));-1===a?Vr(t,void 0):n.length=a+1,ni(e.eventQueue_,zr(t),i);for(var s=0;s<r.length;s++)J(r[s])}}var Ci=function(e,t){var n=Si(e),r=n.namespace;"firebase.com"===n.domain&&M(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||M("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!==typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&F("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new oe(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new Ee(n.pathString)}},Si=function(e){var t="",n="",r="",i="",a="",o=!0,s="https",u=443;if("string"===typeof e){var l=e.indexOf("//");l>=0&&(s=e.substring(0,l-1),e=e.substring(l+2));var h=e.indexOf("/");-1===h&&(h=e.length);var f=e.indexOf("?");-1===f&&(f=e.length),t=e.substring(0,Math.min(h,f)),h<f&&(i=function(e){for(var t="",n=e.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(a){}t+="/"+i}return t}(e.substring(h,f)));var d=function(e){var t={};"?"===e.charAt(0)&&(e=e.substring(1));var n,r=(0,c.Z)(e.split("&"));try{for(r.s();!(n=r.n()).done;){var i=n.value;if(0!==i.length){var a=i.split("=");2===a.length?t[decodeURIComponent(a[0])]=decodeURIComponent(a[1]):F("Invalid query segment '".concat(i,"' in query '").concat(e,"'"))}}}catch(o){r.e(o)}finally{r.f()}return t}(e.substring(Math.min(e.length,f)));(l=t.indexOf(":"))>=0?(o="https"===s||"wss"===s,u=parseInt(t.substring(l+1),10)):l=t.length;var v=t.slice(0,l);if("localhost"===v.toLowerCase())n="localhost";else if(v.split(".").length<=2)n=v;else{var p=t.indexOf(".");r=t.substring(0,p).toLowerCase(),n=t.substring(p+1),a=r}"ns"in d&&(a=d.ns)}return{host:t,port:u,domain:n,subdomain:r,secure:o,scheme:s,pathString:i,namespace:a}},xi="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Ni=(function(){var e=0,t=[]}(),function(){function e(t,n,r,i){(0,l.Z)(this,e),this.eventType=t,this.eventRegistration=n,this.snapshot=r,this.prevName=i}return(0,h.Z)(e,[{key:"getPath",value:function(){var e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}},{key:"getEventType",value:function(){return this.eventType}},{key:"getEventRunner",value:function(){return this.eventRegistration.getEventRunner(this)}},{key:"toString",value:function(){return this.getPath().toString()+":"+this.eventType+":"+(0,y.Wl)(this.snapshot.exportVal())}}]),e}()),Ai=function(){function e(t,n,r){(0,l.Z)(this,e),this.eventRegistration=t,this.error=n,this.path=r}return(0,h.Z)(e,[{key:"getPath",value:function(){return this.path}},{key:"getEventType",value:function(){return"cancel"}},{key:"getEventRunner",value:function(){return this.eventRegistration.getEventRunner(this)}},{key:"toString",value:function(){return this.path.toString()+":cancel"}}]),e}(),Pi=function(){function e(t,n){(0,l.Z)(this,e),this.snapshotCallback=t,this.cancelCallback=n}return(0,h.Z)(e,[{key:"onValue",value:function(e,t){this.snapshotCallback.call(null,e,t)}},{key:"onCancel",value:function(e){return(0,y.hu)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}},{key:"hasCancelCallback",get:function(){return!!this.cancelCallback}},{key:"matches",value:function(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}]),e}(),Ri=function(){function e(t,n,r,i){(0,l.Z)(this,e),this._repo=t,this._path=n,this._queryParams=r,this._orderByCalled=i}return(0,h.Z)(e,[{key:"key",get:function(){return Ze(this._path)?null:Ne(this._path)}},{key:"ref",get:function(){return new Zi(this._repo,this._path)}},{key:"_queryIdentifier",get:function(){var e=Pt(this._queryParams),t=H(e);return"{}"===t?"default":t}},{key:"_queryObject",get:function(){return Pt(this._queryParams)}},{key:"isEqual",value:function(t){if(!((t=(0,y.m9)(t))instanceof e))return!1;var n=this._repo===t._repo,r=Oe(this._path,t._path),i=this._queryIdentifier===t._queryIdentifier;return n&&r&&i}},{key:"toJSON",value:function(){return this.toString()}},{key:"toString",value:function(){return this._repo.toString()+function(e){for(var t="",n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}]),e}();var Zi=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,r){return(0,l.Z)(this,n),t.call(this,e,r,new Nt,!1)}return(0,h.Z)(n,[{key:"parent",get:function(){var e=Pe(this._path);return null===e?null:new n(this._repo,e)}},{key:"root",get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}}]),n}(Ri),Di=function(){function e(t,n,r){(0,l.Z)(this,e),this._node=t,this.ref=n,this._index=r}return(0,h.Z)(e,[{key:"priority",get:function(){return this._node.getPriority().val()}},{key:"key",get:function(){return this.ref.key}},{key:"size",get:function(){return this._node.numChildren()}},{key:"child",value:function(t){var n=new Ee(t),r=Li(this.ref,t);return new e(this._node.getChild(n),r,lt)}},{key:"exists",value:function(){return!this._node.isEmpty()}},{key:"exportVal",value:function(){return this._node.val(!0)}},{key:"forEach",value:function(t){var n=this;return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(function(r,i){return t(new e(i,Li(n.ref,r),lt))}))}},{key:"hasChild",value:function(e){var t=new Ee(e);return!this._node.getChild(t).isEmpty()}},{key:"hasChildren",value:function(){return!this._node.isLeafNode()&&!this._node.isEmpty()}},{key:"toJSON",value:function(){return this.exportVal()}},{key:"val",value:function(){return this._node.val()}}]),e}();function Oi(e,t){return(e=(0,y.m9)(e))._checkNotDeleted("ref"),void 0!==t?Li(e._root,t):e._root}function Li(e,t){var n,r,i,a;return null===Ce((e=(0,y.m9)(e))._path)?(n="child",r="path",a=!1,(i=t)&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),Xr(n,r,i,a)):Xr("child","path",t,!1),new Zi(e._repo,Re(e._path,t))}function Mi(e){e=(0,y.m9)(e);var t=new Pi((function(){})),n=new Fi(t);return function(e,t,n){var r=vr(e.serverSyncTree_,t);return null!=r?Promise.resolve(r):e.server_.get(t).then((function(r){var i,a=mt(r).withIndex(t._queryParams.getIndex());if(fr(e.serverSyncTree_,t,n,!0),t._queryParams.loadsAllData())i=cr(e.serverSyncTree_,t._path,a);else{var o=_r(e.serverSyncTree_,t);i=hr(e.serverSyncTree_,t._path,a,o)}return ni(e.eventQueue_,t._path,i),lr(e.serverSyncTree_,t,n,null,!0),a}),(function(n){return pi(e,"get for query "+(0,y.Wl)(t)+" failed: "+n),Promise.reject(new Error(n))}))}(e._repo,e,n).then((function(t){return new Di(t,new Zi(e._repo,e._path),e._queryParams.getIndex())}))}var Fi=function(){function e(t){(0,l.Z)(this,e),this.callbackContext=t}return(0,h.Z)(e,[{key:"respondsTo",value:function(e){return"value"===e}},{key:"createEvent",value:function(e,t){var n=t._queryParams.getIndex();return new Ni("value",this,new Di(e.snapshotNode,new Zi(t._repo,t._path),n))}},{key:"getEventRunner",value:function(e){var t=this;return"cancel"===e.getEventType()?function(){return t.callbackContext.onCancel(e.error)}:function(){return t.callbackContext.onValue(e.snapshot,null)}}},{key:"createCancelEvent",value:function(e,t){return this.callbackContext.hasCancelCallback?new Ai(this,e,t):null}},{key:"matches",value:function(t){return t instanceof e&&(!t.callbackContext||!this.callbackContext||t.callbackContext.matches(this.callbackContext))}},{key:"hasAnyCallback",value:function(){return null!==this.callbackContext}}]),e}();!function(e){(0,y.hu)(!Un,"__referenceConstructor has already been defined"),Un=e}(Zi),function(e){(0,y.hu)(!Wn,"__referenceConstructor has already been defined"),Wn=e}(Zi);var Ui={},Vi=!1;function ji(e,t,n,r){e.repoInfo_=new oe("".concat(t,":").concat(n),!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0),r&&(e.authTokenProvider_=r)}function qi(e,t,n,r,i){var a=r||e.options.databaseURL;void 0===a&&(e.options.projectId||M("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),D("Using default host for project ",e.options.projectId),a="".concat(e.options.projectId,"-default-rtdb.firebaseio.com"));var o,s=Ci(a,i),u=s.repoInfo,c=void 0;"undefined"!==typeof process&&(c={NODE_ENV:"production",PUBLIC_URL:"/LearnLingo",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.FIREBASE_DATABASE_EMULATOR_HOST),c?(o=!0,a="http://".concat(c,"?ns=").concat(u.namespace),u=(s=Ci(a,i)).repoInfo):o=!s.repoInfo.secure;var l=i&&o?new te(te.OWNER):new ee(e.name,e.options,t);$r("Invalid Firebase Database URL",s),Ze(s.path)||M("Database URL must point to the root of a Firebase Database (not including a child path).");var h=function(e,t,n,r){var i=Ui[t.name];i||(i={},Ui[t.name]=i);var a=i[e.toURLString()];a&&M("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return a=new oi(e,Vi,n,r),i[e.toURLString()]=a,a}(u,e,l,new $(e.name,n));return new Bi(h,e)}var Bi=function(){function e(t,n){(0,l.Z)(this,e),this._repoInternal=t,this.app=n,this.type="database",this._instanceStarted=!1}return(0,h.Z)(e,[{key:"_repo",get:function(){return this._instanceStarted||(si(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}},{key:"_root",get:function(){return this._rootInternal||(this._rootInternal=new Zi(this._repo,Te())),this._rootInternal}},{key:"_delete",value:function(){return null!==this._rootInternal&&(!function(e,t){var n=Ui[t];n&&n[e.key]===e||M("Database ".concat(t,"(").concat(e.repoInfo_,") has already been deleted.")),vi(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}},{key:"_checkNotDeleted",value:function(e){null===this._rootInternal&&M("Cannot call "+e+" on a deleted database.")}}]),e}();function zi(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,v.Mq)(),t=arguments.length>1?arguments[1]:void 0,n=(0,v.qX)(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){var r=(0,y.P0)("database");r&&Hi.apply(void 0,[n].concat((0,u.Z)(r)))}return n}function Hi(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(e=(0,y.m9)(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&M("Cannot call useEmulator() after instance has already been initialized.");var i=e._repoInternal,a=void 0;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&M('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),a=new te(te.OWNER);else if(r.mockUserToken){var o="string"===typeof r.mockUserToken?r.mockUserToken:(0,y.Sg)(r.mockUserToken,e.app.options.projectId);a=new te(o)}ji(i,t,n,a)}qe.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},qe.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var Wi;w(v.Jn),(0,v.Xd)(new p.wA("database",(function(e,t){var n=t.instanceIdentifier;return qi(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),n)}),"PUBLIC").setMultipleInstances(!0)),(0,v.KN)(m,_,Wi),(0,v.KN)(m,_,"esm2017")},2481:function(e,t,n){n.d(t,{JU:function(){return Kc},ad:function(){return Qc},pl:function(){return kl}});var r,i=n(5647),a=n(1752),o=n(1120),s=n(9439),u=n(8664),c=n(7762),l=n(5861),h=n(136),f=n(3668),d=n(3433),v=n(5671),p=n(3144),y=n(7757),g=n.n(y),m=n(9383),_=n(3258),k=n(6781),w=n(5854),b="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},I={},E=E||{},T=b||self;function C(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function S(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var x="closure_uid_"+(1e9*Math.random()>>>0),N=0;function A(e,t,n){return e.call.apply(e.bind,arguments)}function P(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function R(e,t,n){return(R=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?A:P).apply(null,arguments)}function Z(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function D(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var i=Array(arguments.length-2),a=2;a<arguments.length;a++)i[a-2]=arguments[a];return t.prototype[n].apply(e,i)}}function O(){this.s=this.s,this.o=this.o}O.prototype.s=!1,O.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,x)&&e[x]||(e[x]=++N))},O.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var L=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"===typeof e)return"string"!==typeof t||1!=t.length?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function M(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function F(e,t){for(var n=1;n<arguments.length;n++){var r=arguments[n];if(C(r)){var i=e.length||0,a=r.length||0;e.length=i+a;for(var o=0;o<a;o++)e[i+o]=r[o]}else e.push(r)}}function U(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}U.prototype.h=function(){this.defaultPrevented=!0};var V=function(){if(!T.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{var n=function(){};T.addEventListener("test",n,t),T.removeEventListener("test",n,t)}catch(n){}return e}();function j(e){return/^[\s\xa0]*$/.test(e)}function q(){var e=T.navigator;return e&&(e=e.userAgent)?e:""}function B(e){return-1!=q().indexOf(e)}function z(e){return z[" "](e),e}z[" "]=function(){};var H,W,K=B("Opera"),G=B("Trident")||B("MSIE"),Y=B("Edge"),Q=Y||G,J=B("Gecko")&&!(-1!=q().toLowerCase().indexOf("webkit")&&!B("Edge"))&&!(B("Trident")||B("MSIE"))&&!B("Edge"),X=-1!=q().toLowerCase().indexOf("webkit")&&!B("Edge");function $(){var e=T.document;return e?e.documentMode:void 0}e:{var ee="",te=function(){var e=q();return J?/rv:([^\);]+)(\)|;)/.exec(e):Y?/Edge\/([\d\.]+)/.exec(e):G?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):X?/WebKit\/(\S+)/.exec(e):K?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(te&&(ee=te?te[1]:""),G){var ne=$();if(null!=ne&&ne>parseFloat(ee)){H=String(ne);break e}}H=ee}if(T.document&&G){var re=$();W=re||(parseInt(H,10)||void 0)}else W=void 0;var ie=W;function ae(e,t){if(U.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(J){e:{try{z(t.nodeName);var i=!0;break e}catch(a){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:oe[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&ae.$.h.call(this)}}D(ae,U);var oe={2:"touch",3:"pen",4:"mouse"};ae.prototype.h=function(){ae.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var se="closure_listenable_"+(1e6*Math.random()|0),ue=0;function ce(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++ue,this.fa=this.ia=!1}function le(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function he(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function fe(e){var t={};for(var n in e)t[n]=e[n];return t}var de="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ve(e,t){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])e[n]=r[n];for(var a=0;a<de.length;a++)n=de[a],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function pe(e){this.src=e,this.g={},this.h=0}function ye(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],a=L(i,t);(r=0<=a)&&Array.prototype.splice.call(i,a,1),r&&(le(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function ge(e,t,n,r){for(var i=0;i<e.length;++i){var a=e[i];if(!a.fa&&a.listener==t&&a.capture==!!n&&a.la==r)return i}return-1}pe.prototype.add=function(e,t,n,r,i){var a=e.toString();(e=this.g[a])||(e=this.g[a]=[],this.h++);var o=ge(e,t,r,i);return-1<o?(t=e[o],n||(t.ia=!1)):((t=new ce(t,this.src,a,!!r,i)).ia=n,e.push(t)),t};var me="closure_lm_"+(1e6*Math.random()|0),_e={};function ke(e,t,n,r,i){if(r&&r.once)return be(e,t,n,r,i);if(Array.isArray(t)){for(var a=0;a<t.length;a++)ke(e,t[a],n,r,i);return null}return n=Ne(n),e&&e[se]?e.O(t,n,S(r)?!!r.capture:!!r,i):we(e,t,n,!1,r,i)}function we(e,t,n,r,i,a){if(!t)throw Error("Invalid event type");var o=S(i)?!!i.capture:!!i,s=Se(e);if(s||(e[me]=s=new pe(e)),(n=s.add(t,n,r,o,a)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}var t=Ce;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)V||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Te(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function be(e,t,n,r,i){if(Array.isArray(t)){for(var a=0;a<t.length;a++)be(e,t[a],n,r,i);return null}return n=Ne(n),e&&e[se]?e.P(t,n,S(r)?!!r.capture:!!r,i):we(e,t,n,!0,r,i)}function Ie(e,t,n,r,i){if(Array.isArray(t))for(var a=0;a<t.length;a++)Ie(e,t[a],n,r,i);else r=S(r)?!!r.capture:!!r,n=Ne(n),e&&e[se]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=ge(a=e.g[t],n,r,i))&&(le(a[n]),Array.prototype.splice.call(a,n,1),0==a.length&&(delete e.g[t],e.h--)))):e&&(e=Se(e))&&(t=e.g[t.toString()],e=-1,t&&(e=ge(t,n,r,i)),(n=-1<e?t[e]:null)&&Ee(n))}function Ee(e){if("number"!==typeof e&&e&&!e.fa){var t=e.src;if(t&&t[se])ye(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Te(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Se(t))?(ye(n,e),0==n.h&&(n.src=null,t[me]=null)):le(e)}}}function Te(e){return e in _e?_e[e]:_e[e]="on"+e}function Ce(e,t){if(e.fa)e=!0;else{t=new ae(t,this);var n=e.listener,r=e.la||e.src;e.ia&&Ee(e),e=n.call(r,t)}return e}function Se(e){return(e=e[me])instanceof pe?e:null}var xe="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ne(e){return"function"===typeof e?e:(e[xe]||(e[xe]=function(t){return e.handleEvent(t)}),e[xe])}function Ae(){O.call(this),this.i=new pe(this),this.S=this,this.J=null}function Pe(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"===typeof t)t=new U(t,e);else if(t instanceof U)t.target=t.target||e;else{var i=t;ve(t=new U(r,e),i)}if(i=!0,n)for(var a=n.length-1;0<=a;a--){var o=t.g=n[a];i=Re(o,r,!0,t)&&i}if(i=Re(o=t.g=e,r,!0,t)&&i,i=Re(o,r,!1,t)&&i,n)for(a=0;a<n.length;a++)i=Re(o=t.g=n[a],r,!1,t)&&i}function Re(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,a=0;a<t.length;++a){var o=t[a];if(o&&!o.fa&&o.capture==n){var s=o.listener,u=o.la||o.src;o.ia&&ye(e.i,o),i=!1!==s.call(u,r)&&i}}return i&&!r.defaultPrevented}D(Ae,O),Ae.prototype[se]=!0,Ae.prototype.removeEventListener=function(e,t,n,r){Ie(this,e,t,n,r)},Ae.prototype.N=function(){if(Ae.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)le(n[r]);delete t.g[e],t.h--}}this.J=null},Ae.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Ae.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Ze=T.JSON.stringify,De=function(){function e(t,n){(0,v.Z)(this,e),this.i=t,this.j=n,this.h=0,this.g=null}return(0,p.Z)(e,[{key:"get",value:function(){var e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}]),e}();function Oe(){var e=Be,t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Le=function(){function e(){(0,v.Z)(this,e),this.h=this.g=null}return(0,p.Z)(e,[{key:"add",value:function(e,t){var n=Me.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}]),e}(),Me=new De((function(){return new Fe}),(function(e){return e.reset()})),Fe=function(){function e(){(0,v.Z)(this,e),this.next=this.g=this.h=null}return(0,p.Z)(e,[{key:"set",value:function(e,t){this.h=e,this.g=t,this.next=null}},{key:"reset",value:function(){this.next=this.g=this.h=null}}]),e}();function Ue(e){var t=1;e=e.split(":");for(var n=[];0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function Ve(e){T.setTimeout((function(){throw e}),0)}var je,qe=!1,Be=new Le,ze=function(){var e=T.Promise.resolve(void 0);je=function(){e.then(He)}},He=function(){for(var e;e=Oe();){try{e.h.call(e.g)}catch(n){Ve(n)}var t=Me;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}qe=!1};function We(e,t){Ae.call(this),this.h=e||1,this.g=t||T,this.j=R(this.qb,this),this.l=Date.now()}function Ke(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function Ge(e,t,n){if("function"===typeof e)n&&(e=R(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=R(e.handleEvent,e)}return 2147483647<Number(t)?-1:T.setTimeout(e,t||0)}function Ye(e){e.g=Ge((function(){e.g=null,e.i&&(e.i=!1,Ye(e))}),e.j);var t=e.h;e.h=null,e.m.apply(null,t)}D(We,Ae),(r=We.prototype).ga=!1,r.T=null,r.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Pe(this,"tick"),this.ga&&(Ke(this),this.start()))}},r.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.N=function(){We.$.N.call(this),Ke(this),delete this.g};var Qe=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this)).m=e,i.j=r,i.h=null,i.i=!1,i.g=null,i}return(0,p.Z)(n,[{key:"l",value:function(e){this.h=arguments,this.g?this.i=!0:Ye(this)}},{key:"N",value:function(){(0,a.Z)((0,o.Z)(n.prototype),"N",this).call(this),this.g&&(T.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}]),n}(O);function Je(e){O.call(this),this.h=e,this.g={}}D(Je,O);var Xe=[];function $e(e,t,n,r){Array.isArray(n)||(n&&(Xe[0]=n.toString()),n=Xe);for(var i=0;i<n.length;i++){var a=ke(t,n[i],r||e.handleEvent,!1,e.h||e);if(!a)break;e.g[a.key]=a}}function et(e){he(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Ee(e)}),e),e.g={}}function tt(){this.g=!0}function nt(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var a=i[0];if("noop"!=a&&"stop"!=a&&"close"!=a)for(var o=1;o<i.length;o++)i[o]=""}}}return Ze(n)}catch(s){return t}}(e,n)+(r?" "+r:"")}))}Je.prototype.N=function(){Je.$.N.call(this),et(this)},Je.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},tt.prototype.Ea=function(){this.g=!1},tt.prototype.info=function(){};var rt={},it=null;function at(){return it=it||new Ae}function ot(e){U.call(this,rt.Ta,e)}function st(e){var t=at();Pe(t,new ot(t))}function ut(e,t){U.call(this,rt.STAT_EVENT,e),this.stat=t}function ct(e){var t=at();Pe(t,new ut(t,e))}function lt(e,t){U.call(this,rt.Ua,e),this.size=t}function ht(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return T.setTimeout((function(){e()}),t)}rt.Ta="serverreachability",D(ot,U),rt.STAT_EVENT="statevent",D(ut,U),rt.Ua="timingevent",D(lt,U);var ft={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},dt={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function vt(){}function pt(e){return e.h||(e.h=e.i())}function yt(){}vt.prototype.h=null;var gt,mt={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function _t(){U.call(this,"d")}function kt(){U.call(this,"c")}function wt(){}function bt(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new Je(this),this.P=Et,e=Q?125:void 0,this.V=new We(e),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new It}function It(){this.i=null,this.g="",this.h=!1}D(_t,U),D(kt,U),D(wt,vt),wt.prototype.g=function(){return new XMLHttpRequest},wt.prototype.i=function(){return{}},gt=new wt;var Et=45e3,Tt={},Ct={};function St(e,t,n){e.L=1,e.A=Wt(jt(t)),e.u=n,e.S=!0,xt(e,null)}function xt(e,t){e.G=Date.now(),Rt(e),e.B=jt(e.A);var n=e.B,r=e.W;Array.isArray(r)||(r=[String(r)]),on(n.i,"t",r),e.o=0,n=e.l.J,e.h=new It,e.g=sr(e.l,n?t:null,!e.u),0<e.O&&(e.M=new Qe(R(e.Pa,e,e.g),e.O)),$e(e.U,e.g,"readystatechange",e.nb),t=e.I?fe(e.I):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.B,e.v,e.u,t)):(e.v="GET",e.g.ha(e.B,e.v,null,t)),st(),function(e,t,n,r,i,a){e.info((function(){if(e.g)if(a)for(var o="",s=a.split("&"),u=0;u<s.length;u++){var c=s[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=a;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.v,e.B,e.m,e.W,e.u)}function Nt(e){return!!e.g&&("GET"==e.v&&2!=e.L&&e.l.Ha)}function At(e,t,n){for(var r,i=!0;!e.J&&e.o<n.length;){if((r=Pt(e,n))==Ct){4==t&&(e.s=4,ct(14),i=!1),nt(e.j,e.m,null,"[Incomplete Response]");break}if(r==Tt){e.s=4,ct(15),nt(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}nt(e.j,e.m,r,null),Mt(e,r)}Nt(e)&&0!=e.o&&(e.h.g=e.h.g.slice(e.o),e.o=0),4!=t||0!=n.length||e.h.h||(e.s=1,ct(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),$n(t),t.M=!0,ct(11))):(nt(e.j,e.m,n,"[Invalid Chunked Response]"),Lt(e),Ot(e))}function Pt(e,t){var n=e.o,r=t.indexOf("\n",n);return-1==r?Ct:(n=Number(t.substring(n,r)),isNaN(n)?Tt:(r+=1)+n>t.length?Ct:(t=t.slice(r,r+n),e.o=r+n,t))}function Rt(e){e.Y=Date.now()+e.P,Zt(e,e.P)}function Zt(e,t){if(null!=e.C)throw Error("WatchDog timer not null");e.C=ht(R(e.lb,e),t)}function Dt(e){e.C&&(T.clearTimeout(e.C),e.C=null)}function Ot(e){0==e.l.H||e.J||nr(e.l,e)}function Lt(e){Dt(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,Ke(e.V),et(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function Mt(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||dn(n.i,e)))if(!e.K&&dn(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(a){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;tr(n),Hn(n)}Xn(n),ct(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=ht(R(n.ib,n),6e3));if(1>=fn(n.i)&&n.oa){try{n.oa()}catch(a){}n.oa=void 0}}else ir(n,11)}else if((e.K||n.g==e)&&tr(n),!j(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){var a=i[t];if(n.V=a[0],a=a[1],2==n.H)if("c"==a[0]){n.K=a[1],n.pa=a[2];var o=a[3];null!=o&&(n.ra=o,n.l.info("VER="+n.ra));var s=a[4];null!=s&&(n.Ga=s,n.l.info("SVER="+n.Ga));var u=a[5];null!=u&&"number"===typeof u&&0<u&&(r=1.5*u,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=e.g;if(c){var l=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(l){var h=r.i;h.g||-1==l.indexOf("spdy")&&-1==l.indexOf("quic")&&-1==l.indexOf("h2")||(h.j=h.l,h.g=new Set,h.h&&(vn(h,h.h),h.h=null))}if(r.F){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.Da=f,Ht(r.I,r.F,f))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms"));var d=e;if((r=n).wa=or(r,r.J?r.pa:null,r.Y),d.K){pn(r.i,d);var v=d,p=r.L;p&&v.setTimeout(p),v.C&&(Dt(v),Rt(v)),r.g=d}else Jn(r);0<n.j.length&&Kn(n)}else"stop"!=a[0]&&"close"!=a[0]||ir(n,7);else 3==n.H&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?ir(n,7):zn(n):"noop"!=a[0]&&n.h&&n.h.Aa(a),n.A=0)}st()}catch(a){}}function Ft(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(C(e)||"string"===typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!==typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!==typeof Set&&e instanceof Set)){if(C(e)||"string"===typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(var r in t=[],n=0,e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!==typeof Map&&e instanceof Map||"undefined"!==typeof Set&&e instanceof Set)return Array.from(e.values());if("string"===typeof e)return e.split("");if(C(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,a=0;a<i;a++)t.call(void 0,r[a],n&&n[a],e)}(r=bt.prototype).setTimeout=function(e){this.P=e},r.nb=function(e){e=e.target;var t=this.M;t&&3==Fn(e)?t.l():this.Pa(e)},r.Pa=function(e){try{if(e==this.g)e:{var t=Fn(this.g),n=this.g.Ia();this.g.da();if(!(3>t)&&(3!=t||Q||this.g&&(this.h.h||this.g.ja()||Un(this.g)))){this.J||4!=t||7==n||st(),Dt(this);var r=this.g.da();this.ca=r;t:if(Nt(this)){var i=Un(this.g);e="";var a=i.length,o=4==Fn(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){Lt(this),Ot(this);var s="";break t}this.h.i=new T.TextDecoder}for(n=0;n<a;n++)this.h.h=!0,e+=this.h.i.decode(i[n],{stream:o&&n==a-1});i.length=0,this.h.g+=e,this.o=0,s=this.h.g}else s=this.g.ja();if(this.i=200==r,function(e,t,n,r,i,a,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+a+" "+o}))}(this.j,this.v,this.B,this.m,this.W,t,r),this.i){if(this.aa&&!this.K){t:{if(this.g){var u,c=this.g;if((u=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(u)){var l=u;break t}}l=null}if(!(r=l)){this.i=!1,this.s=3,ct(12),Lt(this),Ot(this);break e}nt(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Mt(this,r)}this.S?(At(this,t,s),Q&&this.i&&3==t&&($e(this.U,this.V,"tick",this.mb),this.V.start())):(nt(this.j,this.m,s,null),Mt(this,s)),4==t&&Lt(this),this.i&&!this.J&&(4==t?nr(this.l,this):(this.i=!1,Rt(this)))}else(function(e){var t={};e=(e.g&&2<=Fn(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(var n=0;n<e.length;n++)if(!j(e[n])){var r=Ue(e[n]),i=r[0];if("string"===typeof(r=r[1])){r=r.trim();var a=t[i]||[];t[i]=a,a.push(r)}}!function(e,t){for(var n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==r&&0<s.indexOf("Unknown SID")?(this.s=3,ct(12)):(this.s=0,ct(13)),Lt(this),Ot(this)}}}catch(t){}},r.mb=function(){if(this.g){var e=Fn(this.g),t=this.g.ja();this.o<t.length&&(Dt(this),At(this,e,t),this.i&&4!=e&&Rt(this))}},r.cancel=function(){this.J=!0,Lt(this)},r.lb=function(){this.C=null;var e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.B),2!=this.L&&(st(),ct(17)),Lt(this),this.s=2,Ot(this)):Zt(this,this.Y-e)};var Ut=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Vt(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Vt){this.h=e.h,qt(this,e.j),this.s=e.s,this.g=e.g,Bt(this,e.m),this.l=e.l;var t=e.i,n=new tn;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),zt(this,n),this.o=e.o}else e&&(t=String(e).match(Ut))?(this.h=!1,qt(this,t[1]||"",!0),this.s=Kt(t[2]||""),this.g=Kt(t[3]||"",!0),Bt(this,t[4]),this.l=Kt(t[5]||"",!0),zt(this,t[6]||"",!0),this.o=Kt(t[7]||"")):(this.h=!1,this.i=new tn(null,this.h))}function jt(e){return new Vt(e)}function qt(e,t,n){e.j=n?Kt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Bt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function zt(e,t,n){t instanceof tn?(e.i=t,function(e,t){t&&!e.j&&(nn(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(rn(this,t),on(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=Gt(t,$t)),e.i=new tn(t,e.h))}function Ht(e,t,n){e.i.set(t,n)}function Wt(e){return Ht(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Kt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Gt(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,Yt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Yt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Vt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Gt(t,Qt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(Gt(t,Qt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Gt(n,"/"==n.charAt(0)?Xt:Jt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Gt(n,en)),e.join("")};var Qt=/[#\/\?@]/g,Jt=/[#\?:]/g,Xt=/[#\?]/g,$t=/[#\?@]/g,en=/#/g;function tn(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function nn(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var a=e[n].substring(0,r);i=e[n].substring(r+1)}else a=e[n];t(a,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function rn(e,t){nn(e),t=sn(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function an(e,t){return nn(e),t=sn(e,t),e.g.has(t)}function on(e,t,n){rn(e,t),0<n.length&&(e.i=null,e.g.set(sn(e,t),M(n)),e.h+=n.length)}function sn(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(r=tn.prototype).add=function(e,t){nn(this),this.i=null,e=sn(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},r.forEach=function(e,t){nn(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},r.ta=function(){nn(this);for(var e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[],r=0;r<t.length;r++)for(var i=e[r],a=0;a<i.length;a++)n.push(t[r]);return n},r.Z=function(e){nn(this);var t=[];if("string"===typeof e)an(this,e)&&(t=t.concat(this.g.get(sn(this,e))));else{e=Array.from(this.g.values());for(var n=0;n<e.length;n++)t=t.concat(e[n])}return t},r.set=function(e,t){return nn(this),this.i=null,an(this,e=sn(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},r.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=Array.from(this.g.keys()),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r)),a=this.Z(r);for(r=0;r<a.length;r++){var o=i;""!==a[r]&&(o+="="+encodeURIComponent(String(a[r]))),e.push(o)}}return this.i=e.join("&")};var un=(0,p.Z)((function e(t,n){(0,v.Z)(this,e),this.g=t,this.map=n}));function cn(e){this.l=e||ln,T.PerformanceNavigationTiming?e=0<(e=T.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(T.g&&T.g.Ka&&T.g.Ka()&&T.g.Ka().dc),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var ln=10;function hn(e){return!!e.h||!!e.g&&e.g.size>=e.j}function fn(e){return e.h?1:e.g?e.g.size:0}function dn(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function vn(e,t){e.g?e.g.add(t):e.h=t}function pn(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function yn(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){var t,n=e.i,r=(0,c.Z)(e.g.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;n=n.concat(i.F)}}catch(a){r.e(a)}finally{r.f()}return n}return M(e.i)}cn.prototype.cancel=function(){if(this.i=yn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){var e,t=(0,c.Z)(this.g.values());try{for(t.s();!(e=t.n()).done;){e.value.cancel()}}catch(n){t.e(n)}finally{t.f()}this.g.clear()}};var gn,mn=function(){function e(){(0,v.Z)(this,e)}return(0,p.Z)(e,[{key:"stringify",value:function(e){return T.JSON.stringify(e,void 0)}},{key:"parse",value:function(e){return T.JSON.parse(e,void 0)}}]),e}();function _n(){this.g=new mn}function kn(e,t,n){var r=n||"";try{Ft(e,(function(e,n){var i=e;S(e)&&(i=Ze(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function wn(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(a){}}function bn(e){this.l=e.ec||null,this.j=e.ob||!1}function In(e,t){Ae.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=En,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}D(bn,vt),bn.prototype.g=function(){return new In(this.l,this.j)},bn.prototype.i=(gn={},function(){return gn}),D(In,Ae);var En=0;function Tn(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function Cn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Sn(e)}function Sn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(r=In.prototype).open=function(e,t){if(this.readyState!=En)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Sn(this)},r.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||T).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((function(){})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Cn(this)),this.readyState=En},r.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Sn(this)),this.g&&(this.readyState=3,Sn(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if("undefined"!==typeof T.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Tn(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},r.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Cn(this):Sn(this),3==this.readyState&&Tn(this)}},r.Za=function(e){this.g&&(this.response=this.responseText=e,Cn(this))},r.Ya=function(e){this.g&&(this.response=e,Cn(this))},r.ka=function(){this.g&&Cn(this)},r.setRequestHeader=function(e,t){this.v.append(e,t)},r.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(In.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var xn=T.JSON.parse;function Nn(e){Ae.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=An,this.L=this.M=!1}D(Nn,Ae);var An="",Pn=/^https?$/i,Rn=["POST","PUT"];function Zn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Dn(e),Ln(e)}function Dn(e){e.F||(e.F=!0,Pe(e,"complete"),Pe(e,"error"))}function On(e){if(e.h&&"undefined"!=typeof E&&(!e.C[1]||4!=Fn(e)||2!=e.da()))if(e.v&&4==Fn(e))Ge(e.La,0,e);else if(Pe(e,"readystatechange"),4==Fn(e)){e.h=!1;try{var t,n=e.da();e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break e;default:r=!1}if(!(t=r)){var i;if(i=0===n){var a=String(e.I).match(Ut)[1]||null;!a&&T.self&&T.self.location&&(a=T.self.location.protocol.slice(0,-1)),i=!Pn.test(a?a.toLowerCase():"")}t=i}if(t)Pe(e,"complete"),Pe(e,"success");else{e.m=6;try{var o=2<Fn(e)?e.g.statusText:""}catch(s){o=""}e.j=o+" ["+e.da()+"]",Dn(e)}}finally{Ln(e)}}}function Ln(e,t){if(e.g){Mn(e);var n=e.g,r=e.C[0]?function(){}:null;e.g=null,e.C=null,t||Pe(e,"ready");try{n.onreadystatechange=r}catch(i){}}}function Mn(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(T.clearTimeout(e.A),e.A=null)}function Fn(e){return e.g?e.g.readyState:0}function Un(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case An:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(Hr){return null}}function Vn(e){var t="";return he(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function jn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Vn(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):Ht(e,t,n))}function qn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Bn(e){this.Ga=0,this.j=[],this.l=new tt,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=qn("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=qn("baseRetryDelayMs",5e3,e),this.hb=qn("retryDelaySeedMs",1e4,e),this.eb=qn("forwardChannelMaxRetries",2,e),this.xa=qn("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new cn(e&&e.concurrentRequestLimit),this.Ja=new _n,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function zn(e){if(Wn(e),3==e.H){var t=e.W++,n=jt(e.I);if(Ht(n,"SID",e.K),Ht(n,"RID",t),Ht(n,"TYPE","terminate"),Yn(e,n),(t=new bt(e,e.l,t)).L=2,t.A=Wt(jt(n)),n=!1,T.navigator&&T.navigator.sendBeacon)try{n=T.navigator.sendBeacon(t.A.toString(),"")}catch(r){}!n&&T.Image&&((new Image).src=t.A,n=!0),n||(t.g=sr(t.l,null),t.g.ha(t.A)),t.G=Date.now(),Rt(t)}ar(e)}function Hn(e){e.g&&($n(e),e.g.cancel(),e.g=null)}function Wn(e){Hn(e),e.u&&(T.clearTimeout(e.u),e.u=null),tr(e),e.i.cancel(),e.m&&("number"===typeof e.m&&T.clearTimeout(e.m),e.m=null)}function Kn(e){if(!hn(e.i)&&!e.m){e.m=!0;var t=e.Na;je||ze(),qe||(je(),qe=!0),Be.add(t,e),e.C=0}}function Gn(e,t){var n;n=t?t.m:e.W++;var r=jt(e.I);Ht(r,"SID",e.K),Ht(r,"RID",n),Ht(r,"AID",e.V),Yn(e,r),e.o&&e.s&&jn(r,e.o,e.s),n=new bt(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=Qn(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),vn(e.i,n),St(n,r,t)}function Yn(e,t){e.na&&he(e.na,(function(e,n){Ht(t,n,e)})),e.h&&Ft({},(function(e,n){Ht(t,n,e)}))}function Qn(e,t,n){n=Math.min(e.j.length,n);var r=e.h?R(e.h.Va,e.h,e):null;e:for(var i=e.j,a=-1;;){var o=["count="+n];-1==a?0<n?(a=i[0].g,o.push("ofs="+a)):a=0:o.push("ofs="+a);for(var s=!0,u=0;u<n;u++){var c=i[u].g,l=i[u].map;if(0>(c-=a))a=Math.max(0,i[u].g-100),s=!1;else try{kn(l,o,"req"+c+"_")}catch(h){r&&r(l)}}if(s){r=o.join("&");break e}}return e=e.j.splice(0,n),t.F=e,r}function Jn(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;je||ze(),qe||(je(),qe=!0),Be.add(t,e),e.A=0}}function Xn(e){return!(e.g||e.u||3<=e.A)&&(e.ba++,e.u=ht(R(e.Ma,e),rr(e,e.A)),e.A++,!0)}function $n(e){null!=e.B&&(T.clearTimeout(e.B),e.B=null)}function er(e){e.g=new bt(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=jt(e.wa);Ht(t,"RID","rpc"),Ht(t,"SID",e.K),Ht(t,"AID",e.V),Ht(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&Ht(t,"TO",e.qa),Ht(t,"TYPE","xmlhttp"),Yn(e,t),e.o&&e.s&&jn(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.A=Wt(jt(t)),n.u=null,n.S=!0,xt(n,e)}function tr(e){null!=e.v&&(T.clearTimeout(e.v),e.v=null)}function nr(e,t){var n=null;if(e.g==t){tr(e),$n(e),e.g=null;var r=2}else{if(!dn(e.i,t))return;n=t.F,pn(e.i,t),r=1}if(0!=e.H)if(t.i)if(1==r){n=t.u?t.u.length:0,t=Date.now()-t.G;var i=e.C;Pe(r=at(),new lt(r,n)),Kn(e)}else Jn(e);else if(3==(i=t.s)||0==i&&0<t.ca||!(1==r&&function(e,t){return!(fn(e.i)>=e.i.j-(e.m?1:0))&&(e.m?(e.j=t.F.concat(e.j),!0):!(1==e.H||2==e.H||e.C>=(e.cb?0:e.eb))&&(e.m=ht(R(e.Na,e,t),rr(e,e.C)),e.C++,!0))}(e,t)||2==r&&Xn(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:ir(e,5);break;case 4:ir(e,10);break;case 3:ir(e,6);break;default:ir(e,2)}}function rr(e,t){var n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function ir(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=R(e.pb,e);n||(n=new Vt("//www.google.com/images/cleardot.gif"),T.location&&"http"==T.location.protocol||qt(n,"https"),Wt(n)),function(e,t){var n=new tt;if(T.Image){var r=new Image;r.onload=Z(wn,n,r,"TestLoadImage: loaded",!0,t),r.onerror=Z(wn,n,r,"TestLoadImage: error",!1,t),r.onabort=Z(wn,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=Z(wn,n,r,"TestLoadImage: timeout",!1,t),T.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else ct(2);e.H=0,e.h&&e.h.za(t),ar(e),Wn(e)}function ar(e){if(e.H=0,e.ma=[],e.h){var t=yn(e.i);0==t.length&&0==e.j.length||(F(e.ma,t),F(e.ma,e.j),e.i.i.length=0,M(e.j),e.j.length=0),e.h.ya()}}function or(e,t,n){var r=n instanceof Vt?jt(n):new Vt(n);if(""!=r.g)t&&(r.g=t+"."+r.g),Bt(r,r.m);else{var i=T.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var a=new Vt(null);r&&qt(a,r),t&&(a.g=t),i&&Bt(a,i),n&&(a.l=n),r=a}return n=e.F,t=e.Da,n&&t&&Ht(r,n,t),Ht(r,"VER",e.ra),Yn(e,r),r}function sr(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ha&&!e.va?new Nn(new bn({ob:n})):new Nn(e.va)).Oa(e.J),t}function ur(){}function cr(){if(G&&!(10<=Number(ie)))throw Error("Environmental error: no available transport.")}function lr(e,t){Ae.call(this),this.g=new Bn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!j(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!j(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new dr(this)}function hr(e){_t.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(var n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function fr(){kt.call(this),this.status=1}function dr(e){this.g=e}function vr(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function pr(e,t,n){n||(n=0);var r=Array(16);if("string"===typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var a=e.g[3],o=t+(a^n&(i^a))+r[0]+3614090360&4294967295;o=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=(n=(i=(a=(t=n+(o<<7&4294967295|o>>>25))+((o=a+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^a&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(a^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(a^n&(i^a))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=a+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^a&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(a^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(a^n&(i^a))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=a+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^a&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(a^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(a^n&(i^a))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=a+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^a&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(a^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^a&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=a+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(a^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(a^t&(i^a))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^a&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=a+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(a^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(a^t&(i^a))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^a&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=a+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(a^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(a^t&(i^a))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^a&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=a+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(a^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(a^t&(i^a))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^a)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=a+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(a^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^a^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^a)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=a+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(a^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^a^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^a)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=a+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(a^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^a^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^a)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=a+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(a^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^a^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~a))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=a+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(a|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(a^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~a))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=a+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(a|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(a^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~a))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=a+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(a|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(a^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((a=(t=n+((o=t+(i^(n|~a))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=a+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=a+((o=i+(t^(a|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+a&4294967295}function yr(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var a=0|e[i];r&&a==t||(n[i]=a,r=!1)}this.g=n}(r=Nn.prototype).Oa=function(e){this.M=e},r.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():gt.g(),this.C=this.u?pt(this.u):pt(gt),this.g.onreadystatechange=R(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(u){return void Zn(this,u)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));var a,o=(0,c.Z)(r.keys());try{for(o.s();!(a=o.n()).done;){var u=a.value;n.set(u,r.get(u))}}catch(p){o.e(p)}finally{o.f()}}r=Array.from(n.keys()).find((function(e){return"content-type"==e.toLowerCase()})),i=T.FormData&&e instanceof T.FormData,!(0<=L(Rn,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");var l,h=(0,c.Z)(n);try{for(h.s();!(l=h.n()).done;){var f=(0,s.Z)(l.value,2),d=f[0],v=f[1];this.g.setRequestHeader(d,v)}}catch(p){h.e(p)}finally{h.f()}this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Mn(this),0<this.B&&((this.L=function(e){return G&&"number"===typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=R(this.ua,this)):this.A=Ge(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(u){Zn(this,u)}},r.ua=function(){"undefined"!=typeof E&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Pe(this,"timeout"),this.abort(8))},r.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Pe(this,"complete"),Pe(this,"abort"),Ln(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ln(this,!0)),Nn.$.N.call(this)},r.La=function(){this.s||(this.G||this.v||this.l?On(this):this.kb())},r.kb=function(){On(this)},r.isActive=function(){return!!this.g},r.da=function(){try{return 2<Fn(this)?this.g.status:-1}catch(gn){return-1}},r.ja=function(){try{return this.g?this.g.responseText:""}catch(gn){return""}},r.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),xn(t)}},r.Ia=function(){return this.m},r.Sa=function(){return"string"===typeof this.j?this.j:String(this.j)},(r=Bn.prototype).ra=8,r.H=1,r.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;var t=new bt(this,this.l,e),n=this.s;if(this.U&&(n?ve(n=fe(n),this.U):n=this.U),null!==this.o||this.O||(t.I=n,n=null),this.P)e:{for(var r=0,i=0;i<this.j.length;i++){var a=this.j[i];if(void 0===(a="__data__"in a.map&&"string"===typeof(a=a.map.__data__)?a.length:void 0))break;if(4096<(r+=a)){r=i;break e}if(4096===r||i===this.j.length-1){r=i+1;break e}}r=1e3}else r=1e3;r=Qn(this,t,r),Ht(i=jt(this.I),"RID",e),Ht(i,"CVER",22),this.F&&Ht(i,"X-HTTP-Session-Id",this.F),Yn(this,i),n&&(this.O?r="headers="+encodeURIComponent(String(Vn(n)))+"&"+r:this.o&&jn(i,this.o,n)),vn(this.i,t),this.bb&&Ht(i,"TYPE","init"),this.P?(Ht(i,"$req",r),Ht(i,"SID","null"),t.aa=!0,St(t,i,null)):St(t,i,r),this.H=2}}else 3==this.H&&(e?Gn(this,e):0==this.j.length||hn(this.i)||Gn(this))},r.Ma=function(){if(this.u=null,er(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=ht(R(this.jb,this),e)}},r.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,ct(10),Hn(this),er(this))},r.ib=function(){null!=this.v&&(this.v=null,Hn(this),Xn(this),ct(19))},r.pb=function(e){e?(this.l.info("Successfully pinged google.com"),ct(2)):(this.l.info("Failed to ping google.com"),ct(1))},r.isActive=function(){return!!this.h&&this.h.isActive(this)},(r=ur.prototype).Ba=function(){},r.Aa=function(){},r.za=function(){},r.ya=function(){},r.isActive=function(){return!0},r.Va=function(){},cr.prototype.g=function(e,t){return new lr(e,t)},D(lr,Ae),lr.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;ct(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=or(e,null,e.Y),Kn(e)},lr.prototype.close=function(){zn(this.g)},lr.prototype.u=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=Ze(e),e=n);t.j.push(new un(t.fb++,e)),3==t.H&&Kn(t)},lr.prototype.N=function(){this.g.h=null,delete this.j,zn(this.g),delete this.g,lr.$.N.call(this)},D(hr,_t),D(fr,kt),D(dr,ur),dr.prototype.Ba=function(){Pe(this.g,"a")},dr.prototype.Aa=function(e){Pe(this.g,new hr(e))},dr.prototype.za=function(e){Pe(this.g,new fr)},dr.prototype.ya=function(){Pe(this.g,"b")},D(vr,(function(){this.blockSize=-1})),vr.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},vr.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,a=0;a<t;){if(0==i)for(;a<=n;)pr(this,e,a),a+=this.blockSize;if("string"===typeof e){for(;a<t;)if(r[i++]=e.charCodeAt(a++),i==this.blockSize){pr(this,r),i=0;break}}else for(;a<t;)if(r[i++]=e[a++],i==this.blockSize){pr(this,r),i=0;break}}this.h=i,this.i+=t},vr.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var gr={};function mr(e){return-128<=e&&128>e?function(e,t){var n=gr;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,(function(e){return new yr([0|e],0>e?-1:0)})):new yr([0|e],0>e?-1:0)}function _r(e){if(isNaN(e)||!isFinite(e))return wr;if(0>e)return Cr(_r(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=kr;return new yr(t,0)}var kr=4294967296,wr=mr(0),br=mr(1),Ir=mr(16777216);function Er(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function Tr(e){return-1==e.h}function Cr(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new yr(n,~e.h).add(br)}function Sr(e,t){return e.add(Cr(t))}function xr(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function Nr(e,t){this.g=e,this.h=t}function Ar(e,t){if(Er(t))throw Error("division by zero");if(Er(e))return new Nr(wr,wr);if(Tr(e))return t=Ar(Cr(e),t),new Nr(Cr(t.g),Cr(t.h));if(Tr(t))return t=Ar(e,Cr(t)),new Nr(Cr(t.g),t.h);if(30<e.g.length){if(Tr(e)||Tr(t))throw Error("slowDivide_ only works with positive integers.");for(var n=br,r=t;0>=r.X(e);)n=Pr(n),r=Pr(r);var i=Rr(n,1),a=Rr(r,1);for(r=Rr(r,2),n=Rr(n,2);!Er(r);){var o=a.add(r);0>=o.X(e)&&(i=i.add(n),a=o),r=Rr(r,1),n=Rr(n,1)}return t=Sr(e,i.R(t)),new Nr(i,t)}for(i=wr;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(a=_r(n)).R(t);Tr(o)||0<o.X(e);)o=(a=_r(n-=r)).R(t);Er(a)&&(a=br),i=i.add(a),e=Sr(e,o)}return new Nr(i,e)}function Pr(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new yr(n,e.h)}function Rr(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],a=0;a<r;a++)i[a]=0<t?e.D(a+n)>>>t|e.D(a+n+1)<<32-t:e.D(a+n);return new yr(i,e.h)}(r=yr.prototype).ea=function(){if(Tr(this))return-Cr(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:kr+r)*t,t*=kr}return e},r.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(Er(this))return"0";if(Tr(this))return"-"+Cr(this).toString(e);for(var t=_r(Math.pow(e,6)),n=this,r="";;){var i=Ar(n,t).g,a=((0<(n=Sr(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(Er(n=i))return a+r;for(;6>a.length;)a="0"+a;r=a+r}},r.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},r.X=function(e){return Tr(e=Sr(this,e))?-1:Er(e)?0:1},r.abs=function(){return Tr(this)?Cr(this):this},r.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var a=r+(65535&this.D(i))+(65535&e.D(i)),o=(a>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=o>>>16,a&=65535,o&=65535,n[i]=o<<16|a}return new yr(n,-2147483648&n[n.length-1]?-1:0)},r.R=function(e){if(Er(this)||Er(e))return wr;if(Tr(this))return Tr(e)?Cr(this).R(Cr(e)):Cr(Cr(this).R(e));if(Tr(e))return Cr(this.R(Cr(e)));if(0>this.X(Ir)&&0>e.X(Ir))return _r(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var a=this.D(r)>>>16,o=65535&this.D(r),s=e.D(i)>>>16,u=65535&e.D(i);n[2*r+2*i]+=o*u,xr(n,2*r+2*i),n[2*r+2*i+1]+=a*u,xr(n,2*r+2*i+1),n[2*r+2*i+1]+=o*s,xr(n,2*r+2*i+1),n[2*r+2*i+2]+=a*s,xr(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new yr(n,0)},r.gb=function(e){return Ar(this,e).h},r.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new yr(n,this.h&e.h)},r.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new yr(n,this.h|e.h)},r.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new yr(n,this.h^e.h)},cr.prototype.createWebChannel=cr.prototype.g,lr.prototype.send=lr.prototype.u,lr.prototype.open=lr.prototype.m,lr.prototype.close=lr.prototype.close,ft.NO_ERROR=0,ft.TIMEOUT=8,ft.HTTP_ERROR=6,dt.COMPLETE="complete",yt.EventType=mt,mt.OPEN="a",mt.CLOSE="b",mt.ERROR="c",mt.MESSAGE="d",Ae.prototype.listen=Ae.prototype.O,Nn.prototype.listenOnce=Nn.prototype.P,Nn.prototype.getLastError=Nn.prototype.Sa,Nn.prototype.getLastErrorCode=Nn.prototype.Ia,Nn.prototype.getStatus=Nn.prototype.da,Nn.prototype.getResponseJson=Nn.prototype.Wa,Nn.prototype.getResponseText=Nn.prototype.ja,Nn.prototype.send=Nn.prototype.ha,Nn.prototype.setWithCredentials=Nn.prototype.Oa,vr.prototype.digest=vr.prototype.l,vr.prototype.reset=vr.prototype.reset,vr.prototype.update=vr.prototype.j,yr.prototype.add=yr.prototype.add,yr.prototype.multiply=yr.prototype.R,yr.prototype.modulo=yr.prototype.gb,yr.prototype.compare=yr.prototype.X,yr.prototype.toNumber=yr.prototype.ea,yr.prototype.toString=yr.prototype.toString,yr.prototype.getBits=yr.prototype.D,yr.fromNumber=_r,yr.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return Cr(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=_r(Math.pow(n,8)),i=wr,a=0;a<t.length;a+=8){var o=Math.min(8,t.length-a),s=parseInt(t.substring(a,a+o),n);8>o?(o=_r(Math.pow(n,o)),i=i.R(o).add(_r(s))):i=(i=i.R(r)).add(_r(s))}return i};var Zr=I.createWebChannelTransport=function(){return new cr},Dr=I.getStatEventTarget=function(){return at()},Or=I.ErrorCode=ft,Lr=I.EventType=dt,Mr=I.Event=rt,Fr=I.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Ur=(I.FetchXmlHttpFactory=bn,I.WebChannel=yt),Vr=I.XhrIo=Nn,jr=(I.Md5=vr,I.Integer=yr),qr="@firebase/firestore",Br=function(){function e(t){(0,v.Z)(this,e),this.uid=t}return(0,p.Z)(e,[{key:"isAuthenticated",value:function(){return null!=this.uid}},{key:"toKey",value:function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}},{key:"isEqual",value:function(e){return e.uid===this.uid}}]),e}();Br.UNAUTHENTICATED=new Br(null),Br.GOOGLE_CREDENTIALS=new Br("google-credentials-uid"),Br.FIRST_PARTY=new Br("first-party-uid"),Br.MOCK_USER=new Br("mock-user");var zr="10.8.1",Hr=new k.Yd("@firebase/firestore");function Wr(){return Hr.logLevel}function Kr(e){if(Hr.logLevel<=k.in.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(Qr);Hr.debug.apply(Hr,["Firestore (".concat(zr,"): ").concat(e)].concat((0,d.Z)(i)))}}function Gr(e){if(Hr.logLevel<=k.in.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(Qr);Hr.error.apply(Hr,["Firestore (".concat(zr,"): ").concat(e)].concat((0,d.Z)(i)))}}function Yr(e){if(Hr.logLevel<=k.in.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(Qr);Hr.warn.apply(Hr,["Firestore (".concat(zr,"): ").concat(e)].concat((0,d.Z)(i)))}}function Qr(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function Jr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state",t="FIRESTORE (".concat(zr,") INTERNAL ASSERTION FAILED: ")+e;throw Gr(t),new Error(t)}function Xr(e,t){e||Jr()}function $r(e,t){return e}var ei={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},ti=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this,e,r)).code=e,i.message=r,i.toString=function(){return"".concat(i.name,": [code=").concat(i.code,"]: ").concat(i.message)},i}return(0,p.Z)(n)}(w.ZR),ni=(0,p.Z)((function e(){var t=this;(0,v.Z)(this,e),this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))})),ri=(0,p.Z)((function e(t,n){(0,v.Z)(this,e),this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(t))})),ii=function(){function e(){(0,v.Z)(this,e)}return(0,p.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(null)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(Br.UNAUTHENTICATED)}))}},{key:"shutdown",value:function(){}}]),e}(),ai=function(){function e(t){(0,v.Z)(this,e),this.token=t,this.changeListener=null}return(0,p.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(this.token)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){var n=this;this.changeListener=t,e.enqueueRetryable((function(){return t(n.token.user)}))}},{key:"shutdown",value:function(){this.changeListener=null}}]),e}(),oi=function(){function e(t){(0,v.Z)(this,e),this.t=t,this.currentUser=Br.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}return(0,p.Z)(e,[{key:"start",value:function(e,t){var n=this,r=this.i,i=function(e){return n.i!==r?(r=n.i,t(e)):Promise.resolve()},a=new ni;this.o=function(){n.i++,n.currentUser=n.u(),a.resolve(),a=new ni,e.enqueueRetryable((function(){return i(n.currentUser)}))};var o=function(){var t=a;e.enqueueRetryable((0,l.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.promise;case 2:return e.next=4,i(n.currentUser);case 4:case"end":return e.stop()}}),e)}))))},s=function(e){Kr("FirebaseAuthCredentialsProvider","Auth detected"),n.auth=e,n.auth.addAuthTokenListener(n.o),o()};this.t.onInit((function(e){return s(e)})),setTimeout((function(){if(!n.auth){var e=n.t.getImmediate({optional:!0});e?s(e):(Kr("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new ni)}}),0),o()}},{key:"getToken",value:function(){var e=this,t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return e.i!==t?(Kr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),e.getToken()):n?(Xr("string"==typeof n.accessToken),new ri(n.accessToken,e.currentUser)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.auth&&this.auth.removeAuthTokenListener(this.o)}},{key:"u",value:function(){var e=this.auth&&this.auth.getUid();return Xr(null===e||"string"==typeof e),new Br(e)}}]),e}(),si=function(){function e(t,n,r){(0,v.Z)(this,e),this.l=t,this.h=n,this.P=r,this.type="FirstParty",this.user=Br.FIRST_PARTY,this.I=new Map}return(0,p.Z)(e,[{key:"T",value:function(){return this.P?this.P():null}},{key:"headers",get:function(){this.I.set("X-Goog-AuthUser",this.l);var e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}]),e}(),ui=function(){function e(t,n,r){(0,v.Z)(this,e),this.l=t,this.h=n,this.P=r}return(0,p.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(new si(this.l,this.h,this.P))}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(Br.FIRST_PARTY)}))}},{key:"shutdown",value:function(){}},{key:"invalidateToken",value:function(){}}]),e}(),ci=(0,p.Z)((function e(t){(0,v.Z)(this,e),this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)})),li=function(){function e(t){(0,v.Z)(this,e),this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}return(0,p.Z)(e,[{key:"start",value:function(e,t){var n=this,r=function(e){null!=e.error&&Kr("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));var r=e.token!==n.R;return n.R=e.token,Kr("FirebaseAppCheckTokenProvider","Received ".concat(r?"new":"existing"," token.")),r?t(e.token):Promise.resolve()};this.o=function(t){e.enqueueRetryable((function(){return r(t)}))};var i=function(e){Kr("FirebaseAppCheckTokenProvider","AppCheck detected"),n.appCheck=e,n.appCheck.addTokenListener(n.o)};this.A.onInit((function(e){return i(e)})),setTimeout((function(){if(!n.appCheck){var e=n.A.getImmediate({optional:!0});e?i(e):Kr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}},{key:"getToken",value:function(){var e=this,t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((function(t){return t?(Xr("string"==typeof t.token),e.R=t.token,new ci(t.token)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}]),e}();function hi(e){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}var fi=function(){function e(){(0,v.Z)(this,e)}return(0,p.Z)(e,null,[{key:"newId",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";n.length<20;)for(var r=hi(40),i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length));return n}}]),e}();function di(e,t){return e<t?-1:e>t?1:0}function vi(e,t,n){return e.length===t.length&&e.every((function(e,r){return n(e,t[r])}))}var pi=function(){function e(t,n){if((0,v.Z)(this,e),this.seconds=t,this.nanoseconds=n,n<0)throw new ti(ei.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new ti(ei.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new ti(ei.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new ti(ei.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return(0,p.Z)(e,[{key:"toDate",value:function(){return new Date(this.toMillis())}},{key:"toMillis",value:function(){return 1e3*this.seconds+this.nanoseconds/1e6}},{key:"_compareTo",value:function(e){return this.seconds===e.seconds?di(this.nanoseconds,e.nanoseconds):di(this.seconds,e.seconds)}},{key:"isEqual",value:function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}},{key:"toString",value:function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}},{key:"toJSON",value:function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}},{key:"valueOf",value:function(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}],[{key:"now",value:function(){return e.fromMillis(Date.now())}},{key:"fromDate",value:function(t){return e.fromMillis(t.getTime())}},{key:"fromMillis",value:function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))}}]),e}(),yi=function(){function e(t){(0,v.Z)(this,e),this.timestamp=t}return(0,p.Z)(e,[{key:"compareTo",value:function(e){return this.timestamp._compareTo(e.timestamp)}},{key:"isEqual",value:function(e){return this.timestamp.isEqual(e.timestamp)}},{key:"toMicroseconds",value:function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}},{key:"toString",value:function(){return"SnapshotVersion("+this.timestamp.toString()+")"}},{key:"toTimestamp",value:function(){return this.timestamp}}],[{key:"fromTimestamp",value:function(t){return new e(t)}},{key:"min",value:function(){return new e(new pi(0,0))}},{key:"max",value:function(){return new e(new pi(253402300799,999999999))}}]),e}(),gi=function(){function e(t,n,r){(0,v.Z)(this,e),void 0===n?n=0:n>t.length&&Jr(),void 0===r?r=t.length-n:r>t.length-n&&Jr(),this.segments=t,this.offset=n,this.len=r}return(0,p.Z)(e,[{key:"length",get:function(){return this.len}},{key:"isEqual",value:function(t){return 0===e.comparator(this,t)}},{key:"child",value:function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach((function(e){n.push(e)})):n.push(t),this.construct(n)}},{key:"limit",value:function(){return this.offset+this.length}},{key:"popFirst",value:function(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}},{key:"popLast",value:function(){return this.construct(this.segments,this.offset,this.length-1)}},{key:"firstSegment",value:function(){return this.segments[this.offset]}},{key:"lastSegment",value:function(){return this.get(this.length-1)}},{key:"get",value:function(e){return this.segments[this.offset+e]}},{key:"isEmpty",value:function(){return 0===this.length}},{key:"isPrefixOf",value:function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"isImmediateParentOf",value:function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"forEach",value:function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}},{key:"toArray",value:function(){return this.segments.slice(this.offset,this.limit())}}],[{key:"comparator",value:function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e.get(r),a=t.get(r);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}]),e}(),mi=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,p.Z)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().join("/")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"toUriEncodedString",value:function(){return this.toArray().map(encodeURIComponent).join("/")}}],[{key:"fromString",value:function(){for(var e=[],t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var a=0,o=r;a<o.length;a++){var s=o[a];if(s.indexOf("//")>=0)throw new ti(ei.INVALID_ARGUMENT,"Invalid segment (".concat(s,"). Paths must not contain // in them."));e.push.apply(e,(0,d.Z)(s.split("/").filter((function(e){return e.length>0}))))}return new n(e)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(gi),_i=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ki=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,p.Z)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().map((function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e})).join(".")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"isKeyField",value:function(){return 1===this.length&&"__name__"===this.get(0)}}],[{key:"isValidIdentifier",value:function(e){return _i.test(e)}},{key:"keyField",value:function(){return new n(["__name__"])}},{key:"fromServerFormat",value:function(e){for(var t=[],r="",i=0,a=function(){if(0===r.length)throw new ti(ei.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(r),r=""},o=!1;i<e.length;){var s=e[i];if("\\"===s){if(i+1===e.length)throw new ti(ei.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var u=e[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new ti(ei.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else"`"===s?(o=!o,i++):"."!==s||o?(r+=s,i++):(a(),i++)}if(a(),o)throw new ti(ei.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(gi),wi=function(){function e(t){(0,v.Z)(this,e),this.path=t}return(0,p.Z)(e,[{key:"collectionGroup",get:function(){return this.path.popLast().lastSegment()}},{key:"hasCollectionId",value:function(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}},{key:"getCollectionGroup",value:function(){return this.path.get(this.path.length-2)}},{key:"getCollectionPath",value:function(){return this.path.popLast()}},{key:"isEqual",value:function(e){return null!==e&&0===mi.comparator(this.path,e.path)}},{key:"toString",value:function(){return this.path.toString()}}],[{key:"fromPath",value:function(t){return new e(mi.fromString(t))}},{key:"fromName",value:function(t){return new e(mi.fromString(t).popFirst(5))}},{key:"empty",value:function(){return new e(mi.emptyPath())}},{key:"comparator",value:function(e,t){return mi.comparator(e.path,t.path)}},{key:"isDocumentKey",value:function(e){return e.length%2==0}},{key:"fromSegments",value:function(t){return new e(new mi(t.slice()))}}]),e}(),bi=(0,p.Z)((function e(t,n,r,i){(0,v.Z)(this,e),this.indexId=t,this.collectionGroup=n,this.fields=r,this.indexState=i}));bi.UNKNOWN_ID=-1;function Ii(e,t){var n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=yi.fromTimestamp(1e9===r?new pi(n+1,0):new pi(n,r));return new Ti(i,wi.empty(),t)}function Ei(e){return new Ti(e.readTime,e.key,-1)}var Ti=function(){function e(t,n,r){(0,v.Z)(this,e),this.readTime=t,this.documentKey=n,this.largestBatchId=r}return(0,p.Z)(e,null,[{key:"min",value:function(){return new e(yi.min(),wi.empty(),-1)}},{key:"max",value:function(){return new e(yi.max(),wi.empty(),-1)}}]),e}();function Ci(e,t){var n=e.readTime.compareTo(t.readTime);return 0!==n?n:0!==(n=wi.comparator(e.documentKey,t.documentKey))?n:di(e.largestBatchId,t.largestBatchId)}var Si="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",xi=function(){function e(){(0,v.Z)(this,e),this.onCommittedListeners=[]}return(0,p.Z)(e,[{key:"addOnCommittedListener",value:function(e){this.onCommittedListeners.push(e)}},{key:"raiseOnCommittedEvent",value:function(){this.onCommittedListeners.forEach((function(e){return e()}))}}]),e}();function Ni(e){return Ai.apply(this,arguments)}function Ai(){return(Ai=(0,l.Z)(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.code===ei.FAILED_PRECONDITION&&t.message===Si){e.next=2;break}throw t;case 2:Kr("LocalStore","Unexpectedly lost primary lease");case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Pi=function(){function e(t){var n=this;(0,v.Z)(this,e),this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(e){n.isDone=!0,n.result=e,n.nextCallback&&n.nextCallback(e)}),(function(e){n.isDone=!0,n.error=e,n.catchCallback&&n.catchCallback(e)}))}return(0,p.Z)(e,[{key:"catch",value:function(e){return this.next(void 0,e)}},{key:"next",value:function(t,n){var r=this;return this.callbackAttached&&Jr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e((function(e,i){r.nextCallback=function(n){r.wrapSuccess(t,n).next(e,i)},r.catchCallback=function(t){r.wrapFailure(n,t).next(e,i)}}))}},{key:"toPromise",value:function(){var e=this;return new Promise((function(t,n){e.next(t,n)}))}},{key:"wrapUserFunction",value:function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(t){return e.reject(t)}}},{key:"wrapSuccess",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.resolve(n)}},{key:"wrapFailure",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.reject(n)}}],[{key:"resolve",value:function(t){return new e((function(e,n){e(t)}))}},{key:"reject",value:function(t){return new e((function(e,n){n(t)}))}},{key:"waitFor",value:function(t){return new e((function(e,n){var r=0,i=0,a=!1;t.forEach((function(t){++r,t.next((function(){++i,a&&i===r&&e()}),(function(e){return n(e)}))})),a=!0,i===r&&e()}))}},{key:"or",value:function(t){var n,r=e.resolve(!1),i=(0,c.Z)(t);try{var a=function(){var t=n.value;r=r.next((function(n){return n?e.resolve(n):t()}))};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}return r}},{key:"forEach",value:function(e,t){var n=this,r=[];return e.forEach((function(e,i){r.push(t.call(n,e,i))})),this.waitFor(r)}},{key:"mapArray",value:function(t,n){return new e((function(e,r){for(var i=t.length,a=new Array(i),o=0,s=function(s){var u=s;n(t[u]).next((function(t){a[u]=t,++o===i&&e(a)}),(function(e){return r(e)}))},u=0;u<i;u++)s(u)}))}},{key:"doWhile",value:function(t,n){return new e((function(e,r){!function i(){!0===t()?n().next((function(){i()}),r):e()}()}))}}]),e}(),Ri=function(){function e(t,n){var r=this;(0,v.Z)(this,e),this.action=t,this.transaction=n,this.aborted=!1,this.V=new ni,this.transaction.oncomplete=function(){r.V.resolve()},this.transaction.onabort=function(){n.error?r.V.reject(new Oi(t,n.error)):r.V.resolve()},this.transaction.onerror=function(e){var n=Vi(e.target.error);r.V.reject(new Oi(t,n))}}return(0,p.Z)(e,[{key:"m",get:function(){return this.V.promise}},{key:"abort",value:function(e){e&&this.V.reject(e),this.aborted||(Kr("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}},{key:"g",value:function(){var e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}},{key:"store",value:function(e){var t=this.transaction.objectStore(e);return new Mi(t)}}],[{key:"open",value:function(t,n,r,i){try{return new e(n,t.transaction(i,r))}catch(t){throw new Oi(n,t)}}}]),e}(),Zi=function(){function e(t,n,r){(0,v.Z)(this,e),this.name=t,this.version=n,this.p=r,12.2===e.S((0,w.z$)())&&Gr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return(0,p.Z)(e,[{key:"O",value:function(){var e=(0,l.Z)(g().mark((function e(t){var n=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.db,e.t0){e.next=6;break}return Kr("SimpleDb","Opening database:",this.name),e.next=5,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new Oi(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new ti(ei.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new ti(ei.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new Oi(t,n))},i.onupgradeneeded=function(e){Kr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;n.p.N(t,i.transaction,e.oldVersion,n.version).next((function(){Kr("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}));case 5:this.db=e.sent;case 6:return this.B&&(this.db.onversionchange=function(e){return n.B(e)}),e.abrupt("return",this.db);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"L",value:function(e){this.B=e,this.db&&(this.db.onversionchange=function(t){return e(t)})}},{key:"runTransaction",value:function(){var e=(0,l.Z)(g().mark((function e(t,n,r,i){var a,o,s,u,c,l=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a="readonly"===n,o=0;case 2:return++o,e.prev=3,e.delegateYield(g().mark((function e(){var n,o;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.O(t);case 2:return l.db=e.sent,n=Ri.open(l.db,t,a?"readonly":"readwrite",r),o=i(n).next((function(e){return n.g(),e})).catch((function(e){return n.abort(e),Pi.reject(e)})).toPromise(),o.catch((function(){})),e.next=7,n.m;case 7:return e.t0=o,e.abrupt("return",{v:e.t0});case 9:case"end":return e.stop()}}),e)}))(),"t0",5);case 5:if("object"!==typeof(s=e.t0)){e.next=8;break}return e.abrupt("return",s.v);case 8:e.next=15;break;case 10:if(e.prev=10,e.t1=e.catch(3),u=e.t1,c="FirebaseError"!==u.name&&o<3,Kr("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),c){e.next=15;break}return e.abrupt("return",Promise.reject(u));case 15:e.next=2;break;case 17:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"close",value:function(){this.db&&this.db.close(),this.db=void 0}}],[{key:"delete",value:function(e){return Kr("SimpleDb","Removing database:",e),Fi(window.indexedDB.deleteDatabase(e)).toPromise()}},{key:"D",value:function(){if(!(0,w.hl)())return!1;if(e.C())return!0;var t=(0,w.z$)(),n=e.S(t),r=0<n&&n<10,i=e.v(t),a=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||a)}},{key:"C",value:function(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.F)}},{key:"M",value:function(e,t){return e.store(t)}},{key:"S",value:function(e){var t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}},{key:"v",value:function(e){var t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}}]),e}(),Di=function(){function e(t){(0,v.Z)(this,e),this.k=t,this.q=!1,this.K=null}return(0,p.Z)(e,[{key:"isDone",get:function(){return this.q}},{key:"$",get:function(){return this.K}},{key:"cursor",set:function(e){this.k=e}},{key:"done",value:function(){this.q=!0}},{key:"U",value:function(e){this.K=e}},{key:"delete",value:function(){return Fi(this.k.delete())}}]),e}(),Oi=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this,ei.UNAVAILABLE,"IndexedDB transaction '".concat(e,"' failed: ").concat(r))).name="IndexedDbTransactionError",i}return(0,p.Z)(n)}(ti);function Li(e){return"IndexedDbTransactionError"===e.name}var Mi=function(){function e(t){(0,v.Z)(this,e),this.store=t}return(0,p.Z)(e,[{key:"put",value:function(e,t){var n;return void 0!==t?(Kr("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(Kr("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Fi(n)}},{key:"add",value:function(e){return Kr("SimpleDb","ADD",this.store.name,e,e),Fi(this.store.add(e))}},{key:"get",value:function(e){var t=this;return Fi(this.store.get(e)).next((function(n){return void 0===n&&(n=null),Kr("SimpleDb","GET",t.store.name,e,n),n}))}},{key:"delete",value:function(e){return Kr("SimpleDb","DELETE",this.store.name,e),Fi(this.store.delete(e))}},{key:"count",value:function(){return Kr("SimpleDb","COUNT",this.store.name),Fi(this.store.count())}},{key:"W",value:function(e,t){var n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){var i=r.getAll(n.range);return new Pi((function(e,t){i.onerror=function(e){t(e.target.error)},i.onsuccess=function(t){e(t.target.result)}}))}var a=this.cursor(n),o=[];return this.G(a,(function(e,t){o.push(t)})).next((function(){return o}))}},{key:"j",value:function(e,t){var n=this.store.getAll(e,null===t?void 0:t);return new Pi((function(e,t){n.onerror=function(e){t(e.target.error)},n.onsuccess=function(t){e(t.target.result)}}))}},{key:"H",value:function(e,t){Kr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(e,t);n.J=!1;var r=this.cursor(n);return this.G(r,(function(e,t,n){return n.delete()}))}},{key:"Y",value:function(e,t){var n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.G(r,t)}},{key:"Z",value:function(e){var t=this.cursor({});return new Pi((function(n,r){t.onerror=function(e){var t=Vi(e.target.error);r(t)},t.onsuccess=function(t){var r=t.target.result;r?e(r.primaryKey,r.value).next((function(e){e?r.continue():n()})):n()}}))}},{key:"G",value:function(e,t){var n=[];return new Pi((function(r,i){e.onerror=function(e){i(e.target.error)},e.onsuccess=function(e){var i=e.target.result;if(i){var a=new Di(i),o=t(i.primaryKey,i.value,a);if(o instanceof Pi){var s=o.catch((function(e){return a.done(),Pi.reject(e)}));n.push(s)}a.isDone?r():null===a.$?i.continue():i.continue(a.$)}else r()}})).next((function(){return Pi.waitFor(n)}))}},{key:"options",value:function(e,t){var n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}},{key:"cursor",value:function(e){var t="next";if(e.reverse&&(t="prev"),e.index){var n=this.store.index(e.index);return e.J?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}]),e}();function Fi(e){return new Pi((function(t,n){e.onsuccess=function(e){var n=e.target.result;t(n)},e.onerror=function(e){var t=Vi(e.target.error);n(t)}}))}var Ui=!1;function Vi(e){var t=Zi.S((0,w.z$)());if(t>=12.2&&t<13){var n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){var r=new ti("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '".concat(n,"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround."));return Ui||(Ui=!0,setTimeout((function(){throw r}),0)),r}}return e}var ji=function(){function e(t,n){var r=this;(0,v.Z)(this,e),this.previousValue=t,n&&(n.sequenceNumberHandler=function(e){return r.se(e)},this.oe=function(e){return n.writeSequenceNumber(e)})}return(0,p.Z)(e,[{key:"se",value:function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}},{key:"next",value:function(){var e=++this.previousValue;return this.oe&&this.oe(e),e}}]),e}();function qi(e){return null==e}function Bi(e){return 0===e&&1/e==-1/0}function zi(e){return"number"==typeof e&&Number.isInteger(e)&&!Bi(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}ji._e=-1;var Hi=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments"].concat(["clientMetadata"]).concat(["remoteDocumentGlobal"]).concat(["collectionParents"]).concat(["bundles","namedQueries"]),Wi=([].concat((0,d.Z)(Hi),["documentOverlays"]),["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"]),Ki=Wi;[].concat(Ki,["indexConfiguration","indexState","indexEntries"]);function Gi(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Yi(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Qi(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var Ji=function(){function e(t,n){(0,v.Z)(this,e),this.comparator=t,this.root=n||$i.EMPTY}return(0,p.Z)(e,[{key:"insert",value:function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,$i.BLACK,null,null))}},{key:"remove",value:function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,$i.BLACK,null,null))}},{key:"get",value:function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}},{key:"indexOf",value:function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}},{key:"isEmpty",value:function(){return this.root.isEmpty()}},{key:"size",get:function(){return this.root.size}},{key:"minKey",value:function(){return this.root.minKey()}},{key:"maxKey",value:function(){return this.root.maxKey()}},{key:"inorderTraversal",value:function(e){return this.root.inorderTraversal(e)}},{key:"forEach",value:function(e){this.inorderTraversal((function(t,n){return e(t,n),!1}))}},{key:"toString",value:function(){var e=[];return this.inorderTraversal((function(t,n){return e.push("".concat(t,":").concat(n)),!1})),"{".concat(e.join(", "),"}")}},{key:"reverseTraversal",value:function(e){return this.root.reverseTraversal(e)}},{key:"getIterator",value:function(){return new Xi(this.root,null,this.comparator,!1)}},{key:"getIteratorFrom",value:function(e){return new Xi(this.root,e,this.comparator,!1)}},{key:"getReverseIterator",value:function(){return new Xi(this.root,null,this.comparator,!0)}},{key:"getReverseIteratorFrom",value:function(e){return new Xi(this.root,e,this.comparator,!0)}}]),e}(),Xi=function(){function e(t,n,r,i){(0,v.Z)(this,e),this.isReverse=i,this.nodeStack=[];for(var a=1;!t.isEmpty();)if(a=n?r(t.key,n):1,n&&i&&(a*=-1),a<0)t=this.isReverse?t.left:t.right;else{if(0===a){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return(0,p.Z)(e,[{key:"getNext",value:function(){var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}},{key:"hasNext",value:function(){return this.nodeStack.length>0}},{key:"peek",value:function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}]),e}(),$i=function(){function e(t,n,r,i,a){(0,v.Z)(this,e),this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:e.EMPTY,this.right=null!=a?a:e.EMPTY,this.size=this.left.size+1+this.right.size}return(0,p.Z)(e,[{key:"copy",value:function(t,n,r,i,a){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=a?a:this.right)}},{key:"isEmpty",value:function(){return!1}},{key:"inorderTraversal",value:function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:"min",value:function(){return this.left.isEmpty()?this:this.left.min()}},{key:"minKey",value:function(){return this.min().key}},{key:"maxKey",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}},{key:"removeMin",value:function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()}},{key:"remove",value:function(t,n){var r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(t,i.key)){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()}},{key:"isRed",value:function(){return this.color}},{key:"fixUp",value:function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}},{key:"moveRedLeft",value:function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}},{key:"moveRedRight",value:function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}},{key:"rotateLeft",value:function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}},{key:"rotateRight",value:function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}},{key:"colorFlip",value:function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}},{key:"checkMaxDepth",value:function(){var e=this.check();return Math.pow(2,e)<=this.size+1}},{key:"check",value:function(){if(this.isRed()&&this.left.isRed())throw Jr();if(this.right.isRed())throw Jr();var e=this.left.check();if(e!==this.right.check())throw Jr();return e+(this.isRed()?0:1)}}]),e}();$i.EMPTY=null,$i.RED=!0,$i.BLACK=!1,$i.EMPTY=new(function(){function e(){(0,v.Z)(this,e),this.size=0}return(0,p.Z)(e,[{key:"key",get:function(){throw Jr()}},{key:"value",get:function(){throw Jr()}},{key:"color",get:function(){throw Jr()}},{key:"left",get:function(){throw Jr()}},{key:"right",get:function(){throw Jr()}},{key:"copy",value:function(e,t,n,r,i){return this}},{key:"insert",value:function(e,t,n){return new $i(e,t)}},{key:"remove",value:function(e,t){return this}},{key:"isEmpty",value:function(){return!0}},{key:"inorderTraversal",value:function(e){return!1}},{key:"reverseTraversal",value:function(e){return!1}},{key:"minKey",value:function(){return null}},{key:"maxKey",value:function(){return null}},{key:"isRed",value:function(){return!1}},{key:"checkMaxDepth",value:function(){return!0}},{key:"check",value:function(){return 0}}]),e}());var ea=function(){function e(t){(0,v.Z)(this,e),this.comparator=t,this.data=new Ji(this.comparator)}return(0,p.Z)(e,[{key:"has",value:function(e){return null!==this.data.get(e)}},{key:"first",value:function(){return this.data.minKey()}},{key:"last",value:function(){return this.data.maxKey()}},{key:"size",get:function(){return this.data.size}},{key:"indexOf",value:function(e){return this.data.indexOf(e)}},{key:"forEach",value:function(e){this.data.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"forEachInRange",value:function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}},{key:"forEachWhile",value:function(e,t){var n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}},{key:"firstAfterOrEqual",value:function(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}},{key:"getIterator",value:function(){return new ta(this.data.getIterator())}},{key:"getIteratorFrom",value:function(e){return new ta(this.data.getIteratorFrom(e))}},{key:"add",value:function(e){return this.copy(this.data.remove(e).insert(e,!0))}},{key:"delete",value:function(e){return this.has(e)?this.copy(this.data.remove(e)):this}},{key:"isEmpty",value:function(){return this.data.isEmpty()}},{key:"unionWith",value:function(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach((function(e){t=t.add(e)})),t}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(0!==this.comparator(i,a))return!1}return!0}},{key:"toArray",value:function(){var e=[];return this.forEach((function(t){e.push(t)})),e}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){return e.push(t)})),"SortedSet("+e.toString()+")"}},{key:"copy",value:function(t){var n=new e(this.comparator);return n.data=t,n}}]),e}(),ta=function(){function e(t){(0,v.Z)(this,e),this.iter=t}return(0,p.Z)(e,[{key:"getNext",value:function(){return this.iter.getNext().key}},{key:"hasNext",value:function(){return this.iter.hasNext()}}]),e}();var na=function(){function e(t){(0,v.Z)(this,e),this.fields=t,t.sort(ki.comparator)}return(0,p.Z)(e,[{key:"unionWith",value:function(t){var n,r=new ea(ki.comparator),i=(0,c.Z)(this.fields);try{for(i.s();!(n=i.n()).done;){var a=n.value;r=r.add(a)}}catch(l){i.e(l)}finally{i.f()}var o,s=(0,c.Z)(t);try{for(s.s();!(o=s.n()).done;){var u=o.value;r=r.add(u)}}catch(l){s.e(l)}finally{s.f()}return new e(r.toArray())}},{key:"covers",value:function(e){var t,n=(0,c.Z)(this.fields);try{for(n.s();!(t=n.n()).done;){if(t.value.isPrefixOf(e))return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"isEqual",value:function(e){return vi(this.fields,e.fields,(function(e,t){return e.isEqual(t)}))}}],[{key:"empty",value:function(){return new e([])}}]),e}(),ra=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,v.Z)(this,n),(e=t.apply(this,arguments)).name="Base64DecodeError",e}return(0,p.Z)(n)}((0,u.Z)(Error));var ia=function(e){function t(e){(0,v.Z)(this,t),this.binaryString=e}return(0,p.Z)(t,[{key:e,value:function(){var e=this,t=0;return{next:function(){return t<e.binaryString.length?{value:e.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}}},{key:"toBase64",value:function(){return e=this.binaryString,btoa(e);var e}},{key:"toUint8Array",value:function(){return function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}},{key:"approximateByteSize",value:function(){return 2*this.binaryString.length}},{key:"compareTo",value:function(e){return di(this.binaryString,e.binaryString)}},{key:"isEqual",value:function(e){return this.binaryString===e.binaryString}}],[{key:"fromBase64String",value:function(e){var n=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new ra("Invalid base64 string: "+e):e}}(e);return new t(n)}},{key:"fromUint8Array",value:function(e){var n=function(e){for(var t="",n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new t(n)}}]),t}(Symbol.iterator);ia.EMPTY_BYTE_STRING=new ia("");var aa=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function oa(e){if(Xr(!!e),"string"==typeof e){var t=0,n=aa.exec(e);if(Xr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:sa(e.seconds),nanos:sa(e.nanos)}}function sa(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ua(e){return"string"==typeof e?ia.fromBase64String(e):ia.fromUint8Array(e)}function ca(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function la(e){var t=e.mapValue.fields.__previous_value__;return ca(t)?la(t):t}function ha(e){var t=oa(e.mapValue.fields.__local_write_time__.timestampValue);return new pi(t.seconds,t.nanos)}var fa=(0,p.Z)((function e(t,n,r,i,a,o,s,u,c){(0,v.Z)(this,e),this.databaseId=t,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=a,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.longPollingOptions=u,this.useFetchStreams=c})),da=function(){function e(t,n){(0,v.Z)(this,e),this.projectId=t,this.database=n||"(default)"}return(0,p.Z)(e,[{key:"isDefaultDatabase",get:function(){return"(default)"===this.database}},{key:"isEqual",value:function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}}],[{key:"empty",value:function(){return new e("","")}}]),e}(),va={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function pa(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ca(e)?4:Ca(e)?9007199254740991:10:Jr()}function ya(e,t){if(e===t)return!0;var n=pa(e);if(n!==pa(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return ha(e).isEqual(ha(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;var n=oa(e.timestampValue),r=oa(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return ua(e.bytesValue).isEqual(ua(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return sa(e.geoPointValue.latitude)===sa(t.geoPointValue.latitude)&&sa(e.geoPointValue.longitude)===sa(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return sa(e.integerValue)===sa(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=sa(e.doubleValue),r=sa(t.doubleValue);return n===r?Bi(n)===Bi(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return vi(e.arrayValue.values||[],t.arrayValue.values||[],ya);case 10:return function(e,t){var n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Gi(n)!==Gi(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!ya(n[i],r[i])))return!1;return!0}(e,t);default:return Jr()}}function ga(e,t){return void 0!==(e.values||[]).find((function(e){return ya(e,t)}))}function ma(e,t){if(e===t)return 0;var n=pa(e),r=pa(t);if(n!==r)return di(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return di(e.booleanValue,t.booleanValue);case 2:return function(e,t){var n=sa(e.integerValue||e.doubleValue),r=sa(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return _a(e.timestampValue,t.timestampValue);case 4:return _a(ha(e),ha(t));case 5:return di(e.stringValue,t.stringValue);case 6:return function(e,t){var n=ua(e),r=ua(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){for(var n=e.split("/"),r=t.split("/"),i=0;i<n.length&&i<r.length;i++){var a=di(n[i],r[i]);if(0!==a)return a}return di(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){var n=di(sa(e.latitude),sa(t.latitude));return 0!==n?n:di(sa(e.longitude),sa(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){for(var n=e.values||[],r=t.values||[],i=0;i<n.length&&i<r.length;++i){var a=ma(n[i],r[i]);if(a)return a}return di(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===va.mapValue&&t===va.mapValue)return 0;if(e===va.mapValue)return 1;if(t===va.mapValue)return-1;var n=e.fields||{},r=Object.keys(n),i=t.fields||{},a=Object.keys(i);r.sort(),a.sort();for(var o=0;o<r.length&&o<a.length;++o){var s=di(r[o],a[o]);if(0!==s)return s;var u=ma(n[r[o]],i[a[o]]);if(0!==u)return u}return di(r.length,a.length)}(e.mapValue,t.mapValue);default:throw Jr()}}function _a(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return di(e,t);var n=oa(e),r=oa(t),i=di(n.seconds,r.seconds);return 0!==i?i:di(n.nanos,r.nanos)}function ka(e){return wa(e)}function wa(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){var t=oa(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return ua(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return wi.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return"geo(".concat(e.latitude,",").concat(e.longitude,")")}(e.geoPointValue):"arrayValue"in e?function(e){var t,n="[",r=!0,i=(0,c.Z)(e.values||[]);try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+=wa(a)}}catch(o){i.e(o)}finally{i.f()}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){var t,n=Object.keys(e.fields||{}).sort(),r="{",i=!0,a=(0,c.Z)(n);try{for(a.s();!(t=a.n()).done;){var o=t.value;i?i=!1:r+=",",r+="".concat(o,":").concat(wa(e.fields[o]))}}catch(s){a.e(s)}finally{a.f()}return r+"}"}(e.mapValue):Jr()}function ba(e){return!!e&&"integerValue"in e}function Ia(e){return!!e&&"arrayValue"in e}function Ea(e){return!!e&&"mapValue"in e}function Ta(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return Yi(e.mapValue.fields,(function(e,n){return t.mapValue.fields[e]=Ta(n)})),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Ta(e.arrayValue.values[r]);return n}return Object.assign({},e)}function Ca(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}var Sa=function(){function e(t){(0,v.Z)(this,e),this.value=t}return(0,p.Z)(e,[{key:"field",value:function(e){if(e.isEmpty())return this.value;for(var t=this.value,n=0;n<e.length-1;++n)if(!Ea(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}},{key:"set",value:function(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ta(t)}},{key:"setAll",value:function(e){var t=this,n=ki.emptyPath(),r={},i=[];e.forEach((function(e,a){if(!n.isImmediateParentOf(a)){var o=t.getFieldsMap(n);t.applyChanges(o,r,i),r={},i=[],n=a.popLast()}e?r[a.lastSegment()]=Ta(e):i.push(a.lastSegment())}));var a=this.getFieldsMap(n);this.applyChanges(a,r,i)}},{key:"delete",value:function(e){var t=this.field(e.popLast());Ea(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}},{key:"isEqual",value:function(e){return ya(this.value,e.value)}},{key:"getFieldsMap",value:function(e){var t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(var n=0;n<e.length;++n){var r=t.mapValue.fields[e.get(n)];Ea(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}},{key:"applyChanges",value:function(e,t,n){Yi(t,(function(t,n){return e[t]=n}));var r,i=(0,c.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;delete e[a]}}catch(o){i.e(o)}finally{i.f()}}},{key:"clone",value:function(){return new e(Ta(this.value))}}],[{key:"empty",value:function(){return new e({mapValue:{}})}}]),e}();function xa(e){var t=[];return Yi(e.fields,(function(e,n){var r=new ki([e]);if(Ea(n)){var i=xa(n.mapValue).fields;if(0===i.length)t.push(r);else{var a,o=(0,c.Z)(i);try{for(o.s();!(a=o.n()).done;){var s=a.value;t.push(r.child(s))}}catch(u){o.e(u)}finally{o.f()}}}else t.push(r)})),new na(t)}var Na=function(){function e(t,n,r,i,a,o,s){(0,v.Z)(this,e),this.key=t,this.documentType=n,this.version=r,this.readTime=i,this.createTime=a,this.data=o,this.documentState=s}return(0,p.Z)(e,[{key:"convertToFoundDocument",value:function(e,t){return!this.createTime.isEqual(yi.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}},{key:"convertToNoDocument",value:function(e){return this.version=e,this.documentType=2,this.data=Sa.empty(),this.documentState=0,this}},{key:"convertToUnknownDocument",value:function(e){return this.version=e,this.documentType=3,this.data=Sa.empty(),this.documentState=2,this}},{key:"setHasCommittedMutations",value:function(){return this.documentState=2,this}},{key:"setHasLocalMutations",value:function(){return this.documentState=1,this.version=yi.min(),this}},{key:"setReadTime",value:function(e){return this.readTime=e,this}},{key:"hasLocalMutations",get:function(){return 1===this.documentState}},{key:"hasCommittedMutations",get:function(){return 2===this.documentState}},{key:"hasPendingWrites",get:function(){return this.hasLocalMutations||this.hasCommittedMutations}},{key:"isValidDocument",value:function(){return 0!==this.documentType}},{key:"isFoundDocument",value:function(){return 1===this.documentType}},{key:"isNoDocument",value:function(){return 2===this.documentType}},{key:"isUnknownDocument",value:function(){return 3===this.documentType}},{key:"isEqual",value:function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}},{key:"mutableCopy",value:function(){return new e(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}},{key:"toString",value:function(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}],[{key:"newInvalidDocument",value:function(t){return new e(t,0,yi.min(),yi.min(),yi.min(),Sa.empty(),0)}},{key:"newFoundDocument",value:function(t,n,r,i){return new e(t,1,n,yi.min(),r,i,0)}},{key:"newNoDocument",value:function(t,n){return new e(t,2,n,yi.min(),yi.min(),Sa.empty(),0)}},{key:"newUnknownDocument",value:function(t,n){return new e(t,3,n,yi.min(),yi.min(),Sa.empty(),2)}}]),e}(),Aa=(0,p.Z)((function e(t,n){(0,v.Z)(this,e),this.position=t,this.inclusive=n}));function Pa(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var a=t[i],o=e.position[i];if(r=a.field.isKeyField()?wi.comparator(wi.fromName(o.referenceValue),n.key):ma(o,n.data.field(a.field)),"desc"===a.dir&&(r*=-1),0!==r)break}return r}function Ra(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!ya(e.position[n],t.position[n]))return!1;return!0}var Za=(0,p.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";(0,v.Z)(this,e),this.field=t,this.dir=n}));function Da(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}var Oa=(0,p.Z)((function e(){(0,v.Z)(this,e)})),La=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,i){var a;return(0,v.Z)(this,n),(a=t.call(this)).field=e,a.op=r,a.value=i,a}return(0,p.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(ma(t,this.value)):null!==t&&pa(this.value)===pa(t)&&this.matchesComparison(ma(t,this.value))}},{key:"matchesComparison",value:function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Jr()}}},{key:"isInequality",value:function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}},{key:"getFlattenedFilters",value:function(){return[this]}},{key:"getFilters",value:function(){return[this]}}],[{key:"create",value:function(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new za(e,t,r):"array-contains"===t?new Ga(e,r):"in"===t?new Ya(e,r):"not-in"===t?new Qa(e,r):"array-contains-any"===t?new Ja(e,r):new n(e,t,r)}},{key:"createKeyFieldInFilter",value:function(e,t,n){return"in"===t?new Ha(e,n):new Wa(e,n)}}]),n}(Oa),Ma=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this)).filters=e,i.op=r,i.ue=null,i}return(0,p.Z)(n,[{key:"matches",value:function(e){return Fa(this)?void 0===this.filters.find((function(t){return!t.matches(e)})):void 0!==this.filters.find((function(t){return t.matches(e)}))}},{key:"getFlattenedFilters",value:function(){return null!==this.ue||(this.ue=this.filters.reduce((function(e,t){return e.concat(t.getFlattenedFilters())}),[])),this.ue}},{key:"getFilters",value:function(){return Object.assign([],this.filters)}}],[{key:"create",value:function(e,t){return new n(e,t)}}]),n}(Oa);function Fa(e){return"and"===e.op}function Ua(e){return Va(e)&&Fa(e)}function Va(e){var t,n=(0,c.Z)(e.filters);try{for(n.s();!(t=n.n()).done;){if(t.value instanceof Ma)return!1}}catch(r){n.e(r)}finally{n.f()}return!0}function ja(e){if(e instanceof La)return e.field.canonicalString()+e.op.toString()+ka(e.value);if(Ua(e))return e.filters.map((function(e){return ja(e)})).join(",");var t=e.filters.map((function(e){return ja(e)})).join(",");return"".concat(e.op,"(").concat(t,")")}function qa(e,t){return e instanceof La?function(e,t){return t instanceof La&&e.op===t.op&&e.field.isEqual(t.field)&&ya(e.value,t.value)}(e,t):e instanceof Ma?function(e,t){return t instanceof Ma&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((function(e,n,r){return e&&qa(n,t.filters[r])}),!0)}(e,t):void Jr()}function Ba(e){return e instanceof La?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat(ka(e.value))}(e):e instanceof Ma?function(e){return e.op.toString()+" {"+e.getFilters().map(Ba).join(" ,")+"}"}(e):"Filter"}var za=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,i){var a;return(0,v.Z)(this,n),(a=t.call(this,e,r,i)).key=wi.fromName(i.referenceValue),a}return(0,p.Z)(n,[{key:"matches",value:function(e){var t=wi.comparator(e.key,this.key);return this.matchesComparison(t)}}]),n}(La),Ha=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this,e,"in",r)).keys=Ka("in",r),i}return(0,p.Z)(n,[{key:"matches",value:function(e){return this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(La),Wa=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this,e,"not-in",r)).keys=Ka("not-in",r),i}return(0,p.Z)(n,[{key:"matches",value:function(e){return!this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(La);function Ka(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(e){return wi.fromName(e.referenceValue)}))}var Ga=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){return(0,v.Z)(this,n),t.call(this,e,"array-contains",r)}return(0,p.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return Ia(t)&&ga(t.arrayValue,this.value)}}]),n}(La),Ya=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){return(0,v.Z)(this,n),t.call(this,e,"in",r)}return(0,p.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return null!==t&&ga(this.value.arrayValue,t)}}]),n}(La),Qa=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){return(0,v.Z)(this,n),t.call(this,e,"not-in",r)}return(0,p.Z)(n,[{key:"matches",value:function(e){if(ga(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!ga(this.value.arrayValue,t)}}]),n}(La),Ja=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){return(0,v.Z)(this,n),t.call(this,e,"array-contains-any",r)}return(0,p.Z)(n,[{key:"matches",value:function(e){var t=this,n=e.data.field(this.field);return!(!Ia(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(e){return ga(t.value.arrayValue,e)}))}}]),n}(La),Xa=(0,p.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;(0,v.Z)(this,e),this.path=t,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=a,this.startAt=o,this.endAt=s,this.ce=null}));function $a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return new Xa(e,t,n,r,i,a,o)}function eo(e){var t=$r(e);if(null===t.ce){var n=t.path.canonicalString();null!==t.collectionGroup&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map((function(e){return ja(e)})).join(","),n+="|ob:",n+=t.orderBy.map((function(e){return function(e){return e.field.canonicalString()+e.dir}(e)})).join(","),qi(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map((function(e){return ka(e)})).join(",")),t.endAt&&(n+="|ub:",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map((function(e){return ka(e)})).join(",")),t.ce=n}return t.ce}function to(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!Da(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if(!qa(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Ra(e.startAt,t.startAt)&&Ra(e.endAt,t.endAt)}var no=(0,p.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;(0,v.Z)(this,e),this.path=t,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=a,this.limitType=o,this.startAt=s,this.endAt=u,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}));function ro(e,t,n,r,i,a,o,s){return new no(e,t,n,r,i,a,o,s)}function io(e){return new no(e)}function ao(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function oo(e){return null!==e.collectionGroup}function so(e){var t=$r(e);if(null===t.le){t.le=[];var n,r=new Set,i=(0,c.Z)(t.explicitOrderBy);try{for(i.s();!(n=i.n()).done;){var a=n.value;t.le.push(a),r.add(a.field.canonicalString())}}catch(u){i.e(u)}finally{i.f()}var o=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",s=function(e){var t=new ea(ki.comparator);return e.filters.forEach((function(e){e.getFlattenedFilters().forEach((function(e){e.isInequality()&&(t=t.add(e.field))}))})),t}(t);s.forEach((function(e){r.has(e.canonicalString())||e.isKeyField()||t.le.push(new Za(e,o))})),r.has(ki.keyField().canonicalString())||t.le.push(new Za(ki.keyField(),o))}return t.le}function uo(e){var t=$r(e);return t.he||(t.he=co(t,so(e))),t.he}function co(e,t){if("F"===e.limitType)return $a(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);t=t.map((function(e){var t="desc"===e.dir?"asc":"desc";return new Za(e.field,t)}));var n=e.endAt?new Aa(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Aa(e.startAt.position,e.startAt.inclusive):null;return $a(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}function lo(e,t,n){return new no(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function ho(e,t){return to(uo(e),uo(t))&&e.limitType===t.limitType}function fo(e){return"".concat(eo(uo(e)),"|lt:").concat(e.limitType)}function vo(e){return"Query(target=".concat(function(e){var t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map((function(e){return Ba(e)})).join(", "),"]")),qi(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map((function(e){return function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)})).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((function(e){return ka(e)})).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((function(e){return ka(e)})).join(",")),"Target(".concat(t,")")}(uo(e)),"; limitType=").concat(e.limitType,")")}function po(e,t){return t.isFoundDocument()&&function(e,t){var n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):wi.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){var n,r=(0,c.Z)(so(e));try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.field.isKeyField()&&null===t.data.field(i.field))return!1}}catch(a){r.e(a)}finally{r.f()}return!0}(e,t)&&function(e,t){var n,r=(0,c.Z)(e.filters);try{for(r.s();!(n=r.n()).done;){if(!n.value.matches(t))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){var r=Pa(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,so(e),t))&&!(e.endAt&&!function(e,t,n){var r=Pa(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,so(e),t))}(e,t)}function yo(e){return function(t,n){var r,i=!1,a=(0,c.Z)(so(e));try{for(a.s();!(r=a.n()).done;){var o=r.value,s=go(o,t,n);if(0!==s)return s;i=i||o.field.isKeyField()}}catch(u){a.e(u)}finally{a.f()}return 0}}function go(e,t,n){var r=e.field.isKeyField()?wi.comparator(t.key,n.key):function(e,t,n){var r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?ma(r,i):Jr()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Jr()}}var mo=function(){function e(t,n){(0,v.Z)(this,e),this.mapKeyFn=t,this.equalsFn=n,this.inner={},this.innerSize=0}return(0,p.Z)(e,[{key:"get",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){var r,i=(0,c.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=(0,s.Z)(r.value,2),o=a[0],u=a[1];if(this.equalsFn(o,e))return u}}catch(l){i.e(l)}finally{i.f()}}}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"set",value:function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}},{key:"delete",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}},{key:"forEach",value:function(e){Yi(this.inner,(function(t,n){var r,i=(0,c.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=(0,s.Z)(r.value,2),o=a[0],u=a[1];e(o,u)}}catch(l){i.e(l)}finally{i.f()}}))}},{key:"isEmpty",value:function(){return Qi(this.inner)}},{key:"size",value:function(){return this.innerSize}}]),e}(),_o=new Ji(wi.comparator);function ko(){return _o}var wo=new Ji(wi.comparator);function bo(){for(var e=wo,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];e=e.insert(o.key,o)}return e}function Io(e){var t=wo;return e.forEach((function(e,n){return t=t.insert(e,n.overlayedDocument)})),t}function Eo(){return Co()}function To(){return Co()}function Co(){return new mo((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)}))}var So=new Ji(wi.comparator),xo=new ea(wi.comparator);function No(){for(var e=xo,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];e=e.add(o)}return e}var Ao=new ea(di);function Po(){return Ao}function Ro(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Bi(t)?"-0":t}}function Zo(e){return{integerValue:""+e}}function Do(e,t){return zi(t)?Zo(t):Ro(e,t)}var Oo=(0,p.Z)((function e(){(0,v.Z)(this,e),this._=void 0}));function Lo(e,t,n){return e instanceof Uo?function(e,t){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&ca(t)&&(t=la(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Vo?jo(e,t):e instanceof qo?Bo(e,t):function(e,t){var n=Fo(e,t),r=Ho(n)+Ho(e.Ie);return ba(n)&&ba(e.Ie)?Zo(r):Ro(e.serializer,r)}(e,t)}function Mo(e,t,n){return e instanceof Vo?jo(e,t):e instanceof qo?Bo(e,t):n}function Fo(e,t){return e instanceof zo?function(e){return ba(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}var Uo=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,p.Z)(n)}(Oo),Vo=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this)).elements=e,r}return(0,p.Z)(n)}(Oo);function jo(e,t){var n,r=Wo(t),i=(0,c.Z)(e.elements);try{var a=function(){var e=n.value;r.some((function(t){return ya(t,e)}))||r.push(e)};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}return{arrayValue:{values:r}}}var qo=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this)).elements=e,r}return(0,p.Z)(n)}(Oo);function Bo(e,t){var n,r=Wo(t),i=(0,c.Z)(e.elements);try{var a=function(){var e=n.value;r=r.filter((function(t){return!ya(t,e)}))};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}return{arrayValue:{values:r}}}var zo=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this)).serializer=e,i.Ie=r,i}return(0,p.Z)(n)}(Oo);function Ho(e){return sa(e.integerValue||e.doubleValue)}function Wo(e){return Ia(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var Ko=(0,p.Z)((function e(t,n){(0,v.Z)(this,e),this.version=t,this.transformResults=n})),Go=function(){function e(t,n){(0,v.Z)(this,e),this.updateTime=t,this.exists=n}return(0,p.Z)(e,[{key:"isNone",get:function(){return void 0===this.updateTime&&void 0===this.exists}},{key:"isEqual",value:function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}],[{key:"none",value:function(){return new e}},{key:"exists",value:function(t){return new e(void 0,t)}},{key:"updateTime",value:function(t){return new e(t)}}]),e}();function Yo(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var Qo=(0,p.Z)((function e(){(0,v.Z)(this,e)}));function Jo(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new cs(e.key,Go.none()):new ns(e.key,e.data,Go.none());var n,r=e.data,i=Sa.empty(),a=new ea(ki.comparator),o=(0,c.Z)(t.fields);try{for(o.s();!(n=o.n()).done;){var s=n.value;if(!a.has(s)){var u=r.field(s);null===u&&s.length>1&&(s=s.popLast(),u=r.field(s)),null===u?i.delete(s):i.set(s,u),a=a.add(s)}}}catch(l){o.e(l)}finally{o.f()}return new rs(e.key,i,new na(a.toArray()),Go.none())}function Xo(e,t,n){e instanceof ns?function(e,t,n){var r=e.value.clone(),i=as(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof rs?function(e,t,n){if(Yo(e.precondition,t)){var r=as(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(is(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else t.convertToUnknownDocument(n.version)}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function $o(e,t,n,r){return e instanceof ns?function(e,t,n,r){if(!Yo(e.precondition,t))return n;var i=e.value.clone(),a=os(e.fieldTransforms,r,t);return i.setAll(a),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof rs?function(e,t,n,r){if(!Yo(e.precondition,t))return n;var i=os(e.fieldTransforms,r,t),a=t.data;return a.setAll(is(e)),a.setAll(i),t.convertToFoundDocument(t.version,a).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((function(e){return e.field})))}(e,t,n,r):function(e,t,n){return Yo(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function es(e,t){var n,r=null,i=(0,c.Z)(e.fieldTransforms);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=t.data.field(a.field),s=Fo(a.transform,o||null);null!=s&&(null===r&&(r=Sa.empty()),r.set(a.field,s))}}catch(u){i.e(u)}finally{i.f()}return r||null}function ts(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&vi(e,t,(function(e,t){return function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Vo&&t instanceof Vo||e instanceof qo&&t instanceof qo?vi(e.elements,t.elements,ya):e instanceof zo&&t instanceof zo?ya(e.Ie,t.Ie):e instanceof Uo&&t instanceof Uo}(e.transform,t.transform)}(e,t)}))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}var ns=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return(0,v.Z)(this,n),(a=t.call(this)).key=e,a.value=r,a.precondition=i,a.fieldTransforms=o,a.type=0,a}return(0,p.Z)(n,[{key:"getFieldMask",value:function(){return null}}]),n}(Qo),rs=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,i,a){var o,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return(0,v.Z)(this,n),(o=t.call(this)).key=e,o.data=r,o.fieldMask=i,o.precondition=a,o.fieldTransforms=s,o.type=1,o}return(0,p.Z)(n,[{key:"getFieldMask",value:function(){return this.fieldMask}}]),n}(Qo);function is(e){var t=new Map;return e.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}})),t}function as(e,t,n){var r=new Map;Xr(e.length===n.length);for(var i=0;i<n.length;i++){var a=e[i],o=a.transform,s=t.data.field(a.field);r.set(a.field,Mo(o,s,n[i]))}return r}function os(e,t,n){var r,i=new Map,a=(0,c.Z)(e);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=o.transform,u=n.data.field(o.field);i.set(o.field,Lo(s,u,t))}}catch(l){a.e(l)}finally{a.f()}return i}var ss,us,cs=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=2,i.fieldTransforms=[],i}return(0,p.Z)(n,[{key:"getFieldMask",value:function(){return null}}]),n}(Qo),ls=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var i;return(0,v.Z)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=3,i.fieldTransforms=[],i}return(0,p.Z)(n,[{key:"getFieldMask",value:function(){return null}}]),n}(Qo),hs=function(){function e(t,n,r,i){(0,v.Z)(this,e),this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}return(0,p.Z)(e,[{key:"applyToRemoteDocument",value:function(e,t){for(var n=t.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(e.key)&&Xo(i,e,n[r])}}},{key:"applyToLocalView",value:function(e,t){var n,r=(0,c.Z)(this.baseMutations);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.key.isEqual(e.key)&&(t=$o(i,e,t,this.localWriteTime))}}catch(u){r.e(u)}finally{r.f()}var a,o=(0,c.Z)(this.mutations);try{for(o.s();!(a=o.n()).done;){var s=a.value;s.key.isEqual(e.key)&&(t=$o(s,e,t,this.localWriteTime))}}catch(u){o.e(u)}finally{o.f()}return t}},{key:"applyToLocalDocumentSet",value:function(e,t){var n=this,r=To();return this.mutations.forEach((function(i){var a=e.get(i.key),o=a.overlayedDocument,s=n.applyToLocalView(o,a.mutatedFields),u=Jo(o,s=t.has(i.key)?null:s);null!==u&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(yi.min())})),r}},{key:"keys",value:function(){return this.mutations.reduce((function(e,t){return e.add(t.key)}),No())}},{key:"isEqual",value:function(e){return this.batchId===e.batchId&&vi(this.mutations,e.mutations,(function(e,t){return ts(e,t)}))&&vi(this.baseMutations,e.baseMutations,(function(e,t){return ts(e,t)}))}}]),e}(),fs=function(){function e(t,n,r,i){(0,v.Z)(this,e),this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}return(0,p.Z)(e,null,[{key:"from",value:function(t,n,r){Xr(t.mutations.length===r.length);for(var i=So,a=t.mutations,o=0;o<a.length;o++)i=i.insert(a[o].key,r[o].version);return new e(t,n,r,i)}}]),e}(),ds=function(){function e(t,n){(0,v.Z)(this,e),this.largestBatchId=t,this.mutation=n}return(0,p.Z)(e,[{key:"getKey",value:function(){return this.mutation.key}},{key:"isEqual",value:function(e){return null!==e&&this.mutation===e.mutation}},{key:"toString",value:function(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}]),e}();function vs(e){switch(e){default:return Jr();case ei.CANCELLED:case ei.UNKNOWN:case ei.DEADLINE_EXCEEDED:case ei.RESOURCE_EXHAUSTED:case ei.INTERNAL:case ei.UNAVAILABLE:case ei.UNAUTHENTICATED:return!1;case ei.INVALID_ARGUMENT:case ei.NOT_FOUND:case ei.ALREADY_EXISTS:case ei.PERMISSION_DENIED:case ei.FAILED_PRECONDITION:case ei.ABORTED:case ei.OUT_OF_RANGE:case ei.UNIMPLEMENTED:case ei.DATA_LOSS:return!0}}function ps(e){if(void 0===e)return Gr("GRPC error has no .code"),ei.UNKNOWN;switch(e){case ss.OK:return ei.OK;case ss.CANCELLED:return ei.CANCELLED;case ss.UNKNOWN:return ei.UNKNOWN;case ss.DEADLINE_EXCEEDED:return ei.DEADLINE_EXCEEDED;case ss.RESOURCE_EXHAUSTED:return ei.RESOURCE_EXHAUSTED;case ss.INTERNAL:return ei.INTERNAL;case ss.UNAVAILABLE:return ei.UNAVAILABLE;case ss.UNAUTHENTICATED:return ei.UNAUTHENTICATED;case ss.INVALID_ARGUMENT:return ei.INVALID_ARGUMENT;case ss.NOT_FOUND:return ei.NOT_FOUND;case ss.ALREADY_EXISTS:return ei.ALREADY_EXISTS;case ss.PERMISSION_DENIED:return ei.PERMISSION_DENIED;case ss.FAILED_PRECONDITION:return ei.FAILED_PRECONDITION;case ss.ABORTED:return ei.ABORTED;case ss.OUT_OF_RANGE:return ei.OUT_OF_RANGE;case ss.UNIMPLEMENTED:return ei.UNIMPLEMENTED;case ss.DATA_LOSS:return ei.DATA_LOSS;default:return Jr()}}(us=ss||(ss={}))[us.OK=0]="OK",us[us.CANCELLED=1]="CANCELLED",us[us.UNKNOWN=2]="UNKNOWN",us[us.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",us[us.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",us[us.NOT_FOUND=5]="NOT_FOUND",us[us.ALREADY_EXISTS=6]="ALREADY_EXISTS",us[us.PERMISSION_DENIED=7]="PERMISSION_DENIED",us[us.UNAUTHENTICATED=16]="UNAUTHENTICATED",us[us.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",us[us.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",us[us.ABORTED=10]="ABORTED",us[us.OUT_OF_RANGE=11]="OUT_OF_RANGE",us[us.UNIMPLEMENTED=12]="UNIMPLEMENTED",us[us.INTERNAL=13]="INTERNAL",us[us.UNAVAILABLE=14]="UNAVAILABLE",us[us.DATA_LOSS=15]="DATA_LOSS";new jr([4294967295,4294967295],0);Error;var ys=(0,p.Z)((function e(t,n){(0,v.Z)(this,e),this.databaseId=t,this.useProto3Json=n}));function gs(e,t){return e.useProto3Json?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function ms(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function _s(e,t){return gs(e,t.toTimestamp())}function ks(e){return Xr(!!e),yi.fromTimestamp(function(e){var t=oa(e);return new pi(t.seconds,t.nanos)}(e))}function ws(e,t){return bs(e,t).canonicalString()}function bs(e,t){var n=function(e){return new mi(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function Is(e){var t=mi.fromString(e);return Xr(Ds(t)),t}function Es(e,t){return ws(e.databaseId,t.path)}function Ts(e){var t=Is(e);return 4===t.length?mi.emptyPath():Ss(t)}function Cs(e){return new mi(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Ss(e){return Xr(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function xs(e,t,n){return{name:Es(e,t),fields:n.value.mapValue.fields}}function Ns(e,t){var n;if(t instanceof ns)n={update:xs(e,t.key,t.value)};else if(t instanceof cs)n={delete:Es(e,t.key)};else if(t instanceof rs)n={update:xs(e,t.key,t.data),updateMask:Zs(t.fieldMask)};else{if(!(t instanceof ls))return Jr();n={verify:Es(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((function(e){return function(e,t){var n=t.transform;if(n instanceof Uo)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Vo)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof qo)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof zo)return{fieldPath:t.field.canonicalString(),increment:n.Ie};throw Jr()}(0,e)}))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:_s(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Jr()}(e,t.precondition)),n}function As(e){var t=Ts(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Xr(1===r);var a=n.from[0];a.allDescendants?i=a.collectionId:t=t.child(a.collectionId)}var o=[];n.where&&(o=function(e){var t=Ps(e);return t instanceof Ma&&Ua(t)?t.getFilters():[t]}(n.where));var s=[];n.orderBy&&(s=function(e){return e.map((function(e){return function(e){return new Za(Rs(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)}))}(n.orderBy));var u=null;n.limit&&(u=function(e){var t;return qi(t="object"==typeof e?e.value:e)?null:t}(n.limit));var c=null;n.startAt&&(c=function(e){var t=!!e.before,n=e.values||[];return new Aa(n,t)}(n.startAt));var l=null;return n.endAt&&(l=function(e){var t=!e.before,n=e.values||[];return new Aa(n,t)}(n.endAt)),ro(t,i,s,o,u,"F",c,l)}function Ps(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":var t=Rs(e.unaryFilter.field);return La.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=Rs(e.unaryFilter.field);return La.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Rs(e.unaryFilter.field);return La.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Rs(e.unaryFilter.field);return La.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Jr()}}(e):void 0!==e.fieldFilter?function(e){return La.create(Rs(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Jr()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Ma.create(e.compositeFilter.filters.map((function(e){return Ps(e)})),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Jr()}}(e.compositeFilter.op))}(e):Jr()}function Rs(e){return ki.fromServerFormat(e.fieldPath)}function Zs(e){var t=[];return e.fields.forEach((function(e){return t.push(e.canonicalString())})),{fieldPaths:t}}function Ds(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}var Os=(0,p.Z)((function e(t){(0,v.Z)(this,e),this.ct=t}));function Ls(e){var t=As({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?lo(t,t.limit,"L"):t}var Ms=function(){function e(){(0,v.Z)(this,e)}return(0,p.Z)(e,[{key:"Pt",value:function(e,t){this.It(e,t),t.Tt()}},{key:"It",value:function(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(sa(e.integerValue));else if("doubleValue"in e){var n=sa(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),Bi(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){var r=e.timestampValue;this.Et(t,20),"string"==typeof r?t.At(r):(t.At("".concat(r.seconds||"")),t.dt(r.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(ua(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){var i=e.geoPointValue;this.Et(t,45),t.dt(i.latitude||0),t.dt(i.longitude||0)}else"mapValue"in e?Ca(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):Jr()}},{key:"Rt",value:function(e,t){this.Et(t,25),this.St(e,t)}},{key:"St",value:function(e,t){t.At(e)}},{key:"yt",value:function(e,t){var n=e.fields||{};this.Et(t,55);for(var r=0,i=Object.keys(n);r<i.length;r++){var a=i[r];this.Rt(a,t),this.It(n[a],t)}}},{key:"wt",value:function(e,t){var n=e.values||[];this.Et(t,50);var r,i=(0,c.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.It(a,t)}}catch(o){i.e(o)}finally{i.f()}}},{key:"gt",value:function(e,t){var n=this;this.Et(t,37),wi.fromName(e).path.forEach((function(e){n.Et(t,60),n.St(e,t)}))}},{key:"Et",value:function(e,t){e.dt(t)}},{key:"Vt",value:function(e){e.dt(2)}}]),e}();Ms.bt=new Ms;var Fs=function(){function e(){(0,v.Z)(this,e),this._n=new Us}return(0,p.Z)(e,[{key:"addToCollectionParentIndex",value:function(e,t){return this._n.add(t),Pi.resolve()}},{key:"getCollectionParents",value:function(e,t){return Pi.resolve(this._n.getEntries(t))}},{key:"addFieldIndex",value:function(e,t){return Pi.resolve()}},{key:"deleteFieldIndex",value:function(e,t){return Pi.resolve()}},{key:"deleteAllFieldIndexes",value:function(e){return Pi.resolve()}},{key:"createTargetIndexes",value:function(e,t){return Pi.resolve()}},{key:"getDocumentsMatchingTarget",value:function(e,t){return Pi.resolve(null)}},{key:"getIndexType",value:function(e,t){return Pi.resolve(0)}},{key:"getFieldIndexes",value:function(e,t){return Pi.resolve([])}},{key:"getNextCollectionGroupToUpdate",value:function(e){return Pi.resolve(null)}},{key:"getMinOffset",value:function(e,t){return Pi.resolve(Ti.min())}},{key:"getMinOffsetFromCollectionGroup",value:function(e,t){return Pi.resolve(Ti.min())}},{key:"updateCollectionGroup",value:function(e,t,n){return Pi.resolve()}},{key:"updateIndexEntries",value:function(e,t){return Pi.resolve()}}]),e}(),Us=function(){function e(){(0,v.Z)(this,e),this.index={}}return(0,p.Z)(e,[{key:"add",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new ea(mi.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}},{key:"has",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}},{key:"getEntries",value:function(e){return(this.index[e]||new ea(mi.comparator)).toArray()}}]),e}();new Uint8Array(0);var Vs=function(){function e(t,n,r){(0,v.Z)(this,e),this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return(0,p.Z)(e,null,[{key:"withCacheSize",value:function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}]),e}();Vs.DEFAULT_COLLECTION_PERCENTILE=10,Vs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Vs.DEFAULT=new Vs(41943040,Vs.DEFAULT_COLLECTION_PERCENTILE,Vs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Vs.DISABLED=new Vs(-1,0,0);var js=function(){function e(t){(0,v.Z)(this,e),this.On=t}return(0,p.Z)(e,[{key:"next",value:function(){return this.On+=2,this.On}}],[{key:"Nn",value:function(){return new e(0)}},{key:"Bn",value:function(){return new e(-1)}}]),e}();var qs=function(){function e(){(0,v.Z)(this,e),this.changes=new mo((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)})),this.changesApplied=!1}return(0,p.Z)(e,[{key:"addEntry",value:function(e){this.assertNotApplied(),this.changes.set(e.key,e)}},{key:"removeEntry",value:function(e,t){this.assertNotApplied(),this.changes.set(e,Na.newInvalidDocument(e).setReadTime(t))}},{key:"getEntry",value:function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?Pi.resolve(n):this.getFromCache(e,t)}},{key:"getEntries",value:function(e,t){return this.getAllFromCache(e,t)}},{key:"apply",value:function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}},{key:"assertNotApplied",value:function(){}}]),e}();var Bs=(0,p.Z)((function e(t,n){(0,v.Z)(this,e),this.overlayedDocument=t,this.mutatedFields=n})),zs=function(){function e(t,n,r,i){(0,v.Z)(this,e),this.remoteDocumentCache=t,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}return(0,p.Z)(e,[{key:"getDocument",value:function(e,t){var n=this,r=null;return this.documentOverlayCache.getOverlay(e,t).next((function(i){return r=i,n.remoteDocumentCache.getEntry(e,t)})).next((function(e){return null!==r&&$o(r.mutation,e,na.empty(),pi.now()),e}))}},{key:"getDocuments",value:function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next((function(t){return n.getLocalViewOfDocuments(e,t,No()).next((function(){return t}))}))}},{key:"getLocalViewOfDocuments",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:No(),i=Eo();return this.populateOverlays(e,i,t).next((function(){return n.computeViews(e,t,i,r).next((function(e){var t=bo();return e.forEach((function(e,n){t=t.insert(e,n.overlayedDocument)})),t}))}))}},{key:"getOverlayedDocuments",value:function(e,t){var n=this,r=Eo();return this.populateOverlays(e,r,t).next((function(){return n.computeViews(e,t,r,No())}))}},{key:"populateOverlays",value:function(e,t,n){var r=[];return n.forEach((function(e){t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((function(e){e.forEach((function(e,n){t.set(e,n)}))}))}},{key:"computeViews",value:function(e,t,n,r){var i=ko(),a=Co(),o=Co();return t.forEach((function(e,t){var o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof rs)?i=i.insert(t.key,t):void 0!==o?(a.set(t.key,o.mutation.getFieldMask()),$o(o.mutation,t,o.mutation.getFieldMask(),pi.now())):a.set(t.key,na.empty())})),this.recalculateAndSaveOverlays(e,i).next((function(e){return e.forEach((function(e,t){return a.set(e,t)})),t.forEach((function(e,t){var n;return o.set(e,new Bs(t,null!==(n=a.get(e))&&void 0!==n?n:null))})),o}))}},{key:"recalculateAndSaveOverlays",value:function(e,t){var n=this,r=Co(),i=new Ji((function(e,t){return e-t})),a=No();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((function(e){var n,a=(0,c.Z)(e);try{var o=function(){var e=n.value;e.keys().forEach((function(n){var a=t.get(n);if(null!==a){var o=r.get(n)||na.empty();o=e.applyToLocalView(a,o),r.set(n,o);var s=(i.get(e.batchId)||No()).add(n);i=i.insert(e.batchId,s)}}))};for(a.s();!(n=a.n()).done;)o()}catch(s){a.e(s)}finally{a.f()}})).next((function(){for(var o=[],s=i.getReverseIterator(),u=function(){var i=s.getNext(),u=i.key,c=i.value,l=To();c.forEach((function(e){if(!a.has(e)){var n=Jo(t.get(e),r.get(e));null!==n&&l.set(e,n),a=a.add(e)}})),o.push(n.documentOverlayCache.saveOverlays(e,u,l))};s.hasNext();)u();return Pi.waitFor(o)})).next((function(){return r}))}},{key:"recalculateAndSaveOverlaysForDocumentKeys",value:function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next((function(t){return n.recalculateAndSaveOverlays(e,t)}))}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){return function(e){return wi.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):oo(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}},{key:"getNextDocuments",value:function(e,t,n,r){var i=this;return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((function(a){var o=r-a.size>0?i.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-a.size):Pi.resolve(Eo()),s=-1,u=a;return o.next((function(t){return Pi.forEach(t,(function(t,n){return s<n.largestBatchId&&(s=n.largestBatchId),a.get(t)?Pi.resolve():i.remoteDocumentCache.getEntry(e,t).next((function(e){u=u.insert(t,e)}))})).next((function(){return i.populateOverlays(e,t,a)})).next((function(){return i.computeViews(e,u,t,No())})).next((function(e){return{batchId:s,changes:Io(e)}}))}))}))}},{key:"getDocumentsMatchingDocumentQuery",value:function(e,t){return this.getDocument(e,new wi(t)).next((function(e){var t=bo();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}},{key:"getDocumentsMatchingCollectionGroupQuery",value:function(e,t,n,r){var i=this,a=t.collectionGroup,o=bo();return this.indexManager.getCollectionParents(e,a).next((function(s){return Pi.forEach(s,(function(s){var u=function(e,t){return new no(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(a));return i.getDocumentsMatchingCollectionQuery(e,u,n,r).next((function(e){e.forEach((function(e,t){o=o.insert(e,t)}))}))})).next((function(){return o}))}))}},{key:"getDocumentsMatchingCollectionQuery",value:function(e,t,n,r){var i,a=this;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((function(o){return i=o,a.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)})).next((function(e){i.forEach((function(t,n){var r=n.getKey();null===e.get(r)&&(e=e.insert(r,Na.newInvalidDocument(r)))}));var n=bo();return e.forEach((function(e,r){var a=i.get(e);void 0!==a&&$o(a.mutation,r,na.empty(),pi.now()),po(t,r)&&(n=n.insert(e,r))})),n}))}}]),e}(),Hs=function(){function e(t){(0,v.Z)(this,e),this.serializer=t,this.cr=new Map,this.lr=new Map}return(0,p.Z)(e,[{key:"getBundleMetadata",value:function(e,t){return Pi.resolve(this.cr.get(t))}},{key:"saveBundleMetadata",value:function(e,t){return this.cr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:ks(e.createTime)}}(t)),Pi.resolve()}},{key:"getNamedQuery",value:function(e,t){return Pi.resolve(this.lr.get(t))}},{key:"saveNamedQuery",value:function(e,t){return this.lr.set(t.name,function(e){return{name:e.name,query:Ls(e.bundledQuery),readTime:ks(e.readTime)}}(t)),Pi.resolve()}}]),e}(),Ws=function(){function e(){(0,v.Z)(this,e),this.overlays=new Ji(wi.comparator),this.hr=new Map}return(0,p.Z)(e,[{key:"getOverlay",value:function(e,t){return Pi.resolve(this.overlays.get(t))}},{key:"getOverlays",value:function(e,t){var n=this,r=Eo();return Pi.forEach(t,(function(t){return n.getOverlay(e,t).next((function(e){null!==e&&r.set(t,e)}))})).next((function(){return r}))}},{key:"saveOverlays",value:function(e,t,n){var r=this;return n.forEach((function(n,i){r.ht(e,t,i)})),Pi.resolve()}},{key:"removeOverlaysForBatchId",value:function(e,t,n){var r=this,i=this.hr.get(n);return void 0!==i&&(i.forEach((function(e){return r.overlays=r.overlays.remove(e)})),this.hr.delete(n)),Pi.resolve()}},{key:"getOverlaysForCollection",value:function(e,t,n){for(var r=Eo(),i=t.length+1,a=new wi(t.child("")),o=this.overlays.getIteratorFrom(a);o.hasNext();){var s=o.getNext().value,u=s.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===i&&s.largestBatchId>n&&r.set(s.getKey(),s)}return Pi.resolve(r)}},{key:"getOverlaysForCollectionGroup",value:function(e,t,n,r){for(var i=new Ji((function(e,t){return e-t})),a=this.overlays.getIterator();a.hasNext();){var o=a.getNext().value;if(o.getKey().getCollectionGroup()===t&&o.largestBatchId>n){var s=i.get(o.largestBatchId);null===s&&(s=Eo(),i=i.insert(o.largestBatchId,s)),s.set(o.getKey(),o)}}for(var u=Eo(),c=i.getIterator();c.hasNext()&&(c.getNext().value.forEach((function(e,t){return u.set(e,t)})),!(u.size()>=r)););return Pi.resolve(u)}},{key:"ht",value:function(e,t,n){var r=this.overlays.get(n.key);if(null!==r){var i=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,i)}this.overlays=this.overlays.insert(n.key,new ds(t,n));var a=this.hr.get(t);void 0===a&&(a=No(),this.hr.set(t,a)),this.hr.set(t,a.add(n.key))}}]),e}(),Ks=function(){function e(){(0,v.Z)(this,e),this.Pr=new ea(Gs.Ir),this.Tr=new ea(Gs.Er)}return(0,p.Z)(e,[{key:"isEmpty",value:function(){return this.Pr.isEmpty()}},{key:"addReference",value:function(e,t){var n=new Gs(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}},{key:"dr",value:function(e,t){var n=this;e.forEach((function(e){return n.addReference(e,t)}))}},{key:"removeReference",value:function(e,t){this.Ar(new Gs(e,t))}},{key:"Rr",value:function(e,t){var n=this;e.forEach((function(e){return n.removeReference(e,t)}))}},{key:"Vr",value:function(e){var t=this,n=new wi(new mi([])),r=new Gs(n,e),i=new Gs(n,e+1),a=[];return this.Tr.forEachInRange([r,i],(function(e){t.Ar(e),a.push(e.key)})),a}},{key:"mr",value:function(){var e=this;this.Pr.forEach((function(t){return e.Ar(t)}))}},{key:"Ar",value:function(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}},{key:"gr",value:function(e){var t=new wi(new mi([])),n=new Gs(t,e),r=new Gs(t,e+1),i=No();return this.Tr.forEachInRange([n,r],(function(e){i=i.add(e.key)})),i}},{key:"containsKey",value:function(e){var t=new Gs(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}]),e}(),Gs=function(){function e(t,n){(0,v.Z)(this,e),this.key=t,this.pr=n}return(0,p.Z)(e,null,[{key:"Ir",value:function(e,t){return wi.comparator(e.key,t.key)||di(e.pr,t.pr)}},{key:"Er",value:function(e,t){return di(e.pr,t.pr)||wi.comparator(e.key,t.key)}}]),e}(),Ys=function(){function e(t,n){(0,v.Z)(this,e),this.indexManager=t,this.referenceDelegate=n,this.mutationQueue=[],this.yr=1,this.wr=new ea(Gs.Ir)}return(0,p.Z)(e,[{key:"checkEmpty",value:function(e){return Pi.resolve(0===this.mutationQueue.length)}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];var a=new hs(i,t,n,r);this.mutationQueue.push(a);var o,s=(0,c.Z)(r);try{for(s.s();!(o=s.n()).done;){var u=o.value;this.wr=this.wr.add(new Gs(u.key,i)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast())}}catch(l){s.e(l)}finally{s.f()}return Pi.resolve(a)}},{key:"lookupMutationBatch",value:function(e,t){return Pi.resolve(this.Sr(t))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=t+1,r=this.br(n),i=r<0?0:r;return Pi.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}},{key:"getHighestUnacknowledgedBatchId",value:function(){return Pi.resolve(0===this.mutationQueue.length?-1:this.yr-1)}},{key:"getAllMutationBatches",value:function(e){return Pi.resolve(this.mutationQueue.slice())}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=new Gs(t,0),i=new Gs(t,Number.POSITIVE_INFINITY),a=[];return this.wr.forEachInRange([r,i],(function(e){var t=n.Sr(e.pr);a.push(t)})),Pi.resolve(a)}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new ea(di);return t.forEach((function(e){var t=new Gs(e,0),i=new Gs(e,Number.POSITIVE_INFINITY);n.wr.forEachInRange([t,i],(function(e){r=r.add(e.pr)}))})),Pi.resolve(this.Dr(r))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=t.path,r=n.length+1,i=n;wi.isDocumentKey(i)||(i=i.child(""));var a=new Gs(new wi(i),0),o=new ea(di);return this.wr.forEachWhile((function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.pr)),!0)}),a),Pi.resolve(this.Dr(o))}},{key:"Dr",value:function(e){var t=this,n=[];return e.forEach((function(e){var r=t.Sr(e);null!==r&&n.push(r)})),n}},{key:"removeMutationBatch",value:function(e,t){var n=this;Xr(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();var r=this.wr;return Pi.forEach(t.mutations,(function(i){var a=new Gs(i.key,t.batchId);return r=r.delete(a),n.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((function(){n.wr=r}))}},{key:"Mn",value:function(e){}},{key:"containsKey",value:function(e,t){var n=new Gs(t,0),r=this.wr.firstAfterOrEqual(n);return Pi.resolve(t.isEqual(r&&r.key))}},{key:"performConsistencyCheck",value:function(e){return this.mutationQueue.length,Pi.resolve()}},{key:"Cr",value:function(e,t){return this.br(e)}},{key:"br",value:function(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}},{key:"Sr",value:function(e){var t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}]),e}(),Qs=function(){function e(t){(0,v.Z)(this,e),this.vr=t,this.docs=new Ji(wi.comparator),this.size=0}return(0,p.Z)(e,[{key:"setIndexManager",value:function(e){this.indexManager=e}},{key:"addEntry",value:function(e,t){var n=t.key,r=this.docs.get(n),i=r?r.size:0,a=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}},{key:"removeEntry",value:function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}},{key:"getEntry",value:function(e,t){var n=this.docs.get(t);return Pi.resolve(n?n.document.mutableCopy():Na.newInvalidDocument(t))}},{key:"getEntries",value:function(e,t){var n=this,r=ko();return t.forEach((function(e){var t=n.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():Na.newInvalidDocument(e))})),Pi.resolve(r)}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){for(var i=ko(),a=t.path,o=new wi(a.child("")),s=this.docs.getIteratorFrom(o);s.hasNext();){var u=s.getNext(),c=u.key,l=u.value.document;if(!a.isPrefixOf(c.path))break;c.path.length>a.length+1||Ci(Ei(l),n)<=0||(r.has(l.key)||po(t,l))&&(i=i.insert(l.key,l.mutableCopy()))}return Pi.resolve(i)}},{key:"getAllFromCollectionGroup",value:function(e,t,n,r){Jr()}},{key:"Fr",value:function(e,t){return Pi.forEach(this.docs,(function(e){return t(e)}))}},{key:"newChangeBuffer",value:function(e){return new Js(this)}},{key:"getSize",value:function(e){return Pi.resolve(this.size)}}]),e}(),Js=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this)).ar=e,r}return(0,p.Z)(n,[{key:"applyChanges",value:function(e){var t=this,n=[];return this.changes.forEach((function(r,i){i.isValidDocument()?n.push(t.ar.addEntry(e,i)):t.ar.removeEntry(r)})),Pi.waitFor(n)}},{key:"getFromCache",value:function(e,t){return this.ar.getEntry(e,t)}},{key:"getAllFromCache",value:function(e,t){return this.ar.getEntries(e,t)}}]),n}(qs),Xs=function(){function e(t){(0,v.Z)(this,e),this.persistence=t,this.Mr=new mo((function(e){return eo(e)}),to),this.lastRemoteSnapshotVersion=yi.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Ks,this.targetCount=0,this.Br=js.Nn()}return(0,p.Z)(e,[{key:"forEachTarget",value:function(e,t){return this.Mr.forEach((function(e,n){return t(n)})),Pi.resolve()}},{key:"getLastRemoteSnapshotVersion",value:function(e){return Pi.resolve(this.lastRemoteSnapshotVersion)}},{key:"getHighestSequenceNumber",value:function(e){return Pi.resolve(this.Or)}},{key:"allocateTargetId",value:function(e){return this.highestTargetId=this.Br.next(),Pi.resolve(this.highestTargetId)}},{key:"setTargetsMetadata",value:function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),Pi.resolve()}},{key:"qn",value:function(e){this.Mr.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Br=new js(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}},{key:"addTargetData",value:function(e,t){return this.qn(t),this.targetCount+=1,Pi.resolve()}},{key:"updateTargetData",value:function(e,t){return this.qn(t),Pi.resolve()}},{key:"removeTargetData",value:function(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,Pi.resolve()}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return this.Mr.forEach((function(o,s){s.sequenceNumber<=t&&null===n.get(s.targetId)&&(r.Mr.delete(o),a.push(r.removeMatchingKeysForTargetId(e,s.targetId)),i++)})),Pi.waitFor(a).next((function(){return i}))}},{key:"getTargetCount",value:function(e){return Pi.resolve(this.targetCount)}},{key:"getTargetData",value:function(e,t){var n=this.Mr.get(t)||null;return Pi.resolve(n)}},{key:"addMatchingKeys",value:function(e,t,n){return this.Nr.dr(t,n),Pi.resolve()}},{key:"removeMatchingKeys",value:function(e,t,n){this.Nr.Rr(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((function(t){i.push(r.markPotentiallyOrphaned(e,t))})),Pi.waitFor(i)}},{key:"removeMatchingKeysForTargetId",value:function(e,t){return this.Nr.Vr(t),Pi.resolve()}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=this.Nr.gr(t);return Pi.resolve(n)}},{key:"containsKey",value:function(e,t){return Pi.resolve(this.Nr.containsKey(t))}}]),e}(),$s=function(){function e(t,n){var r=this;(0,v.Z)(this,e),this.Lr={},this.overlays={},this.kr=new ji(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new Xs(this),this.indexManager=new Fs,this.remoteDocumentCache=function(e){return new Qs(e)}((function(e){return r.referenceDelegate.Kr(e)})),this.serializer=new Os(n),this.$r=new Hs(this.serializer)}return(0,p.Z)(e,[{key:"start",value:function(){return Promise.resolve()}},{key:"shutdown",value:function(){return this.qr=!1,Promise.resolve()}},{key:"started",get:function(){return this.qr}},{key:"setDatabaseDeletedListener",value:function(){}},{key:"setNetworkEnabled",value:function(){}},{key:"getIndexManager",value:function(e){return this.indexManager}},{key:"getDocumentOverlayCache",value:function(e){var t=this.overlays[e.toKey()];return t||(t=new Ws,this.overlays[e.toKey()]=t),t}},{key:"getMutationQueue",value:function(e,t){var n=this.Lr[e.toKey()];return n||(n=new Ys(t,this.referenceDelegate),this.Lr[e.toKey()]=n),n}},{key:"getTargetCache",value:function(){return this.Qr}},{key:"getRemoteDocumentCache",value:function(){return this.remoteDocumentCache}},{key:"getBundleCache",value:function(){return this.$r}},{key:"runTransaction",value:function(e,t,n){var r=this;Kr("MemoryPersistence","Starting transaction:",e);var i=new eu(this.kr.next());return this.referenceDelegate.Ur(),n(i).next((function(e){return r.referenceDelegate.Wr(i).next((function(){return e}))})).toPromise().then((function(e){return i.raiseOnCommittedEvent(),e}))}},{key:"Gr",value:function(e,t){return Pi.or(Object.values(this.Lr).map((function(n){return function(){return n.containsKey(e,t)}})))}}]),e}(),eu=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this)).currentSequenceNumber=e,r}return(0,p.Z)(n)}(xi),tu=function(){function e(t){(0,v.Z)(this,e),this.persistence=t,this.zr=new Ks,this.jr=null}return(0,p.Z)(e,[{key:"Jr",get:function(){if(this.jr)return this.jr;throw Jr()}},{key:"addReference",value:function(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),Pi.resolve()}},{key:"removeReference",value:function(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),Pi.resolve()}},{key:"markPotentiallyOrphaned",value:function(e,t){return this.Jr.add(t.toString()),Pi.resolve()}},{key:"removeTarget",value:function(e,t){var n=this;this.zr.Vr(t.targetId).forEach((function(e){return n.Jr.add(e.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((function(e){e.forEach((function(e){return n.Jr.add(e.toString())}))})).next((function(){return r.removeTargetData(e,t)}))}},{key:"Ur",value:function(){this.jr=new Set}},{key:"Wr",value:function(e){var t=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Pi.forEach(this.Jr,(function(r){var i=wi.fromPath(r);return t.Yr(e,i).next((function(e){e||n.removeEntry(i,yi.min())}))})).next((function(){return t.jr=null,n.apply(e)}))}},{key:"updateLimboDocument",value:function(e,t){var n=this;return this.Yr(e,t).next((function(e){e?n.Jr.delete(t.toString()):n.Jr.add(t.toString())}))}},{key:"Kr",value:function(e){return 0}},{key:"Yr",value:function(e,t){var n=this;return Pi.or([function(){return Pi.resolve(n.zr.containsKey(t))},function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.Gr(e,t)}])}}],[{key:"Hr",value:function(t){return new e(t)}}]),e}();var nu=function(){function e(t,n,r,i){(0,v.Z)(this,e),this.targetId=t,this.fromCache=n,this.qi=r,this.Qi=i}return(0,p.Z)(e,null,[{key:"Ki",value:function(t,n){var r,i=No(),a=No(),o=(0,c.Z)(n.docChanges);try{for(o.s();!(r=o.n()).done;){var s=r.value;switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:a=a.add(s.doc.key)}}}catch(u){o.e(u)}finally{o.f()}return new e(t,n.fromCache,i,a)}}]),e}(),ru=function(){function e(){(0,v.Z)(this,e),this._documentReadCount=0}return(0,p.Z)(e,[{key:"documentReadCount",get:function(){return this._documentReadCount}},{key:"incrementDocumentReadCount",value:function(e){this._documentReadCount+=e}}]),e}(),iu=function(){function e(){(0,v.Z)(this,e),this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=(0,w.G6)()?8:Zi.v((0,w.z$)())>0?6:4}return(0,p.Z)(e,[{key:"initialize",value:function(e,t){this.zi=e,this.indexManager=t,this.$i=!0}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){var i=this,a={result:null};return this.ji(e,t).next((function(e){a.result=e})).next((function(){if(!a.result)return i.Hi(e,t,r,n).next((function(e){a.result=e}))})).next((function(){if(!a.result){var n=new ru;return i.Ji(e,t,n).next((function(r){if(a.result=r,i.Ui)return i.Yi(e,t,n,r.size)}))}})).next((function(){return a.result}))}},{key:"Yi",value:function(e,t,n,r){return n.documentReadCount<this.Wi?(Wr()<=k.in.DEBUG&&Kr("QueryEngine","SDK will not create cache indexes for query:",vo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),Pi.resolve()):(Wr()<=k.in.DEBUG&&Kr("QueryEngine","Query:",vo(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(Wr()<=k.in.DEBUG&&Kr("QueryEngine","The SDK decides to create cache indexes for query:",vo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,uo(t))):Pi.resolve())}},{key:"ji",value:function(e,t){var n=this;if(ao(t))return Pi.resolve(null);var r=uo(t);return this.indexManager.getIndexType(e,r).next((function(i){return 0===i?null:(null!==t.limit&&1===i&&(t=lo(t,null,"F"),r=uo(t)),n.indexManager.getDocumentsMatchingTarget(e,r).next((function(i){var a=No.apply(void 0,(0,d.Z)(i));return n.zi.getDocuments(e,a).next((function(i){return n.indexManager.getMinOffset(e,r).next((function(r){var o=n.Zi(t,i);return n.Xi(t,o,a,r.readTime)?n.ji(e,lo(t,null,"F")):n.es(e,o,t,r)}))}))})))}))}},{key:"Hi",value:function(e,t,n,r){var i=this;return ao(t)||r.isEqual(yi.min())?Pi.resolve(null):this.zi.getDocuments(e,n).next((function(a){var o=i.Zi(t,a);return i.Xi(t,o,n,r)?Pi.resolve(null):(Wr()<=k.in.DEBUG&&Kr("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),vo(t)),i.es(e,o,t,Ii(r,-1)).next((function(e){return e})))}))}},{key:"Zi",value:function(e,t){var n=new ea(yo(e));return t.forEach((function(t,r){po(e,r)&&(n=n.add(r))})),n}},{key:"Xi",value:function(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;var i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}},{key:"Ji",value:function(e,t,n){return Wr()<=k.in.DEBUG&&Kr("QueryEngine","Using full collection scan to execute query:",vo(t)),this.zi.getDocumentsMatchingQuery(e,t,Ti.min(),n)}},{key:"es",value:function(e,t,n,r){return this.zi.getDocumentsMatchingQuery(e,n,r).next((function(e){return t.forEach((function(t){e=e.insert(t.key,t)})),e}))}}]),e}(),au=function(){function e(t,n,r,i){(0,v.Z)(this,e),this.persistence=t,this.ts=n,this.serializer=i,this.ns=new Ji(di),this.rs=new mo((function(e){return eo(e)}),to),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(r)}return(0,p.Z)(e,[{key:"_s",value:function(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new zs(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}},{key:"collectGarbage",value:function(e){var t=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return e.collect(n,t.ns)}))}}]),e}();function ou(e,t,n,r){return new au(e,t,n,r)}function su(e,t){return uu.apply(this,arguments)}function uu(){return uu=(0,l.Z)(g().mark((function e(t,n){var r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=$r(t),e.next=3,r.persistence.runTransaction("Handle user change","readonly",(function(e){var t;return r.mutationQueue.getAllMutationBatches(e).next((function(i){return t=i,r._s(n),r.mutationQueue.getAllMutationBatches(e)})).next((function(n){var i,a=[],o=[],s=No(),u=(0,c.Z)(t);try{for(u.s();!(i=u.n()).done;){var l=i.value;a.push(l.batchId);var h,f=(0,c.Z)(l.mutations);try{for(f.s();!(h=f.n()).done;){var d=h.value;s=s.add(d.key)}}catch(k){f.e(k)}finally{f.f()}}}catch(k){u.e(k)}finally{u.f()}var v,p=(0,c.Z)(n);try{for(p.s();!(v=p.n()).done;){var y=v.value;o.push(y.batchId);var g,m=(0,c.Z)(y.mutations);try{for(m.s();!(g=m.n()).done;){var _=g.value;s=s.add(_.key)}}catch(k){m.e(k)}finally{m.f()}}}catch(k){p.e(k)}finally{p.f()}return r.localDocuments.getDocuments(e,s).next((function(e){return{us:e,removedBatchIds:a,addedBatchIds:o}}))}))}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),uu.apply(this,arguments)}function cu(e,t){var n=$r(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(e){var r=t.batch.keys(),i=n.os.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){var i=n.batch,a=i.keys(),o=Pi.resolve();return a.forEach((function(e){o=o.next((function(){return r.getEntry(t,e)})).next((function(t){var a=n.docVersions.get(e);Xr(null!==a),t.version.compareTo(a)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((function(){return e.mutationQueue.removeMutationBatch(t,i)}))}(n,e,t,i).next((function(){return i.apply(e)})).next((function(){return n.mutationQueue.performConsistencyCheck(e)})).next((function(){return n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)})).next((function(){return n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){for(var t=No(),n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))})).next((function(){return n.localDocuments.getDocuments(e,r)}))}))}function lu(e){var t=$r(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(function(e){return t.Qr.getLastRemoteSnapshotVersion(e)}))}function hu(e,t){var n=$r(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(e){return void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)}))}var fu=function(){function e(){(0,v.Z)(this,e),this.activeTargetIds=Po()}return(0,p.Z)(e,[{key:"As",value:function(e){this.activeTargetIds=this.activeTargetIds.add(e)}},{key:"Rs",value:function(e){this.activeTargetIds=this.activeTargetIds.delete(e)}},{key:"ds",value:function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}]),e}(),du=function(){function e(){(0,v.Z)(this,e),this.no=new fu,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return(0,p.Z)(e,[{key:"addPendingMutation",value:function(e){}},{key:"updateMutationState",value:function(e,t,n){}},{key:"addLocalQueryTarget",value:function(e){return this.no.As(e),this.ro[e]||"not-current"}},{key:"updateQueryState",value:function(e,t,n){this.ro[e]=t}},{key:"removeLocalQueryTarget",value:function(e){this.no.Rs(e)}},{key:"isLocalQueryTarget",value:function(e){return this.no.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){delete this.ro[e]}},{key:"getAllActiveQueryTargets",value:function(){return this.no.activeTargetIds}},{key:"isActiveQueryTarget",value:function(e){return this.no.activeTargetIds.has(e)}},{key:"start",value:function(){return this.no=new fu,Promise.resolve()}},{key:"handleUserChange",value:function(e,t,n){}},{key:"setOnlineState",value:function(e){}},{key:"shutdown",value:function(){}},{key:"writeSequenceNumber",value:function(e){}},{key:"notifyBundleLoaded",value:function(e){}}]),e}(),vu=function(){function e(){(0,v.Z)(this,e)}return(0,p.Z)(e,[{key:"io",value:function(e){}},{key:"shutdown",value:function(){}}]),e}(),pu=function(){function e(){var t=this;(0,v.Z)(this,e),this.so=function(){return t.oo()},this._o=function(){return t.ao()},this.uo=[],this.co()}return(0,p.Z)(e,[{key:"io",value:function(e){this.uo.push(e)}},{key:"shutdown",value:function(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}},{key:"co",value:function(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}},{key:"oo",value:function(){Kr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");var e,t=(0,c.Z)(this.uo);try{for(t.s();!(e=t.n()).done;){(0,e.value)(0)}}catch(n){t.e(n)}finally{t.f()}}},{key:"ao",value:function(){Kr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");var e,t=(0,c.Z)(this.uo);try{for(t.s();!(e=t.n()).done;){(0,e.value)(1)}}catch(n){t.e(n)}finally{t.f()}}}],[{key:"D",value:function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}]),e}(),yu=null;function gu(){return null===yu?yu=268435456+Math.round(2147483648*Math.random()):yu++,"0x"+yu.toString(16)}var mu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},_u=function(){function e(t){(0,v.Z)(this,e),this.lo=t.lo,this.ho=t.ho}return(0,p.Z)(e,[{key:"Po",value:function(e){this.Io=e}},{key:"To",value:function(e){this.Eo=e}},{key:"onMessage",value:function(e){this.Ao=e}},{key:"close",value:function(){this.ho()}},{key:"send",value:function(e){this.lo(e)}},{key:"Ro",value:function(){this.Io()}},{key:"Vo",value:function(e){this.Eo(e)}},{key:"mo",value:function(e){this.Ao(e)}}]),e}(),ku="WebChannelConnection",wu=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,v.Z)(this,n),(r=t.call(this,e)).forceLongPolling=e.forceLongPolling,r.autoDetectLongPolling=e.autoDetectLongPolling,r.useFetchStreams=e.useFetchStreams,r.longPollingOptions=e.longPollingOptions,r}return(0,p.Z)(n,[{key:"Co",value:function(e,t,n,r){var i=gu();return new Promise((function(a,o){var s=new Vr;s.setWithCredentials(!0),s.listenOnce(Lr.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case Or.NO_ERROR:var t=s.getResponseJson();Kr(ku,"XHR for RPC '".concat(e,"' ").concat(i," received:"),JSON.stringify(t)),a(t);break;case Or.TIMEOUT:Kr(ku,"RPC '".concat(e,"' ").concat(i," timed out")),o(new ti(ei.DEADLINE_EXCEEDED,"Request time out"));break;case Or.HTTP_ERROR:var n=s.getStatus();if(Kr(ku,"RPC '".concat(e,"' ").concat(i," failed with status:"),n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson();Array.isArray(r)&&(r=r[0]);var u=null==r?void 0:r.error;if(u&&u.status&&u.message){var c=function(e){var t=e.toLowerCase().replace(/_/g,"-");return Object.values(ei).indexOf(t)>=0?t:ei.UNKNOWN}(u.status);o(new ti(c,u.message))}else o(new ti(ei.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new ti(ei.UNAVAILABLE,"Connection failed."));break;default:Jr()}}finally{Kr(ku,"RPC '".concat(e,"' ").concat(i," completed."))}}));var u=JSON.stringify(r);Kr(ku,"RPC '".concat(e,"' ").concat(i," sending request:"),r),s.send(t,"POST",u,n,15)}))}},{key:"Fo",value:function(e,t,n){var r=gu(),i=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Zr(),o=Dr(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;void 0!==u&&(s.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(s.useFetchStreams=!0),this.Do(s.initMessageHeaders,t,n),s.encodeInitMessageHeaders=!0;var c=i.join("");Kr(ku,"Creating RPC '".concat(e,"' stream ").concat(r,": ").concat(c),s);var l=a.createWebChannel(c,s),h=!1,f=!1,d=new _u({lo:function(t){f?Kr(ku,"Not sending because RPC '".concat(e,"' stream ").concat(r," is closed:"),t):(h||(Kr(ku,"Opening RPC '".concat(e,"' stream ").concat(r," transport.")),l.open(),h=!0),Kr(ku,"RPC '".concat(e,"' stream ").concat(r," sending:"),t),l.send(t))},ho:function(){return l.close()}}),v=function(e,t,n){e.listen(t,(function(e){try{n(e)}catch(e){setTimeout((function(){throw e}),0)}}))};return v(l,Ur.EventType.OPEN,(function(){f||Kr(ku,"RPC '".concat(e,"' stream ").concat(r," transport opened."))})),v(l,Ur.EventType.CLOSE,(function(){f||(f=!0,Kr(ku,"RPC '".concat(e,"' stream ").concat(r," transport closed")),d.Vo())})),v(l,Ur.EventType.ERROR,(function(t){f||(f=!0,Yr(ku,"RPC '".concat(e,"' stream ").concat(r," transport errored:"),t),d.Vo(new ti(ei.UNAVAILABLE,"The operation could not be completed")))})),v(l,Ur.EventType.MESSAGE,(function(t){var n;if(!f){var i=t.data[0];Xr(!!i);var a=i,o=a.error||(null===(n=a[0])||void 0===n?void 0:n.error);if(o){Kr(ku,"RPC '".concat(e,"' stream ").concat(r," received error:"),o);var s=o.status,u=function(e){var t=ss[e];if(void 0!==t)return ps(t)}(s),c=o.message;void 0===u&&(u=ei.INTERNAL,c="Unknown error status: "+s+" with message "+o.message),f=!0,d.Vo(new ti(u,c)),l.close()}else Kr(ku,"RPC '".concat(e,"' stream ").concat(r," received:"),i),d.mo(i)}})),v(o,Mr.STAT_EVENT,(function(t){t.stat===Fr.PROXY?Kr(ku,"RPC '".concat(e,"' stream ").concat(r," detected buffering proxy")):t.stat===Fr.NOPROXY&&Kr(ku,"RPC '".concat(e,"' stream ").concat(r," detected no buffering proxy"))})),setTimeout((function(){d.Ro()}),0),d}}]),n}(function(){function e(t){(0,v.Z)(this,e),this.databaseInfo=t,this.databaseId=t.databaseId;var n=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.fo=n+"://"+t.host,this.po="projects/".concat(r,"/databases/").concat(i),this.yo="(default)"===this.databaseId.database?"project_id=".concat(r):"project_id=".concat(r,"&database_id=").concat(i)}return(0,p.Z)(e,[{key:"wo",get:function(){return!1}},{key:"So",value:function(e,t,n,r,i){var a=gu(),o=this.bo(e,t.toUriEncodedString());Kr("RestConnection","Sending RPC '".concat(e,"' ").concat(a,":"),o,n);var s={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(s,r,i),this.Co(e,o,s,n).then((function(t){return Kr("RestConnection","Received RPC '".concat(e,"' ").concat(a,": "),t),t}),(function(t){throw Yr("RestConnection","RPC '".concat(e,"' ").concat(a," failed with error: "),t,"url: ",o,"request:",n),t}))}},{key:"vo",value:function(e,t,n,r,i,a){return this.So(e,t,n,r,i)}},{key:"Do",value:function(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+zr,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((function(t,n){return e[n]=t})),n&&n.headers.forEach((function(t,n){return e[n]=t}))}},{key:"bo",value:function(e,t){var n=mu[e];return"".concat(this.fo,"/v1/").concat(t,":").concat(n)}},{key:"terminate",value:function(){}}]),e}());function bu(){return"undefined"!=typeof document?document:null}function Iu(e){return new ys(e,!0)}var Eu=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;(0,v.Z)(this,e),this.oi=t,this.timerId=n,this.Mo=r,this.xo=i,this.Oo=a,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}return(0,p.Z)(e,[{key:"reset",value:function(){this.No=0}},{key:"ko",value:function(){this.No=this.Oo}},{key:"qo",value:function(e){var t=this;this.cancel();var n=Math.floor(this.No+this.Qo()),r=Math.max(0,Date.now()-this.Lo),i=Math.max(0,n-r);i>0&&Kr("ExponentialBackoff","Backing off for ".concat(i," ms (base delay: ").concat(this.No," ms, delay with jitter: ").concat(n," ms, last attempt: ").concat(r," ms ago)")),this.Bo=this.oi.enqueueAfterDelay(this.timerId,i,(function(){return t.Lo=Date.now(),e()})),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}},{key:"Ko",value:function(){null!==this.Bo&&(this.Bo.skipDelay(),this.Bo=null)}},{key:"cancel",value:function(){null!==this.Bo&&(this.Bo.cancel(),this.Bo=null)}},{key:"Qo",value:function(){return(Math.random()-.5)*this.No}}]),e}(),Tu=function(){function e(t,n,r,i,a,o,s,u){(0,v.Z)(this,e),this.oi=t,this.$o=r,this.Uo=i,this.connection=a,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=s,this.listener=u,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new Eu(t,n)}return(0,p.Z)(e,[{key:"Ho",value:function(){return 1===this.state||5===this.state||this.Jo()}},{key:"Jo",value:function(){return 2===this.state||3===this.state}},{key:"start",value:function(){4!==this.state?this.auth():this.Yo()}},{key:"stop",value:function(){var e=(0,l.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.Ho(),!e.t0){e.next=4;break}return e.next=4,this.close(0);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Zo",value:function(){this.state=0,this.jo.reset()}},{key:"Xo",value:function(){var e=this;this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,(function(){return e.e_()})))}},{key:"t_",value:function(e){this.n_(),this.stream.send(e)}},{key:"e_",value:function(){var e=(0,l.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.Jo()){e.next=2;break}return e.abrupt("return",this.close(0));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"n_",value:function(){this.Go&&(this.Go.cancel(),this.Go=null)}},{key:"r_",value:function(){this.zo&&(this.zo.cancel(),this.zo=null)}},{key:"close",value:function(){var e=(0,l.Z)(g().mark((function e(t,n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==t?this.jo.reset():n&&n.code===ei.RESOURCE_EXHAUSTED?(Gr(n.toString()),Gr("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):n&&n.code===ei.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=t,e.next=9,this.listener.To(n);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"i_",value:function(){}},{key:"auth",value:function(){var e=this;this.state=1;var t=this.s_(this.Wo),n=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((function(t){var r=(0,s.Z)(t,2),i=r[0],a=r[1];e.Wo===n&&e.o_(i,a)}),(function(n){t((function(){var t=new ti(ei.UNKNOWN,"Fetching auth token failed: "+n.message);return e.__(t)}))}))}},{key:"o_",value:function(e,t){var n=this,r=this.s_(this.Wo);this.stream=this.a_(e,t),this.stream.Po((function(){r((function(){return n.state=2,n.zo=n.oi.enqueueAfterDelay(n.Uo,1e4,(function(){return n.Jo()&&(n.state=3),Promise.resolve()})),n.listener.Po()}))})),this.stream.To((function(e){r((function(){return n.__(e)}))})),this.stream.onMessage((function(e){r((function(){return n.onMessage(e)}))}))}},{key:"Yo",value:function(){var e=this;this.state=5,this.jo.qo((0,l.Z)(g().mark((function t(){return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.state=0,e.start();case 1:case"end":return t.stop()}}),t)}))))}},{key:"__",value:function(e){return Kr("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}},{key:"s_",value:function(e){var t=this;return function(n){t.oi.enqueueAndForget((function(){return t.Wo===e?n():(Kr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}}}]),e}(),Cu=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,i,a,o,s){var u;return(0,v.Z)(this,n),(u=t.call(this,e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,i,a,s)).serializer=o,u.h_=!1,u}return(0,p.Z)(n,[{key:"P_",get:function(){return this.h_}},{key:"start",value:function(){this.h_=!1,this.lastStreamToken=void 0,(0,a.Z)((0,o.Z)(n.prototype),"start",this).call(this)}},{key:"i_",value:function(){this.h_&&this.I_([])}},{key:"a_",value:function(e,t){return this.connection.Fo("Write",e,t)}},{key:"onMessage",value:function(e){if(Xr(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();var t=function(e,t){return e&&e.length>0?(Xr(void 0!==t),e.map((function(e){return function(e,t){var n=e.updateTime?ks(e.updateTime):ks(t);return n.isEqual(yi.min())&&(n=ks(t)),new Ko(n,e.transformResults||[])}(e,t)}))):[]}(e.writeResults,e.commitTime),n=ks(e.commitTime);return this.listener.T_(n,t)}return Xr(!e.writeResults||0===e.writeResults.length),this.h_=!0,this.listener.E_()}},{key:"d_",value:function(){var e={};e.database=Cs(this.serializer),this.t_(e)}},{key:"I_",value:function(e){var t=this,n={streamToken:this.lastStreamToken,writes:e.map((function(e){return Ns(t.serializer,e)}))};this.t_(n)}}]),n}(Tu),Su=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,i,a){var o;return(0,v.Z)(this,n),(o=t.call(this)).authCredentials=e,o.appCheckCredentials=r,o.connection=i,o.serializer=a,o.A_=!1,o}return(0,p.Z)(n,[{key:"R_",value:function(){if(this.A_)throw new ti(ei.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"So",value:function(e,t,n,r){var i=this;return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((function(a){var o=(0,s.Z)(a,2),u=o[0],c=o[1];return i.connection.So(e,bs(t,n),r,u,c)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===ei.UNAUTHENTICATED&&(i.authCredentials.invalidateToken(),i.appCheckCredentials.invalidateToken()),e):new ti(ei.UNKNOWN,e.toString())}))}},{key:"vo",value:function(e,t,n,r,i){var a=this;return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((function(o){var u=(0,s.Z)(o,2),c=u[0],l=u[1];return a.connection.vo(e,bs(t,n),r,c,l,i)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===ei.UNAUTHENTICATED&&(a.authCredentials.invalidateToken(),a.appCheckCredentials.invalidateToken()),e):new ti(ei.UNKNOWN,e.toString())}))}},{key:"terminate",value:function(){this.A_=!0,this.connection.terminate()}}]),n}((0,p.Z)((function e(){(0,v.Z)(this,e)})));var xu=function(){function e(t,n){(0,v.Z)(this,e),this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}return(0,p.Z)(e,[{key:"p_",value:function(){var e=this;0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return e.f_=null,e.w_("Backend didn't respond within 10 seconds."),e.y_("Offline"),Promise.resolve()})))}},{key:"S_",value:function(e){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.y_("Offline")))}},{key:"set",value:function(e){this.b_(),this.m_=0,"Online"===e&&(this.g_=!1),this.y_(e)}},{key:"y_",value:function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}},{key:"w_",value:function(e){var t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.g_?(Gr(t),this.g_=!1):Kr("OnlineStateTracker",t)}},{key:"b_",value:function(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}]),e}(),Nu=(0,p.Z)((function e(t,n,r,i,a){var o=this;(0,v.Z)(this,e),this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=a,this.M_.io((function(e){r.enqueueAndForget((0,l.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=Du(o),!e.t0){e.next=5;break}return Kr("RemoteStore","Restarting streams for network reachability change."),e.next=5,function(){var e=(0,l.Z)(g().mark((function e(t){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=$r(t)).v_.add(4),e.next=4,Ru(n);case 4:return n.x_.set("Unknown"),n.v_.delete(4),e.next=8,Au(n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(o);case 5:case"end":return e.stop()}}),e)}))))})),this.x_=new xu(r,i)}));function Au(e){return Pu.apply(this,arguments)}function Pu(){return(Pu=(0,l.Z)(g().mark((function e(t){var n,r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Du(t)){e.next=18;break}n=(0,c.Z)(t.F_),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return i=r.value,e.next=8,i(!0);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,12,15,18]])})))).apply(this,arguments)}function Ru(e){return Zu.apply(this,arguments)}function Zu(){return(Zu=(0,l.Z)(g().mark((function e(t){var n,r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(0,c.Z)(t.F_),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return i=r.value,e.next=7,i(!1);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})))).apply(this,arguments)}function Du(e){return 0===$r(e).v_.size}function Ou(e,t,n){return Lu.apply(this,arguments)}function Lu(){return(Lu=(0,l.Z)(g().mark((function e(t,n,r){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Li(n)){e.next=2;break}throw n;case 2:return t.v_.add(1),e.next=5,Ru(t);case 5:t.x_.set("Offline"),r||(r=function(){return lu(t.localStore)}),t.asyncQueue.enqueueRetryable((0,l.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Kr("RemoteStore","Retrying IndexedDB access"),e.next=3,r();case 3:return t.v_.delete(1),e.next=6,Au(t);case 6:case"end":return e.stop()}}),e)}))));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Mu(e,t){return t().catch((function(n){return Ou(e,n,t)}))}function Fu(e){return Uu.apply(this,arguments)}function Uu(){return Uu=(0,l.Z)(g().mark((function e(t){var n,r,i,a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=$r(t),r=nc(n),i=n.D_.length>0?n.D_[n.D_.length-1].batchId:-1;case 2:if(!Vu(n)){e.next=19;break}return e.prev=3,e.next=6,hu(n.localStore,i);case 6:if(null!==(a=e.sent)){e.next=10;break}return 0===n.D_.length&&r.Xo(),e.abrupt("break",19);case 10:i=a.batchId,ju(n,a),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(3),e.next=17,Ou(n,e.t0);case 17:e.next=2;break;case 19:qu(n)&&Bu(n);case 20:case"end":return e.stop()}}),e,null,[[3,13]])}))),Uu.apply(this,arguments)}function Vu(e){return Du(e)&&e.D_.length<10}function ju(e,t){e.D_.push(t);var n=nc(e);n.Jo()&&n.P_&&n.I_(t.mutations)}function qu(e){return Du(e)&&!nc(e).Ho()&&e.D_.length>0}function Bu(e){nc(e).start()}function zu(e){return Hu.apply(this,arguments)}function Hu(){return(Hu=(0,l.Z)(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:nc(t).d_();case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wu(e){return Ku.apply(this,arguments)}function Ku(){return(Ku=(0,l.Z)(g().mark((function e(t){var n,r,i,a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=nc(t),r=(0,c.Z)(t.D_);try{for(r.s();!(i=r.n()).done;)a=i.value,n.I_(a.mutations)}catch(o){r.e(o)}finally{r.f()}case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gu(e,t,n){return Yu.apply(this,arguments)}function Yu(){return Yu=(0,l.Z)(g().mark((function e(t,n,r){var i,a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.D_.shift(),a=fs.from(i,n,r),e.next=3,Mu(t,(function(){return t.remoteSyncer.applySuccessfulWrite(a)}));case 3:return e.next=5,Fu(t);case 5:case"end":return e.stop()}}),e)}))),Yu.apply(this,arguments)}function Qu(e,t){return Ju.apply(this,arguments)}function Ju(){return Ju=(0,l.Z)(g().mark((function e(t,n){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n&&nc(t).P_,!e.t0){e.next=4;break}return e.next=4,function(){var e=(0,l.Z)(g().mark((function e(t,n){var r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!function(e){return vs(e)&&e!==ei.ABORTED}(n.code)){e.next=7;break}return r=t.D_.shift(),nc(t).Zo(),e.next=5,Mu(t,(function(){return t.remoteSyncer.rejectFailedWrite(r.batchId,n)}));case 5:return e.next=7,Fu(t);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:qu(t)&&Bu(t);case 5:case"end":return e.stop()}}),e)}))),Ju.apply(this,arguments)}function Xu(e,t){return $u.apply(this,arguments)}function $u(){return $u=(0,l.Z)(g().mark((function e(t,n){var r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=$r(t)).asyncQueue.verifyOperationInProgress(),Kr("RemoteStore","RemoteStore received new credentials"),i=Du(r),r.v_.add(3),e.next=6,Ru(r);case 6:return i&&r.x_.set("Unknown"),e.next=9,r.remoteSyncer.handleCredentialChange(n);case 9:return r.v_.delete(3),e.next=12,Au(r);case 12:case"end":return e.stop()}}),e)}))),$u.apply(this,arguments)}function ec(e,t){return tc.apply(this,arguments)}function tc(){return(tc=(0,l.Z)(g().mark((function e(t,n){var r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=$r(t),!n){e.next=7;break}return r.v_.delete(2),e.next=5,Au(r);case 5:e.next=13;break;case 7:if(e.t0=n,e.t0){e.next=13;break}return r.v_.add(2),e.next=12,Ru(r);case 12:r.x_.set("Unknown");case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nc(e){return e.B_||(e.B_=function(e,t,n){var r=$r(e);return r.R_(),new Cu(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:zu.bind(null,e),To:Qu.bind(null,e),E_:Wu.bind(null,e),T_:Gu.bind(null,e)}),e.F_.push(function(){var t=(0,l.Z)(g().mark((function t(n){return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return e.B_.Zo(),t.next=4,Fu(e);case 4:t.next=9;break;case 6:return t.next=8,e.B_.stop();case 8:e.D_.length>0&&(Kr("RemoteStore","Stopping write stream with ".concat(e.D_.length," pending writes")),e.D_=[]);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),e.B_}var rc=function(){function e(t,n,r,i,a){(0,v.Z)(this,e),this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=a,this.deferred=new ni,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(e){}))}return(0,p.Z)(e,[{key:"promise",get:function(){return this.deferred.promise}},{key:"start",value:function(e){var t=this;this.timerHandle=setTimeout((function(){return t.handleDelayElapsed()}),e)}},{key:"skipDelay",value:function(){return this.handleDelayElapsed()}},{key:"cancel",value:function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ti(ei.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}},{key:"handleDelayElapsed",value:function(){var e=this;this.asyncQueue.enqueueAndForget((function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then((function(t){return e.deferred.resolve(t)}))):Promise.resolve()}))}},{key:"clearTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}))}],[{key:"createAndSchedule",value:function(t,n,r,i,a){var o=new e(t,n,Date.now()+r,i,a);return o.start(r),o}}]),e}();function ic(e,t){if(Gr("AsyncQueue","".concat(t,": ").concat(e)),Li(e))return new ti(ei.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}var ac=(0,p.Z)((function e(){(0,v.Z)(this,e),this.queries=new mo((function(e){return fo(e)}),ho),this.onlineState="Unknown",this.K_=new Set}));function oc(e){e.K_.forEach((function(e){e.next()}))}var sc=function(){function e(t,n,r,i,a,o){(0,v.Z)(this,e),this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=o,this.fa={},this.ga=new mo((function(e){return fo(e)}),ho),this.pa=new Map,this.ya=new Set,this.wa=new Ji(wi.comparator),this.Sa=new Map,this.ba=new Ks,this.Da={},this.Ca=new Map,this.va=js.Bn(),this.onlineState="Unknown",this.Fa=void 0}return(0,p.Z)(e,[{key:"isPrimaryClient",get:function(){return!0===this.Fa}}]),e}();function uc(e,t,n){return cc.apply(this,arguments)}function cc(){return cc=(0,l.Z)(g().mark((function e(t,n,r){var i,a,o;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=wc(t),e.prev=1,e.next=4,function(e,t){var n,r,i=$r(e),a=pi.now(),o=t.reduce((function(e,t){return e.add(t.key)}),No());return i.persistence.runTransaction("Locally write mutations","readwrite",(function(e){var s=ko(),u=No();return i.os.getEntries(e,o).next((function(e){(s=e).forEach((function(e,t){t.isValidDocument()||(u=u.add(e))}))})).next((function(){return i.localDocuments.getOverlayedDocuments(e,s)})).next((function(r){n=r;var o,s=[],u=(0,c.Z)(t);try{for(u.s();!(o=u.n()).done;){var l=o.value,h=es(l,n.get(l.key).overlayedDocument);null!=h&&s.push(new rs(l.key,h,xa(h.value.mapValue),Go.exists(!0)))}}catch(f){u.e(f)}finally{u.f()}return i.mutationQueue.addMutationBatch(e,a,s,t)})).next((function(t){r=t;var a=t.applyToLocalDocumentSet(n,u);return i.documentOverlayCache.saveOverlays(e,t.batchId,a)}))})).then((function(){return{batchId:r.batchId,changes:Io(n)}}))}(i.localStore,n);case 4:return a=e.sent,i.sharedClientState.addPendingMutation(a.batchId),function(e,t,n){var r=e.Da[e.currentUser.toKey()];r||(r=new Ji(di)),r=r.insert(t,n),e.Da[e.currentUser.toKey()]=r}(i,a.batchId,r),e.next=9,gc(i,a.changes);case 9:return e.next=11,Fu(i.remoteStore);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),o=ic(e.t0,"Failed to persist write"),r.reject(o);case 17:case"end":return e.stop()}}),e,null,[[1,13]])}))),cc.apply(this,arguments)}function lc(e,t,n){var r=$r(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.ga.forEach((function(e,n){var r=n.view.U_(t);r.snapshot&&i.push(r.snapshot)})),function(e,t){var n=$r(e);n.onlineState=t;var r=!1;n.queries.forEach((function(e,n){var i,a=(0,c.Z)(n.Q_);try{for(a.s();!(i=a.n()).done;){i.value.U_(t)&&(r=!0)}}catch(o){a.e(o)}finally{a.f()}})),r&&oc(n)}(r.eventManager,t),i.length&&r.fa.u_(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function hc(e,t){return fc.apply(this,arguments)}function fc(){return fc=(0,l.Z)(g().mark((function e(t,n){var r,i,a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=$r(t),i=n.batch.batchId,e.prev=1,e.next=4,cu(r.localStore,n);case 4:return a=e.sent,yc(r,i,null),pc(r,i),r.sharedClientState.updateMutationState(i,"acknowledged"),e.next=10,gc(r,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,Ni(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])}))),fc.apply(this,arguments)}function dc(e,t,n){return vc.apply(this,arguments)}function vc(){return vc=(0,l.Z)(g().mark((function e(t,n,r){var i,a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=$r(t),e.prev=1,e.next=4,function(e,t){var n=$r(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(e){var r;return n.mutationQueue.lookupMutationBatch(e,t).next((function(t){return Xr(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)})).next((function(){return n.mutationQueue.performConsistencyCheck(e)})).next((function(){return n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)})).next((function(){return n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)})).next((function(){return n.localDocuments.getDocuments(e,r)}))}))}(i.localStore,n);case 4:return a=e.sent,yc(i,n,r),pc(i,n),i.sharedClientState.updateMutationState(n,"rejected",r),e.next=10,gc(i,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,Ni(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])}))),vc.apply(this,arguments)}function pc(e,t){(e.Ca.get(t)||[]).forEach((function(e){e.resolve()})),e.Ca.delete(t)}function yc(e,t,n){var r=$r(e),i=r.Da[r.currentUser.toKey()];if(i){var a=i.get(t);a&&(n?a.reject(n):a.resolve(),i=i.remove(t)),r.Da[r.currentUser.toKey()]=i}}function gc(e,t,n){return mc.apply(this,arguments)}function mc(){return mc=(0,l.Z)(g().mark((function e(t,n,r){var i,a,o,s;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=$r(t),a=[],o=[],s=[],e.t0=i.ga.isEmpty(),e.t0){e.next=9;break}return i.ga.forEach((function(e,t){s.push(i.Ma(t,n,r).then((function(e){if((e||r)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(t.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){a.push(e);var n=nu.Ki(t.targetId,e);o.push(n)}})))})),e.next=6,Promise.all(s);case 6:return i.fa.u_(a),e.next=9,function(){var e=(0,l.Z)(g().mark((function e(t,n){var r,i,a,o,s,u,l,h;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=$r(t),e.prev=1,e.next=4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(e){return Pi.forEach(n,(function(t){return Pi.forEach(t.qi,(function(n){return r.persistence.referenceDelegate.addReference(e,t.targetId,n)})).next((function(){return Pi.forEach(t.Qi,(function(n){return r.persistence.referenceDelegate.removeReference(e,t.targetId,n)}))}))}))}));case 4:e.next=11;break;case 6:if(e.prev=6,e.t0=e.catch(1),Li(e.t0)){e.next=10;break}throw e.t0;case 10:Kr("LocalStore","Failed to update sequence numbers: "+e.t0);case 11:i=(0,c.Z)(n);try{for(i.s();!(a=i.n()).done;)o=a.value,s=o.targetId,o.fromCache||(u=r.ns.get(s),l=u.snapshotVersion,h=u.withLastLimboFreeSnapshotVersion(l),r.ns=r.ns.insert(s,h))}catch(f){i.e(f)}finally{i.f()}case 13:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,n){return e.apply(this,arguments)}}()(i.localStore,o);case 9:case"end":return e.stop()}}),e)}))),mc.apply(this,arguments)}function _c(e,t){return kc.apply(this,arguments)}function kc(){return(kc=(0,l.Z)(g().mark((function e(t,n){var r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=$r(t)).currentUser.isEqual(n)){e.next=11;break}return Kr("SyncEngine","User change. New user:",n.toKey()),e.next=5,su(r.localStore,n);case 5:return i=e.sent,r.currentUser=n,function(e,t){e.Ca.forEach((function(e){e.forEach((function(e){e.reject(new ti(ei.CANCELLED,t))}))})),e.Ca.clear()}(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(n,i.removedBatchIds,i.addedBatchIds),e.next=11,gc(r,i.us);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wc(e){var t=$r(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=hc.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=dc.bind(null,t),t}var bc=function(){function e(){(0,v.Z)(this,e),this.synchronizeTabs=!1}return(0,p.Z)(e,[{key:"initialize",value:function(){var e=(0,l.Z)(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.serializer=Iu(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),e.next=5,this.persistence.start();case 5:this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createGarbageCollectionScheduler",value:function(e,t){return null}},{key:"createIndexBackfillerScheduler",value:function(e,t){return null}},{key:"createLocalStore",value:function(e){return ou(this.persistence,new iu,e.initialUser,this.serializer)}},{key:"createPersistence",value:function(e){return new $s(tu.Hr,this.serializer)}},{key:"createSharedClientState",value:function(e){return new du}},{key:"terminate",value:function(){var e=(0,l.Z)(g().mark((function e(){var t,n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(n=this.indexBackfillerScheduler)||void 0===n||n.stop(),this.sharedClientState.shutdown(),e.next=5,this.persistence.shutdown();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),Ic=function(){function e(){(0,v.Z)(this,e)}return(0,p.Z)(e,[{key:"initialize",value:function(){var e=(0,l.Z)(g().mark((function e(t,n){var r=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.localStore,e.t0){e.next=12;break}return this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(e){return lc(r.syncEngine,e,1)},this.remoteStore.remoteSyncer.handleCredentialChange=_c.bind(null,this.syncEngine),e.next=12,ec(this.remoteStore,this.syncEngine.isPrimaryClient);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createEventManager",value:function(e){return new ac}},{key:"createDatastore",value:function(e){var t=Iu(e.databaseInfo.databaseId),n=function(e){return new wu(e)}(e.databaseInfo);return function(e,t,n,r){return new Su(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}},{key:"createRemoteStore",value:function(e){var t=this;return function(e,t,n,r,i){return new Nu(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(function(e){return lc(t.syncEngine,e,0)}),pu.D()?new pu:new vu)}},{key:"createSyncEngine",value:function(e,t){return function(e,t,n,r,i,a,o){var s=new sc(e,t,n,r,i,a);return o&&(s.Fa=!0),s}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}},{key:"terminate",value:function(){var e=(0,l.Z)(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,function(){var e=(0,l.Z)(g().mark((function e(t){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=$r(t),Kr("RemoteStore","RemoteStore shutting down."),n.v_.add(5),e.next=5,Ru(n);case 5:n.M_.shutdown(),n.x_.set("Unknown");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(this.remoteStore);case 2:null===(t=this.datastore)||void 0===t||t.terminate();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();var Ec=function(){function e(t,n,r,i){var a=this;(0,v.Z)(this,e),this.authCredentials=t,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=Br.UNAUTHENTICATED,this.clientId=fi.newId(),this.authCredentialListener=function(){return Promise.resolve()},this.appCheckCredentialListener=function(){return Promise.resolve()},this.authCredentials.start(r,function(){var e=(0,l.Z)(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Kr("FirestoreClient","Received user=",t.uid),e.next=3,a.authCredentialListener(t);case 3:a.user=t;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.appCheckCredentials.start(r,(function(e){return Kr("FirestoreClient","Received new app check token=",e),a.appCheckCredentialListener(e,a.user)}))}return(0,p.Z)(e,[{key:"configuration",get:function(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}},{key:"setCredentialChangeListener",value:function(e){this.authCredentialListener=e}},{key:"setAppCheckTokenChangeListener",value:function(e){this.appCheckCredentialListener=e}},{key:"verifyNotTerminated",value:function(){if(this.asyncQueue.isShuttingDown)throw new ti(ei.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"terminate",value:function(){var e=this;this.asyncQueue.enterRestrictedMode();var t=new ni;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,l.Z)(g().mark((function n(){var r;return g().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,n.t0=e._onlineComponents,!n.t0){n.next=5;break}return n.next=5,e._onlineComponents.terminate();case 5:if(n.t1=e._offlineComponents,!n.t1){n.next=9;break}return n.next=9,e._offlineComponents.terminate();case 9:e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve(),n.next=18;break;case 14:n.prev=14,n.t2=n.catch(0),r=ic(n.t2,"Failed to shutdown persistence"),t.reject(r);case 18:case"end":return n.stop()}}),n,null,[[0,14]])})))),t.promise}}]),e}();function Tc(e,t){return Cc.apply(this,arguments)}function Cc(){return Cc=(0,l.Z)(g().mark((function e(t,n){var r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),Kr("FirestoreClient","Initializing OfflineComponentProvider"),r=t.configuration,e.next=4,n.initialize(r);case 4:i=r.initialUser,t.setCredentialChangeListener(function(){var e=(0,l.Z)(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i.isEqual(t),e.t0){e.next=5;break}return e.next=4,su(n.localStore,t);case 4:i=t;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t._offlineComponents=n;case 6:case"end":return e.stop()}}),e)}))),Cc.apply(this,arguments)}function Sc(e,t){return xc.apply(this,arguments)}function xc(){return(xc=(0,l.Z)(g().mark((function e(t,n){var r;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),e.next=3,Ac(t);case 3:return r=e.sent,Kr("FirestoreClient","Initializing OnlineComponentProvider"),e.next=7,n.initialize(r,t.configuration);case 7:t.setCredentialChangeListener((function(e){return Xu(n.remoteStore,e)})),t.setAppCheckTokenChangeListener((function(e,t){return Xu(n.remoteStore,t)})),t._onlineComponents=n;case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Nc(e){return"FirebaseError"===e.name?e.code===ei.FAILED_PRECONDITION||e.code===ei.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}function Ac(e){return Pc.apply(this,arguments)}function Pc(){return(Pc=(0,l.Z)(g().mark((function e(t){var n;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t._offlineComponents){e.next=21;break}if(!t._uninitializedComponentsProvider){e.next=18;break}return Kr("FirestoreClient","Using user provided OfflineComponentProvider"),e.prev=3,e.next=6,Tc(t,t._uninitializedComponentsProvider._offline);case 6:e.next=16;break;case 8:if(e.prev=8,e.t0=e.catch(3),Nc(n=e.t0)){e.next=13;break}throw n;case 13:return Yr("Error using user provided cache. Falling back to memory cache: "+n),e.next=16,Tc(t,new bc);case 16:e.next=21;break;case 18:return Kr("FirestoreClient","Using default OfflineComponentProvider"),e.next=21,Tc(t,new bc);case 21:return e.abrupt("return",t._offlineComponents);case 22:case"end":return e.stop()}}),e,null,[[3,8]])})))).apply(this,arguments)}function Rc(e){return Zc.apply(this,arguments)}function Zc(){return(Zc=(0,l.Z)(g().mark((function e(t){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t._onlineComponents,e.t0){e.next=11;break}if(!t._uninitializedComponentsProvider){e.next=8;break}return Kr("FirestoreClient","Using user provided OnlineComponentProvider"),e.next=6,Sc(t,t._uninitializedComponentsProvider._online);case 6:e.next=11;break;case 8:return Kr("FirestoreClient","Using default OnlineComponentProvider"),e.next=11,Sc(t,new Ic);case 11:return e.abrupt("return",t._onlineComponents);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dc(e){return Rc(e).then((function(e){return e.syncEngine}))}function Oc(e){var t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}var Lc=new Map;function Mc(e,t,n){if(!n)throw new ti(ei.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function Fc(e){if(!wi.isDocumentKey(e))throw new ti(ei.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function Uc(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";var t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}return"function"==typeof e?"a function":Jr()}function Vc(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new ti(ei.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Uc(e);throw new ti(ei.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}return e}var jc=function(){function e(t){var n,r;if((0,v.Z)(this,e),void 0===t.host){if(void 0!==t.ssl)throw new ti(ei.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(n=t.ssl)||void 0===n||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new ti(ei.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new ti(ei.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))})("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Oc(null!==(r=t.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new ti(ei.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new ti(ei.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new ti(ei.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}return(0,p.Z)(e,[{key:"isEqual",value:function(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}]),e}(),qc=function(){function e(t,n,r,i){(0,v.Z)(this,e),this._authCredentials=t,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new jc({}),this._settingsFrozen=!1}return(0,p.Z)(e,[{key:"app",get:function(){if(!this._app)throw new ti(ei.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}},{key:"_initialized",get:function(){return this._settingsFrozen}},{key:"_terminated",get:function(){return void 0!==this._terminateTask}},{key:"_setSettings",value:function(e){if(this._settingsFrozen)throw new ti(ei.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new jc(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new ii;switch(e.type){case"firstParty":return new ui(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new ti(ei.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}},{key:"_getSettings",value:function(){return this._settings}},{key:"_freezeSettings",value:function(){return this._settingsFrozen=!0,this._settings}},{key:"_delete",value:function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}},{key:"toJSON",value:function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}},{key:"_terminate",value:function(){return function(e){var t=Lc.get(e);t&&(Kr("ComponentProvider","Removing Datastore"),Lc.delete(e),t.terminate())}(this),Promise.resolve()}}]),e}();function Bc(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=(e=Vc(e,qc))._getSettings(),o="".concat(t,":").concat(n);if("firestore.googleapis.com"!==a.host&&a.host!==o&&Yr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},a),{host:o,ssl:!1})),i.mockUserToken){var s,u;if("string"==typeof i.mockUserToken)s=i.mockUserToken,u=Br.MOCK_USER;else{s=(0,w.Sg)(i.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);var c=i.mockUserToken.sub||i.mockUserToken.user_id;if(!c)throw new ti(ei.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new Br(c)}e._authCredentials=new ai(new ri(s,u))}}var zc=function(){function e(t,n,r){(0,v.Z)(this,e),this.converter=n,this._query=r,this.type="query",this.firestore=t}return(0,p.Z)(e,[{key:"withConverter",value:function(t){return new e(this.firestore,t,this._query)}}]),e}(),Hc=function(){function e(t,n,r){(0,v.Z)(this,e),this.converter=n,this._key=r,this.type="document",this.firestore=t}return(0,p.Z)(e,[{key:"_path",get:function(){return this._key.path}},{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"path",get:function(){return this._key.path.canonicalString()}},{key:"parent",get:function(){return new Wc(this.firestore,this.converter,this._key.path.popLast())}},{key:"withConverter",value:function(t){return new e(this.firestore,t,this._key)}}]),e}(),Wc=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,i){var a;return(0,v.Z)(this,n),(a=t.call(this,e,r,io(i)))._path=i,a.type="collection",a}return(0,p.Z)(n,[{key:"id",get:function(){return this._query.path.lastSegment()}},{key:"path",get:function(){return this._query.path.canonicalString()}},{key:"parent",get:function(){var e=this._path.popLast();return e.isEmpty()?null:new Hc(this.firestore,null,new wi(e))}},{key:"withConverter",value:function(e){return new n(this.firestore,e,this._path)}}]),n}(zc);function Kc(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,w.m9)(e),1===arguments.length&&(t=fi.newId()),Mc("doc","path",t),e instanceof qc){var a=mi.fromString.apply(mi,[t].concat(r));return Fc(a),new Hc(e,null,new wi(a))}if(!(e instanceof Hc||e instanceof Wc))throw new ti(ei.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=e._path.child(mi.fromString.apply(mi,[t].concat(r)));return Fc(o),new Hc(e.firestore,e instanceof Wc?e.converter:null,new wi(o))}var Gc=function(){function e(){var t=this;(0,v.Z)(this,e),this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new Eu(this,"async_queue_retry"),this._u=function(){var e=bu();e&&Kr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.jo.Ko()};var n=bu();n&&"function"==typeof n.addEventListener&&n.addEventListener("visibilitychange",this._u)}return(0,p.Z)(e,[{key:"isShuttingDown",get:function(){return this.tu}},{key:"enqueueAndForget",value:function(e){this.enqueue(e)}},{key:"enqueueAndForgetEvenWhileRestricted",value:function(e){this.au(),this.uu(e)}},{key:"enterRestrictedMode",value:function(e){if(!this.tu){this.tu=!0,this.su=e||!1;var t=bu();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._u)}}},{key:"enqueue",value:function(e){var t=this;if(this.au(),this.tu)return new Promise((function(){}));var n=new ni;return this.uu((function(){return t.tu&&t.su?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)})).then((function(){return n.promise}))}},{key:"enqueueRetryable",value:function(e){var t=this;this.enqueueAndForget((function(){return t.eu.push(e),t.cu()}))}},{key:"cu",value:function(){var e=(0,l.Z)(g().mark((function e(){var t=this;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===this.eu.length){e.next=14;break}return e.prev=1,e.next=4,this.eu[0]();case 4:this.eu.shift(),this.jo.reset(),e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(1),Li(e.t0)){e.next=12;break}throw e.t0;case 12:Kr("AsyncQueue","Operation failed with retryable error: "+e.t0);case 13:this.eu.length>0&&this.jo.qo((function(){return t.cu()}));case 14:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"uu",value:function(e){var t=this,n=this.Xa.then((function(){return t.iu=!0,e().catch((function(e){t.ru=e,t.iu=!1;var n=function(e){var t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Gr("INTERNAL UNHANDLED ERROR: ",n),e})).then((function(e){return t.iu=!1,e}))}));return this.Xa=n,n}},{key:"enqueueAfterDelay",value:function(e,t,n){var r=this;this.au(),this.ou.indexOf(e)>-1&&(t=0);var i=rc.createAndSchedule(this,e,t,n,(function(e){return r.lu(e)}));return this.nu.push(i),i}},{key:"au",value:function(){this.ru&&Jr()}},{key:"verifyOperationInProgress",value:function(){}},{key:"hu",value:function(){var e=(0,l.Z)(g().mark((function e(){var t;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.Xa,e.next=3,t;case 3:if(t!==this.Xa){e.next=0;break}case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Pu",value:function(e){var t,n=(0,c.Z)(this.nu);try{for(n.s();!(t=n.n()).done;){if(t.value.timerId===e)return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"Iu",value:function(e){var t=this;return this.hu().then((function(){t.nu.sort((function(e,t){return e.targetTimeMs-t.targetTimeMs}));var n,r=(0,c.Z)(t.nu);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.skipDelay(),"all"!==e&&i.timerId===e)break}}catch(a){r.e(a)}finally{r.f()}return t.hu()}))}},{key:"Tu",value:function(e){this.ou.push(e)}},{key:"lu",value:function(e){var t=this.nu.indexOf(e);this.nu.splice(t,1)}}]),e}();var Yc=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,i,a){var o;return(0,v.Z)(this,n),(o=t.call(this,e,r,i,a)).type="firestore",o._queue=new Gc,o._persistenceKey=(null==a?void 0:a.name)||"[DEFAULT]",o}return(0,p.Z)(n,[{key:"_terminate",value:function(){return this._firestoreClient||Xc(this),this._firestoreClient.terminate()}}]),n}(qc);function Qc(e,t){var n="object"==typeof e?e:(0,m.Mq)(),r="string"==typeof e?e:t||"(default)",i=(0,m.qX)(n,"firestore").getImmediate({identifier:r});if(!i._initialized){var a=(0,w.P0)("firestore");a&&Bc.apply(void 0,[i].concat((0,d.Z)(a)))}return i}function Jc(e){return e._firestoreClient||Xc(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Xc(e){var t,n,r,i=e._freezeSettings(),a=function(e,t,n,r){return new fa(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Oc(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new Ec(e._authCredentials,e._appCheckCredentials,e._queue,a),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}var $c=function(){function e(t){(0,v.Z)(this,e),this._byteString=t}return(0,p.Z)(e,[{key:"toBase64",value:function(){return this._byteString.toBase64()}},{key:"toUint8Array",value:function(){return this._byteString.toUint8Array()}},{key:"toString",value:function(){return"Bytes(base64: "+this.toBase64()+")"}},{key:"isEqual",value:function(e){return this._byteString.isEqual(e._byteString)}}],[{key:"fromBase64String",value:function(t){try{return new e(ia.fromBase64String(t))}catch(t){throw new ti(ei.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}},{key:"fromUint8Array",value:function(t){return new e(ia.fromUint8Array(t))}}]),e}(),el=function(){function e(){(0,v.Z)(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0;i<n.length;++i)if(0===n[i].length)throw new ti(ei.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ki(n)}return(0,p.Z)(e,[{key:"isEqual",value:function(e){return this._internalPath.isEqual(e._internalPath)}}]),e}();var tl=(0,p.Z)((function e(t){(0,v.Z)(this,e),this._methodName=t})),nl=function(){function e(t,n){if((0,v.Z)(this,e),!isFinite(t)||t<-90||t>90)throw new ti(ei.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new ti(ei.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}return(0,p.Z)(e,[{key:"latitude",get:function(){return this._lat}},{key:"longitude",get:function(){return this._long}},{key:"isEqual",value:function(e){return this._lat===e._lat&&this._long===e._long}},{key:"toJSON",value:function(){return{latitude:this._lat,longitude:this._long}}},{key:"_compareTo",value:function(e){return di(this._lat,e._lat)||di(this._long,e._long)}}]),e}(),rl=/^__.*__$/,il=function(){function e(t,n,r){(0,v.Z)(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return(0,p.Z)(e,[{key:"toMutation",value:function(e,t){return null!==this.fieldMask?new rs(e,this.data,this.fieldMask,t,this.fieldTransforms):new ns(e,this.data,t,this.fieldTransforms)}}]),e}();function al(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Jr()}}var ol=function(){function e(t,n,r,i,a,o){(0,v.Z)(this,e),this.settings=t,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,void 0===a&&this.Eu(),this.fieldTransforms=a||[],this.fieldMask=o||[]}return(0,p.Z)(e,[{key:"path",get:function(){return this.settings.path}},{key:"du",get:function(){return this.settings.du}},{key:"Au",value:function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}},{key:"Ru",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Au({path:n,Vu:!1});return r.mu(e),r}},{key:"fu",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Au({path:n,Vu:!1});return r.Eu(),r}},{key:"gu",value:function(e){return this.Au({path:void 0,Vu:!0})}},{key:"pu",value:function(e){return gl(e,this.settings.methodName,this.settings.yu||!1,this.path,this.settings.wu)}},{key:"contains",value:function(e){return void 0!==this.fieldMask.find((function(t){return e.isPrefixOf(t)}))||void 0!==this.fieldTransforms.find((function(t){return e.isPrefixOf(t.field)}))}},{key:"Eu",value:function(){if(this.path)for(var e=0;e<this.path.length;e++)this.mu(this.path.get(e))}},{key:"mu",value:function(e){if(0===e.length)throw this.pu("Document fields must not be empty");if(al(this.du)&&rl.test(e))throw this.pu('Document fields cannot begin and end with "__"')}}]),e}(),sl=function(){function e(t,n,r){(0,v.Z)(this,e),this.databaseId=t,this.ignoreUndefinedProperties=n,this.serializer=r||Iu(t)}return(0,p.Z)(e,[{key:"Su",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new ol({du:e,methodName:t,wu:n,path:ki.emptyPath(),Vu:!1,yu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}]),e}();function ul(e){var t=e._freezeSettings(),n=Iu(e._databaseId);return new sl(e._databaseId,!!t.ignoreUndefinedProperties,n)}function cl(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=e.Su(a.merge||a.mergeFields?2:0,t,n,i);dl("Data must be an object, but it was:",o,r);var s,u,l=hl(r,o);if(a.merge)s=new na(o.fieldMask),u=o.fieldTransforms;else if(a.mergeFields){var h,f=[],d=(0,c.Z)(a.mergeFields);try{for(d.s();!(h=d.n()).done;){var v=h.value,p=vl(t,v,n);if(!o.contains(p))throw new ti(ei.INVALID_ARGUMENT,"Field '".concat(p,"' is specified in your field mask but missing from your input data."));ml(f,p)||f.push(p)}}catch(y){d.e(y)}finally{d.f()}s=new na(f),u=o.fieldTransforms.filter((function(e){return s.covers(e.field)}))}else s=null,u=o.fieldTransforms;return new il(new Sa(l),s,u)}function ll(e,t){if(fl(e=(0,w.m9)(e)))return dl("Unsupported field value:",t,e),hl(e,t);if(e instanceof tl)return function(e,t){if(!al(t.du))throw t.pu("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.pu("".concat(e._methodName,"() is not currently supported inside arrays"));var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Vu&&4!==t.du)throw t.pu("Nested arrays are not supported");return function(e,t){var n,r=[],i=0,a=(0,c.Z)(e);try{for(a.s();!(n=a.n()).done;){var o=ll(n.value,t.gu(i));null==o&&(o={nullValue:"NULL_VALUE"}),r.push(o),i++}}catch(s){a.e(s)}finally{a.f()}return{arrayValue:{values:r}}}(e,t)}return function(e,t){if(null===(e=(0,w.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Do(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=pi.fromDate(e);return{timestampValue:gs(t.serializer,n)}}if(e instanceof pi){var r=new pi(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:gs(t.serializer,r)}}if(e instanceof nl)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof $c)return{bytesValue:ms(t.serializer,e._byteString)};if(e instanceof Hc){var i=t.databaseId,a=e.firestore._databaseId;if(!a.isEqual(i))throw t.pu("Document reference is for database ".concat(a.projectId,"/").concat(a.database," but should be for database ").concat(i.projectId,"/").concat(i.database));return{referenceValue:ws(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.pu("Unsupported field value: ".concat(Uc(e)))}(e,t)}function hl(e,t){var n={};return Qi(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Yi(e,(function(e,r){var i=ll(r,t.Ru(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function fl(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof pi||e instanceof nl||e instanceof $c||e instanceof Hc||e instanceof tl)}function dl(e,t,n){if(!fl(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){var r=Uc(n);throw"an object"===r?t.pu(e+" a custom object"):t.pu(e+" "+r)}}function vl(e,t,n){if((t=(0,w.m9)(t))instanceof el)return t._internalPath;if("string"==typeof t)return yl(e,t);throw gl("Field path arguments must be of type string or ",e,!1,void 0,n)}var pl=new RegExp("[~\\*/\\[\\]]");function yl(e,t,n){if(t.search(pl)>=0)throw gl("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return(0,i.Z)(el,(0,d.Z)(t.split(".")))._internalPath}catch(D){throw gl("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function gl(e,t,n,r,i){var a=r&&!r.isEmpty(),o=void 0!==i,s="Function ".concat(t,"() called with invalid data");n&&(s+=" (via `toFirestore()`)"),s+=". ";var u="";return(a||o)&&(u+=" (found",a&&(u+=" in field ".concat(r)),o&&(u+=" in document ".concat(i)),u+=")"),new ti(ei.INVALID_ARGUMENT,s+e+u)}function ml(e,t){return e.some((function(e){return e.isEqual(t)}))}function _l(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}function kl(e,t,n){e=Vc(e,Hc);var r=Vc(e.firestore,Yc),i=_l(e.converter,t,n);return wl(r,[cl(ul(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Go.none())])}function wl(e,t){return function(e,t){var n=new ni;return e.asyncQueue.enqueueAndForget((0,l.Z)(g().mark((function r(){return g().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=uc,r.next=3,Dc(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(Jc(e),t)}new WeakMap;!function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){zr=e}(m.Jn),(0,m.Xd)(new _.wA("firestore",(function(e,n){var r=n.instanceIdentifier,i=n.options,a=e.getProvider("app").getImmediate(),o=new Yc(new oi(e.getProvider("auth-internal")),new li(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new ti(ei.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new da(e.options.projectId,t)}(a,r),a);return i=Object.assign({useFetchStreams:t},i),o._setSettings(i),o}),"PUBLIC").setMultipleInstances(!0)),(0,m.KN)(qr,"4.4.3",e),(0,m.KN)(qr,"4.4.3","esm2017")}()}}]);
//# sourceMappingURL=935.3b37ff96.chunk.js.map